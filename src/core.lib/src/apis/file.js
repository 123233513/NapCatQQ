function _0x1b92(_0x49f754,_0x5e2cd1){const _0x1c5b3f=_0x1c5b();return _0x1b92=function(_0x1b927f,_0x531dc5){_0x1b927f=_0x1b927f-0xec;let _0x5eeae9=_0x1c5b3f[_0x1b927f];return _0x5eeae9;},_0x1b92(_0x49f754,_0x5e2cd1);}const _0x1c867d=_0x1b92;(function(_0x25cf70,_0xe9e120){const _0x11e6a4=_0x1b92,_0x410edb=_0x25cf70();while(!![]){try{const _0x203e71=parseInt(_0x11e6a4(0x10d))/0x1*(-parseInt(_0x11e6a4(0x12a))/0x2)+-parseInt(_0x11e6a4(0xf4))/0x3*(-parseInt(_0x11e6a4(0x13b))/0x4)+parseInt(_0x11e6a4(0xee))/0x5*(-parseInt(_0x11e6a4(0x11f))/0x6)+parseInt(_0x11e6a4(0x119))/0x7+parseInt(_0x11e6a4(0x104))/0x8*(parseInt(_0x11e6a4(0xef))/0x9)+parseInt(_0x11e6a4(0xfa))/0xa*(-parseInt(_0x11e6a4(0xf1))/0xb)+parseInt(_0x11e6a4(0x137))/0xc*(parseInt(_0x11e6a4(0x133))/0xd);if(_0x203e71===_0xe9e120)break;else _0x410edb['push'](_0x410edb['shift']());}catch(_0x47f6d2){_0x410edb['push'](_0x410edb['shift']());}}}(_0x1c5b,0x87443));import{ElementType,IMAGE_HTTP_HOST,IMAGE_HTTP_HOST_NT}from'@/core/entities';import _0x18f25d from'path';import _0x1bf9f9 from'fs';import _0x57fcf4 from'fs/promises';import{logDebug}from'@/common/utils/log';import{napCatCore}from'@/core';import{calculateFileMD5}from'@/common/utils/file';import*as _0x3668e9 from'file-type';import{MsgListener}from'@/core/listeners';import _0x9fe3ab from'image-size';import{sessionConfig}from'@/core/sessionConfig';import{randomUUID}from'crypto';import{rkeyManager}from'../utils/rkey';function _0x1c5b(){const _0x27a3a4=['set','startsWith','下载超时','msgId','start\x20downloadMedia','3108VQHJTd','clearCacheDataByKeys','LVyKi','originImageUrl','&rkey=','onLoginSuccess','PNnKr','fileTypeFromFile','getChatCacheList','getDesktopTmpPath','scanCache','addCacheScanedPaths','5850943VWVEfR','modhc','getStorageCleanService','getFileSize','toUpperCase','sWRZh','66wEIaHY','downloadMedia','receive\x20downloadMedia\x20task','downloadRichMedia','join','zGZME','vXSIU','OpJoQ','getRkey','getCacheSessionPathList','group_rkey','88TGkifp','TcVAc','downloadPath','getRichMediaFilePathForGuild','filePath','basename','md5HexStr','UTwDy','getMsgService','44382HcxYYr','RduXP','tmp','qAtDS','432Yeprxz','addListener','includes','downloadMedia\x20complete','116528hbNQFG','tGnaS','fileUuid','hotUpdate','getHotUpdateCachePath','442415WSVsmz','9gsCsaW','addCacheScannedPaths','73359dXieeZ','getFileCacheInfo','akwaV','39nhfawn','/download','ext','getChatCacheInfo','onRichMediaDownloadComplete','PIC','290ZyOGNy','spSPo','oGvGG','clearChatCache','uploadFile','session','private_rkey','eALVc','defaultFileDownloadPath','getFileType','4160384snZFNu','Fkhrd','copyFile','existsSync'];_0x1c5b=function(){return _0x27a3a4;};return _0x1c5b();}import{AsyncQueue}from'@/common/utils/AsyncQueue';const getRKeyTaskQueue=new AsyncQueue(),downloadMediaTasks=new Map(),downloadMediaListener=new MsgListener();downloadMediaListener[_0x1c867d(0xf8)]=_0x33ecab=>{for(const [_0x4274a6,_0x35bee6]of downloadMediaTasks){_0x35bee6(_0x33ecab),downloadMediaTasks['delete'](_0x4274a6);}},setTimeout(()=>{const _0x484771=_0x1c867d;napCatCore[_0x484771(0x112)](()=>{const _0x19315c=_0x484771;napCatCore[_0x19315c(0x138)](downloadMediaListener);});},0x64);export class NTQQFileApi{static async[_0x1c867d(0x103)](_0xdee063){const _0x3374cf=_0x1c867d;return _0x3668e9[_0x3374cf(0x114)](_0xdee063);}static async[_0x1c867d(0x106)](_0xf4ce2c,_0x59c9ae){const _0x4beadf=_0x1c867d;await napCatCore['util'][_0x4beadf(0x106)](_0xf4ce2c,_0x59c9ae);}static async['getFileSize'](_0x3bf14b){const _0x5e6f3b=_0x1c867d;return await napCatCore['util'][_0x5e6f3b(0x11c)](_0x3bf14b);}static async[_0x1c867d(0xfe)](_0x5af51e,_0x17e59e=ElementType[_0x1c867d(0xf9)],_0x1eae80=0x0){const _0x752ada=_0x1c867d,_0x342caa={'eALVc':function(_0x7981aa,_0x5b6594){return _0x7981aa(_0x5b6594);},'spSPo':function(_0x573631,_0x282016){return _0x573631===_0x282016;}},_0x4974bc=await _0x342caa[_0x752ada(0x101)](calculateFileMD5,_0x5af51e);let _0x21be70=(await NTQQFileApi[_0x752ada(0x103)](_0x5af51e))?.[_0x752ada(0xf6)]||'';_0x21be70&&(_0x21be70='.'+_0x21be70);let _0x252ff2=''+_0x18f25d[_0x752ada(0x12f)](_0x5af51e);_0x342caa[_0x752ada(0xfb)](_0x252ff2['indexOf']('.'),-0x1)&&(_0x252ff2+=_0x21be70);const _0x1b33ae=napCatCore[_0x752ada(0xff)][_0x752ada(0x132)]()[_0x752ada(0x12d)]({'md5HexStr':_0x4974bc,'fileName':_0x252ff2,'elementType':_0x17e59e,'elementSubType':_0x1eae80,'thumbSize':0x0,'needCreate':!![],'downloadType':0x1,'file_uuid':''});await NTQQFileApi['copyFile'](_0x5af51e,_0x1b33ae);const _0x2c612b=await NTQQFileApi[_0x752ada(0x11c)](_0x5af51e);return{'md5':_0x4974bc,'fileName':_0x252ff2,'path':_0x1b33ae,'fileSize':_0x2c612b,'ext':_0x21be70};}static async[_0x1c867d(0x120)](_0xf56b3b,_0x106a46,_0x406d0f,_0x5a0e8d,_0x255798,_0x14eb84,_0x56740e=0x3e8*0x3c*0x2,_0x578f5b=![]){const _0xd556fe=_0x1c867d,_0x555a8e={'akwaV':function(_0x7ad60e,_0x2f6a9c){return _0x7ad60e(_0x2f6a9c);},'vXSIU':function(_0x48497,_0xb57704){return _0x48497===_0xb57704;},'eRsOT':function(_0x32728a,_0x23a4ec){return _0x32728a(_0x23a4ec);},'OpJoQ':function(_0x5da5fe){return _0x5da5fe();},'tGnaS':function(_0x488fcb,_0x4bcea9,_0xbd975c){return _0x488fcb(_0x4bcea9,_0xbd975c);},'sWRZh':function(_0x33a7b1,_0xb20ae3,_0x47c9dd,_0x35b9a9,_0x8eca4a,_0x503319,_0x2c3b99,_0x5ea604,_0x435d2e,_0x6ea456){return _0x33a7b1(_0xb20ae3,_0x47c9dd,_0x35b9a9,_0x8eca4a,_0x503319,_0x2c3b99,_0x5ea604,_0x435d2e,_0x6ea456);},'UTwDy':_0xd556fe(0x121),'PNnKr':_0xd556fe(0x10c)};_0x555a8e[_0xd556fe(0x11e)](logDebug,_0x555a8e[_0xd556fe(0x131)],_0xf56b3b,_0x106a46,_0x406d0f,_0x5a0e8d,_0x255798,_0x14eb84,_0x56740e,_0x578f5b);if(_0x14eb84&&_0x1bf9f9[_0xd556fe(0x107)](_0x14eb84)){if(_0x578f5b)try{await _0x57fcf4['unlink'](_0x14eb84);}catch(_0x58993b){}else return _0x14eb84;}return logDebug(_0x555a8e[_0xd556fe(0x113)],_0xf56b3b,_0x106a46,_0x406d0f,_0x5a0e8d,_0x255798,_0x14eb84,_0x56740e,_0x578f5b),new Promise((_0x5bcec3,_0x59cd70)=>{const _0x2bc26c=_0xd556fe,_0x45bc58={'cSukk':function(_0x348055,_0x32ad7b,_0x2377f5,_0x150634){return _0x348055(_0x32ad7b,_0x2377f5,_0x150634);},'Fkhrd':_0x2bc26c(0x13a),'LVyKi':function(_0x3d98bb,_0x49487b){const _0x160ff5=_0x2bc26c;return _0x555a8e[_0x160ff5(0x125)](_0x3d98bb,_0x49487b);},'modhc':_0x2bc26c(0x12c),'TcVAc':function(_0x77a7a1,_0x48f4a0){return _0x555a8e['eRsOT'](_0x77a7a1,_0x48f4a0);}};let _0x5c09fe=![];const _0x54df30=_0x399614=>{const _0x5336d7=_0x2bc26c;_0x45bc58['cSukk'](logDebug,_0x45bc58[_0x5336d7(0x105)],_0x399614,_0xf56b3b);if(_0x45bc58[_0x5336d7(0x10f)](_0x399614[_0x5336d7(0x10b)],_0xf56b3b)){_0x5c09fe=!![];let _0x4b138f=_0x399614[_0x5336d7(0x12e)];if(_0x4b138f[_0x5336d7(0x109)]('\x5c')){const _0x437bc9=sessionConfig[_0x5336d7(0x102)];logDebug(_0x45bc58[_0x5336d7(0x11a)],_0x437bc9),_0x4b138f=_0x18f25d[_0x5336d7(0x123)](_0x437bc9,_0x4b138f);}_0x45bc58[_0x5336d7(0x12b)](_0x5bcec3,_0x4b138f);}};downloadMediaTasks[_0x2bc26c(0x108)](_0x555a8e[_0x2bc26c(0x126)](randomUUID),_0x54df30),_0x555a8e[_0x2bc26c(0x13c)](setTimeout,()=>{const _0x1e7dbb=_0x2bc26c;!_0x5c09fe&&_0x555a8e[_0x1e7dbb(0xf3)](_0x59cd70,_0x1e7dbb(0x10a));},_0x56740e),napCatCore[_0x2bc26c(0xff)][_0x2bc26c(0x132)]()[_0x2bc26c(0x122)]({'fileModelId':'0','downloadSourceType':0x0,'triggerType':0x1,'msgId':_0xf56b3b,'chatType':_0x106a46,'peerUid':_0x406d0f,'elementId':_0x5a0e8d,'thumbSize':0x0,'downloadType':0x1,'filePath':_0x255798});});}static async['getImageSize'](_0x169dc8){const _0x8a697b={'zGZME':function(_0x1cbbe1,_0x257441){return _0x1cbbe1(_0x257441);}};return new Promise((_0x67439,_0x598f4)=>{_0x9fe3ab(_0x169dc8,(_0x1e89d2,_0x31a3ca)=>{const _0x54568a=_0x1b92;_0x1e89d2?_0x8a697b[_0x54568a(0x124)](_0x598f4,_0x1e89d2):_0x8a697b[_0x54568a(0x124)](_0x67439,_0x31a3ca);});});}static async['getImageUrl'](_0x175851,_0x40898e){const _0x28d8fb=_0x1c867d,_0x1030a7={'RduXP':_0x28d8fb(0xf5),'qAtDS':function(_0x4a073b,_0x203a79){return _0x4a073b+_0x203a79;},'FzcCQ':function(_0x4501d9,_0x39f7f1){return _0x4501d9+_0x39f7f1;},'yNOlD':function(_0x2e9952,_0x3a3090){return _0x2e9952+_0x3a3090;},'oGvGG':function(_0x4a6cd3,_0x52f775){return _0x4a6cd3||_0x52f775;}};if(!_0x175851)return'';const _0x342bbe=_0x175851[_0x28d8fb(0x110)],_0x4b5f8b=_0x175851['md5HexStr'],_0x298683=_0x175851[_0x28d8fb(0x130)],_0x1d4bb1=_0x175851[_0x28d8fb(0x13d)];if(_0x342bbe){if(_0x342bbe['startsWith'](_0x1030a7[_0x28d8fb(0x134)])){if(_0x342bbe[_0x28d8fb(0x139)](_0x28d8fb(0x111)))return _0x1030a7[_0x28d8fb(0x136)](IMAGE_HTTP_HOST_NT,_0x342bbe);const _0x5977dc=await rkeyManager[_0x28d8fb(0x127)](),_0x5c008f=_0x40898e?_0x5977dc[_0x28d8fb(0x100)]:_0x5977dc[_0x28d8fb(0x129)];return _0x1030a7['FzcCQ'](IMAGE_HTTP_HOST_NT+_0x342bbe,''+_0x5c008f);}else return _0x1030a7['yNOlD'](IMAGE_HTTP_HOST,_0x342bbe);}else{if(_0x1030a7[_0x28d8fb(0xfc)](_0x298683,_0x4b5f8b))return IMAGE_HTTP_HOST+'/gchatpic_new/0/0-0-'+_0x1030a7[_0x28d8fb(0xfc)](_0x298683,_0x4b5f8b)[_0x28d8fb(0x11d)]()+'/0';}return logDebug('图片url获取失败',_0x175851),'';}}export class NTQQFileCacheApi{static async['setCacheSilentScan'](_0x1b5ddd=!![]){return'';}static[_0x1c867d(0x128)](){return'';}static['clearCache'](_0x27fe48=[_0x1c867d(0x135),_0x1c867d(0xec)]){const _0xdf24b0=_0x1c867d;return napCatCore[_0xdf24b0(0xff)][_0xdf24b0(0x11b)]()[_0xdf24b0(0x10e)](_0x27fe48);}static[_0x1c867d(0xf0)](_0x390d51={}){const _0x670deb=_0x1c867d;return napCatCore['session']['getStorageCleanService']()[_0x670deb(0x118)](_0x390d51);}static[_0x1c867d(0x117)](){const _0x5f576e=_0x1c867d;return napCatCore[_0x5f576e(0xff)]['getStorageCleanService']()['scanCache']();}static[_0x1c867d(0xed)](){return'';}static[_0x1c867d(0x116)](){return'';}static[_0x1c867d(0x115)](_0x21ddb2,_0x171380=0x3e8,_0x3ffa95=0x0){const _0x45afcc=_0x1c867d;return napCatCore[_0x45afcc(0xff)][_0x45afcc(0x11b)]()[_0x45afcc(0xf7)](_0x21ddb2,_0x171380,0x1,_0x3ffa95);}static[_0x1c867d(0xf2)](_0x1cb764,_0xb4db38=0x3e8,_0x10445d){const _0x513666=_0x10445d?_0x10445d:{'fileType':_0x1cb764};}static async[_0x1c867d(0xfd)](_0x3fb81a=[],_0x21409e=[]){const _0x2b6fd9=_0x1c867d;return napCatCore[_0x2b6fd9(0xff)]['getStorageCleanService']()['clearChatCacheInfo'](_0x3fb81a,_0x21409e);}}