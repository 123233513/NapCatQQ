function _0x5ad4(){const _0x2f7f5a=['scanCache','7832wVzElX','getChatCacheList','aSUau','getDesktopTmpPath','BOMvu','getRichMediaFilePathForGuild','addCacheScannedPaths','ext','12MPPpAK','getStorageCleanService','basename','getFileCacheInfo','RmIge','下载超时','msgId','OODvw','vQFRU','jSkOL','56796kbBkXd','1499286uxsaSP','filePath','originImageUrl','util','onRichMediaDownloadComplete','14031vDkieT','2216ZhBaIj','getFileType','clearChatCacheInfo','startsWith','2136dVEpVP','10280huCVmO','1313465CKMPPt','toUpperCase','downloadMedia','md5HexStr','delete','copyFile','indexOf','27835KcmQvP','addCacheScanedPaths','downloadRichMedia','VxzMw','group_rkey','session','onLoginSuccess','mqAOP','join','wstBV','addListener','fileTypeFromFile','setCacheSilentScan','35VFbAMP','hpCVb','QqNBH','defaultFileDownloadPath','set','getMsgService','sjfZf','151450FNSsdy','getFileSize','getImageUrl','20uGGquv','getChatCacheInfo','tmp','getRkey','/download','private_rkey','EMlmo','图片url获取失败','getImageSize','existsSync','wqqCK','WFVPP'];_0x5ad4=function(){return _0x2f7f5a;};return _0x5ad4();}const _0xca6636=_0x1ba9;(function(_0x4dfb9c,_0x4256ea){const _0x16c211=_0x1ba9,_0x147a5d=_0x4dfb9c();while(!![]){try{const _0x1d5bf1=-parseInt(_0x16c211(0x1fd))/0x1+parseInt(_0x16c211(0x1e9))/0x2*(-parseInt(_0x16c211(0x229))/0x3)+-parseInt(_0x16c211(0x214))/0x4*(parseInt(_0x16c211(0x1f6))/0x5)+-parseInt(_0x16c211(0x1ea))/0x6*(-parseInt(_0x16c211(0x20a))/0x7)+-parseInt(_0x16c211(0x1f0))/0x8*(parseInt(_0x16c211(0x1ef))/0x9)+parseInt(_0x16c211(0x1f5))/0xa*(-parseInt(_0x16c211(0x221))/0xb)+parseInt(_0x16c211(0x1f4))/0xc*(parseInt(_0x16c211(0x211))/0xd);if(_0x1d5bf1===_0x4256ea)break;else _0x147a5d['push'](_0x147a5d['shift']());}catch(_0x3024de){_0x147a5d['push'](_0x147a5d['shift']());}}}(_0x5ad4,0xabfb2));import{ElementType,IMAGE_HTTP_HOST,IMAGE_HTTP_HOST_NT}from'@/core/entities';import _0x314c2d from'path';import _0x3c355c from'fs';function _0x1ba9(_0x4674a8,_0x1d753e){const _0x5ad410=_0x5ad4();return _0x1ba9=function(_0x1ba907,_0x417924){_0x1ba907=_0x1ba907-0x1e4;let _0x555fc7=_0x5ad410[_0x1ba907];return _0x555fc7;},_0x1ba9(_0x4674a8,_0x1d753e);}import _0x14b903 from'fs/promises';import{logDebug}from'@/common/utils/log';import{napCatCore}from'@/core';import{calculateFileMD5}from'@/common/utils/file';import*as _0x156868 from'file-type';import{MsgListener}from'@/core/listeners';import _0x9f914f from'image-size';import{sessionConfig}from'@/core/sessionConfig';import{randomUUID}from'crypto';import{rkeyManager}from'../utils/rkey';import{AsyncQueue}from'@/common/utils/AsyncQueue';const getRKeyTaskQueue=new AsyncQueue(),downloadMediaTasks=new Map(),downloadMediaListener=new MsgListener();downloadMediaListener[_0xca6636(0x1ee)]=_0x1e42dd=>{const _0x13bdef=_0xca6636,_0x380239={'sjfZf':function(_0x265a86,_0x2caea1){return _0x265a86(_0x2caea1);}};for(const [_0x2f592a,_0x165151]of downloadMediaTasks){_0x380239[_0x13bdef(0x210)](_0x165151,_0x1e42dd),downloadMediaTasks[_0x13bdef(0x1fa)](_0x2f592a);}},setTimeout(()=>{const _0x271835=_0xca6636;napCatCore[_0x271835(0x203)](()=>{const _0x478605=_0x271835;napCatCore[_0x478605(0x207)](downloadMediaListener);});},0x64);export class NTQQFileApi{static async[_0xca6636(0x1f1)](_0x139a8e){const _0x558f7f=_0xca6636;return _0x156868[_0x558f7f(0x208)](_0x139a8e);}static async[_0xca6636(0x1fb)](_0xabdcf6,_0x1df4df){const _0x1dfc9a=_0xca6636;await napCatCore[_0x1dfc9a(0x1ed)][_0x1dfc9a(0x1fb)](_0xabdcf6,_0x1df4df);}static async['getFileSize'](_0x1ba46f){const _0x218ce8=_0xca6636;return await napCatCore[_0x218ce8(0x1ed)]['getFileSize'](_0x1ba46f);}static async['uploadFile'](_0x52dc56,_0x64e6e=ElementType['PIC'],_0x1a0297=0x0){const _0x1ac50b=_0xca6636,_0x1a2c35={'vQFRU':function(_0x8d27cc,_0x2b27ce){return _0x8d27cc(_0x2b27ce);},'LLgam':function(_0x3c9ca0,_0x18fb19){return _0x3c9ca0+_0x18fb19;},'mfxtk':function(_0x261e34,_0x267b32){return _0x261e34===_0x267b32;}},_0x15141c=await _0x1a2c35[_0x1ac50b(0x1e7)](calculateFileMD5,_0x52dc56);let _0x40a75b=(await NTQQFileApi[_0x1ac50b(0x1f1)](_0x52dc56))?.[_0x1ac50b(0x228)]||'';_0x40a75b&&(_0x40a75b=_0x1a2c35['LLgam']('.',_0x40a75b));let _0x116a0e=''+_0x314c2d[_0x1ac50b(0x22b)](_0x52dc56);_0x1a2c35['mfxtk'](_0x116a0e[_0x1ac50b(0x1fc)]('.'),-0x1)&&(_0x116a0e+=_0x40a75b);const _0xd29ebc=napCatCore[_0x1ac50b(0x202)]['getMsgService']()[_0x1ac50b(0x226)]({'md5HexStr':_0x15141c,'fileName':_0x116a0e,'elementType':_0x64e6e,'elementSubType':_0x1a0297,'thumbSize':0x0,'needCreate':!![],'downloadType':0x1,'file_uuid':''});await NTQQFileApi[_0x1ac50b(0x1fb)](_0x52dc56,_0xd29ebc);const _0x53d8ee=await NTQQFileApi[_0x1ac50b(0x212)](_0x52dc56);return{'md5':_0x15141c,'fileName':_0x116a0e,'path':_0xd29ebc,'fileSize':_0x53d8ee,'ext':_0x40a75b};}static async[_0xca6636(0x1f8)](_0x3a926b,_0x4e8ac7,_0x11db49,_0x49e0ff,_0x21ad40,_0x476223,_0x102e49=0x3e8*0x3c*0x2,_0x44bab8=![]){const _0x1a3ad0=_0xca6636,_0x4ae1f5={'jSkOL':function(_0x485f4e,_0x29cf78){return _0x485f4e===_0x29cf78;},'heQeu':function(_0x1ffe0f,_0x22d2cc){return _0x1ffe0f(_0x22d2cc);},'EMlmo':_0x1a3ad0(0x1e4),'aSUau':function(_0x35c10f){return _0x35c10f();},'QqNBH':function(_0xf6fd10,_0x5ee224,_0xf848c9){return _0xf6fd10(_0x5ee224,_0xf848c9);}};if(_0x476223&&_0x3c355c[_0x1a3ad0(0x21d)](_0x476223)){if(_0x44bab8)try{await _0x14b903['unlink'](_0x476223);}catch(_0x249832){}else return _0x476223;}return new Promise((_0x57cbe8,_0xd61577)=>{const _0x170a9c=_0x1a3ad0,_0x190824={'wstBV':_0x4ae1f5[_0x170a9c(0x21a)]};let _0x13d0da=![];const _0x5efc37=_0x5a1f46=>{const _0x92706=_0x170a9c;if(_0x4ae1f5[_0x92706(0x1e8)](_0x5a1f46[_0x92706(0x1e5)],_0x3a926b)){_0x13d0da=!![];let _0x1fc030=_0x5a1f46[_0x92706(0x1eb)];if(_0x1fc030[_0x92706(0x1f3)]('\x5c')){const _0x5c8ff2=sessionConfig[_0x92706(0x20d)];_0x1fc030=_0x314c2d[_0x92706(0x205)](_0x5c8ff2,_0x1fc030);}_0x4ae1f5['heQeu'](_0x57cbe8,_0x1fc030);}};downloadMediaTasks[_0x170a9c(0x20e)](_0x4ae1f5[_0x170a9c(0x223)](randomUUID),_0x5efc37),_0x4ae1f5[_0x170a9c(0x20c)](setTimeout,()=>{const _0x4aa11d=_0x170a9c;!_0x13d0da&&_0xd61577(_0x190824[_0x4aa11d(0x206)]);},_0x102e49),napCatCore[_0x170a9c(0x202)][_0x170a9c(0x20f)]()[_0x170a9c(0x1ff)]({'fileModelId':'0','downloadSourceType':0x0,'triggerType':0x1,'msgId':_0x3a926b,'chatType':_0x4e8ac7,'peerUid':_0x11db49,'elementId':_0x49e0ff,'thumbSize':0x0,'downloadType':0x1,'filePath':_0x21ad40});});}static async[_0xca6636(0x21c)](_0x4c3fcf){const _0x5a7f80={'mqAOP':function(_0x385c24,_0x4a0890){return _0x385c24(_0x4a0890);},'VxzMw':function(_0x520598,_0xbb6433,_0x461ad1){return _0x520598(_0xbb6433,_0x461ad1);}};return new Promise((_0x56233b,_0x1acde9)=>{const _0x43fa4d=_0x1ba9,_0x557da3={'wqqCK':function(_0x56c9dd,_0x5595cf){const _0x47ff45=_0x1ba9;return _0x5a7f80[_0x47ff45(0x204)](_0x56c9dd,_0x5595cf);}};_0x5a7f80[_0x43fa4d(0x200)](_0x9f914f,_0x4c3fcf,(_0x2c87ae,_0x369ec9)=>{const _0x24c847=_0x43fa4d;_0x2c87ae?_0x557da3[_0x24c847(0x21e)](_0x1acde9,_0x2c87ae):_0x56233b(_0x369ec9);});});}static async[_0xca6636(0x213)](_0x40855f,_0x45b41b){const _0x382a03=_0xca6636,_0x16fd46={'zDRkF':_0x382a03(0x218),'hpCVb':'&rkey=','OODvw':function(_0x52fcfc,_0x1a2644){return _0x52fcfc+_0x1a2644;},'BOMvu':function(_0x21a39c,_0x2505a2){return _0x21a39c||_0x2505a2;},'xluiJ':function(_0x52873d,_0x5d7737){return _0x52873d||_0x5d7737;},'RmIge':function(_0xdb9ec4,_0x18c412,_0x1428b4){return _0xdb9ec4(_0x18c412,_0x1428b4);},'WFVPP':_0x382a03(0x21b)};if(!_0x40855f)return'';const _0x46de6b=_0x40855f[_0x382a03(0x1ec)],_0x79ad3a=_0x40855f['md5HexStr'],_0x50c3ab=_0x40855f[_0x382a03(0x1f9)],_0x4eb05a=_0x40855f['fileUuid'];if(_0x46de6b){if(_0x46de6b['startsWith'](_0x16fd46['zDRkF'])){if(_0x46de6b['includes'](_0x16fd46[_0x382a03(0x20b)]))return _0x16fd46[_0x382a03(0x1e6)](IMAGE_HTTP_HOST_NT,_0x46de6b);const _0x408fd2=await rkeyManager[_0x382a03(0x217)](),_0x3a6a02=_0x45b41b?_0x408fd2[_0x382a03(0x219)]:_0x408fd2[_0x382a03(0x201)];return IMAGE_HTTP_HOST_NT+_0x46de6b+(''+_0x3a6a02);}else return _0x16fd46[_0x382a03(0x1e6)](IMAGE_HTTP_HOST,_0x46de6b);}else{if(_0x16fd46[_0x382a03(0x225)](_0x50c3ab,_0x79ad3a))return IMAGE_HTTP_HOST+'/gchatpic_new/0/0-0-'+_0x16fd46['xluiJ'](_0x50c3ab,_0x79ad3a)[_0x382a03(0x1f7)]()+'/0';}return _0x16fd46[_0x382a03(0x22d)](logDebug,_0x16fd46[_0x382a03(0x21f)],_0x40855f),'';}}export class NTQQFileCacheApi{static async[_0xca6636(0x209)](_0x56f12b=!![]){return'';}static['getCacheSessionPathList'](){return'';}static['clearCache'](_0x2f28b6=[_0xca6636(0x216),'hotUpdate']){return napCatCore['session']['getStorageCleanService']()['clearCacheDataByKeys'](_0x2f28b6);}static[_0xca6636(0x227)](_0x3e805b={}){const _0x21519c=_0xca6636;return napCatCore[_0x21519c(0x202)]['getStorageCleanService']()[_0x21519c(0x1fe)](_0x3e805b);}static[_0xca6636(0x220)](){const _0x4e4208=_0xca6636;return napCatCore[_0x4e4208(0x202)][_0x4e4208(0x22a)]()[_0x4e4208(0x220)]();}static['getHotUpdateCachePath'](){return'';}static[_0xca6636(0x224)](){return'';}static[_0xca6636(0x222)](_0x2230fc,_0xad0513=0x3e8,_0x298b78=0x0){const _0x18d273=_0xca6636;return napCatCore[_0x18d273(0x202)][_0x18d273(0x22a)]()[_0x18d273(0x215)](_0x2230fc,_0xad0513,0x1,_0x298b78);}static[_0xca6636(0x22c)](_0x4b4177,_0x44a7e1=0x3e8,_0x162607){const _0x5dec87=_0x162607?_0x162607:{'fileType':_0x4b4177};}static async['clearChatCache'](_0x743d7c=[],_0x5988aa=[]){const _0x5b31bc=_0xca6636;return napCatCore[_0x5b31bc(0x202)][_0x5b31bc(0x22a)]()[_0x5b31bc(0x1f2)](_0x743d7c,_0x5988aa);}}