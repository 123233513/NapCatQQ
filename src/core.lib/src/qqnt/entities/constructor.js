const _0x2867da=_0x48f6;function _0x48f6(_0x5ad9d2,_0x43f299){const _0x1391e3=_0x1391();return _0x48f6=function(_0x48f6db,_0x7eea4d){_0x48f6db=_0x48f6db-0x1c0;let _0x1c3f81=_0x1391e3[_0x48f6db];return _0x1c3f81;},_0x48f6(_0x5ad9d2,_0x43f299);}(function(_0x1ed103,_0x53c190){const _0x4ad48b=_0x48f6,_0x3f18a9=_0x1ed103();while(!![]){try{const _0x4766de=-parseInt(_0x4ad48b(0x1f1))/0x1+parseInt(_0x4ad48b(0x1ed))/0x2+parseInt(_0x4ad48b(0x20f))/0x3+parseInt(_0x4ad48b(0x1cf))/0x4*(parseInt(_0x4ad48b(0x20c))/0x5)+parseInt(_0x4ad48b(0x1e1))/0x6+-parseInt(_0x4ad48b(0x1dd))/0x7*(parseInt(_0x4ad48b(0x1f4))/0x8)+-parseInt(_0x4ad48b(0x1ee))/0x9;if(_0x4766de===_0x53c190)break;else _0x3f18a9['push'](_0x3f18a9['shift']());}catch(_0x2a3e4c){_0x3f18a9['push'](_0x3f18a9['shift']());}}}(_0x1391,0xceb3e));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'../entities';import{promises as _0x23b3c3}from'node:fs';import _0x358a6e from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/qqnt/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{log}from'@/common/utils/log';function _0x1391(){const _0x393985=['width','KmHcT','height','stat','28cMtdJP','wmCor','end','text','rps','ARK','MCXPn','获取视频信息失败','npSuI','PTT','toString','PIC','FACE','markdown','10437FaXXKP','unlink','gif','VIDEO','10030254xLCzVk','CSrto','time','error','catch','[骰子]','VSxvH','viNPx','face','PaSNa','vcjiI','writeFile','619282QCiadJ','7078806PuabSX','jpg','video','1494474EoVpCU','REPLY','gRFyp','4328TfIyFJ','uploadFile','HwLdv','Ori','hOeeT','pic','reply','copyFile','normal2','swIIH','文件异常，大小为0','VWCPK','normal','size','WKnEW','fvnJo','ark','ptt','screenshots','lWolL','视频信息','_0.png','TEXT','dice','916785NilbfE','sep','notAt','2008332RHprQc','RGifY','gMeKG','STlvg','ZeqfT','dirname','join','coXHB','Thumb','jySLg','UdTfi','mp4'];_0x1391=function(){return _0x393985;};return _0x1391();}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static[_0x2867da(0x1d2)](_0x375229){const _0x4f07dd=_0x2867da;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x375229,'atType':AtType[_0x4f07dd(0x20e)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x2d181a,_0x1ca98a,_0x9e91f4,_0x2db006){const _0x7a870=_0x2867da;return{'elementType':ElementType[_0x7a870(0x20a)],'elementId':'','textElement':{'content':'@'+_0x2db006,'atType':_0x9e91f4,'atUid':_0x2d181a,'atTinyId':'','atNtUid':_0x1ca98a}};}static[_0x2867da(0x1fa)](_0x5b3cb2,_0x205f47,_0x5a0b33,_0x4fb30e){const _0x556a60=_0x2867da;return{'elementType':ElementType[_0x556a60(0x1f2)],'elementId':'','replyElement':{'replayMsgSeq':_0x5b3cb2,'replayMsgId':_0x205f47,'senderUin':_0x5a0b33,'senderUinStr':_0x4fb30e}};}static async[_0x2867da(0x1f9)](_0x1ac492,_0xfab077='',_0x34bcc4=0x0){const _0x52cebb=_0x2867da,_0x51e53a={'hOeeT':'文件异常，大小为0','coXHB':function(_0x1141f7,_0x8806a8,_0x5c8069){return _0x1141f7(_0x8806a8,_0x5c8069);},'RGifY':'图片信息'},{md5:_0x3540cc,fileName:_0xdb1f1d,path:_0x3f92f5,fileSize:_0x50eb8e}=await NTQQFileApi[_0x52cebb(0x1f5)](_0x1ac492,ElementType['PIC'],_0x34bcc4);if(_0x50eb8e===0x0)throw _0x51e53a[_0x52cebb(0x1f8)];const _0x315487=await NTQQFileApi['getImageSize'](_0x1ac492),_0x152882={'md5HexStr':_0x3540cc,'fileSize':_0x50eb8e[_0x52cebb(0x1d9)](),'picWidth':_0x315487?.[_0x52cebb(0x1cb)],'picHeight':_0x315487?.[_0x52cebb(0x1cd)],'fileName':_0xdb1f1d,'sourcePath':_0x3f92f5,'original':!![],'picType':isGIF(_0x1ac492)?PicType[_0x52cebb(0x1df)]:PicType[_0x52cebb(0x1ef)],'picSubType':_0x34bcc4,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0xfab077};return _0x51e53a[_0x52cebb(0x1c6)](log,_0x51e53a[_0x52cebb(0x1c0)],_0x152882),{'elementType':ElementType[_0x52cebb(0x1da)],'elementId':'','picElement':_0x152882};}static async['file'](_0x36ea37,_0x5125f8=''){const _0x1b7dc2=_0x2867da,_0x4cf3e2={'gRFyp':function(_0x1457a5,_0x2085c1){return _0x1457a5===_0x2085c1;},'VWCPK':_0x1b7dc2(0x1fe),'PaSNa':function(_0x2c437c,_0x1d276c){return _0x2c437c||_0x1d276c;}},{md5:_0x469169,fileName:_0x327d8d,path:_0x759a75,fileSize:_0x37ce37}=await NTQQFileApi[_0x1b7dc2(0x1f5)](_0x36ea37,ElementType['FILE']);if(_0x4cf3e2[_0x1b7dc2(0x1f3)](_0x37ce37,0x0))throw _0x4cf3e2[_0x1b7dc2(0x1ff)];const _0x4c9968={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x4cf3e2[_0x1b7dc2(0x1ea)](_0x5125f8,_0x327d8d),'filePath':_0x759a75,'fileSize':_0x37ce37[_0x1b7dc2(0x1d9)]()}};return _0x4c9968;}static async[_0x2867da(0x1f0)](_0x56e47b,_0x46594d='',_0x10ba11=''){const _0x4d1881=_0x2867da,_0x7785fe={'vcjiI':function(_0x40b6cb,_0x428076){return _0x40b6cb(_0x428076);},'swIIH':function(_0x44731b,_0x393e89){return _0x44731b(_0x393e89);},'CSrto':function(_0x657b44,_0x3a92c4,_0x5c8f30){return _0x657b44(_0x3a92c4,_0x5c8f30);},'VSxvH':_0x4d1881(0x1d1),'lWolL':_0x4d1881(0x1e4),'wmCor':function(_0x3a9bc3,_0x542526){return _0x3a9bc3+_0x542526;},'nmGxI':function(_0x415c00,_0x4470e7){return _0x415c00+_0x4470e7;},'npSuI':function(_0xcfb61e,_0x500146){return _0xcfb61e===_0x500146;},'MCXPn':'path','irgNh':_0x4d1881(0x1ca),'ZeqfT':_0x4d1881(0x1d6),'DDuXN':function(_0x250b9b,_0x3b891a){return _0x250b9b||_0x3b891a;}},{fileName:_0x51661d,path:_0x4ef504,fileSize:_0x1f174d,md5:_0x481a97}=await NTQQFileApi[_0x4d1881(0x1f5)](_0x56e47b,ElementType['VIDEO']);if(_0x7785fe[_0x4d1881(0x1d7)](_0x1f174d,0x0))throw _0x4d1881(0x1fe);const _0x349705=require(_0x7785fe[_0x4d1881(0x1d5)]);let _0x24c629=_0x4ef504['replace'](_0x349705['sep']+_0x4d1881(0x1f7)+_0x349705['sep'],_0x349705[_0x4d1881(0x20d)]+_0x4d1881(0x1c7)+_0x349705[_0x4d1881(0x20d)]);_0x24c629=_0x349705[_0x4d1881(0x1c4)](_0x24c629);let _0x240a0a={'width':0x780,'height':0x438,'time':0xf,'format':_0x7785fe['irgNh'],'size':_0x1f174d,'filePath':_0x56e47b};try{_0x240a0a=await _0x7785fe['vcjiI'](getVideoInfo,_0x4ef504),_0x7785fe[_0x4d1881(0x1e2)](log,_0x4d1881(0x208),_0x240a0a);}catch(_0x524060){log(_0x7785fe[_0x4d1881(0x1c3)],_0x524060);}const _0x5be793=new Promise((_0x13c8d5,_0xf4c8ba)=>{const _0x1eab72=_0x4d1881,_0x1cbefa={'viNPx':function(_0x24b754,_0x2c7df6){const _0x50e67c=_0x48f6;return _0x7785fe[_0x50e67c(0x1fd)](_0x24b754,_0x2c7df6);},'jySLg':function(_0x49de5b,_0x29d7bb){return _0x49de5b(_0x29d7bb);},'HwLdv':function(_0x55a528,_0x47657a,_0x5769ab){const _0x567c89=_0x48f6;return _0x7785fe[_0x567c89(0x1e2)](_0x55a528,_0x47657a,_0x5769ab);},'zvSzr':'获取视频封面失败，使用默认封面'},_0x4a58c3=_0x481a97+_0x1eab72(0x209),_0x1bf55e=_0x349705[_0x1eab72(0x1c5)](_0x24c629,_0x4a58c3);_0x7785fe[_0x1eab72(0x1fd)](_0x358a6e,_0x56e47b)['on'](_0x7785fe[_0x1eab72(0x1e7)],()=>{})['on'](_0x7785fe[_0x1eab72(0x207)],_0x4abd75=>{const _0x335f6a=_0x1eab72,_0x341714={'HSXVW':function(_0x4ac280,_0x283f42){const _0x1f4195=_0x48f6;return _0x1cbefa[_0x1f4195(0x1c8)](_0x4ac280,_0x283f42);}};_0x1cbefa[_0x335f6a(0x1f6)](log,_0x1cbefa['zvSzr'],_0x4abd75),_0x10ba11?_0x23b3c3[_0x335f6a(0x1fb)](_0x10ba11,_0x1bf55e)['then'](()=>{const _0x4925a0=_0x335f6a;_0x1cbefa[_0x4925a0(0x1e8)](_0x13c8d5,_0x1bf55e);})['catch'](_0xf4c8ba):_0x23b3c3[_0x335f6a(0x1ec)](_0x1bf55e,defaultVideoThumb)['then'](()=>{_0x341714['HSXVW'](_0x13c8d5,_0x1bf55e);})[_0x335f6a(0x1e5)](_0xf4c8ba);})[_0x1eab72(0x206)]({'timestamps':[0x0],'filename':_0x4a58c3,'folder':_0x24c629,'size':_0x7785fe[_0x1eab72(0x1d0)](_0x7785fe['nmGxI'](_0x240a0a[_0x1eab72(0x1cb)],'x'),_0x240a0a[_0x1eab72(0x1cd)])})['on'](_0x7785fe[_0x1eab72(0x1e7)],()=>{const _0x36648b=_0x1eab72;_0x7785fe[_0x36648b(0x1eb)](_0x13c8d5,_0x1bf55e);});}),_0x4cf2c7=new Map(),_0x2a74f1=await _0x5be793,_0x255d79=(await _0x23b3c3[_0x4d1881(0x1ce)](_0x2a74f1))[_0x4d1881(0x201)];_0x4cf2c7['set'](0x0,_0x2a74f1);const _0x5651a3=await calculateFileMD5(_0x2a74f1),_0x416fb8={'elementType':ElementType[_0x4d1881(0x1e0)],'elementId':'','videoElement':{'fileName':_0x7785fe['DDuXN'](_0x46594d,_0x51661d),'filePath':_0x4ef504,'videoMd5':_0x481a97,'thumbMd5':_0x5651a3,'fileTime':_0x240a0a[_0x4d1881(0x1e3)],'thumbPath':_0x4cf2c7,'thumbSize':_0x255d79,'thumbWidth':_0x240a0a[_0x4d1881(0x1cb)],'thumbHeight':_0x240a0a[_0x4d1881(0x1cd)],'fileSize':''+_0x1f174d}};return _0x416fb8;}static async[_0x2867da(0x205)](_0x2d39ae){const _0x1b5796=_0x2867da,_0x470baa={'UdTfi':function(_0x192721,_0x2cc65b){return _0x192721(_0x2cc65b);},'STlvg':function(_0x56b9d2,_0x554c7b){return _0x56b9d2===_0x554c7b;},'gMeKG':'文件异常，大小为0','fvnJo':function(_0xea20a6,_0x3586d1){return _0xea20a6||_0x3586d1;}},{converted:_0x538c72,path:_0x2fd510,duration:_0x99c959}=await _0x470baa[_0x1b5796(0x1c9)](encodeSilk,_0x2d39ae),{md5:_0x43891c,fileName:_0x22c6de,path:_0x45b55f,fileSize:_0x232f53}=await NTQQFileApi[_0x1b5796(0x1f5)](_0x2fd510,ElementType[_0x1b5796(0x1d8)]);if(_0x470baa[_0x1b5796(0x1c2)](_0x232f53,0x0))throw _0x470baa[_0x1b5796(0x1c1)];return _0x538c72&&_0x23b3c3[_0x1b5796(0x1de)](_0x2fd510)['then'](),{'elementType':ElementType[_0x1b5796(0x1d8)],'elementId':'','pttElement':{'fileName':_0x22c6de,'filePath':_0x45b55f,'md5HexStr':_0x43891c,'fileSize':_0x232f53,'duration':_0x470baa[_0x1b5796(0x203)](_0x99c959,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x2867da(0x1e9)](_0x2bb9e7){const _0x1adf38=_0x2867da,_0x301298={'ctNDT':function(_0x3b48d5,_0x33822b){return _0x3b48d5<_0x33822b;}};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x2bb9e7,'faceType':_0x301298['ctNDT'](_0x2bb9e7,0xde)?FaceType[_0x1adf38(0x200)]:FaceType[_0x1adf38(0x1fc)]}};}static[_0x2867da(0x20b)](_0x63db1){const _0x4f60=_0x2867da,_0x12abf1={'WKnEW':_0x4f60(0x1e6)};return{'elementType':ElementType[_0x4f60(0x1db)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4f60(0x20b)],'faceType':FaceType[_0x4f60(0x20b)],'faceText':_0x12abf1[_0x4f60(0x202)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2867da(0x1d3)](_0x5f26a8){const _0x40266b=_0x2867da,_0xa5ad8a={'KmHcT':'[包剪锤]'};return{'elementType':ElementType[_0x40266b(0x1db)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0xa5ad8a[_0x40266b(0x1cc)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2867da(0x204)](_0x1ff0e7){const _0x26a480=_0x2867da;return{'elementType':ElementType[_0x26a480(0x1d4)],'elementId':'','arkElement':{'bytesData':_0x1ff0e7,'linkInfo':null,'subElementType':null}};}static[_0x2867da(0x1dc)](_0x117ce5){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x117ce5}};}}