const _0x13f5a8=_0x1f16;(function(_0xee30f1,_0x34968b){const _0x2afa9e=_0x1f16,_0x84b61e=_0xee30f1();while(!![]){try{const _0x2da0c6=-parseInt(_0x2afa9e(0x192))/0x1+-parseInt(_0x2afa9e(0x165))/0x2+parseInt(_0x2afa9e(0x16f))/0x3*(parseInt(_0x2afa9e(0x1a6))/0x4)+-parseInt(_0x2afa9e(0x167))/0x5+-parseInt(_0x2afa9e(0x1aa))/0x6+parseInt(_0x2afa9e(0x19b))/0x7+-parseInt(_0x2afa9e(0x1a0))/0x8*(-parseInt(_0x2afa9e(0x17f))/0x9);if(_0x2da0c6===_0x34968b)break;else _0x84b61e['push'](_0x84b61e['shift']());}catch(_0x4b737e){_0x84b61e['push'](_0x84b61e['shift']());}}}(_0x18a3,0xb6d4f));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'../entities';import{promises as _0x51d468}from'node:fs';function _0x1f16(_0x2d0bba,_0xdcd2c){const _0x18a3d3=_0x18a3();return _0x1f16=function(_0x1f1678,_0x16a8ba){_0x1f1678=_0x1f1678-0x161;let _0x10698d=_0x18a3d3[_0x1f1678];return _0x10698d;},_0x1f16(_0x2d0bba,_0xdcd2c);}import _0x442333 from'fluent-ffmpeg';function _0x18a3(){const _0xa2d529=['uSFlN','_0.png','error','ZlyLa','DMnaj','KTJIk','time','2889JJtzxm','jpg','width','normal2','视频信息','RPS','toString','ARK','gif','FACE','height','GZIFj','nNctJ','normal','face','HsGaJ','NGBiH','PTT','TEXT','1037285LxqYSl','VIDEO','LzkAN','OKcaq','video','[骰子]','uploadFile','Ori','size','9532397yPYdfx','AjwNI','yHBzq','BWcnp','图片信息','31984huabQe','获取视频封面失败，使用默认封面','文件异常，大小为0','notAt','FILE','copyFile','8RqiLlh','file','kCPwD','then','2236674hmNCMg','RoVvv','rps','twrEC','sep','ZAxDh','1881266rYjgVa','screenshots','1805555YeFUir','reply','rBTcI','mp4','path','writeFile','text','获取视频信息失败','1223337OAVtra','Thumb','end','fLLLT','Uexlo','catch','PIC','dirname','replace'];_0x18a3=function(){return _0xa2d529;};return _0x18a3();}import{NTQQFileApi}from'@/core/qqnt/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{log}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static[_0x13f5a8(0x16d)](_0x4e2153){const _0x1ec767=_0x13f5a8;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x4e2153,'atType':AtType[_0x1ec767(0x1a3)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x47d66e,_0x2ffa08,_0x10dda1,_0x762f9f){const _0x2a0f04=_0x13f5a8;return{'elementType':ElementType[_0x2a0f04(0x191)],'elementId':'','textElement':{'content':'@'+_0x762f9f,'atType':_0x10dda1,'atUid':_0x47d66e,'atTinyId':'','atNtUid':_0x2ffa08}};}static[_0x13f5a8(0x168)](_0x438cf4,_0x16900a,_0xffbf80,_0x30830b){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x438cf4,'replayMsgId':_0x16900a,'senderUin':_0xffbf80,'senderUinStr':_0x30830b}};}static async['pic'](_0x1141a6,_0x4fa18b='',_0x123e62=0x0){const _0x5ef1b2=_0x13f5a8,_0xd31729={'ZAxDh':function(_0x359c57,_0x5a1d8e){return _0x359c57===_0x5a1d8e;},'KTJIk':_0x5ef1b2(0x1a2),'nNctJ':function(_0xda3cbd,_0x2b1b89){return _0xda3cbd(_0x2b1b89);},'aFcao':function(_0x2c6330,_0x3fdc71,_0x15b9ed){return _0x2c6330(_0x3fdc71,_0x15b9ed);},'DMnaj':_0x5ef1b2(0x19f)},{md5:_0x1cb8d5,fileName:_0x35615c,path:_0x4471c1,fileSize:_0x43f7d8}=await NTQQFileApi[_0x5ef1b2(0x198)](_0x1141a6,ElementType[_0x5ef1b2(0x175)],_0x123e62);if(_0xd31729[_0x5ef1b2(0x164)](_0x43f7d8,0x0))throw _0xd31729[_0x5ef1b2(0x17d)];const _0x3424f7=await NTQQFileApi['getImageSize'](_0x1141a6),_0xeec5bc={'md5HexStr':_0x1cb8d5,'fileSize':_0x43f7d8[_0x5ef1b2(0x185)](),'picWidth':_0x3424f7?.['width'],'picHeight':_0x3424f7?.[_0x5ef1b2(0x189)],'fileName':_0x35615c,'sourcePath':_0x4471c1,'original':!![],'picType':_0xd31729[_0x5ef1b2(0x18b)](isGIF,_0x1141a6)?PicType[_0x5ef1b2(0x187)]:PicType[_0x5ef1b2(0x180)],'picSubType':_0x123e62,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x4fa18b};return _0xd31729['aFcao'](log,_0xd31729[_0x5ef1b2(0x17c)],_0xeec5bc),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0xeec5bc};}static async[_0x13f5a8(0x1a7)](_0x2825fd,_0x87d16d=''){const _0x6e01f2=_0x13f5a8,_0x1d77e7={'uSFlN':function(_0x301ce9,_0x55edc3){return _0x301ce9===_0x55edc3;},'HsGaJ':_0x6e01f2(0x1a2),'twrEC':function(_0x54d588,_0x68012c){return _0x54d588||_0x68012c;}},{md5:_0x5b14d0,fileName:_0x5bfc60,path:_0x130bf8,fileSize:_0x178f5e}=await NTQQFileApi[_0x6e01f2(0x198)](_0x2825fd,ElementType[_0x6e01f2(0x1a4)]);if(_0x1d77e7[_0x6e01f2(0x178)](_0x178f5e,0x0))throw _0x1d77e7[_0x6e01f2(0x18e)];const _0x1678b3={'elementType':ElementType[_0x6e01f2(0x1a4)],'elementId':'','fileElement':{'fileName':_0x1d77e7[_0x6e01f2(0x162)](_0x87d16d,_0x5bfc60),'filePath':_0x130bf8,'fileSize':_0x178f5e['toString']()}};return _0x1678b3;}static async[_0x13f5a8(0x196)](_0x31d2cc,_0x42c05a='',_0x407a75=''){const _0x27cbb9=_0x13f5a8,_0x3486bd={'RoVvv':function(_0x3128b6,_0x5a3e1d,_0x2ab04d){return _0x3128b6(_0x5a3e1d,_0x2ab04d);},'NGBiH':_0x27cbb9(0x1a1),'rBTcI':function(_0xd6c783,_0x34d783){return _0xd6c783(_0x34d783);},'Uexlo':function(_0x411308,_0x2de3e4){return _0x411308(_0x2de3e4);},'GZIFj':_0x27cbb9(0x171),'qEAQc':_0x27cbb9(0x17a),'QRdzk':function(_0x45bbe6,_0xd47ead){return _0x45bbe6+_0xd47ead;},'yHBzq':function(_0x8db56d,_0x5cb93a){return _0x8db56d===_0x5cb93a;},'kCPwD':_0x27cbb9(0x16b),'LzkAN':function(_0x4cf8b5,_0x247f88){return _0x4cf8b5(_0x247f88);},'OKcaq':_0x27cbb9(0x183),'AjwNI':function(_0x4b2510,_0x4f22a0){return _0x4b2510(_0x4f22a0);}},{fileName:_0x406cee,path:_0x324f0e,fileSize:_0x1c69d6,md5:_0x2ce2e9}=await NTQQFileApi['uploadFile'](_0x31d2cc,ElementType[_0x27cbb9(0x193)]);if(_0x3486bd[_0x27cbb9(0x19d)](_0x1c69d6,0x0))throw'文件异常，大小为0';const _0x1aeeed=_0x3486bd[_0x27cbb9(0x173)](require,_0x3486bd[_0x27cbb9(0x1a8)]);let _0x178f6b=_0x324f0e[_0x27cbb9(0x177)](_0x1aeeed[_0x27cbb9(0x163)]+_0x27cbb9(0x199)+_0x1aeeed[_0x27cbb9(0x163)],_0x1aeeed[_0x27cbb9(0x163)]+_0x27cbb9(0x170)+_0x1aeeed['sep']);_0x178f6b=_0x1aeeed[_0x27cbb9(0x176)](_0x178f6b);let _0x4aeb9d={'width':0x780,'height':0x438,'time':0xf,'format':_0x27cbb9(0x16a),'size':_0x1c69d6,'filePath':_0x31d2cc};try{_0x4aeb9d=await _0x3486bd[_0x27cbb9(0x194)](getVideoInfo,_0x324f0e),log(_0x3486bd[_0x27cbb9(0x195)],_0x4aeb9d);}catch(_0xe34bcb){_0x3486bd[_0x27cbb9(0x1ab)](log,_0x27cbb9(0x16e),_0xe34bcb);}const _0x212d1f=new Promise((_0x2c2421,_0x4c934d)=>{const _0x2cb2b4=_0x27cbb9,_0x145897={'ZlyLa':function(_0x3c5616,_0x9b74a){const _0x5cda48=_0x1f16;return _0x3486bd[_0x5cda48(0x169)](_0x3c5616,_0x9b74a);}},_0x4198ac=_0x2ce2e9+_0x2cb2b4(0x179),_0x513752=_0x1aeeed['join'](_0x178f6b,_0x4198ac);_0x3486bd[_0x2cb2b4(0x173)](_0x442333,_0x31d2cc)['on'](_0x3486bd['GZIFj'],()=>{})['on'](_0x3486bd['qEAQc'],_0x550af3=>{const _0x3e0bf1=_0x2cb2b4;_0x3486bd['RoVvv'](log,_0x3486bd[_0x3e0bf1(0x18f)],_0x550af3),_0x407a75?_0x51d468[_0x3e0bf1(0x1a5)](_0x407a75,_0x513752)['then'](()=>{_0x145897['ZlyLa'](_0x2c2421,_0x513752);})[_0x3e0bf1(0x174)](_0x4c934d):_0x51d468[_0x3e0bf1(0x16c)](_0x513752,defaultVideoThumb)[_0x3e0bf1(0x1a9)](()=>{const _0x15209c=_0x3e0bf1;_0x145897[_0x15209c(0x17b)](_0x2c2421,_0x513752);})[_0x3e0bf1(0x174)](_0x4c934d);})[_0x2cb2b4(0x166)]({'timestamps':[0x0],'filename':_0x4198ac,'folder':_0x178f6b,'size':_0x3486bd['QRdzk'](_0x4aeb9d[_0x2cb2b4(0x181)]+'x',_0x4aeb9d[_0x2cb2b4(0x189)])})['on'](_0x3486bd[_0x2cb2b4(0x18a)],()=>{const _0x4d160a=_0x2cb2b4;_0x3486bd[_0x4d160a(0x169)](_0x2c2421,_0x513752);});}),_0x3369af=new Map(),_0x5d6a18=await _0x212d1f,_0x4b9299=(await _0x51d468['stat'](_0x5d6a18))[_0x27cbb9(0x19a)];_0x3369af['set'](0x0,_0x5d6a18);const _0x3d243a=await _0x3486bd[_0x27cbb9(0x19c)](calculateFileMD5,_0x5d6a18),_0x18b63f={'elementType':ElementType[_0x27cbb9(0x193)],'elementId':'','videoElement':{'fileName':_0x42c05a||_0x406cee,'filePath':_0x324f0e,'videoMd5':_0x2ce2e9,'thumbMd5':_0x3d243a,'fileTime':_0x4aeb9d[_0x27cbb9(0x17e)],'thumbPath':_0x3369af,'thumbSize':_0x4b9299,'thumbWidth':_0x4aeb9d[_0x27cbb9(0x181)],'thumbHeight':_0x4aeb9d[_0x27cbb9(0x189)],'fileSize':''+_0x1c69d6}};return _0x18b63f;}static async['ptt'](_0x2138d2){const _0x2355ab=_0x13f5a8,_0x59ac17={'qenPI':function(_0x29725f,_0x13aa61){return _0x29725f(_0x13aa61);}},{converted:_0x59ddeb,path:_0x14f5d1,duration:_0x4e540a}=await _0x59ac17['qenPI'](encodeSilk,_0x2138d2),{md5:_0x1a4c52,fileName:_0x44f8f0,path:_0x58950a,fileSize:_0x3fe4aa}=await NTQQFileApi['uploadFile'](_0x14f5d1,ElementType[_0x2355ab(0x190)]);if(_0x3fe4aa===0x0)throw _0x2355ab(0x1a2);return _0x59ddeb&&_0x51d468['unlink'](_0x14f5d1)[_0x2355ab(0x1a9)](),{'elementType':ElementType[_0x2355ab(0x190)],'elementId':'','pttElement':{'fileName':_0x44f8f0,'filePath':_0x58950a,'md5HexStr':_0x1a4c52,'fileSize':_0x3fe4aa,'duration':_0x4e540a||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x13f5a8(0x18d)](_0x437fbd){const _0x3e412d=_0x13f5a8,_0x2d352c={'fLLLT':function(_0x247acc,_0x540ed7){return _0x247acc<_0x540ed7;}};return{'elementType':ElementType[_0x3e412d(0x188)],'elementId':'','faceElement':{'faceIndex':_0x437fbd,'faceType':_0x2d352c[_0x3e412d(0x172)](_0x437fbd,0xde)?FaceType[_0x3e412d(0x18c)]:FaceType[_0x3e412d(0x182)]}};}static['dice'](_0x287170){const _0x1ea55f=_0x13f5a8;return{'elementType':ElementType[_0x1ea55f(0x188)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':_0x1ea55f(0x197),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x13f5a8(0x161)](_0x134ce4){const _0x28ad2a=_0x13f5a8,_0xaad355={'BWcnp':'[包剪锤]'};return{'elementType':ElementType[_0x28ad2a(0x188)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x28ad2a(0x184)],'faceText':_0xaad355[_0x28ad2a(0x19e)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x142847){const _0x3113be=_0x13f5a8;return{'elementType':ElementType[_0x3113be(0x186)],'elementId':'','arkElement':{'bytesData':_0x142847,'linkInfo':null,'subElementType':null}};}}