const _0x216785=_0x3587;(function(_0x39ce8d,_0x4b164c){const _0x5a00b8=_0x3587,_0x19709b=_0x39ce8d();while(!![]){try{const _0x5f0029=-parseInt(_0x5a00b8(0x166))/0x1*(-parseInt(_0x5a00b8(0x159))/0x2)+-parseInt(_0x5a00b8(0x169))/0x3*(parseInt(_0x5a00b8(0x154))/0x4)+parseInt(_0x5a00b8(0x191))/0x5+-parseInt(_0x5a00b8(0x15e))/0x6+parseInt(_0x5a00b8(0x174))/0x7*(-parseInt(_0x5a00b8(0x17d))/0x8)+parseInt(_0x5a00b8(0x194))/0x9+-parseInt(_0x5a00b8(0x197))/0xa;if(_0x5f0029===_0x4b164c)break;else _0x19709b['push'](_0x19709b['shift']());}catch(_0x49d369){_0x19709b['push'](_0x19709b['shift']());}}}(_0x53b9,0x7715d));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'../entities';import{promises as _0x420ef5}from'node:fs';function _0x53b9(){const _0x2e27aa=['iWHkt','then','PWjWN','48vzecad','TEXT','denTM','RvEDH','face','1484870KKmBjL','HWbhC','copyFile','normal2','XVWNr','659922uhseLr','width','QduwI','图片信息','jpg','sep','Ori','UMkaf','1hhcylk','SUHDh','文件异常，大小为0','1371aawGbm','toString','text','FDWyI','dice','catch','notAt','hZFik','GOtNv','获取视频信息失败','_0.png','70POEPsC','PIC','qxhsh','ark','RPS','视频信息','IrsxB','height','set','392944KPoRKp','mp4','stat','FACE','FILE','replace','writeFile','[骰子]','rps','VIDEO','path','YalGi','end','uploadFile','REPLY','ptt','sDmKp','PTT','video','time','868945jFddPh','获取视频封面失败，使用默认封面','join','7063524YpbFGF','pic','dirname','6066360dXciKl','size','DMoXI'];_0x53b9=function(){return _0x2e27aa;};return _0x53b9();}import _0x171841 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/qqnt/apis/file';function _0x3587(_0x47af47,_0x5bea8c){const _0x53b955=_0x53b9();return _0x3587=function(_0x3587da,_0x3fa7f5){_0x3587da=_0x3587da-0x154;let _0x3f521e=_0x53b955[_0x3587da];return _0x3f521e;},_0x3587(_0x47af47,_0x5bea8c);}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{log}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static[_0x216785(0x16b)](_0x1ac664){const _0x18cf1d=_0x216785;return{'elementType':ElementType[_0x18cf1d(0x155)],'elementId':'','textElement':{'content':_0x1ac664,'atType':AtType[_0x18cf1d(0x16f)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x188637,_0x35543d,_0x45c021,_0x4f10bc){const _0x341dca=_0x216785;return{'elementType':ElementType[_0x341dca(0x155)],'elementId':'','textElement':{'content':'@'+_0x4f10bc,'atType':_0x45c021,'atUid':_0x188637,'atTinyId':'','atNtUid':_0x35543d}};}static['reply'](_0x35b62a,_0x4e6d29,_0x49a557,_0x571aa2){const _0x3e0156=_0x216785;return{'elementType':ElementType[_0x3e0156(0x18b)],'elementId':'','replyElement':{'replayMsgSeq':_0x35b62a,'replayMsgId':_0x4e6d29,'senderUin':_0x49a557,'senderUinStr':_0x571aa2}};}static async[_0x216785(0x195)](_0x5cb52a,_0x422a94='',_0x3f70a0=0x0){const _0x2e69ec=_0x216785,_0x2d22ec={'oICdr':function(_0x352702,_0x408f40){return _0x352702===_0x408f40;},'XVWNr':_0x2e69ec(0x168),'bmfGQ':function(_0x5030db,_0x28a513){return _0x5030db(_0x28a513);},'qxhsh':function(_0x36dead,_0xc043e3,_0x432938){return _0x36dead(_0xc043e3,_0x432938);}},{md5:_0x53bd69,fileName:_0x2bdd5f,path:_0x864d96,fileSize:_0x1ba0d1}=await NTQQFileApi['uploadFile'](_0x5cb52a,ElementType[_0x2e69ec(0x175)],_0x3f70a0);if(_0x2d22ec['oICdr'](_0x1ba0d1,0x0))throw _0x2d22ec[_0x2e69ec(0x15d)];const _0x2865d7=await NTQQFileApi['getImageSize'](_0x5cb52a),_0x347175={'md5HexStr':_0x53bd69,'fileSize':_0x1ba0d1[_0x2e69ec(0x16a)](),'picWidth':_0x2865d7?.['width'],'picHeight':_0x2865d7?.[_0x2e69ec(0x17b)],'fileName':_0x2bdd5f,'sourcePath':_0x864d96,'original':!![],'picType':_0x2d22ec['bmfGQ'](isGIF,_0x5cb52a)?PicType['gif']:PicType[_0x2e69ec(0x162)],'picSubType':_0x3f70a0,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x422a94};return _0x2d22ec[_0x2e69ec(0x176)](log,_0x2e69ec(0x161),_0x347175),{'elementType':ElementType[_0x2e69ec(0x175)],'elementId':'','picElement':_0x347175};}static async['file'](_0x3f476a,_0x4c9ca7=''){const _0x50a44f=_0x216785,_0x17f8e0={'DMoXI':function(_0x2442b7,_0x97c7ab){return _0x2442b7===_0x97c7ab;},'gVfTY':_0x50a44f(0x168)},{md5:_0x450245,fileName:_0x493f5a,path:_0x51a8c6,fileSize:_0x26426c}=await NTQQFileApi[_0x50a44f(0x18a)](_0x3f476a,ElementType[_0x50a44f(0x181)]);if(_0x17f8e0[_0x50a44f(0x199)](_0x26426c,0x0))throw _0x17f8e0['gVfTY'];const _0x35dc35={'elementType':ElementType[_0x50a44f(0x181)],'elementId':'','fileElement':{'fileName':_0x4c9ca7||_0x493f5a,'filePath':_0x51a8c6,'fileSize':_0x26426c[_0x50a44f(0x16a)]()}};return _0x35dc35;}static async[_0x216785(0x18f)](_0x7c206e,_0x4b8b2d='',_0x27e911=''){const _0x5a91d9=_0x216785,_0x2b254d={'denTM':function(_0x58712b,_0x4a0595){return _0x58712b(_0x4a0595);},'RvEDH':function(_0x340b31,_0x12cd1c){return _0x340b31(_0x12cd1c);},'HWbhC':_0x5a91d9(0x192),'YalGi':function(_0x508349,_0x1828d9){return _0x508349+_0x1828d9;},'aJcaA':function(_0x2e2e43,_0x380f5e){return _0x2e2e43+_0x380f5e;},'IrsxB':_0x5a91d9(0x189),'SUHDh':function(_0x18ea74,_0x2b8dde){return _0x18ea74===_0x2b8dde;},'qOhqS':_0x5a91d9(0x168),'OTlMu':function(_0x42b054,_0x35a1a0){return _0x42b054(_0x35a1a0);},'GOtNv':_0x5a91d9(0x187),'taQTw':function(_0x221a94,_0x52fc3a){return _0x221a94(_0x52fc3a);},'FDWyI':function(_0x250595,_0x403255,_0x564632){return _0x250595(_0x403255,_0x564632);},'Rlzwl':_0x5a91d9(0x179),'hZFik':function(_0x46a466,_0x58b196,_0x17f84b){return _0x46a466(_0x58b196,_0x17f84b);},'YrdRT':_0x5a91d9(0x172),'iWHkt':function(_0x12e0d3,_0x5c9c94){return _0x12e0d3||_0x5c9c94;}},{fileName:_0x492866,path:_0x5d24a2,fileSize:_0x364119,md5:_0x13bd03}=await NTQQFileApi[_0x5a91d9(0x18a)](_0x7c206e,ElementType[_0x5a91d9(0x186)]);if(_0x2b254d[_0x5a91d9(0x167)](_0x364119,0x0))throw _0x2b254d['qOhqS'];const _0x3f72d3=_0x2b254d['OTlMu'](require,_0x2b254d[_0x5a91d9(0x171)]);let _0x46c34c=_0x5d24a2[_0x5a91d9(0x182)](_0x3f72d3[_0x5a91d9(0x163)]+_0x5a91d9(0x164)+_0x3f72d3[_0x5a91d9(0x163)],_0x3f72d3[_0x5a91d9(0x163)]+'Thumb'+_0x3f72d3['sep']);_0x46c34c=_0x3f72d3[_0x5a91d9(0x196)](_0x46c34c);let _0x4d7a40={'width':0x780,'height':0x438,'time':0xf,'format':_0x5a91d9(0x17e),'size':_0x364119,'filePath':_0x7c206e};try{_0x4d7a40=await _0x2b254d['taQTw'](getVideoInfo,_0x5d24a2),_0x2b254d[_0x5a91d9(0x16c)](log,_0x2b254d['Rlzwl'],_0x4d7a40);}catch(_0x24263e){_0x2b254d[_0x5a91d9(0x170)](log,_0x2b254d['YrdRT'],_0x24263e);}const _0x1d5321=new Promise((_0x25a4f8,_0x2a7911)=>{const _0x36baef=_0x5a91d9,_0x1922b2=_0x13bd03+_0x36baef(0x173),_0x52e54d=_0x3f72d3[_0x36baef(0x193)](_0x46c34c,_0x1922b2);_0x2b254d['RvEDH'](_0x171841,_0x7c206e)['on'](_0x36baef(0x189),()=>{})['on']('error',_0x8c00a=>{const _0x451112=_0x36baef,_0x238cc7={'sDmKp':function(_0x5d92f5,_0x57e646){const _0x143b3a=_0x3587;return _0x2b254d[_0x143b3a(0x156)](_0x5d92f5,_0x57e646);},'QduwI':function(_0x18b2e4,_0x446435){const _0x2a7b3d=_0x3587;return _0x2b254d[_0x2a7b3d(0x157)](_0x18b2e4,_0x446435);}};log(_0x2b254d[_0x451112(0x15a)],_0x8c00a),_0x27e911?_0x420ef5[_0x451112(0x15b)](_0x27e911,_0x52e54d)[_0x451112(0x19b)](()=>{const _0x1460ff=_0x451112;_0x238cc7[_0x1460ff(0x18d)](_0x25a4f8,_0x52e54d);})[_0x451112(0x16e)](_0x2a7911):_0x420ef5[_0x451112(0x183)](_0x52e54d,defaultVideoThumb)[_0x451112(0x19b)](()=>{const _0x6530e2=_0x451112;_0x238cc7[_0x6530e2(0x160)](_0x25a4f8,_0x52e54d);})['catch'](_0x2a7911);})['screenshots']({'timestamps':[0x0],'filename':_0x1922b2,'folder':_0x46c34c,'size':_0x2b254d[_0x36baef(0x188)](_0x2b254d['aJcaA'](_0x4d7a40[_0x36baef(0x15f)],'x'),_0x4d7a40[_0x36baef(0x17b)])})['on'](_0x2b254d[_0x36baef(0x17a)],()=>{_0x25a4f8(_0x52e54d);});}),_0x125648=new Map(),_0x2fc766=await _0x1d5321,_0xa84d77=(await _0x420ef5[_0x5a91d9(0x17f)](_0x2fc766))[_0x5a91d9(0x198)];_0x125648[_0x5a91d9(0x17c)](0x0,_0x2fc766);const _0x536191=await calculateFileMD5(_0x2fc766),_0xe08a35={'elementType':ElementType[_0x5a91d9(0x186)],'elementId':'','videoElement':{'fileName':_0x2b254d[_0x5a91d9(0x19a)](_0x4b8b2d,_0x492866),'filePath':_0x5d24a2,'videoMd5':_0x13bd03,'thumbMd5':_0x536191,'fileTime':_0x4d7a40[_0x5a91d9(0x190)],'thumbPath':_0x125648,'thumbSize':_0xa84d77,'thumbWidth':_0x4d7a40[_0x5a91d9(0x15f)],'thumbHeight':_0x4d7a40[_0x5a91d9(0x17b)],'fileSize':''+_0x364119}};return _0xe08a35;}static async[_0x216785(0x18c)](_0x271e11){const _0x3e1b92=_0x216785,_0x5d7ea4={'PWjWN':function(_0x251e84,_0x2afc0e){return _0x251e84(_0x2afc0e);},'MCqiG':function(_0x1d0d59,_0x41ee97){return _0x1d0d59===_0x41ee97;},'Gommb':function(_0x337fa9,_0x7389a){return _0x337fa9||_0x7389a;}},{converted:_0x4d9b7b,path:_0x54f482,duration:_0x35c78a}=await _0x5d7ea4[_0x3e1b92(0x19c)](encodeSilk,_0x271e11),{md5:_0x365805,fileName:_0xdee99c,path:_0x4f0190,fileSize:_0x57a450}=await NTQQFileApi[_0x3e1b92(0x18a)](_0x54f482,ElementType[_0x3e1b92(0x18e)]);if(_0x5d7ea4['MCqiG'](_0x57a450,0x0))throw _0x3e1b92(0x168);return _0x4d9b7b&&_0x420ef5['unlink'](_0x54f482)[_0x3e1b92(0x19b)](),{'elementType':ElementType[_0x3e1b92(0x18e)],'elementId':'','pttElement':{'fileName':_0xdee99c,'filePath':_0x4f0190,'md5HexStr':_0x365805,'fileSize':_0x57a450,'duration':_0x5d7ea4['Gommb'](_0x35c78a,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x216785(0x158)](_0x2c5322){const _0x3f34e8=_0x216785,_0x3fd94e={'HaNFO':function(_0x175ee8,_0x4e2f40){return _0x175ee8<_0x4e2f40;}};return{'elementType':ElementType[_0x3f34e8(0x180)],'elementId':'','faceElement':{'faceIndex':_0x2c5322,'faceType':_0x3fd94e['HaNFO'](_0x2c5322,0xde)?FaceType['normal']:FaceType[_0x3f34e8(0x15c)]}};}static[_0x216785(0x16d)](_0x41be6d){const _0x57917b=_0x216785;return{'elementType':ElementType[_0x57917b(0x180)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x57917b(0x16d)],'faceText':_0x57917b(0x184),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x216785(0x185)](_0x29cc58){const _0x3e3dc3=_0x216785,_0x183836={'UMkaf':'[包剪锤]'};return{'elementType':ElementType[_0x3e3dc3(0x180)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x3e3dc3(0x178)],'faceText':_0x183836[_0x3e3dc3(0x165)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x216785(0x177)](_0x329b99){return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x329b99,'linkInfo':null,'subElementType':null}};}}