function _0x54d2(_0x3d568d,_0x3f7a8a){const _0x47c68c=_0x47c6();return _0x54d2=function(_0x54d248,_0x1e9ec2){_0x54d248=_0x54d248-0x1ae;let _0x364ef7=_0x47c68c[_0x54d248];return _0x364ef7;},_0x54d2(_0x3d568d,_0x3f7a8a);}const _0x3a2e6e=_0x54d2;(function(_0x225769,_0x309fb8){const _0x4a92de=_0x54d2,_0xbbd0ab=_0x225769();while(!![]){try{const _0x1d6951=parseInt(_0x4a92de(0x1df))/0x1*(parseInt(_0x4a92de(0x1b7))/0x2)+-parseInt(_0x4a92de(0x203))/0x3+-parseInt(_0x4a92de(0x202))/0x4+-parseInt(_0x4a92de(0x1f3))/0x5+-parseInt(_0x4a92de(0x1c9))/0x6*(parseInt(_0x4a92de(0x1c7))/0x7)+-parseInt(_0x4a92de(0x1d8))/0x8+parseInt(_0x4a92de(0x1ae))/0x9;if(_0x1d6951===_0x309fb8)break;else _0xbbd0ab['push'](_0xbbd0ab['shift']());}catch(_0xd7f3c){_0xbbd0ab['push'](_0xbbd0ab['shift']());}}}(_0x47c6,0x6e618));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'../entities';import{promises as _0x154f4f}from'node:fs';import _0x3db3a9 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/qqnt/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{log}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x47c6(){const _0x228d7a=['jpg','toString','SPEPR','TEXT','text','_0.png','mp4','sep','pmmVk','hWpvw','ZCIdD','获取视频信息失败','5396648bjBjyQ','error','writeFile','XYaWW','getImageSize','VWzlN','copyFile','45984OHzpEl','CdoVP','video','normal','uploadFile','unlink','图片信息','RPS','DeHym','markdown','mqyjc','stat','normal2','NaWvi','MARKDOWN','Gyaiu','VIDEO','gif','height','reply','4214505SZCmkH','FILE','screenshots','REPLY','dice','PTT','FACE','UfIhK','GJhgS','dirname','视频信息','pic','xvMwg','ARK','path','2300728CeeqCZ','63924vODOHc','27123138AeQzNP','face','[包剪锤]','IeJwC','notAt','then','获取视频封面失败，使用默认封面','ark','join','12ilPnIV','Thumb','hNmpM','file','set','vunzm','replace','文件异常，大小为0','end','wQrgH','PIC','width','dvPfI','kVZyD','WSyYP','ihIXz','7fkzmAT','jyDfn','4340964gOWGja','Ori','qmfJQ'];_0x47c6=function(){return _0x228d7a;};return _0x47c6();}import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static[_0x3a2e6e(0x1d0)](_0x2dc0de){const _0x2f65a4=_0x3a2e6e;return{'elementType':ElementType[_0x2f65a4(0x1cf)],'elementId':'','textElement':{'content':_0x2dc0de,'atType':AtType[_0x2f65a4(0x1b2)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x148d22,_0x25b5f7,_0x67cc69,_0x4cfd64){const _0x126106=_0x3a2e6e;return{'elementType':ElementType[_0x126106(0x1cf)],'elementId':'','textElement':{'content':'@'+_0x4cfd64,'atType':_0x67cc69,'atUid':_0x148d22,'atTinyId':'','atNtUid':_0x25b5f7}};}static[_0x3a2e6e(0x1f2)](_0x19e1c6,_0x53dbf6,_0x385c89,_0x6b3208){const _0x13853c=_0x3a2e6e;return{'elementType':ElementType[_0x13853c(0x1f6)],'elementId':'','replyElement':{'replayMsgSeq':_0x19e1c6,'replayMsgId':_0x53dbf6,'senderUin':_0x385c89,'senderUinStr':_0x6b3208}};}static async[_0x3a2e6e(0x1fe)](_0x5a1fba,_0x1a831d='',_0x556497=0x0){const _0x27d027=_0x3a2e6e,_0x43f671={'CdoVP':_0x27d027(0x1be),'ihIXz':function(_0x481979,_0x3f399a){return _0x481979(_0x3f399a);},'hWpvw':function(_0x5c3bc9,_0xb7fc8d,_0x4ae25d){return _0x5c3bc9(_0xb7fc8d,_0x4ae25d);},'UfIhK':_0x27d027(0x1e5)},{md5:_0xacff2a,fileName:_0x27c50c,path:_0x4dd016,fileSize:_0x50b871}=await NTQQFileApi[_0x27d027(0x1e3)](_0x5a1fba,ElementType['PIC'],_0x556497);if(_0x50b871===0x0)throw _0x43f671[_0x27d027(0x1e0)];const _0x240161=await NTQQFileApi[_0x27d027(0x1dc)](_0x5a1fba),_0x165103={'md5HexStr':_0xacff2a,'fileSize':_0x50b871[_0x27d027(0x1cd)](),'picWidth':_0x240161?.[_0x27d027(0x1c2)],'picHeight':_0x240161?.[_0x27d027(0x1f1)],'fileName':_0x27c50c,'sourcePath':_0x4dd016,'original':!![],'picType':_0x43f671[_0x27d027(0x1c6)](isGIF,_0x5a1fba)?PicType[_0x27d027(0x1f0)]:PicType[_0x27d027(0x1cc)],'picSubType':_0x556497,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x1a831d};return _0x43f671[_0x27d027(0x1d5)](log,_0x43f671[_0x27d027(0x1fa)],_0x165103),{'elementType':ElementType[_0x27d027(0x1c1)],'elementId':'','picElement':_0x165103};}static async[_0x3a2e6e(0x1ba)](_0x3c5dfd,_0x252944=''){const _0x4e7147=_0x3a2e6e,_0x293348={'pVggM':function(_0x5793ce,_0x4ccb94){return _0x5793ce===_0x4ccb94;},'IeJwC':_0x4e7147(0x1be),'VWzlN':function(_0x242d56,_0x7817db){return _0x242d56||_0x7817db;}},{md5:_0x3203aa,fileName:_0x30653c,path:_0x261992,fileSize:_0x3cc335}=await NTQQFileApi[_0x4e7147(0x1e3)](_0x3c5dfd,ElementType['FILE']);if(_0x293348['pVggM'](_0x3cc335,0x0))throw _0x293348[_0x4e7147(0x1b1)];const _0x4fe531={'elementType':ElementType[_0x4e7147(0x1f4)],'elementId':'','fileElement':{'fileName':_0x293348[_0x4e7147(0x1dd)](_0x252944,_0x30653c),'filePath':_0x261992,'fileSize':_0x3cc335['toString']()}};return _0x4fe531;}static async[_0x3a2e6e(0x1e1)](_0x3d4430,_0x2b4a02='',_0x4c86bf=''){const _0x246967=_0x3a2e6e,_0x3742a8={'GJhgS':function(_0x3a413c,_0x376718){return _0x3a413c(_0x376718);},'hNmpM':function(_0x7833c9,_0x23868d){return _0x7833c9(_0x23868d);},'ZCIdD':_0x246967(0x1bf),'taomD':_0x246967(0x1d9),'AOaon':function(_0x1c5567,_0x408d53){return _0x1c5567+_0x408d53;},'swuCP':function(_0x22ba0a,_0x50b9b4){return _0x22ba0a+_0x50b9b4;},'WSyYP':function(_0x3328ea,_0x5b0cb5){return _0x3328ea===_0x5b0cb5;},'jyDfn':'文件异常，大小为0','vunzm':_0x246967(0x201),'pmmVk':_0x246967(0x1d2),'xvMwg':function(_0x401bf1,_0x3d5aa6,_0x6e1f3b){return _0x401bf1(_0x3d5aa6,_0x6e1f3b);},'Gyaiu':_0x246967(0x1fd),'gtmfl':function(_0x57a8a5,_0x8210d,_0x146428){return _0x57a8a5(_0x8210d,_0x146428);},'wQrgH':function(_0x41a65f,_0x15e7be){return _0x41a65f(_0x15e7be);},'qmfJQ':function(_0x4e6ab8,_0x4a349d){return _0x4e6ab8||_0x4a349d;}},{fileName:_0x2e1a9e,path:_0x3d368c,fileSize:_0x105c11,md5:_0x2741d6}=await NTQQFileApi[_0x246967(0x1e3)](_0x3d4430,ElementType[_0x246967(0x1ef)]);if(_0x3742a8[_0x246967(0x1c5)](_0x105c11,0x0))throw _0x3742a8[_0x246967(0x1c8)];const _0xb79779=_0x3742a8[_0x246967(0x1fb)](require,_0x3742a8[_0x246967(0x1bc)]);let _0x21b649=_0x3d368c[_0x246967(0x1bd)](_0xb79779[_0x246967(0x1d3)]+_0x246967(0x1ca)+_0xb79779['sep'],_0xb79779[_0x246967(0x1d3)]+_0x246967(0x1b8)+_0xb79779[_0x246967(0x1d3)]);_0x21b649=_0xb79779[_0x246967(0x1fc)](_0x21b649);let _0x3917f9={'width':0x780,'height':0x438,'time':0xf,'format':_0x3742a8[_0x246967(0x1d4)],'size':_0x105c11,'filePath':_0x3d4430};try{_0x3917f9=await getVideoInfo(_0x3d368c),_0x3742a8[_0x246967(0x1ff)](log,_0x3742a8[_0x246967(0x1ee)],_0x3917f9);}catch(_0x41dd69){_0x3742a8['gtmfl'](log,_0x246967(0x1d7),_0x41dd69);}const _0x3d754a=new Promise((_0x258954,_0x418c9e)=>{const _0x32a0e5=_0x246967,_0x204503={'SPEPR':function(_0x1fe28c,_0x21847c){const _0x28b866=_0x54d2;return _0x3742a8[_0x28b866(0x1fb)](_0x1fe28c,_0x21847c);},'dvPfI':function(_0x3f22b6,_0xb4821d){const _0x59da68=_0x54d2;return _0x3742a8[_0x59da68(0x1fb)](_0x3f22b6,_0xb4821d);},'NaWvi':function(_0x558621,_0x3c2824,_0x5a4536){return _0x558621(_0x3c2824,_0x5a4536);}},_0x219614=_0x2741d6+_0x32a0e5(0x1d1),_0x1362be=_0xb79779[_0x32a0e5(0x1b6)](_0x21b649,_0x219614);_0x3742a8[_0x32a0e5(0x1b9)](_0x3db3a9,_0x3d4430)['on'](_0x3742a8['ZCIdD'],()=>{})['on'](_0x3742a8['taomD'],_0xdfe8c6=>{const _0x688e7b=_0x32a0e5,_0x56dd00={'kVZyD':function(_0xa2b283,_0xcf8ff6){const _0x54c5f6=_0x54d2;return _0x204503[_0x54c5f6(0x1c3)](_0xa2b283,_0xcf8ff6);}};_0x204503[_0x688e7b(0x1ec)](log,_0x688e7b(0x1b4),_0xdfe8c6),_0x4c86bf?_0x154f4f[_0x688e7b(0x1de)](_0x4c86bf,_0x1362be)['then'](()=>{const _0xb4383d=_0x688e7b;_0x56dd00[_0xb4383d(0x1c4)](_0x258954,_0x1362be);})['catch'](_0x418c9e):_0x154f4f[_0x688e7b(0x1da)](_0x1362be,defaultVideoThumb)[_0x688e7b(0x1b3)](()=>{const _0x2072ec=_0x688e7b;_0x204503[_0x2072ec(0x1ce)](_0x258954,_0x1362be);})['catch'](_0x418c9e);})[_0x32a0e5(0x1f5)]({'timestamps':[0x0],'filename':_0x219614,'folder':_0x21b649,'size':_0x3742a8['AOaon'](_0x3742a8['swuCP'](_0x3917f9['width'],'x'),_0x3917f9[_0x32a0e5(0x1f1)])})['on'](_0x3742a8[_0x32a0e5(0x1d6)],()=>{const _0x23df46=_0x32a0e5;_0x3742a8[_0x23df46(0x1fb)](_0x258954,_0x1362be);});}),_0x4fb9b2=new Map(),_0x202cd5=await _0x3d754a,_0x3a3e65=(await _0x154f4f[_0x246967(0x1ea)](_0x202cd5))['size'];_0x4fb9b2[_0x246967(0x1bb)](0x0,_0x202cd5);const _0x49b8e0=await _0x3742a8[_0x246967(0x1c0)](calculateFileMD5,_0x202cd5),_0xec3e16={'elementType':ElementType[_0x246967(0x1ef)],'elementId':'','videoElement':{'fileName':_0x3742a8[_0x246967(0x1cb)](_0x2b4a02,_0x2e1a9e),'filePath':_0x3d368c,'videoMd5':_0x2741d6,'thumbMd5':_0x49b8e0,'fileTime':_0x3917f9['time'],'thumbPath':_0x4fb9b2,'thumbSize':_0x3a3e65,'thumbWidth':_0x3917f9[_0x246967(0x1c2)],'thumbHeight':_0x3917f9[_0x246967(0x1f1)],'fileSize':''+_0x105c11}};return _0xec3e16;}static async['ptt'](_0xb11eba){const _0x5282f2=_0x3a2e6e,_0x28e27e={'XYaWW':function(_0x3ad7d8,_0x5826f2){return _0x3ad7d8(_0x5826f2);},'DeHym':function(_0x26aa47,_0x372ba9){return _0x26aa47===_0x372ba9;}},{converted:_0x5b54b2,path:_0x586ff2,duration:_0x4ffbc3}=await _0x28e27e[_0x5282f2(0x1db)](encodeSilk,_0xb11eba),{md5:_0x49b596,fileName:_0x245463,path:_0x32cc5e,fileSize:_0x24409e}=await NTQQFileApi['uploadFile'](_0x586ff2,ElementType['PTT']);if(_0x28e27e[_0x5282f2(0x1e7)](_0x24409e,0x0))throw _0x5282f2(0x1be);return _0x5b54b2&&_0x154f4f[_0x5282f2(0x1e4)](_0x586ff2)['then'](),{'elementType':ElementType[_0x5282f2(0x1f8)],'elementId':'','pttElement':{'fileName':_0x245463,'filePath':_0x32cc5e,'md5HexStr':_0x49b596,'fileSize':_0x24409e,'duration':_0x4ffbc3||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x3a2e6e(0x1af)](_0x51c6c5){const _0x21a7c5=_0x3a2e6e;return{'elementType':ElementType[_0x21a7c5(0x1f9)],'elementId':'','faceElement':{'faceIndex':_0x51c6c5,'faceType':_0x51c6c5<0xde?FaceType[_0x21a7c5(0x1e2)]:FaceType[_0x21a7c5(0x1eb)]}};}static[_0x3a2e6e(0x1f7)](_0x186c79){const _0x1b78c9=_0x3a2e6e,_0x38284a={'mqyjc':'[骰子]'};return{'elementType':ElementType[_0x1b78c9(0x1f9)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x1b78c9(0x1f7)],'faceText':_0x38284a[_0x1b78c9(0x1e9)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x56aeee){const _0x3bb2c6=_0x3a2e6e;return{'elementType':ElementType[_0x3bb2c6(0x1f9)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x3bb2c6(0x1e6)],'faceText':_0x3bb2c6(0x1b0),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3a2e6e(0x1b5)](_0xb40576){const _0x1a63eb=_0x3a2e6e;return{'elementType':ElementType[_0x1a63eb(0x200)],'elementId':'','arkElement':{'bytesData':_0xb40576,'linkInfo':null,'subElementType':null}};}static[_0x3a2e6e(0x1e8)](_0x2d7d24){const _0x53b07d=_0x3a2e6e;return{'elementType':ElementType[_0x53b07d(0x1ed)],'elementId':'','markdownElement':{'content':_0x2d7d24}};}}