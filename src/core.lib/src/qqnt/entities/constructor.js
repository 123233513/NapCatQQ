function _0x2cd0(_0x2f8175,_0x44a7f8){const _0xd4fdae=_0xd4fd();return _0x2cd0=function(_0x2cd0ed,_0x4c835e){_0x2cd0ed=_0x2cd0ed-0x9f;let _0x406e62=_0xd4fdae[_0x2cd0ed];return _0x406e62;},_0x2cd0(_0x2f8175,_0x44a7f8);}const _0x421d43=_0x2cd0;(function(_0x53b794,_0x5b7bf5){const _0x2deb93=_0x2cd0,_0x205025=_0x53b794();while(!![]){try{const _0x2fec93=parseInt(_0x2deb93(0xc2))/0x1+parseInt(_0x2deb93(0xa6))/0x2+parseInt(_0x2deb93(0xc7))/0x3+-parseInt(_0x2deb93(0xa7))/0x4*(parseInt(_0x2deb93(0xdc))/0x5)+parseInt(_0x2deb93(0xb5))/0x6*(parseInt(_0x2deb93(0x9f))/0x7)+-parseInt(_0x2deb93(0xac))/0x8+-parseInt(_0x2deb93(0xb4))/0x9*(parseInt(_0x2deb93(0xbd))/0xa);if(_0x2fec93===_0x5b7bf5)break;else _0x205025['push'](_0x205025['shift']());}catch(_0x1d377b){_0x205025['push'](_0x205025['shift']());}}}(_0xd4fd,0x8f469));import{AtType,ElementType,PicType}from'../entities';import{promises as _0xa51557}from'node:fs';import _0x320dc2 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/qqnt/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';function _0xd4fd(){const _0x155e03=['sYAfQ','unlink','replace','pic','ZIHAj','35271UeTqsA','1091754KETcTG','TFNbS','face','ARK','end','_0.png','writeFile','join','2110tMpJgN','cxQGC','getImageSize','获取视频封面失败，使用默认封面','video','603243TiHQOa','图片信息','copyFile','height','zyyCI','204750eTdDjl','CXOkx','error','EZcpE','tpORS','time','QihSJ','MarHA','catch','Eiihj','toString','BfBEM','文件异常，大小为0','width','Ori','mp4','dirname','FILE','uploadFile','stat','VIDEO','2335RxtXPf','PTT','TEXT','NxXLv','PIC','NGkse','28ovPyGz','DqfaC','screenshots','reply','TMRIU','sep','then','1796672pskyPv','3932nUbtSO','IANyf','doTnQ','boFBY','ark','3398704rEShgk','获取视频信息失败','kiQcj'];_0xd4fd=function(){return _0x155e03;};return _0xd4fd();}import{log}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static['text'](_0x21d01e){const _0x49dbe2=_0x2cd0;return{'elementType':ElementType[_0x49dbe2(0xde)],'elementId':'','textElement':{'content':_0x21d01e,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x5524e9,_0x47d7e1,_0x34c6f2,_0x66708){const _0x199ad7=_0x2cd0;return{'elementType':ElementType[_0x199ad7(0xde)],'elementId':'','textElement':{'content':'@'+_0x66708,'atType':_0x34c6f2,'atUid':_0x5524e9,'atTinyId':'','atNtUid':_0x47d7e1}};}static[_0x421d43(0xa2)](_0x9d4eea,_0x471b3a,_0x2ed892,_0x772520){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x9d4eea,'replayMsgId':_0x471b3a,'senderUin':_0x2ed892,'senderUinStr':_0x772520}};}static async[_0x421d43(0xb2)](_0x375e61,_0x33f039='',_0x2e33bf=0x0){const _0x3eb004=_0x421d43,_0x29407f={'DqfaC':function(_0x4549b7,_0x1a74a0){return _0x4549b7===_0x1a74a0;},'wjfIJ':_0x3eb004(0xd3),'Eiihj':function(_0x14ad0a,_0x15b5c0){return _0x14ad0a(_0x15b5c0);},'TMRIU':function(_0xedbd6b,_0x5b95b5,_0x73fe14){return _0xedbd6b(_0x5b95b5,_0x73fe14);},'boFBY':_0x3eb004(0xc3)},{md5:_0x10810d,fileName:_0x4aaa90,path:_0x5c10f0,fileSize:_0x288ed4}=await NTQQFileApi['uploadFile'](_0x375e61,ElementType[_0x3eb004(0xe0)],_0x2e33bf);if(_0x29407f[_0x3eb004(0xa0)](_0x288ed4,0x0))throw _0x29407f['wjfIJ'];const _0x549d3e=await NTQQFileApi[_0x3eb004(0xbf)](_0x375e61),_0x38d626={'md5HexStr':_0x10810d,'fileSize':_0x288ed4[_0x3eb004(0xd1)](),'picWidth':_0x549d3e?.[_0x3eb004(0xd4)],'picHeight':_0x549d3e?.[_0x3eb004(0xc5)],'fileName':_0x4aaa90,'sourcePath':_0x5c10f0,'original':!![],'picType':_0x29407f[_0x3eb004(0xd0)](isGIF,_0x375e61)?PicType['gif']:PicType['jpg'],'picSubType':_0x2e33bf,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x33f039};return _0x29407f[_0x3eb004(0xa3)](log,_0x29407f[_0x3eb004(0xaa)],_0x38d626),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x38d626};}static async['file'](_0x220742,_0x3007b4=''){const _0x35bce7=_0x421d43,_0x41d2ae={'FyiEg':function(_0x3c9c5c,_0x19bc04){return _0x3c9c5c===_0x19bc04;},'PrCsd':_0x35bce7(0xd3),'zyyCI':function(_0xed2712,_0x36b64b){return _0xed2712||_0x36b64b;}},{md5:_0x4de466,fileName:_0x22e274,path:_0xbe0256,fileSize:_0x5bccae}=await NTQQFileApi[_0x35bce7(0xd9)](_0x220742,ElementType['FILE']);if(_0x41d2ae['FyiEg'](_0x5bccae,0x0))throw _0x41d2ae['PrCsd'];const _0x418e14={'elementType':ElementType[_0x35bce7(0xd8)],'elementId':'','fileElement':{'fileName':_0x41d2ae[_0x35bce7(0xc6)](_0x3007b4,_0x22e274),'filePath':_0xbe0256,'fileSize':_0x5bccae[_0x35bce7(0xd1)]()}};return _0x418e14;}static async[_0x421d43(0xc1)](_0x51a440,_0x2b26cf='',_0x4fe90d=''){const _0x1db88a=_0x421d43,_0x210b6d={'cxQGC':function(_0x67a95e,_0x2d2d0b,_0xf8e89e){return _0x67a95e(_0x2d2d0b,_0xf8e89e);},'doTnQ':_0x1db88a(0xc0),'tpORS':function(_0x4a03bf,_0x7f4c8a){return _0x4a03bf(_0x7f4c8a);},'CXOkx':_0x1db88a(0xc9),'TFNbS':function(_0x236f6e,_0x2f661b){return _0x236f6e+_0x2f661b;},'PAXcs':_0x1db88a(0xb9),'IANyf':function(_0x51f3af,_0x27b88a){return _0x51f3af===_0x27b88a;},'sYAfQ':_0x1db88a(0xd3),'EZcpE':'path','TLyAW':_0x1db88a(0xd6),'NGkse':'视频信息','ktvcW':function(_0x3d4c60,_0x476989,_0x15a148){return _0x3d4c60(_0x476989,_0x15a148);},'MarHA':_0x1db88a(0xad),'ZIHAj':function(_0x494e14,_0x4d90e5){return _0x494e14||_0x4d90e5;},'kiQcj':function(_0x337f6c,_0x25b067){return _0x337f6c+_0x25b067;}},{fileName:_0x4f375f,path:_0x9e759a,fileSize:_0x1ea816,md5:_0x3eb7ce}=await NTQQFileApi[_0x1db88a(0xd9)](_0x51a440,ElementType[_0x1db88a(0xdb)]);if(_0x210b6d[_0x1db88a(0xa8)](_0x1ea816,0x0))throw _0x210b6d[_0x1db88a(0xaf)];const _0x3fecc0=_0x210b6d['tpORS'](require,_0x210b6d[_0x1db88a(0xca)]);let _0x46d0d5=_0x9e759a[_0x1db88a(0xb1)](_0x3fecc0[_0x1db88a(0xa4)]+_0x1db88a(0xd5)+_0x3fecc0['sep'],_0x3fecc0[_0x1db88a(0xa4)]+'Thumb'+_0x3fecc0[_0x1db88a(0xa4)]);_0x46d0d5=_0x3fecc0[_0x1db88a(0xd7)](_0x46d0d5);let _0x4d928e={'width':0x780,'height':0x438,'time':0xf,'format':_0x210b6d['TLyAW'],'size':_0x1ea816,'filePath':_0x51a440};try{_0x4d928e=await _0x210b6d[_0x1db88a(0xcb)](getVideoInfo,_0x9e759a),log(_0x210b6d[_0x1db88a(0xe1)],_0x4d928e);}catch(_0x14b069){_0x210b6d['ktvcW'](log,_0x210b6d[_0x1db88a(0xce)],_0x14b069);}const _0x5b6c5d=new Promise((_0x586dc1,_0x3fe088)=>{const _0x4ca18b=_0x1db88a,_0x981f60={'QihSJ':function(_0x326d44,_0x43d4f6){const _0x10f81d=_0x2cd0;return _0x210b6d[_0x10f81d(0xcb)](_0x326d44,_0x43d4f6);}},_0x3a20a6=_0x3eb7ce+_0x4ca18b(0xba),_0x331c8d=_0x3fecc0[_0x4ca18b(0xbc)](_0x46d0d5,_0x3a20a6);_0x210b6d['tpORS'](_0x320dc2,_0x51a440)['on'](_0x4ca18b(0xb9),()=>{})['on'](_0x210b6d[_0x4ca18b(0xc8)],_0x148cde=>{const _0x3621fb=_0x4ca18b;_0x210b6d[_0x3621fb(0xbe)](log,_0x210b6d[_0x3621fb(0xa9)],_0x148cde),_0x4fe90d?_0xa51557[_0x3621fb(0xc4)](_0x4fe90d,_0x331c8d)[_0x3621fb(0xa5)](()=>{_0x586dc1(_0x331c8d);})[_0x3621fb(0xcf)](_0x3fe088):_0xa51557[_0x3621fb(0xbb)](_0x331c8d,defaultVideoThumb)['then'](()=>{const _0x173ed6=_0x3621fb;_0x981f60[_0x173ed6(0xcd)](_0x586dc1,_0x331c8d);})[_0x3621fb(0xcf)](_0x3fe088);})[_0x4ca18b(0xa1)]({'timestamps':[0x0],'filename':_0x3a20a6,'folder':_0x46d0d5,'size':_0x210b6d[_0x4ca18b(0xb6)](_0x210b6d['TFNbS'](_0x4d928e[_0x4ca18b(0xd4)],'x'),_0x4d928e['height'])})['on'](_0x210b6d['PAXcs'],()=>{const _0x539b75=_0x4ca18b;_0x981f60[_0x539b75(0xcd)](_0x586dc1,_0x331c8d);});}),_0x2a839e=new Map(),_0x146266=await _0x5b6c5d,_0x398703=(await _0xa51557[_0x1db88a(0xda)](_0x146266))['size'];_0x2a839e['set'](0x0,_0x146266);const _0x588eb0=await calculateFileMD5(_0x146266),_0x30af3b={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x210b6d[_0x1db88a(0xb3)](_0x2b26cf,_0x4f375f),'filePath':_0x9e759a,'videoMd5':_0x3eb7ce,'thumbMd5':_0x588eb0,'fileTime':_0x4d928e[_0x1db88a(0xcc)],'thumbPath':_0x2a839e,'thumbSize':_0x398703,'thumbWidth':_0x4d928e[_0x1db88a(0xd4)],'thumbHeight':_0x4d928e[_0x1db88a(0xc5)],'fileSize':_0x210b6d[_0x1db88a(0xae)]('',_0x1ea816)}};return _0x30af3b;}static async['ptt'](_0x217879){const _0x2adfca=_0x421d43,_0x50f886={'NxXLv':function(_0x432ba6,_0x317c47){return _0x432ba6===_0x317c47;},'BfBEM':'文件异常，大小为0'},{converted:_0x10ca71,path:_0x31d47a,duration:_0xc55677}=await encodeSilk(_0x217879),{md5:_0x35f079,fileName:_0x394889,path:_0x489497,fileSize:_0x508c5a}=await NTQQFileApi['uploadFile'](_0x31d47a,ElementType[_0x2adfca(0xdd)]);if(_0x50f886[_0x2adfca(0xdf)](_0x508c5a,0x0))throw _0x50f886[_0x2adfca(0xd2)];return _0x10ca71&&_0xa51557[_0x2adfca(0xb0)](_0x31d47a)['then'](),{'elementType':ElementType[_0x2adfca(0xdd)],'elementId':'','pttElement':{'fileName':_0x394889,'filePath':_0x489497,'md5HexStr':_0x35f079,'fileSize':_0x508c5a,'duration':_0xc55677||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x421d43(0xb7)](_0x34d759){return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x34d759,'faceType':0x1}};}static[_0x421d43(0xab)](_0x435cb9){const _0x38f858=_0x421d43;return{'elementType':ElementType[_0x38f858(0xb8)],'elementId':'','arkElement':{'bytesData':_0x435cb9,'linkInfo':null,'subElementType':null}};}}