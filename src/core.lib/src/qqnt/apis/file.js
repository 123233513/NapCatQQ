const _0x48d97c=_0x2bd3;(function(_0x3fdf39,_0xc17cae){const _0x2daaad=_0x2bd3,_0x3e95a2=_0x3fdf39();while(!![]){try{const _0x28d8cf=-parseInt(_0x2daaad(0x1e8))/0x1+parseInt(_0x2daaad(0x1ee))/0x2*(-parseInt(_0x2daaad(0x1d9))/0x3)+-parseInt(_0x2daaad(0x1da))/0x4+parseInt(_0x2daaad(0x1e2))/0x5+-parseInt(_0x2daaad(0x1e9))/0x6+-parseInt(_0x2daaad(0x1df))/0x7+parseInt(_0x2daaad(0x1d4))/0x8;if(_0x28d8cf===_0xc17cae)break;else _0x3e95a2['push'](_0x3e95a2['shift']());}catch(_0x143302){_0x3e95a2['push'](_0x3e95a2['shift']());}}}(_0x4359,0x39f27));function _0x4359(){const _0x2ea4d6=['copyFile','service','wrapper','8406656ipczck','startsWith','jSoxR','getFileType','indexOf','2685qhjEqZ','1718784auOZwx','msgId','aQXna','removeKernelMsgListener','PIC','610512zsqRQz','xBCdB','join','1968125JkKqCj','kernelService','ynrfx','onRichMediaDownloadComplete','msg','BldwE','130182fCxSDo','1904802IJuuVs','mClmF','ext','uploadFile','existsSync','542TlyTcU','util','downloadMedia','下载超时','getFileSize'];_0x4359=function(){return _0x2ea4d6;};return _0x4359();}import{ElementType}from'@/core/qqnt/entities';import _0x49ad01 from'path';import _0x2e2bb8 from'fs';import{napCatCore}from'@/core';import{calculateFileMD5}from'@/common/utils/file';import*as _0x1faff5 from'file-type';import{MsgListener}from'@/core/qqnt/listeners';import _0x16642d from'image-size';function _0x2bd3(_0xb4dc4e,_0x7df888){const _0x435932=_0x4359();return _0x2bd3=function(_0x2bd3a9,_0x1158de){_0x2bd3a9=_0x2bd3a9-0x1cf;let _0x20aacd=_0x435932[_0x2bd3a9];return _0x20aacd;},_0x2bd3(_0xb4dc4e,_0x7df888);}import{sessionConfig}from'@/core/qqnt/sessionConfig';export class NTQQFileApi{static async[_0x48d97c(0x1d7)](_0x449fb9){return _0x1faff5['fileTypeFromFile'](_0x449fb9);}static async[_0x48d97c(0x1d1)](_0x6cf06,_0x2a29ae){const _0x3a78e3=_0x48d97c;await napCatCore['wrapper']['util'][_0x3a78e3(0x1d1)](_0x6cf06,_0x2a29ae);}static async['getFileSize'](_0x875bec){const _0xfa3241=_0x48d97c;return await napCatCore[_0xfa3241(0x1d3)][_0xfa3241(0x1ef)][_0xfa3241(0x1d0)](_0x875bec);}static async[_0x48d97c(0x1ec)](_0x273a8b,_0xdc6b55=ElementType[_0x48d97c(0x1de)],_0x37ab0d=0x0){const _0x449abd=_0x48d97c,_0xf72749={'ZkEfr':function(_0x4c670a,_0x44b427){return _0x4c670a+_0x44b427;},'ynrfx':function(_0x22299d,_0x5c8754){return _0x22299d===_0x5c8754;}},_0x1a6cdc=await calculateFileMD5(_0x273a8b);let _0x17990b=(await NTQQFileApi[_0x449abd(0x1d7)](_0x273a8b))?.[_0x449abd(0x1eb)]||'';_0x17990b&&(_0x17990b=_0xf72749['ZkEfr']('.',_0x17990b));let _0x1738ae=''+_0x49ad01['basename'](_0x273a8b);_0xf72749[_0x449abd(0x1e4)](_0x1738ae[_0x449abd(0x1d8)]('.'),-0x1)&&(_0x1738ae+=_0x17990b);const _0x2acbce=napCatCore[_0x449abd(0x1d2)]['msg'][_0x449abd(0x1e3)]['getRichMediaFilePathForGuild']({'md5HexStr':_0x1a6cdc,'fileName':_0x1738ae,'elementType':_0xdc6b55,'elementSubType':_0x37ab0d,'thumbSize':0x0,'needCreate':!![],'downloadType':0x1,'file_uuid':''});await NTQQFileApi[_0x449abd(0x1d1)](_0x273a8b,_0x2acbce);const _0x147df4=await NTQQFileApi[_0x449abd(0x1d0)](_0x273a8b);return{'md5':_0x1a6cdc,'fileName':_0x1738ae,'path':_0x2acbce,'fileSize':_0x147df4,'ext':_0x17990b};}static async[_0x48d97c(0x1f0)](_0x4fc979,_0x4a0884,_0x1edc58,_0x4d7416,_0x56715e,_0x4a46a3,_0x45f5ba=0x3e8*0x3c*0x2){const _0x47251c=_0x48d97c,_0x4f2f23={'aQXna':function(_0x2d454c,_0x30aa0e){return _0x2d454c(_0x30aa0e);},'wgdih':_0x47251c(0x1cf),'mClmF':function(_0xbca67b,_0x493357,_0x40a77b){return _0xbca67b(_0x493357,_0x40a77b);}};if(_0x4a46a3&&_0x2e2bb8[_0x47251c(0x1ed)](_0x4a46a3))return _0x4a46a3;const _0x15d1d9=new MsgListener();return new Promise((_0x1a052e,_0x4b45fb)=>{const _0x1a734d=_0x47251c,_0x478665={'BldwE':function(_0x1c70ab,_0x3d389e){return _0x1c70ab(_0x3d389e);}};let _0x5b9089=![];_0x15d1d9[_0x1a734d(0x1e5)]=_0x4bf6c8=>{const _0x14c87f=_0x1a734d;if(_0x4bf6c8[_0x14c87f(0x1db)]===_0x4fc979){_0x5b9089=!![];let _0x1be9d2=_0x4bf6c8['filePath'];if(_0x1be9d2[_0x14c87f(0x1d5)]('\x5c')){const _0x4f831c=sessionConfig?.['defaultFileDownloadPath'];_0x1be9d2=_0x49ad01[_0x14c87f(0x1e1)](_0x4f831c,_0x1be9d2);}_0x478665[_0x14c87f(0x1e7)](_0x1a052e,_0x1be9d2),napCatCore[_0x14c87f(0x1d2)][_0x14c87f(0x1e6)][_0x14c87f(0x1e3)]?.[_0x14c87f(0x1dd)](_0x3fbfc9);}};const _0x3fbfc9=napCatCore[_0x1a734d(0x1d2)][_0x1a734d(0x1e6)]['addMsgListener'](_0x15d1d9);_0x4f2f23[_0x1a734d(0x1ea)](setTimeout,()=>{const _0x2bd1f4=_0x1a734d;!_0x5b9089&&(_0x4f2f23[_0x2bd1f4(0x1dc)](_0x4b45fb,new Error(_0x4f2f23['wgdih'])),napCatCore[_0x2bd1f4(0x1d2)][_0x2bd1f4(0x1e6)][_0x2bd1f4(0x1e3)]?.[_0x2bd1f4(0x1dd)](_0x3fbfc9));},_0x45f5ba),napCatCore[_0x1a734d(0x1d2)][_0x1a734d(0x1e6)]['kernelService']?.['downloadRichMedia']({'fileModelId':'0','downloadSourceType':0x0,'triggerType':0x1,'msgId':_0x4fc979,'chatType':_0x4a0884,'peerUid':_0x1edc58,'elementId':_0x4d7416,'thumbSize':0x0,'downloadType':0x1,'filePath':_0x56715e});});}static async['getImageSize'](_0xdb1f5f){const _0x270538={'xBCdB':function(_0xc763d3,_0x4203e0,_0x55c309){return _0xc763d3(_0x4203e0,_0x55c309);}};return new Promise((_0x57f30b,_0x16fcb8)=>{const _0x2a4ad2=_0x2bd3,_0x527407={'jSoxR':function(_0x2519ad,_0x858c1b){return _0x2519ad(_0x858c1b);}};_0x270538[_0x2a4ad2(0x1e0)](_0x16642d,_0xdb1f5f,(_0x309dd4,_0x1748f2)=>{const _0x24b9ba=_0x2a4ad2;_0x309dd4?_0x527407[_0x24b9ba(0x1d6)](_0x16fcb8,_0x309dd4):_0x527407[_0x24b9ba(0x1d6)](_0x57f30b,_0x1748f2);});});}}