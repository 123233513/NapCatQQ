const _0x201ddd=_0x1d85;(function(_0x3663f7,_0x471740){const _0x422e2f=_0x1d85,_0x8efbd7=_0x3663f7();while(!![]){try{const _0x1732ff=parseInt(_0x422e2f(0x1e2))/0x1*(parseInt(_0x422e2f(0x203))/0x2)+parseInt(_0x422e2f(0x200))/0x3*(parseInt(_0x422e2f(0x1f5))/0x4)+parseInt(_0x422e2f(0x1ff))/0x5+parseInt(_0x422e2f(0x1eb))/0x6*(-parseInt(_0x422e2f(0x1fb))/0x7)+-parseInt(_0x422e2f(0x1fa))/0x8+-parseInt(_0x422e2f(0x1e8))/0x9*(parseInt(_0x422e2f(0x208))/0xa)+-parseInt(_0x422e2f(0x1f4))/0xb*(parseInt(_0x422e2f(0x1f9))/0xc);if(_0x1732ff===_0x471740)break;else _0x8efbd7['push'](_0x8efbd7['shift']());}catch(_0x43d29d){_0x8efbd7['push'](_0x8efbd7['shift']());}}}(_0x30fc,0xbba52));import{ElementType}from'@/core/qqnt/entities';import _0x52d7e7 from'path';function _0x30fc(){const _0xd6a936=['2750741MhxXgs','downloadMedia','defaultFileDownloadPath','OxHvg','4641070pSaokd','114483NWRdgP','filePath','join','61170MlsPAB','existsSync','copyFile','getFileType','msg','10clWduL','jhlZZ','13SSjtcG','RUhmz','Vajkd','Vjvlq','kernelService','下载超时','2720691vsWZxz','ext','util','6BBdmFk','wrapper','service','getFileSize','removeKernelMsgListener','PIC','startsWith','onRichMediaDownloadComplete','addMsgListener','1155781HzEcJB','36DDoXch','uploadFile','fileTypeFromFile','vMwoe','12NzSPep','802728yQxsYv'];_0x30fc=function(){return _0xd6a936;};return _0x30fc();}import _0x3e9e6b from'fs';function _0x1d85(_0x4f2878,_0xc7b21f){const _0x30fcd2=_0x30fc();return _0x1d85=function(_0x1d8560,_0x3341d5){_0x1d8560=_0x1d8560-0x1e1;let _0x17402b=_0x30fcd2[_0x1d8560];return _0x17402b;},_0x1d85(_0x4f2878,_0xc7b21f);}import{napCatCore}from'@/core';import{calculateFileMD5}from'@/common/utils/file';import*as _0x57207d from'file-type';import{MsgListener}from'@/core/qqnt/listeners';import _0x1d1580 from'image-size';import{sessionConfig}from'@/core/qqnt/sessionConfig';export class NTQQFileApi{static async[_0x201ddd(0x206)](_0x4e002d){const _0x1b04fa=_0x201ddd;return _0x57207d[_0x1b04fa(0x1f7)](_0x4e002d);}static async[_0x201ddd(0x205)](_0x11a2f9,_0x1f12ba){const _0x196fb5=_0x201ddd;await napCatCore[_0x196fb5(0x1ec)][_0x196fb5(0x1ea)][_0x196fb5(0x205)](_0x11a2f9,_0x1f12ba);}static async[_0x201ddd(0x1ee)](_0x2c9d2f){const _0x2829b9=_0x201ddd;return await napCatCore[_0x2829b9(0x1ec)][_0x2829b9(0x1ea)][_0x2829b9(0x1ee)](_0x2c9d2f);}static async[_0x201ddd(0x1f6)](_0xd87f4d,_0x4129b4=ElementType[_0x201ddd(0x1f0)],_0xab61a=0x0){const _0x2be4db=_0x201ddd,_0x43aef1={'jhlZZ':function(_0x32fae3,_0x171216){return _0x32fae3(_0x171216);},'Vajkd':function(_0x255abd,_0x110622){return _0x255abd+_0x110622;}},_0x276230=await _0x43aef1[_0x2be4db(0x1e1)](calculateFileMD5,_0xd87f4d);let _0x33dda5=(await NTQQFileApi[_0x2be4db(0x206)](_0xd87f4d))?.[_0x2be4db(0x1e9)]||'';_0x33dda5&&(_0x33dda5=_0x43aef1[_0x2be4db(0x1e4)]('.',_0x33dda5));let _0x3761de=''+_0x52d7e7['basename'](_0xd87f4d);_0x3761de['indexOf']('.')===-0x1&&(_0x3761de+=_0x33dda5);const _0x297829=napCatCore[_0x2be4db(0x1ed)][_0x2be4db(0x207)]['kernelService']['getRichMediaFilePathForGuild']({'md5HexStr':_0x276230,'fileName':_0x3761de,'elementType':_0x4129b4,'elementSubType':_0xab61a,'thumbSize':0x0,'needCreate':!![],'downloadType':0x1,'file_uuid':''});await NTQQFileApi[_0x2be4db(0x205)](_0xd87f4d,_0x297829);const _0x20e74f=await NTQQFileApi['getFileSize'](_0xd87f4d);return{'md5':_0x276230,'fileName':_0x3761de,'path':_0x297829,'fileSize':_0x20e74f,'ext':_0x33dda5};}static async[_0x201ddd(0x1fc)](_0x53a639,_0x3f4884,_0x4b4d53,_0x253a0d,_0xaa91ef,_0xabebc5,_0x200193=0x3e8*0x3c*0x2){const _0x2cd829=_0x201ddd,_0x5d0204={'OxHvg':function(_0x521447,_0x3c30e0){return _0x521447(_0x3c30e0);},'RLTBE':function(_0x55d35d,_0x4a0c66){return _0x55d35d(_0x4a0c66);},'Vjvlq':_0x2cd829(0x1e7),'RUhmz':function(_0x285d42,_0x441e27,_0x567152){return _0x285d42(_0x441e27,_0x567152);}};if(_0xabebc5&&_0x3e9e6b[_0x2cd829(0x204)](_0xabebc5))return _0xabebc5;const _0x2d2de3=new MsgListener();return new Promise((_0xef1555,_0x1f10ba)=>{const _0x2d0dd4=_0x2cd829;let _0x16130a=![];_0x2d2de3[_0x2d0dd4(0x1f2)]=_0x3712ba=>{const _0x1747c8=_0x2d0dd4;if(_0x3712ba['msgId']===_0x53a639){_0x16130a=!![];let _0x2939c4=_0x3712ba[_0x1747c8(0x201)];if(_0x2939c4[_0x1747c8(0x1f1)]('\x5c')){const _0x1d11a2=sessionConfig?.[_0x1747c8(0x1fd)];_0x2939c4=_0x52d7e7[_0x1747c8(0x202)](_0x1d11a2,_0x2939c4);}_0x5d0204[_0x1747c8(0x1fe)](_0xef1555,_0x2939c4),napCatCore[_0x1747c8(0x1ed)]['msg'][_0x1747c8(0x1e6)]?.['removeKernelMsgListener'](_0xeeacf1);}};const _0xeeacf1=napCatCore['service']['msg'][_0x2d0dd4(0x1f3)](_0x2d2de3);_0x5d0204[_0x2d0dd4(0x1e3)](setTimeout,()=>{const _0x12144f=_0x2d0dd4;!_0x16130a&&(_0x5d0204['RLTBE'](_0x1f10ba,new Error(_0x5d0204[_0x12144f(0x1e5)])),napCatCore[_0x12144f(0x1ed)][_0x12144f(0x207)][_0x12144f(0x1e6)]?.[_0x12144f(0x1ef)](_0xeeacf1));},_0x200193),napCatCore[_0x2d0dd4(0x1ed)][_0x2d0dd4(0x207)]['kernelService']?.['downloadRichMedia']({'fileModelId':'0','downloadSourceType':0x0,'triggerType':0x1,'msgId':_0x53a639,'chatType':_0x3f4884,'peerUid':_0x4b4d53,'elementId':_0x253a0d,'thumbSize':0x0,'downloadType':0x1,'filePath':_0xaa91ef});});}static async['getImageSize'](_0x1d582a){const _0xd25436={'vMwoe':function(_0x3e6450,_0x5a5869){return _0x3e6450(_0x5a5869);},'Hqtyg':function(_0x50061f,_0xb6632d,_0x7bc7c0){return _0x50061f(_0xb6632d,_0x7bc7c0);}};return new Promise((_0x31efd3,_0x3ee353)=>{_0xd25436['Hqtyg'](_0x1d1580,_0x1d582a,(_0xf9a96c,_0x57f7f1)=>{const _0x450de8=_0x1d85;_0xf9a96c?_0xd25436[_0x450de8(0x1f8)](_0x3ee353,_0xf9a96c):_0xd25436['vMwoe'](_0x31efd3,_0x57f7f1);});});}}