const _0x27abcd=_0x454d;(function(_0x186060,_0x31edf8){const _0x168273=_0x454d,_0x13e5d8=_0x186060();while(!![]){try{const _0x318ab3=-parseInt(_0x168273(0xe0))/0x1+parseInt(_0x168273(0xf4))/0x2+parseInt(_0x168273(0xf5))/0x3*(parseInt(_0x168273(0xdc))/0x4)+-parseInt(_0x168273(0xf6))/0x5+-parseInt(_0x168273(0xe8))/0x6+-parseInt(_0x168273(0xea))/0x7*(-parseInt(_0x168273(0xe9))/0x8)+-parseInt(_0x168273(0xe3))/0x9*(-parseInt(_0x168273(0xda))/0xa);if(_0x318ab3===_0x31edf8)break;else _0x13e5d8['push'](_0x13e5d8['shift']());}catch(_0x1e8b6d){_0x13e5d8['push'](_0x13e5d8['shift']());}}}(_0x4bad,0xac1e2));function _0x4bad(){const _0x1b1dd2=['thbOJ','MWWeI','3814PcKhGA','UIQWN','defaultFileDownloadPath','9nDiVSh','PWYmw','startsWith','removeKernelMsgListener','kVTnm','6335550YYvnFD','10616bEgnRW','2135irJbEb','PIC','wrapper','msg','EgtaR','service','nPcMB','copyFile','下载超时','GIJLL','201628Kfbcvv','87YTFZRd','790685AtYJXq','tTpNN','basename','getRichMediaFilePathForGuild','uploadFile','util','jwqWm','JmzYy','existsSync','getFileSize','msgId','fileTypeFromFile','kernelService','XLumS','filePath','indexOf','6809820LGpMTP','downloadRichMedia','101564OfZfjF','GQSfq'];_0x4bad=function(){return _0x1b1dd2;};return _0x4bad();}import{ElementType}from'@/core/qqnt/entities';import _0x4c767a from'path';import _0x39a772 from'fs';import{napCatCore}from'@/core';import{calculateFileMD5}from'@/common/utils/file';import*as _0x395334 from'file-type';import{MsgListener}from'@/core/qqnt/listeners';import _0x1962f5 from'image-size';function _0x454d(_0x1f7edd,_0x2bb198){const _0x4badca=_0x4bad();return _0x454d=function(_0x454d8d,_0x2f1b7b){_0x454d8d=_0x454d8d-0xd9;let _0x1c14fc=_0x4badca[_0x454d8d];return _0x1c14fc;},_0x454d(_0x1f7edd,_0x2bb198);}import{sessionConfig}from'@/core/qqnt/sessionConfig';export class NTQQFileApi{static async['getFileType'](_0x7b2462){const _0x19f8bb=_0x454d;return _0x395334[_0x19f8bb(0x101)](_0x7b2462);}static async[_0x27abcd(0xf1)](_0x202608,_0x5eeadc){const _0x4a1e59=_0x27abcd;await napCatCore['wrapper'][_0x4a1e59(0xfb)][_0x4a1e59(0xf1)](_0x202608,_0x5eeadc);}static async[_0x27abcd(0xff)](_0x207f48){const _0x514b90=_0x27abcd;return await napCatCore[_0x514b90(0xec)][_0x514b90(0xfb)][_0x514b90(0xff)](_0x207f48);}static async[_0x27abcd(0xfa)](_0x3c26bf,_0x546166=ElementType[_0x27abcd(0xeb)],_0x1351ed=0x0){const _0x594a52=_0x27abcd,_0x2663b2={'MWWeI':function(_0x14975a,_0x55cd48){return _0x14975a(_0x55cd48);},'GQSfq':function(_0x202c1d,_0x382501){return _0x202c1d+_0x382501;},'AutkZ':function(_0x4f8a4b,_0x4d4214){return _0x4f8a4b===_0x4d4214;}},_0x14ac67=await _0x2663b2[_0x594a52(0xdf)](calculateFileMD5,_0x3c26bf);let _0x2b3b1a=(await NTQQFileApi['getFileType'](_0x3c26bf))?.['ext']||'';_0x2b3b1a&&(_0x2b3b1a=_0x2663b2[_0x594a52(0xdd)]('.',_0x2b3b1a));let _0x770118=''+_0x4c767a[_0x594a52(0xf8)](_0x3c26bf);_0x2663b2['AutkZ'](_0x770118[_0x594a52(0xd9)]('.'),-0x1)&&(_0x770118+=_0x2b3b1a);const _0x576b94=napCatCore['service'][_0x594a52(0xed)][_0x594a52(0x102)][_0x594a52(0xf9)]({'md5HexStr':_0x14ac67,'fileName':_0x770118,'elementType':_0x546166,'elementSubType':_0x1351ed,'thumbSize':0x0,'needCreate':!![],'downloadType':0x1,'file_uuid':''});await NTQQFileApi[_0x594a52(0xf1)](_0x3c26bf,_0x576b94);const _0x584f87=await NTQQFileApi[_0x594a52(0xff)](_0x3c26bf);return{'md5':_0x14ac67,'fileName':_0x770118,'path':_0x576b94,'fileSize':_0x584f87,'ext':_0x2b3b1a};}static async['downloadMedia'](_0x156b85,_0xee3d6f,_0x517bcd,_0x510caf,_0x36fcc9,_0x329c6d,_0x5e91ab=0x3e8*0x3c*0x2){const _0x29bc33=_0x27abcd,_0x232042={'tTpNN':function(_0x3e568a,_0x4433ae){return _0x3e568a===_0x4433ae;},'JmzYy':function(_0x48393d,_0x1a3cca){return _0x48393d(_0x1a3cca);},'EgtaR':_0x29bc33(0xf2),'thbOJ':function(_0x5b5634,_0x546d21,_0x815b1){return _0x5b5634(_0x546d21,_0x815b1);}};if(_0x329c6d&&_0x39a772[_0x29bc33(0xfe)](_0x329c6d))return _0x329c6d;const _0x526a2c=new MsgListener();return new Promise((_0x38b9b0,_0x593518)=>{const _0x4a077d=_0x29bc33,_0x24993c={'GIJLL':function(_0x108ed1,_0x362163){const _0x341840=_0x454d;return _0x232042[_0x341840(0xf7)](_0x108ed1,_0x362163);},'nPcMB':function(_0x17145f,_0x528c9b){const _0x40ce1d=_0x454d;return _0x232042[_0x40ce1d(0xfd)](_0x17145f,_0x528c9b);},'PWYmw':function(_0x59543c,_0x423c8e){return _0x59543c(_0x423c8e);},'XLumS':_0x232042[_0x4a077d(0xee)]};let _0x84f38f=![];_0x526a2c['onRichMediaDownloadComplete']=_0x189ec2=>{const _0x3fe4cd=_0x4a077d;if(_0x24993c[_0x3fe4cd(0xf3)](_0x189ec2[_0x3fe4cd(0x100)],_0x156b85)){_0x84f38f=!![];let _0x2b1d7e=_0x189ec2[_0x3fe4cd(0x104)];if(_0x2b1d7e[_0x3fe4cd(0xe5)]('\x5c')){const _0x415221=sessionConfig?.[_0x3fe4cd(0xe2)];_0x2b1d7e=_0x4c767a['join'](_0x415221,_0x2b1d7e);}_0x24993c[_0x3fe4cd(0xf0)](_0x38b9b0,_0x2b1d7e),napCatCore[_0x3fe4cd(0xef)][_0x3fe4cd(0xed)][_0x3fe4cd(0x102)]?.[_0x3fe4cd(0xe6)](_0x1944c5);}};const _0x1944c5=napCatCore['service'][_0x4a077d(0xed)]['addMsgListener'](_0x526a2c);_0x232042[_0x4a077d(0xde)](setTimeout,()=>{const _0x194838=_0x4a077d;!_0x84f38f&&(_0x24993c[_0x194838(0xe4)](_0x593518,new Error(_0x24993c[_0x194838(0x103)])),napCatCore['service']['msg'][_0x194838(0x102)]?.[_0x194838(0xe6)](_0x1944c5));},_0x5e91ab),napCatCore['service']['msg']['kernelService']?.[_0x4a077d(0xdb)]({'fileModelId':'0','downloadSourceType':0x0,'triggerType':0x1,'msgId':_0x156b85,'chatType':_0xee3d6f,'peerUid':_0x517bcd,'elementId':_0x510caf,'thumbSize':0x0,'downloadType':0x1,'filePath':_0x36fcc9});});}static async['getImageSize'](_0x2f0624){const _0x4eeeab={'kVTnm':function(_0x353db8,_0x43b7ce){return _0x353db8(_0x43b7ce);},'UIQWN':function(_0xbd2ca7,_0x1cd60a,_0x47fb7b){return _0xbd2ca7(_0x1cd60a,_0x47fb7b);}};return new Promise((_0x23cde8,_0x1cd3fe)=>{const _0x16e262=_0x454d,_0x5b2b62={'jwqWm':function(_0x3ccb0b,_0x1714d1){const _0x56ad22=_0x454d;return _0x4eeeab[_0x56ad22(0xe7)](_0x3ccb0b,_0x1714d1);}};_0x4eeeab[_0x16e262(0xe1)](_0x1962f5,_0x2f0624,(_0x1fa08a,_0x51a172)=>{const _0x23bbd3=_0x16e262;_0x1fa08a?_0x1cd3fe(_0x1fa08a):_0x5b2b62[_0x23bbd3(0xfc)](_0x23cde8,_0x51a172);});});}}