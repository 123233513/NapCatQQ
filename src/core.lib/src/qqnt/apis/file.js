(function(_0x3c86bb,_0x4f8cf2){const _0x46fbe3=_0x21f9,_0x26ef5b=_0x3c86bb();while(!![]){try{const _0x29922a=parseInt(_0x46fbe3(0x19a))/0x1+parseInt(_0x46fbe3(0x1b5))/0x2+-parseInt(_0x46fbe3(0x1c2))/0x3*(-parseInt(_0x46fbe3(0x16f))/0x4)+-parseInt(_0x46fbe3(0x198))/0x5*(-parseInt(_0x46fbe3(0x190))/0x6)+-parseInt(_0x46fbe3(0x1ae))/0x7*(parseInt(_0x46fbe3(0x15b))/0x8)+parseInt(_0x46fbe3(0x1a3))/0x9*(-parseInt(_0x46fbe3(0x1b3))/0xa)+-parseInt(_0x46fbe3(0x1bb))/0xb*(-parseInt(_0x46fbe3(0x1c4))/0xc);if(_0x29922a===_0x4f8cf2)break;else _0x26ef5b['push'](_0x26ef5b['shift']());}catch(_0x61f0d6){_0x26ef5b['push'](_0x26ef5b['shift']());}}}(_0x2d2a,0xb8e8c));const _0x473677=_0x1088;(function(_0x45f466,_0x10d048){const _0x484b45=_0x21f9,_0x160d4e={'aLRSN':function(_0x233d81){return _0x233d81();},'esDvp':function(_0xffdbc2,_0x4314c){return _0xffdbc2+_0x4314c;},'PBims':function(_0x3a9b22,_0x48d7ef){return _0x3a9b22+_0x48d7ef;},'NnOow':function(_0x15840f,_0x579043){return _0x15840f/_0x579043;},'onkML':function(_0x5e181d,_0x47a217){return _0x5e181d(_0x47a217);},'LUnqd':function(_0x175f9c,_0x4794d7){return _0x175f9c*_0x4794d7;},'lVUeA':function(_0xc6af79,_0x1f8885){return _0xc6af79/_0x1f8885;},'uMQlR':function(_0x5aedec,_0x770011){return _0x5aedec(_0x770011);},'LMTlm':function(_0x32696c,_0x127146){return _0x32696c/_0x127146;},'eqIol':function(_0x1404af,_0x3a555a){return _0x1404af(_0x3a555a);},'omUjH':function(_0x323073,_0x1b4662){return _0x323073/_0x1b4662;},'THCRa':function(_0x2b138e,_0x386d11){return _0x2b138e(_0x386d11);},'CDJXc':function(_0x1f9db2,_0x7215b){return _0x1f9db2(_0x7215b);},'urgDp':function(_0x9b67f4,_0x222c77){return _0x9b67f4/_0x222c77;},'jlZvk':function(_0x57d2e5,_0x24424b){return _0x57d2e5(_0x24424b);},'gCCwE':function(_0x5242b6,_0x550ef1){return _0x5242b6/_0x550ef1;},'YlZFR':function(_0x26bb86,_0x7ebc8c){return _0x26bb86===_0x7ebc8c;},'XumKi':_0x484b45(0x1a0)},_0x359074=_0x1088,_0x4c1eef=_0x160d4e[_0x484b45(0x1bd)](_0x45f466);while(!![]){try{const _0x51a3ae=_0x160d4e[_0x484b45(0x15e)](_0x160d4e[_0x484b45(0x1bf)](_0x160d4e['PBims'](_0x160d4e['PBims'](_0x160d4e[_0x484b45(0x167)](_0x160d4e[_0x484b45(0x19f)](parseInt,_0x160d4e[_0x484b45(0x19f)](_0x359074,0xab)),0x1)*(_0x160d4e['onkML'](parseInt,_0x359074(0xb4))/0x2),_0x160d4e['LUnqd'](_0x160d4e[_0x484b45(0x1b2)](-_0x160d4e[_0x484b45(0x19f)](parseInt,_0x160d4e[_0x484b45(0x19f)](_0x359074,0xb3)),0x3),_0x160d4e[_0x484b45(0x167)](-_0x160d4e[_0x484b45(0x180)](parseInt,_0x160d4e['onkML'](_0x359074,0xc1)),0x4))),_0x160d4e['LMTlm'](-parseInt(_0x160d4e[_0x484b45(0x1b0)](_0x359074,0xc5)),0x5)),_0x160d4e[_0x484b45(0x168)](_0x160d4e['onkML'](parseInt,_0x160d4e['onkML'](_0x359074,0xc3)),0x6)),_0x160d4e[_0x484b45(0x19d)](-_0x160d4e[_0x484b45(0x175)](parseInt,_0x160d4e[_0x484b45(0x1c1)](_0x359074,0xaa)),0x7))+_0x160d4e['urgDp'](-_0x160d4e[_0x484b45(0x1c1)](parseInt,_0x160d4e[_0x484b45(0x187)](_0x359074,0xc0)),0x8)+_0x160d4e[_0x484b45(0x16e)](_0x160d4e['lVUeA'](-_0x160d4e[_0x484b45(0x1c1)](parseInt,_0x359074(0xa9)),0x9),_0x160d4e[_0x484b45(0x1af)](-_0x160d4e[_0x484b45(0x1b0)](parseInt,_0x359074(0xbe)),0xa));if(_0x160d4e['YlZFR'](_0x51a3ae,_0x10d048))break;else _0x4c1eef[_0x484b45(0x16c)](_0x4c1eef[_0x160d4e[_0x484b45(0x169)]]());}catch(_0x5123e0){_0x4c1eef[_0x484b45(0x16c)](_0x4c1eef[_0x160d4e[_0x484b45(0x169)]]());}}}(_0x573e,0x68c21));import{ElementType}from'@/core/qqnt/entities';import _0x49a8fd from'path';function _0x1088(_0xacc0fd,_0x116fcf){const _0x1035fc=_0x21f9,_0x52afdc={'PTEqg':function(_0x8cd26f,_0x44a99b){return _0x8cd26f-_0x44a99b;},'iDKTK':function(_0x2b1c62){return _0x2b1c62();},'iumSs':function(_0x3c1401,_0x22952d,_0x54a6b8){return _0x3c1401(_0x22952d,_0x54a6b8);}},_0x5ebce2=_0x52afdc[_0x1035fc(0x174)](_0x573e);return _0x1088=function(_0x662d98,_0xd7a3b4){_0x662d98=_0x52afdc['PTEqg'](_0x662d98,0xa6);let _0x715c9a=_0x5ebce2[_0x662d98];return _0x715c9a;},_0x52afdc[_0x1035fc(0x192)](_0x1088,_0xacc0fd,_0x116fcf);}import _0x284cc1 from'fs';import{napCatCore}from'@/core';import{calculateFileMD5}from'@/common/utils/file';import*as _0x2eced0 from'file-type';function _0x21f9(_0x51cf0f,_0x3930ff){const _0x2d2a46=_0x2d2a();return _0x21f9=function(_0x21f934,_0x38818b){_0x21f934=_0x21f934-0x15a;let _0x15d32d=_0x2d2a46[_0x21f934];return _0x15d32d;},_0x21f9(_0x51cf0f,_0x3930ff);}function _0x573e(){const _0x20906c=_0x21f9,_0x3dbb5c={'hpyRL':_0x20906c(0x171),'XuaTO':_0x20906c(0x18e),'yYiSE':_0x20906c(0x19e),'dgBRR':_0x20906c(0x16b),'BLltI':_0x20906c(0x164),'QjvGL':_0x20906c(0x1c5),'exFAJ':_0x20906c(0x195),'bHHko':_0x20906c(0x1c0),'YxnDZ':_0x20906c(0x17f),'dtXVJ':'TWJeJ','jDdAG':_0x20906c(0x1b1),'Mblon':_0x20906c(0x1b7),'ILLWS':_0x20906c(0x1c3),'zoVLn':_0x20906c(0x1a6),'QBgEI':_0x20906c(0x196),'KIWMi':_0x20906c(0x1c7),'xfOyH':_0x20906c(0x19c),'yfOFg':_0x20906c(0x165),'EJXtQ':_0x20906c(0x15a),'iiiFH':_0x20906c(0x178),'JqJSf':_0x20906c(0x176),'qIWuC':'defaultFileDownloadPath','CZjyr':_0x20906c(0x17b),'nPuAP':_0x20906c(0x1a2),'VoFfJ':_0x20906c(0x181),'bYMMf':function(_0x121250){return _0x121250();}},_0x311e69=[_0x3dbb5c['hpyRL'],_0x3dbb5c[_0x20906c(0x18f)],_0x20906c(0x16a),_0x3dbb5c[_0x20906c(0x17d)],_0x20906c(0x162),'baknI',_0x3dbb5c['dgBRR'],_0x3dbb5c['BLltI'],_0x3dbb5c[_0x20906c(0x197)],_0x3dbb5c['exFAJ'],_0x20906c(0x1a8),_0x3dbb5c[_0x20906c(0x18a)],'downloadRichMedia',_0x3dbb5c[_0x20906c(0x1a9)],_0x3dbb5c[_0x20906c(0x1ba)],_0x3dbb5c[_0x20906c(0x1a5)],_0x3dbb5c[_0x20906c(0x17a)],_0x3dbb5c[_0x20906c(0x194)],_0x3dbb5c[_0x20906c(0x182)],_0x20906c(0x19b),_0x3dbb5c['QBgEI'],_0x3dbb5c['KIWMi'],_0x3dbb5c[_0x20906c(0x177)],'下载超时',_0x3dbb5c[_0x20906c(0x179)],_0x3dbb5c[_0x20906c(0x189)],_0x3dbb5c[_0x20906c(0x166)],_0x3dbb5c[_0x20906c(0x1ac)],_0x3dbb5c['qIWuC'],_0x20906c(0x170),_0x20906c(0x15d),_0x20906c(0x193),_0x3dbb5c[_0x20906c(0x184)],_0x3dbb5c[_0x20906c(0x183)],_0x3dbb5c['VoFfJ'],_0x20906c(0x15c),_0x20906c(0x163)];return _0x573e=function(){return _0x311e69;},_0x3dbb5c[_0x20906c(0x161)](_0x573e);}import{MsgListener}from'@/core/qqnt/listeners';import _0x462575 from'image-size';function _0x2d2a(){const _0x304f8a=['basename','16ztnbVc','773832Tcorxz','1600bFKCUA','esDvp','RyPHa','RbjfL','bYMMf','getImageSize','IeZdI','wEjLP','join','iiiFH','NnOow','LMTlm','XumKi','getFileSize','addMsgListener','push','PFAFs','LUnqd','908MTpfec','msgId','3391825SjQoUR','rpmAG','hsmli','iDKTK','THCRa','copyFile','xfOyH','service','yfOFg','Mblon','2786912hcXjia','ysyCD','yYiSE','OnkZM','GLhIc','uMQlR','getRichMediaFilePathForGuild','zoVLn','nPuAP','CZjyr','Yzuuv','filePath','jlZvk','AbWXe','EJXtQ','bHHko','kQord','EpKxy','iSorz','msg','XuaTO','36KsAJXf','DfmmS','iumSs','HqeKG','ILLWS','86571iDJwkq','8INjGBu','QjvGL','32255WrkCcu','Tqjbu','884813FFTPyi','589839MBTmGE','getFileType','omUjH','wrapper','onkML','shift','FlHpw','4aKftyy','72degVGs','BREsD','jDdAG','removeKernelMsgListener','yfbYb','3669981WQcnMh','YxnDZ','BrDyV','aCopi','JqJSf','indexOf','4432834zMcHbz','gCCwE','eqIol','util','lVUeA','1670720UNcliA','cEXrn','2946228NcROzA','vJWML','existsSync','startsWith','MDeLx','dtXVJ','11NdyPDX','LohCr','aLRSN','fileTypeFromFile','PBims','28869oPFnJn','CDJXc','9939bjHSEO','PIC','2541648LeNnUt','ext','OUDZZ','kernelService','KLByH'];_0x2d2a=function(){return _0x304f8a;};return _0x2d2a();}import{sessionConfig}from'@/core/qqnt/sessionConfig';export class NTQQFileApi{static async[_0x473677(0xb6)](_0x48325b){const _0x221dcc=_0x21f9,_0x193063={'EpKxy':_0x221dcc(0x1be)};return _0x2eced0[_0x193063[_0x221dcc(0x18c)]](_0x48325b);}static async[_0x473677(0xbb)](_0x4618ef,_0x431206){const _0x52ead8=_0x21f9,_0x46d522={'BREsD':function(_0x5ca99c,_0x5d897b){return _0x5ca99c(_0x5d897b);}},_0x47462a=_0x473677;await napCatCore[_0x46d522[_0x52ead8(0x1a4)](_0x47462a,0xc8)][_0x46d522[_0x52ead8(0x1a4)](_0x47462a,0xaf)][_0x46d522[_0x52ead8(0x1a4)](_0x47462a,0xbb)](_0x4618ef,_0x431206);}static async[_0x473677(0xc7)](_0x4371f5){const _0x3acc57=_0x21f9,_0x2f74ec={'FlHpw':function(_0xca87a7,_0x426086){return _0xca87a7(_0x426086);},'yORdE':function(_0x209978,_0x2a8811){return _0x209978(_0x2a8811);},'RFZpG':_0x3acc57(0x16a)},_0x1f067a=_0x473677;return await napCatCore[_0x2f74ec[_0x3acc57(0x1a1)](_0x1f067a,0xc8)][_0x2f74ec['yORdE'](_0x1f067a,0xaf)][_0x2f74ec['RFZpG']](_0x4371f5);}static async['uploadFile'](_0x21c3b4,_0x3c393e=ElementType[_0x473677(0xb1)],_0x19f921=0x0){const _0xf1cc34=_0x21f9,_0x13f152={'Yzuuv':function(_0x5288a6,_0x4a85a9){return _0x5288a6(_0x4a85a9);},'vJWML':function(_0x13a1ba,_0x5634ce){return _0x13a1ba===_0x5634ce;},'yfbYb':_0xf1cc34(0x19c),'LohCr':function(_0x582b98,_0x3236d5){return _0x582b98(_0x3236d5);},'Tqjbu':function(_0x518ac2,_0x258bc8){return _0x518ac2(_0x258bc8);},'DfmmS':function(_0x2ce0f1,_0x4d94e4){return _0x2ce0f1(_0x4d94e4);},'PFAFs':_0xf1cc34(0x1ad),'AbWXe':function(_0x77487,_0x1a727c){return _0x77487(_0x1a727c);}},_0x27da54=_0x473677,_0x533341={'IeZdI':function(_0x1fb012,_0x34c7d4){const _0x1691c3=_0xf1cc34;return _0x13f152[_0x1691c3(0x185)](_0x1fb012,_0x34c7d4);},'GLhIc':function(_0x96a5df,_0x572a06){return _0x96a5df+_0x572a06;},'baknI':function(_0x422984,_0x4ff637){const _0x1ae2a3=_0xf1cc34;return _0x13f152[_0x1ae2a3(0x1b6)](_0x422984,_0x4ff637);}},_0x576518=await _0x533341[_0x27da54(0xc4)](calculateFileMD5,_0x21c3b4);let _0x11e209=(await NTQQFileApi[_0x13f152[_0xf1cc34(0x1a7)]](_0x21c3b4))?.[_0x13f152[_0xf1cc34(0x1bc)](_0x27da54,0xa8)]||'';_0x11e209&&(_0x11e209=_0x533341[_0x13f152[_0xf1cc34(0x199)](_0x27da54,0xad)]('.',_0x11e209));let _0x19193c=''+_0x49a8fd[_0x13f152[_0xf1cc34(0x191)](_0x27da54,0xb9)](_0x21c3b4);_0x533341[_0x13f152[_0xf1cc34(0x1bc)](_0x27da54,0xca)](_0x19193c[_0x13f152[_0xf1cc34(0x16d)]]('.'),-0x1)&&(_0x19193c+=_0x11e209);const _0x20554d=napCatCore[_0x27da54(0xba)][_0x27da54(0xc6)][_0x27da54(0xb5)][_0x27da54(0xc2)]({'md5HexStr':_0x576518,'fileName':_0x19193c,'elementType':_0x3c393e,'elementSubType':_0x19f921,'thumbSize':0x0,'needCreate':!![],'downloadType':0x1,'file_uuid':''});await NTQQFileApi[_0x13f152[_0xf1cc34(0x188)](_0x27da54,0xbb)](_0x21c3b4,_0x20554d);const _0x2baac0=await NTQQFileApi[_0x13f152['Yzuuv'](_0x27da54,0xc7)](_0x21c3b4);return{'md5':_0x576518,'fileName':_0x19193c,'path':_0x20554d,'fileSize':_0x2baac0,'ext':_0x11e209};}static async['downloadMedia'](_0x376f61,_0x1e0920,_0x2eb079,_0x2ec4bd,_0xf7e6bf,_0xdbbbc2,_0x34f724=0x3e8*0x3c*0x2){const _0xc2647a=_0x21f9,_0x32dc2a={'aCopi':function(_0x279dcd,_0x3fc022){return _0x279dcd(_0x3fc022);},'cEXrn':function(_0x3b3569,_0x27f812){return _0x3b3569===_0x27f812;},'KLByH':_0xc2647a(0x186),'rpmAG':_0xc2647a(0x1b8),'hsmli':function(_0x368e49,_0x3c294b){return _0x368e49(_0x3c294b);},'OnkZM':_0xc2647a(0x18e),'kQord':function(_0x2b67bb,_0x50e488){return _0x2b67bb(_0x50e488);},'fyGkY':function(_0x1f651c,_0xa2dda7){return _0x1f651c(_0xa2dda7);},'RbjfL':_0xc2647a(0x178),'ysyCD':'kernelService','MDeLx':'onRichMediaDownloadComplete','BrDyV':function(_0x342d09,_0x122a4a){return _0x342d09(_0x122a4a);},'OUDZZ':function(_0x4587f7,_0x4e978d){return _0x4587f7(_0x4e978d);},'RyPHa':function(_0x7ee00a,_0x37ee50){return _0x7ee00a(_0x37ee50);}},_0x343b9a=_0x473677,_0x343283={'HqeKG':_0x343b9a(0xb7),'wEjLP':function(_0x2e3c9a,_0x422251,_0xee0956){return _0x2e3c9a(_0x422251,_0xee0956);}};if(_0xdbbbc2&&_0x284cc1[_0x343b9a(0xb0)](_0xdbbbc2))return _0xdbbbc2;const _0x2d6d24=new MsgListener();return new Promise((_0x17adbf,_0x1e34de)=>{const _0x42c843=_0xc2647a,_0x3d821c=_0x343b9a,_0x187bdf={'TWJeJ':function(_0xbd124a,_0x25ec33){const _0x214cce=_0x21f9;return _0x32dc2a[_0x214cce(0x1ab)](_0xbd124a,_0x25ec33);}};let _0xa53d33=![];_0x2d6d24[_0x32dc2a[_0x42c843(0x1b9)]]=_0x4d7696=>{const _0x20aefa=_0x42c843,_0x4c7926=_0x1088;if(_0x32dc2a[_0x20aefa(0x1b4)](_0x4d7696[_0x32dc2a[_0x20aefa(0x1ab)](_0x4c7926,0xbd)],_0x376f61)){_0xa53d33=!![];let _0xc63676=_0x4d7696[_0x32dc2a[_0x20aefa(0x1c8)]];if(_0xc63676[_0x32dc2a[_0x20aefa(0x172)]]('\x5c')){const _0x28a10f=sessionConfig?.[_0x32dc2a[_0x20aefa(0x173)](_0x4c7926,0xbc)];_0xc63676=_0x49a8fd[_0x4c7926(0xb8)](_0x28a10f,_0xc63676);}_0x187bdf[_0x4c7926(0xae)](_0x17adbf,_0xc63676),napCatCore[_0x4c7926(0xba)][_0x32dc2a[_0x20aefa(0x17e)]][_0x32dc2a[_0x20aefa(0x18b)](_0x4c7926,0xb5)]?.[_0x4c7926(0xb2)](_0x41bbf5);}};const _0x41bbf5=napCatCore[_0x32dc2a[_0x42c843(0x173)](_0x3d821c,0xba)][_0x3d821c(0xc6)][_0x32dc2a[_0x42c843(0x1aa)](_0x3d821c,0xa6)](_0x2d6d24);_0x343283[_0x3d821c(0xa7)](setTimeout,()=>{const _0x3ba4b0=_0x42c843,_0x13e97a=_0x3d821c;!_0xa53d33&&(_0x32dc2a[_0x3ba4b0(0x173)](_0x1e34de,new Error(_0x343283[_0x32dc2a['fyGkY'](_0x13e97a,0xbf)])),napCatCore[_0x32dc2a[_0x3ba4b0(0x160)]][_0x13e97a(0xc6)][_0x32dc2a[_0x3ba4b0(0x17c)]]?.[_0x13e97a(0xb2)](_0x41bbf5));},_0x34f724),napCatCore[_0x32dc2a[_0x42c843(0x1c6)](_0x3d821c,0xba)][_0x32dc2a['hsmli'](_0x3d821c,0xc6)][_0x32dc2a[_0x42c843(0x15f)](_0x3d821c,0xb5)]?.[_0x32dc2a[_0x42c843(0x18b)](_0x3d821c,0xac)]({'fileModelId':'0','downloadSourceType':0x0,'triggerType':0x1,'msgId':_0x376f61,'chatType':_0x1e0920,'peerUid':_0x2eb079,'elementId':_0x2ec4bd,'thumbSize':0x0,'downloadType':0x1,'filePath':_0xf7e6bf});});}static async[_0x473677(0xc9)](_0xc50ee4){const _0x2fac35={'iSorz':function(_0x4dddd8,_0xbed3b9){return _0x4dddd8(_0xbed3b9);},'ILxvB':function(_0x213343,_0x163c83,_0x5a7371){return _0x213343(_0x163c83,_0x5a7371);}};return new Promise((_0x53079f,_0x1ab036)=>{const _0x1e2835={'RXRbg':function(_0x40b9a1,_0x504a0d){const _0x56e530=_0x21f9;return _0x2fac35[_0x56e530(0x18d)](_0x40b9a1,_0x504a0d);}};_0x2fac35['ILxvB'](_0x462575,_0xc50ee4,(_0xbe405d,_0x2d8e55)=>{_0xbe405d?_0x1e2835['RXRbg'](_0x1ab036,_0xbe405d):_0x53079f(_0x2d8e55);});});}}