const _0x2b0952=_0x2707;(function(_0x39323e,_0x3fbbe5){const _0x6d3f=_0x2707,_0x355795=_0x39323e();while(!![]){try{const _0x3260ae=parseInt(_0x6d3f(0x1cd))/0x1*(-parseInt(_0x6d3f(0x1b8))/0x2)+parseInt(_0x6d3f(0x1c0))/0x3*(parseInt(_0x6d3f(0x188))/0x4)+-parseInt(_0x6d3f(0x1db))/0x5*(parseInt(_0x6d3f(0x1d1))/0x6)+-parseInt(_0x6d3f(0x1ae))/0x7*(-parseInt(_0x6d3f(0x1a0))/0x8)+parseInt(_0x6d3f(0x18d))/0x9+parseInt(_0x6d3f(0x1c7))/0xa+parseInt(_0x6d3f(0x1bf))/0xb*(-parseInt(_0x6d3f(0x1a6))/0xc);if(_0x3260ae===_0x3fbbe5)break;else _0x355795['push'](_0x355795['shift']());}catch(_0x81ee23){_0x355795['push'](_0x355795['shift']());}}}(_0x3821,0xc3245));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x336bc8}from'node:fs';import _0x5a32ef from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';function _0x3821(){const _0x7895e9=['sysface','语音转换失败,\x20请检查语音文件是否正常','uploadFile','rps','dice','[包剪锤]','Thumb','AniStickerId','wjAOb','获取视频信息失败','join','FILE','QSid','unlink','7039832dmbKSV','height','YNhiy','copyFile','XDFmY','ptt','16283880aoOXzw','VIDEO','ARK','PTT','error','MARKDOWN','notAt','TEXT','7pCPjom','kDYHY','XQmOL','eZSAK','MFACE','qCopT','FZDFL','gif','FACE','_0.png','62MruJZP','stat','ark','mp4','PIC','jpg','WhyAu','11LAUuWV','105emYfQy','dLHoj','sep','FIZJm','width','RPS','BPgxL','5355930EUkKWw','file','then','reply','stringify','find','8043szCuGk','Ori','AniStickerType','[骰子]','6rQBqtu','fVpUV','JsvHF','gYrOo','获取视频封面失败，使用默认封面','emoji','pic','toString','qyUeq','end','2484245VEDmbE','catch','markdown','文件异常，大小为0','QDes','getImageSize','screenshots','replace','49148GAiyQd','set','UhykN','mface','get','9511704QHbeIV','AniStickerPackId','[商城表情]','rQSlm','size'];_0x3821=function(){return _0x7895e9;};return _0x3821();}import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x2707(_0x48a681,_0x36f040){const _0x38216c=_0x3821();return _0x2707=function(_0x2707be,_0xa9bb5f){_0x2707be=_0x2707be-0x182;let _0x67b750=_0x38216c[_0x2707be];return _0x67b750;},_0x2707(_0x48a681,_0x36f040);}import{encodeSilk}from'@/common/utils/audio';import _0x39e9a0 from'./face_config.json';import*as _0x16b640 from'node:path';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x5c56b6){const _0x1a1b7e=_0x2707;return{'elementType':ElementType[_0x1a1b7e(0x1ad)],'elementId':'','textElement':{'content':_0x5c56b6,'atType':AtType[_0x1a1b7e(0x1ac)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x297040,_0x2de89c,_0x2e4a17,_0x27009d){const _0x3bcfd1=_0x2707;return{'elementType':ElementType[_0x3bcfd1(0x1ad)],'elementId':'','textElement':{'content':'@'+_0x27009d,'atType':_0x2e4a17,'atUid':_0x297040,'atTinyId':'','atNtUid':_0x2de89c}};}static[_0x2b0952(0x1ca)](_0xf32f28,_0x670d0d,_0x26e97f,_0x5badb8){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0xf32f28,'replayMsgId':_0x670d0d,'senderUin':_0x26e97f,'senderUinStr':_0x5badb8}};}static async[_0x2b0952(0x1d7)](_0x2526e9,_0x580aa2='',_0x224b70=0x0){const _0x29465f=_0x2b0952,_0x3228cb={'qyUeq':function(_0x2a548a,_0x2db30f){return _0x2a548a===_0x2db30f;},'KDmXx':_0x29465f(0x183),'YeDqA':function(_0x334c8c,_0x58f59c){return _0x334c8c(_0x58f59c);},'LLTOD':function(_0x2d2758,_0x5b112d,_0x3fd04e){return _0x2d2758(_0x5b112d,_0x3fd04e);},'aNBEG':'图片信息'},{md5:_0xe76df5,fileName:_0x456da6,path:_0x462a14,fileSize:_0x40e40d}=await NTQQFileApi[_0x29465f(0x194)](_0x2526e9,ElementType['PIC'],_0x224b70);if(_0x3228cb[_0x29465f(0x1d9)](_0x40e40d,0x0))throw _0x3228cb['KDmXx'];const _0x465a03=await NTQQFileApi[_0x29465f(0x185)](_0x2526e9),_0x1bfa53={'md5HexStr':_0xe76df5,'fileSize':_0x40e40d[_0x29465f(0x1d8)](),'picWidth':_0x465a03?.['width'],'picHeight':_0x465a03?.[_0x29465f(0x1a1)],'fileName':_0x456da6,'sourcePath':_0x462a14,'original':!![],'picType':_0x3228cb['YeDqA'](isGIF,_0x2526e9)?PicType[_0x29465f(0x1b5)]:PicType[_0x29465f(0x1bd)],'picSubType':_0x224b70,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x580aa2};return _0x3228cb['LLTOD'](logDebug,_0x3228cb['aNBEG'],_0x1bfa53),{'elementType':ElementType[_0x29465f(0x1bc)],'elementId':'','picElement':_0x1bfa53};}static async[_0x2b0952(0x1c8)](_0x254528,_0x5d01a4=''){const _0x29a69e=_0x2b0952,_0x4563c9={'XDFmY':function(_0x3b6170,_0x1d6071){return _0x3b6170===_0x1d6071;},'XQmOL':'文件异常，大小为0','qCopT':function(_0x3cb651,_0xb690b7){return _0x3cb651||_0xb690b7;}},{md5:_0x56c833,fileName:_0x261ac3,path:_0x91d562,fileSize:_0x3605cf}=await NTQQFileApi['uploadFile'](_0x254528,ElementType[_0x29a69e(0x19d)]);if(_0x4563c9[_0x29a69e(0x1a4)](_0x3605cf,0x0))throw _0x4563c9[_0x29a69e(0x1b0)];const _0x27fa57={'elementType':ElementType[_0x29a69e(0x19d)],'elementId':'','fileElement':{'fileName':_0x4563c9[_0x29a69e(0x1b3)](_0x5d01a4,_0x261ac3),'filePath':_0x91d562,'fileSize':_0x3605cf[_0x29a69e(0x1d8)]()}};return _0x27fa57;}static async['video'](_0x3070d2,_0x82a63a='',_0x519534=''){const _0x122b5d=_0x2b0952,_0x5435d1={'UhykN':function(_0x5af1e6,_0x859b0e,_0x492a95){return _0x5af1e6(_0x859b0e,_0x492a95);},'fVpUV':_0x122b5d(0x1d5),'wjAOb':function(_0x5ae7e0,_0x492f6e){return _0x5ae7e0(_0x492f6e);},'ubNna':function(_0xaca5f3,_0x4a38b7){return _0xaca5f3(_0x4a38b7);},'gYrOo':_0x122b5d(0x1da),'TqyLx':_0x122b5d(0x1aa),'YmIIR':function(_0x30557e,_0x450359){return _0x30557e+_0x450359;},'YNhiy':function(_0x185d12,_0x158ec2){return _0x185d12===_0x158ec2;},'dCvhg':function(_0x14e409,_0xa2402f){return _0x14e409(_0xa2402f);},'rltxS':'视频信息','dLHoj':_0x122b5d(0x19b),'WhyAu':function(_0x431553,_0x1f659d){return _0x431553+_0x1f659d;}},{fileName:_0x3cf996,path:_0x2bf824,fileSize:_0x4d8c13,md5:_0x33ec12}=await NTQQFileApi[_0x122b5d(0x194)](_0x3070d2,ElementType[_0x122b5d(0x1a7)]);if(_0x5435d1[_0x122b5d(0x1a2)](_0x4d8c13,0x0))throw _0x122b5d(0x183);let _0x5139cb=_0x2bf824[_0x122b5d(0x187)](_0x16b640[_0x122b5d(0x1c2)]+_0x122b5d(0x1ce)+_0x16b640['sep'],_0x16b640[_0x122b5d(0x1c2)]+_0x122b5d(0x198)+_0x16b640[_0x122b5d(0x1c2)]);_0x5139cb=_0x16b640['dirname'](_0x5139cb);let _0x5d5b4b={'width':0x780,'height':0x438,'time':0xf,'format':_0x122b5d(0x1bb),'size':_0x4d8c13,'filePath':_0x3070d2};try{_0x5d5b4b=await _0x5435d1['dCvhg'](getVideoInfo,_0x2bf824),logDebug(_0x5435d1['rltxS'],_0x5d5b4b);}catch(_0x50d31b){_0x5435d1[_0x122b5d(0x18a)](logError,_0x5435d1[_0x122b5d(0x1c1)],_0x50d31b);}const _0x1c0503=new Promise((_0x18e4c8,_0x1c3ffb)=>{const _0x17e578=_0x122b5d,_0x4156ec=_0x33ec12+_0x17e578(0x1b7),_0x438b66=_0x16b640[_0x17e578(0x19c)](_0x5139cb,_0x4156ec);_0x5435d1['ubNna'](_0x5a32ef,_0x3070d2)['on'](_0x5435d1['gYrOo'],()=>{})['on'](_0x5435d1['TqyLx'],_0x393636=>{const _0x27ceb1=_0x17e578;_0x5435d1[_0x27ceb1(0x18a)](logDebug,_0x5435d1[_0x27ceb1(0x1d2)],_0x393636),_0x519534?_0x336bc8[_0x27ceb1(0x1a3)](_0x519534,_0x438b66)[_0x27ceb1(0x1c9)](()=>{_0x18e4c8(_0x438b66);})[_0x27ceb1(0x1dc)](_0x1c3ffb):_0x336bc8['writeFile'](_0x438b66,defaultVideoThumb)[_0x27ceb1(0x1c9)](()=>{_0x18e4c8(_0x438b66);})['catch'](_0x1c3ffb);})[_0x17e578(0x186)]({'timestamps':[0x0],'filename':_0x4156ec,'folder':_0x5139cb,'size':_0x5435d1['YmIIR'](_0x5d5b4b[_0x17e578(0x1c4)]+'x',_0x5d5b4b[_0x17e578(0x1a1)])})['on'](_0x5435d1[_0x17e578(0x1d4)],()=>{const _0x59bfa9=_0x17e578;_0x5435d1[_0x59bfa9(0x19a)](_0x18e4c8,_0x438b66);});}),_0x9a3e4e=new Map(),_0x376318=await _0x1c0503,_0x227a28=(await _0x336bc8[_0x122b5d(0x1b9)](_0x376318))[_0x122b5d(0x191)];_0x9a3e4e[_0x122b5d(0x189)](0x0,_0x376318);const _0x27b1a5=await _0x5435d1['wjAOb'](calculateFileMD5,_0x376318),_0x438806={'elementType':ElementType[_0x122b5d(0x1a7)],'elementId':'','videoElement':{'fileName':_0x82a63a||_0x3cf996,'filePath':_0x2bf824,'videoMd5':_0x33ec12,'thumbMd5':_0x27b1a5,'fileTime':_0x5d5b4b['time'],'thumbPath':_0x9a3e4e,'thumbSize':_0x227a28,'thumbWidth':_0x5d5b4b[_0x122b5d(0x1c4)],'thumbHeight':_0x5d5b4b[_0x122b5d(0x1a1)],'fileSize':_0x5435d1[_0x122b5d(0x1be)]('',_0x4d8c13)}};return _0x438806;}static async[_0x2b0952(0x1a5)](_0x3e3333){const _0x38fe94=_0x2b0952,_0x3124af={'BPgxL':function(_0x59087b,_0x17b2c1){return _0x59087b===_0x17b2c1;},'FIZJm':_0x38fe94(0x183),'eZSAK':function(_0x263450,_0xbf62c8){return _0x263450||_0xbf62c8;}},{converted:_0x31eb8d,path:_0x49a588,duration:_0x48f673}=await encodeSilk(_0x3e3333);if(!_0x49a588)throw _0x38fe94(0x193);const {md5:_0x1f89f4,fileName:_0x5a8e5b,path:_0x105b02,fileSize:_0xadd832}=await NTQQFileApi[_0x38fe94(0x194)](_0x49a588,ElementType[_0x38fe94(0x1a9)]);if(_0x3124af[_0x38fe94(0x1c6)](_0xadd832,0x0))throw _0x3124af[_0x38fe94(0x1c3)];return _0x31eb8d&&_0x336bc8[_0x38fe94(0x19f)](_0x49a588)[_0x38fe94(0x1c9)](),{'elementType':ElementType[_0x38fe94(0x1a9)],'elementId':'','pttElement':{'fileName':_0x5a8e5b,'filePath':_0x105b02,'md5HexStr':_0x1f89f4,'fileSize':_0xadd832,'duration':_0x3124af[_0x38fe94(0x1b1)](_0x48f673,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x5ef19f){const _0x12ab38=_0x2b0952,_0x4489ea={'kDYHY':function(_0x53b13e,_0x78ac43){return _0x53b13e(_0x78ac43);},'hIcbb':function(_0x3c8bb1,_0x29d5eb){return _0x3c8bb1>=_0x29d5eb;}},_0x175f18=_0x39e9a0[_0x12ab38(0x192)],_0x1c71a0=_0x39e9a0[_0x12ab38(0x1d6)],_0xff9450=_0x175f18[_0x12ab38(0x1cc)](_0x106c8b=>_0x106c8b[_0x12ab38(0x19e)]===_0x5ef19f[_0x12ab38(0x1d8)]());_0x5ef19f=_0x4489ea[_0x12ab38(0x1af)](parseInt,_0x5ef19f[_0x12ab38(0x1d8)]());let _0x328bc4=0x1;return _0x4489ea['hIcbb'](_0x5ef19f,0xde)&&(_0x328bc4=0x2),_0xff9450[_0x12ab38(0x1cf)]&&(_0x328bc4=0x3),{'elementType':ElementType[_0x12ab38(0x1b6)],'elementId':'','faceElement':{'faceIndex':_0x5ef19f,'faceType':_0x328bc4,'faceText':_0xff9450[_0x12ab38(0x184)],'stickerId':_0xff9450[_0x12ab38(0x199)],'stickerType':_0xff9450[_0x12ab38(0x1cf)],'packId':_0xff9450[_0x12ab38(0x18e)],'sourceType':0x1}};}static[_0x2b0952(0x18b)](_0x144dd9,_0x354c0b,_0x51b446,_0x47f16c){const _0x29e73a=_0x2b0952,_0x22ef95={'rQSlm':_0x29e73a(0x18f)};return{'elementType':ElementType[_0x29e73a(0x1b2)],'marketFaceElement':{'emojiPackageId':_0x144dd9,'emojiId':_0x354c0b,'key':_0x51b446,'faceName':_0x47f16c||mFaceCache[_0x29e73a(0x18c)](_0x354c0b)||_0x22ef95[_0x29e73a(0x190)]}};}static[_0x2b0952(0x196)](_0x3bb73d){const _0x162708=_0x2b0952,_0x9d2ed={'FZDFL':_0x162708(0x1d0)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x162708(0x196)],'faceType':FaceType[_0x162708(0x196)],'faceText':_0x9d2ed[_0x162708(0x1b4)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2b0952(0x195)](_0x27496a){const _0x449e7d=_0x2b0952,_0xa62c35={'JsvHF':_0x449e7d(0x197)};return{'elementType':ElementType[_0x449e7d(0x1b6)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x449e7d(0x1c5)],'faceText':_0xa62c35[_0x449e7d(0x1d3)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2b0952(0x1ba)](_0x5c9507){const _0x10b1c0=_0x2b0952,_0x269fc1={'QVBAG':function(_0x155eec,_0x5f52b4){return _0x155eec!==_0x5f52b4;}};return _0x269fc1['QVBAG'](typeof _0x5c9507,'string')&&(_0x5c9507=JSON[_0x10b1c0(0x1cb)](_0x5c9507)),{'elementType':ElementType[_0x10b1c0(0x1a8)],'elementId':'','arkElement':{'bytesData':_0x5c9507,'linkInfo':null,'subElementType':null}};}static[_0x2b0952(0x182)](_0x44cf46){const _0x2a83fc=_0x2b0952;return{'elementType':ElementType[_0x2a83fc(0x1ab)],'elementId':'','markdownElement':{'content':_0x44cf46}};}}