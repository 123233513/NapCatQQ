const _0x146258=_0xb494;(function(_0x47c30a,_0x1ad4f6){const _0x2b59f6=_0xb494,_0x45c4b3=_0x47c30a();while(!![]){try{const _0x3d2c7b=-parseInt(_0x2b59f6(0x138))/0x1*(-parseInt(_0x2b59f6(0x16d))/0x2)+-parseInt(_0x2b59f6(0x17d))/0x3*(parseInt(_0x2b59f6(0x15a))/0x4)+parseInt(_0x2b59f6(0x147))/0x5+-parseInt(_0x2b59f6(0x164))/0x6*(-parseInt(_0x2b59f6(0x173))/0x7)+-parseInt(_0x2b59f6(0x159))/0x8+-parseInt(_0x2b59f6(0x169))/0x9+parseInt(_0x2b59f6(0x161))/0xa*(-parseInt(_0x2b59f6(0x167))/0xb);if(_0x3d2c7b===_0x1ad4f6)break;else _0x45c4b3['push'](_0x45c4b3['shift']());}catch(_0x1fc6d6){_0x45c4b3['push'](_0x45c4b3['shift']());}}}(_0x4015,0x61d9c));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x2549f8}from'node:fs';import _0x22985c from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';function _0x4015(){const _0x29cab8=['iBlKK','qqeAe','uploadFile','LapfL','PIC','2475775fVtsLA','ClJPZ','mface','width','PTT','notAt','gif','path','获取视频信息失败','UIePt','dirname','height','then','FACE','mZxJH','replace','UcKno','video','2928456kZuLVI','17244dZFTYw','mp4','REPLY','pic','HNwdQ','_0.png','获取视频封面失败，使用默认封面','115510baCbYD','LIAaB','getImageSize','3900630YSweUQ','VIDEO','face','77CYGfYu','uhmRJ','1520181WSWvQD','unlink','stringify','YntdL','2icCyCa','EAmWt','RiWYG','IvHdD','SYGcz','视频信息','7BAfsBk','jliqV','sep','ARK','get','ark','Thumb','MakbW','FILE','toString','342DDaQEI','set','pXqRP','TEXT','time','error','QswEy','dBSNH','string','ptt','dice','AAhpY','size','markdown','362813nFHxnQ','file','JMJDN','ddbPv','end','语音转换失败,\x20请检查语音文件是否正常','文件异常，大小为0','[包剪锤]','ugbwu','catch'];_0x4015=function(){return _0x29cab8;};return _0x4015();}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();function _0xb494(_0x41e3ab,_0x30ba52){const _0x40159a=_0x4015();return _0xb494=function(_0xb49440,_0x107e30){_0xb49440=_0xb49440-0x132;let _0x1de5ed=_0x40159a[_0xb49440];return _0x1de5ed;},_0xb494(_0x41e3ab,_0x30ba52);}export class SendMsgElementConstructor{static['text'](_0x5c5099){const _0x23e606=_0xb494;return{'elementType':ElementType[_0x23e606(0x180)],'elementId':'','textElement':{'content':_0x5c5099,'atType':AtType[_0x23e606(0x14c)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x1da6f8,_0x1f767f,_0x20f4cc,_0xbda6c8){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0xbda6c8,'atType':_0x20f4cc,'atUid':_0x1da6f8,'atTinyId':'','atNtUid':_0x1f767f}};}static['reply'](_0x4b3d4c,_0xf22180,_0x15a78e,_0x108afb){const _0x37c4f8=_0xb494;return{'elementType':ElementType[_0x37c4f8(0x15c)],'elementId':'','replyElement':{'replayMsgSeq':_0x4b3d4c,'replayMsgId':_0xf22180,'senderUin':_0x15a78e,'senderUinStr':_0x108afb}};}static async[_0x146258(0x15d)](_0x51d8e8,_0x58e647='',_0x4d70f3=0x0){const _0x2a2ebd=_0x146258,_0x42c3f1={'MakbW':function(_0x456559,_0x348795){return _0x456559===_0x348795;},'oVOcE':_0x2a2ebd(0x13e),'uhmRJ':function(_0x50684c,_0x3ed9aa,_0x4efbb8){return _0x50684c(_0x3ed9aa,_0x4efbb8);},'UIePt':'图片信息'},{md5:_0x558582,fileName:_0x37f8bc,path:_0x2d18a5,fileSize:_0x1af6c3}=await NTQQFileApi[_0x2a2ebd(0x144)](_0x51d8e8,ElementType[_0x2a2ebd(0x146)],_0x4d70f3);if(_0x42c3f1[_0x2a2ebd(0x17a)](_0x1af6c3,0x0))throw _0x42c3f1['oVOcE'];const _0x4070c6=await NTQQFileApi[_0x2a2ebd(0x163)](_0x51d8e8),_0x249ade={'md5HexStr':_0x558582,'fileSize':_0x1af6c3['toString'](),'picWidth':_0x4070c6?.[_0x2a2ebd(0x14a)],'picHeight':_0x4070c6?.[_0x2a2ebd(0x152)],'fileName':_0x37f8bc,'sourcePath':_0x2d18a5,'original':!![],'picType':isGIF(_0x51d8e8)?PicType[_0x2a2ebd(0x14d)]:PicType['jpg'],'picSubType':_0x4d70f3,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x58e647};return _0x42c3f1[_0x2a2ebd(0x168)](logDebug,_0x42c3f1[_0x2a2ebd(0x150)],_0x249ade),{'elementType':ElementType[_0x2a2ebd(0x146)],'elementId':'','picElement':_0x249ade};}static async[_0x146258(0x139)](_0x1247f0,_0x5a2a4e=''){const _0x29890a=_0x146258,_0x456e3d={'LIAaB':function(_0x3bb18b,_0x43c13b){return _0x3bb18b===_0x43c13b;},'ClJPZ':_0x29890a(0x13e)},{md5:_0x54bdf2,fileName:_0x271061,path:_0x7c1921,fileSize:_0x1a2e5f}=await NTQQFileApi['uploadFile'](_0x1247f0,ElementType[_0x29890a(0x17b)]);if(_0x456e3d[_0x29890a(0x162)](_0x1a2e5f,0x0))throw _0x456e3d[_0x29890a(0x148)];const _0x30be2d={'elementType':ElementType[_0x29890a(0x17b)],'elementId':'','fileElement':{'fileName':_0x5a2a4e||_0x271061,'filePath':_0x7c1921,'fileSize':_0x1a2e5f[_0x29890a(0x17c)]()}};return _0x30be2d;}static async[_0x146258(0x158)](_0x498935,_0x57e1ab='',_0x34315a=''){const _0x3b6d89=_0x146258,_0x21cedb={'IvHdD':function(_0x12aada,_0x5d1d42){return _0x12aada(_0x5d1d42);},'mZxJH':function(_0x48a967,_0x130e9e){return _0x48a967(_0x130e9e);},'dBSNH':function(_0xda3101,_0xf6c825,_0x1bbf0e){return _0xda3101(_0xf6c825,_0x1bbf0e);},'UcKno':_0x3b6d89(0x160),'JMJDN':_0x3b6d89(0x182),'iBlKK':function(_0x53bd68,_0x58a269){return _0x53bd68+_0x58a269;},'EAmWt':function(_0x516ede,_0x2b0318){return _0x516ede+_0x2b0318;},'qqeAe':_0x3b6d89(0x13c),'UePGy':function(_0x4db94d,_0x328d41){return _0x4db94d===_0x328d41;},'UbWSr':_0x3b6d89(0x13e),'pXqRP':function(_0x3dbb99,_0x5289e6){return _0x3dbb99(_0x5289e6);},'iHeNy':_0x3b6d89(0x15b),'YntdL':function(_0x55a1e8,_0x4739a8,_0x5e5d11){return _0x55a1e8(_0x4739a8,_0x5e5d11);},'QswEy':_0x3b6d89(0x172),'ddbPv':_0x3b6d89(0x14f),'ybBTG':function(_0x275cc5,_0x2339c6){return _0x275cc5||_0x2339c6;},'ugbwu':function(_0x3c5cb1,_0x38e912){return _0x3c5cb1+_0x38e912;}},{fileName:_0x240814,path:_0x50649c,fileSize:_0x112ccd,md5:_0x2e31bb}=await NTQQFileApi[_0x3b6d89(0x144)](_0x498935,ElementType[_0x3b6d89(0x165)]);if(_0x21cedb['UePGy'](_0x112ccd,0x0))throw _0x21cedb['UbWSr'];const _0x5cdf46=_0x21cedb[_0x3b6d89(0x17f)](require,_0x3b6d89(0x14e));let _0x52068f=_0x50649c[_0x3b6d89(0x156)](_0x5cdf46['sep']+'Ori'+_0x5cdf46[_0x3b6d89(0x175)],_0x5cdf46['sep']+_0x3b6d89(0x179)+_0x5cdf46[_0x3b6d89(0x175)]);_0x52068f=_0x5cdf46[_0x3b6d89(0x151)](_0x52068f);let _0x403514={'width':0x780,'height':0x438,'time':0xf,'format':_0x21cedb['iHeNy'],'size':_0x112ccd,'filePath':_0x498935};try{_0x403514=await _0x21cedb['mZxJH'](getVideoInfo,_0x50649c),_0x21cedb[_0x3b6d89(0x16c)](logDebug,_0x21cedb[_0x3b6d89(0x183)],_0x403514);}catch(_0xfe614b){logError(_0x21cedb[_0x3b6d89(0x13b)],_0xfe614b);}const _0x18eecb=new Promise((_0x3800a3,_0x6c316b)=>{const _0x1ede3d=_0x3b6d89,_0x3b95ac={'LapfL':function(_0x4013b6,_0x11a08c){const _0x27f357=_0xb494;return _0x21cedb[_0x27f357(0x155)](_0x4013b6,_0x11a08c);}},_0x227f2e=_0x2e31bb+_0x1ede3d(0x15f),_0xd4510d=_0x5cdf46['join'](_0x52068f,_0x227f2e);_0x21cedb['IvHdD'](_0x22985c,_0x498935)['on']('end',()=>{})['on'](_0x21cedb[_0x1ede3d(0x13a)],_0x58e306=>{const _0x3b7779=_0x1ede3d,_0x54f426={'CCGVy':function(_0x154ca5,_0xc4e04a){const _0x3834b5=_0xb494;return _0x21cedb[_0x3834b5(0x170)](_0x154ca5,_0xc4e04a);},'SYGcz':function(_0x204bb3,_0x51fb2e){const _0x4601cf=_0xb494;return _0x21cedb[_0x4601cf(0x155)](_0x204bb3,_0x51fb2e);}};_0x21cedb[_0x3b7779(0x184)](logDebug,_0x21cedb[_0x3b7779(0x157)],_0x58e306),_0x34315a?_0x2549f8['copyFile'](_0x34315a,_0xd4510d)[_0x3b7779(0x153)](()=>{_0x54f426['CCGVy'](_0x3800a3,_0xd4510d);})[_0x3b7779(0x141)](_0x6c316b):_0x2549f8['writeFile'](_0xd4510d,defaultVideoThumb)['then'](()=>{const _0x46ac9a=_0x3b7779;_0x54f426[_0x46ac9a(0x171)](_0x3800a3,_0xd4510d);})[_0x3b7779(0x141)](_0x6c316b);})['screenshots']({'timestamps':[0x0],'filename':_0x227f2e,'folder':_0x52068f,'size':_0x21cedb[_0x1ede3d(0x142)](_0x21cedb[_0x1ede3d(0x16e)](_0x403514['width'],'x'),_0x403514[_0x1ede3d(0x152)])})['on'](_0x21cedb[_0x1ede3d(0x143)],()=>{const _0x3dd60c=_0x1ede3d;_0x3b95ac[_0x3dd60c(0x145)](_0x3800a3,_0xd4510d);});}),_0x1518f=new Map(),_0x30724b=await _0x18eecb,_0x14cdcb=(await _0x2549f8['stat'](_0x30724b))[_0x3b6d89(0x136)];_0x1518f[_0x3b6d89(0x17e)](0x0,_0x30724b);const _0x4ed317=await _0x21cedb[_0x3b6d89(0x170)](calculateFileMD5,_0x30724b),_0x5e4855={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x21cedb['ybBTG'](_0x57e1ab,_0x240814),'filePath':_0x50649c,'videoMd5':_0x2e31bb,'thumbMd5':_0x4ed317,'fileTime':_0x403514[_0x3b6d89(0x181)],'thumbPath':_0x1518f,'thumbSize':_0x14cdcb,'thumbWidth':_0x403514[_0x3b6d89(0x14a)],'thumbHeight':_0x403514[_0x3b6d89(0x152)],'fileSize':_0x21cedb[_0x3b6d89(0x140)]('',_0x112ccd)}};return _0x5e4855;}static async[_0x146258(0x133)](_0x4d8025){const _0x4d2eb6=_0x146258,_0x52a76d={'nNIVp':function(_0x367e0b,_0xc1b70c){return _0x367e0b(_0xc1b70c);},'jliqV':_0x4d2eb6(0x13d),'epGpM':function(_0x283a52,_0x22bf00){return _0x283a52===_0x22bf00;},'HNwdQ':'文件异常，大小为0','KLrSE':function(_0x177398,_0x303c77){return _0x177398||_0x303c77;}},{converted:_0x40529a,path:_0x58f9b9,duration:_0x1333c0}=await _0x52a76d['nNIVp'](encodeSilk,_0x4d8025);if(!_0x58f9b9)throw _0x52a76d[_0x4d2eb6(0x174)];const {md5:_0x3a1f53,fileName:_0x5661e0,path:_0x18dd27,fileSize:_0x453bb9}=await NTQQFileApi['uploadFile'](_0x58f9b9,ElementType[_0x4d2eb6(0x14b)]);if(_0x52a76d['epGpM'](_0x453bb9,0x0))throw _0x52a76d[_0x4d2eb6(0x15e)];return _0x40529a&&_0x2549f8[_0x4d2eb6(0x16a)](_0x58f9b9)[_0x4d2eb6(0x153)](),{'elementType':ElementType[_0x4d2eb6(0x14b)],'elementId':'','pttElement':{'fileName':_0x5661e0,'filePath':_0x18dd27,'md5HexStr':_0x3a1f53,'fileSize':_0x453bb9,'duration':_0x52a76d['KLrSE'](_0x1333c0,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x146258(0x166)](_0x34fa4b){const _0x12d70d=_0x146258,_0x3e406={'AAhpY':function(_0x1a296e,_0x5d006b){return _0x1a296e<_0x5d006b;}};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x34fa4b,'faceType':_0x3e406[_0x12d70d(0x135)](_0x34fa4b,0xde)?FaceType['normal']:FaceType['normal2']}};}static[_0x146258(0x149)](_0x174785,_0x438165,_0x1d999c,_0xf9098e){const _0xd026ce=_0x146258;return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x174785,'emojiId':_0x438165,'key':_0x1d999c,'faceName':_0xf9098e||mFaceCache[_0xd026ce(0x177)](_0x438165)||'[商城表情]'}};}static[_0x146258(0x134)](_0x558a16){const _0xd49d6f=_0x146258,_0x36b4df={'RiWYG':'[骰子]'};return{'elementType':ElementType[_0xd49d6f(0x154)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0xd49d6f(0x134)],'faceType':FaceType[_0xd49d6f(0x134)],'faceText':_0x36b4df[_0xd49d6f(0x16f)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x2652bf){const _0x242855=_0x146258;return{'elementType':ElementType[_0x242855(0x154)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x242855(0x13f),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x146258(0x178)](_0x2fc23e){const _0x4d350b=_0x146258,_0x3d149d={'MmDRh':_0x4d350b(0x132)};return typeof _0x2fc23e!==_0x3d149d['MmDRh']&&(_0x2fc23e=JSON[_0x4d350b(0x16b)](_0x2fc23e)),{'elementType':ElementType[_0x4d350b(0x176)],'elementId':'','arkElement':{'bytesData':_0x2fc23e,'linkInfo':null,'subElementType':null}};}static[_0x146258(0x137)](_0x242664){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x242664}};}}