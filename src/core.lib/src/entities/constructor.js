const _0x18a22c=_0x1a4c;(function(_0x55df1b,_0xf4436d){const _0x13c13d=_0x1a4c,_0x5ac9cb=_0x55df1b();while(!![]){try{const _0x2788fa=parseInt(_0x13c13d(0x186))/0x1+-parseInt(_0x13c13d(0x19a))/0x2+parseInt(_0x13c13d(0x197))/0x3*(parseInt(_0x13c13d(0x177))/0x4)+parseInt(_0x13c13d(0x158))/0x5+-parseInt(_0x13c13d(0x198))/0x6+parseInt(_0x13c13d(0x15e))/0x7*(-parseInt(_0x13c13d(0x195))/0x8)+-parseInt(_0x13c13d(0x174))/0x9;if(_0x2788fa===_0xf4436d)break;else _0x5ac9cb['push'](_0x5ac9cb['shift']());}catch(_0x4b7ade){_0x5ac9cb['push'](_0x5ac9cb['shift']());}}}(_0x543c,0x5a45e));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x101e6f}from'node:fs';import _0xcc906 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x543c(){const _0x1533a4=['REPLY','GlWIk','dkQiz','FILE','ACMQz','2241540bsyBUi','uploadFile','hECUf','4cbdWgJ','set','path','markdown','Thumb','getImageSize','RPS','sep','语音转换失败,\x20请检查语音文件是否正常','notAt','get','ptt','writeFile','文件异常，大小为0','toString','608100nFGjPR','gif','dirname','kkOKX','normal','end','string','PIC','MFACE','获取视频封面失败，使用默认封面','[骰子]','TEXT','fpXTe','time','FACE','8fkExxH','stat','1477491rAoVsj','3103968WLtIes','[包剪锤]','823604WYamMb','图片信息','MARKDOWN','[商城表情]','JEynt','dice','视频信息','nbGrh','pic','ARK','btLLa','hrHTF','then','screenshots','3368765ahPudc','ZVnVF','file','BdpkF','oGrKT','Ori','1584814OAKIeK','catch','rps','lVaCe','error','HwjpM','PTT','reply','width','height','VIDEO','zhRMZ','size','yadaQ','cfRFl','JucGK','mface'];_0x543c=function(){return _0x1533a4;};return _0x543c();}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x1a4c(_0xdae940,_0x1b0bdd){const _0x543c37=_0x543c();return _0x1a4c=function(_0x1a4c51,_0x4af917){_0x1a4c51=_0x1a4c51-0x14b;let _0xdb45d2=_0x543c37[_0x1a4c51];return _0xdb45d2;},_0x1a4c(_0xdae940,_0x1b0bdd);}import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x4bf7d2){const _0x210f28=_0x1a4c;return{'elementType':ElementType[_0x210f28(0x191)],'elementId':'','textElement':{'content':_0x4bf7d2,'atType':AtType[_0x210f28(0x180)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4d6d21,_0x11939e,_0x22603e,_0x4b44dc){const _0x2797fe=_0x1a4c;return{'elementType':ElementType[_0x2797fe(0x191)],'elementId':'','textElement':{'content':'@'+_0x4b44dc,'atType':_0x22603e,'atUid':_0x4d6d21,'atTinyId':'','atNtUid':_0x11939e}};}static[_0x18a22c(0x165)](_0x4ce114,_0x2bcf5c,_0x490471,_0x5f49a9){const _0x58e955=_0x18a22c;return{'elementType':ElementType[_0x58e955(0x16f)],'elementId':'','replyElement':{'replayMsgSeq':_0x4ce114,'replayMsgId':_0x2bcf5c,'senderUin':_0x490471,'senderUinStr':_0x5f49a9}};}static async[_0x18a22c(0x152)](_0xb60a46,_0x3137e9='',_0x2e4343=0x0){const _0x584848=_0x18a22c,_0x5b0532={'JucGK':_0x584848(0x184),'hECUf':function(_0x5c6220,_0x45018d,_0xdc75e5){return _0x5c6220(_0x45018d,_0xdc75e5);},'JEynt':_0x584848(0x14b)},{md5:_0x9123dc,fileName:_0x51b97a,path:_0x49bba6,fileSize:_0x1537d9}=await NTQQFileApi['uploadFile'](_0xb60a46,ElementType[_0x584848(0x18d)],_0x2e4343);if(_0x1537d9===0x0)throw _0x5b0532[_0x584848(0x16d)];const _0x4b5ca0=await NTQQFileApi[_0x584848(0x17c)](_0xb60a46),_0x34b6cd={'md5HexStr':_0x9123dc,'fileSize':_0x1537d9[_0x584848(0x185)](),'picWidth':_0x4b5ca0?.[_0x584848(0x166)],'picHeight':_0x4b5ca0?.[_0x584848(0x167)],'fileName':_0x51b97a,'sourcePath':_0x49bba6,'original':!![],'picType':isGIF(_0xb60a46)?PicType[_0x584848(0x187)]:PicType['jpg'],'picSubType':_0x2e4343,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3137e9};return _0x5b0532[_0x584848(0x176)](logDebug,_0x5b0532[_0x584848(0x14e)],_0x34b6cd),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x34b6cd};}static async[_0x18a22c(0x15a)](_0x3c802e,_0x52819a=''){const _0xbf4336=_0x18a22c,_0x5569fc={'zhRMZ':function(_0x4ac2c4,_0x234804){return _0x4ac2c4===_0x234804;},'xSLlD':_0xbf4336(0x184),'GlWIk':function(_0x18aa08,_0x8d2162){return _0x18aa08||_0x8d2162;}},{md5:_0x247030,fileName:_0x3b4b80,path:_0x93bcc,fileSize:_0x38382d}=await NTQQFileApi[_0xbf4336(0x175)](_0x3c802e,ElementType[_0xbf4336(0x172)]);if(_0x5569fc[_0xbf4336(0x169)](_0x38382d,0x0))throw _0x5569fc['xSLlD'];const _0x248ef5={'elementType':ElementType[_0xbf4336(0x172)],'elementId':'','fileElement':{'fileName':_0x5569fc[_0xbf4336(0x170)](_0x52819a,_0x3b4b80),'filePath':_0x93bcc,'fileSize':_0x38382d[_0xbf4336(0x185)]()}};return _0x248ef5;}static async['video'](_0x382c71,_0x3ebce8='',_0x5951d4=''){const _0x49cdf8=_0x18a22c,_0x227b2c={'oGrKT':function(_0x45021b,_0x177666){return _0x45021b(_0x177666);},'kkOKX':_0x49cdf8(0x18b),'cfRFl':function(_0x50f15b,_0x2cf5f5){return _0x50f15b(_0x2cf5f5);},'miffR':_0x49cdf8(0x179),'ZVnVF':'mp4','yadaQ':function(_0x154c25,_0x3daa66,_0x38cb04){return _0x154c25(_0x3daa66,_0x38cb04);},'lVaCe':'获取视频信息失败','nbGrh':function(_0x17f77c,_0x2e85c4){return _0x17f77c+_0x2e85c4;}},{fileName:_0x405954,path:_0x4bf24d,fileSize:_0x5e2a57,md5:_0x4a255c}=await NTQQFileApi[_0x49cdf8(0x175)](_0x382c71,ElementType[_0x49cdf8(0x168)]);if(_0x5e2a57===0x0)throw'文件异常，大小为0';const _0x17cd37=_0x227b2c[_0x49cdf8(0x16c)](require,_0x227b2c['miffR']);let _0x410541=_0x4bf24d['replace'](_0x17cd37['sep']+_0x49cdf8(0x15d)+_0x17cd37['sep'],_0x17cd37[_0x49cdf8(0x17e)]+_0x49cdf8(0x17b)+_0x17cd37[_0x49cdf8(0x17e)]);_0x410541=_0x17cd37[_0x49cdf8(0x188)](_0x410541);let _0x248448={'width':0x780,'height':0x438,'time':0xf,'format':_0x227b2c[_0x49cdf8(0x159)],'size':_0x5e2a57,'filePath':_0x382c71};try{_0x248448=await getVideoInfo(_0x4bf24d),_0x227b2c[_0x49cdf8(0x16b)](logDebug,_0x49cdf8(0x150),_0x248448);}catch(_0x4155a1){logError(_0x227b2c[_0x49cdf8(0x161)],_0x4155a1);}const _0x52f53d=new Promise((_0x37a3e1,_0x3b970f)=>{const _0x5df0f8=_0x49cdf8,_0x5e3a21=_0x4a255c+'_0.png',_0x2c07a9=_0x17cd37['join'](_0x410541,_0x5e3a21);_0xcc906(_0x382c71)['on'](_0x227b2c['kkOKX'],()=>{})['on'](_0x5df0f8(0x162),_0x14bf15=>{const _0x553cb9=_0x5df0f8,_0x5e993e={'ACMQz':function(_0x4448aa,_0x22253){const _0x53264d=_0x1a4c;return _0x227b2c[_0x53264d(0x15c)](_0x4448aa,_0x22253);}};logDebug(_0x553cb9(0x18f),_0x14bf15),_0x5951d4?_0x101e6f['copyFile'](_0x5951d4,_0x2c07a9)[_0x553cb9(0x156)](()=>{_0x37a3e1(_0x2c07a9);})[_0x553cb9(0x15f)](_0x3b970f):_0x101e6f[_0x553cb9(0x183)](_0x2c07a9,defaultVideoThumb)[_0x553cb9(0x156)](()=>{const _0x2f738c=_0x553cb9;_0x5e993e[_0x2f738c(0x173)](_0x37a3e1,_0x2c07a9);})['catch'](_0x3b970f);})[_0x5df0f8(0x157)]({'timestamps':[0x0],'filename':_0x5e3a21,'folder':_0x410541,'size':_0x248448['width']+'x'+_0x248448[_0x5df0f8(0x167)]})['on'](_0x227b2c[_0x5df0f8(0x189)],()=>{const _0x3b38f4=_0x5df0f8;_0x227b2c[_0x3b38f4(0x15c)](_0x37a3e1,_0x2c07a9);});}),_0xee32c5=new Map(),_0x3d703a=await _0x52f53d,_0x2c2dd0=(await _0x101e6f[_0x49cdf8(0x196)](_0x3d703a))[_0x49cdf8(0x16a)];_0xee32c5[_0x49cdf8(0x178)](0x0,_0x3d703a);const _0x14e178=await calculateFileMD5(_0x3d703a),_0x594d04={'elementType':ElementType[_0x49cdf8(0x168)],'elementId':'','videoElement':{'fileName':_0x3ebce8||_0x405954,'filePath':_0x4bf24d,'videoMd5':_0x4a255c,'thumbMd5':_0x14e178,'fileTime':_0x248448[_0x49cdf8(0x193)],'thumbPath':_0xee32c5,'thumbSize':_0x2c2dd0,'thumbWidth':_0x248448['width'],'thumbHeight':_0x248448['height'],'fileSize':_0x227b2c[_0x49cdf8(0x151)]('',_0x5e2a57)}};return _0x594d04;}static async[_0x18a22c(0x182)](_0x5d01e3){const _0xfab227=_0x18a22c,_0x251f95={'BzTbB':function(_0x3fde47,_0xe7cd3d){return _0x3fde47(_0xe7cd3d);},'hrHTF':_0xfab227(0x17f),'fpXTe':function(_0x319dbb,_0x3e1c24){return _0x319dbb===_0x3e1c24;},'dkQiz':_0xfab227(0x184)},{converted:_0xf60566,path:_0x4204a7,duration:_0x4cf097}=await _0x251f95['BzTbB'](encodeSilk,_0x5d01e3);if(!_0x4204a7)throw _0x251f95[_0xfab227(0x155)];const {md5:_0x5e995f,fileName:_0x4c8a2a,path:_0x52b4c0,fileSize:_0x4cde64}=await NTQQFileApi[_0xfab227(0x175)](_0x4204a7,ElementType[_0xfab227(0x164)]);if(_0x251f95[_0xfab227(0x192)](_0x4cde64,0x0))throw _0x251f95[_0xfab227(0x171)];return _0xf60566&&_0x101e6f['unlink'](_0x4204a7)['then'](),{'elementType':ElementType[_0xfab227(0x164)],'elementId':'','pttElement':{'fileName':_0x4c8a2a,'filePath':_0x52b4c0,'md5HexStr':_0x5e995f,'fileSize':_0x4cde64,'duration':_0x4cf097||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x32e676){const _0xeda123=_0x18a22c,_0x3601a8={'btLLa':function(_0x45d463,_0x55893d){return _0x45d463<_0x55893d;}};return{'elementType':ElementType[_0xeda123(0x194)],'elementId':'','faceElement':{'faceIndex':_0x32e676,'faceType':_0x3601a8[_0xeda123(0x154)](_0x32e676,0xde)?FaceType[_0xeda123(0x18a)]:FaceType['normal2']}};}static[_0x18a22c(0x16e)](_0xa9cebb,_0x36c54e,_0x733c6d,_0x1301d6){const _0x2abcfc=_0x18a22c,_0xdf3b01={'odLdZ':_0x2abcfc(0x14d)};return{'elementType':ElementType[_0x2abcfc(0x18e)],'marketFaceElement':{'emojiPackageId':_0xa9cebb,'emojiId':_0x36c54e,'key':_0x733c6d,'faceName':_0x1301d6||mFaceCache[_0x2abcfc(0x181)](_0x36c54e)||_0xdf3b01['odLdZ']}};}static[_0x18a22c(0x14f)](_0x47443d){const _0x150c92=_0x18a22c,_0x2332d1={'DSqeb':_0x150c92(0x190)};return{'elementType':ElementType[_0x150c92(0x194)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x150c92(0x14f)],'faceText':_0x2332d1['DSqeb'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x18a22c(0x160)](_0x169bac){const _0x16e3e4=_0x18a22c,_0x30afa9={'HwjpM':_0x16e3e4(0x199)};return{'elementType':ElementType[_0x16e3e4(0x194)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x16e3e4(0x17d)],'faceText':_0x30afa9[_0x16e3e4(0x163)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x574504){const _0x26ec33=_0x18a22c,_0x38850a={'BdpkF':_0x26ec33(0x18c)};return typeof _0x574504!==_0x38850a[_0x26ec33(0x15b)]&&(_0x574504=JSON['stringify'](_0x574504)),{'elementType':ElementType[_0x26ec33(0x153)],'elementId':'','arkElement':{'bytesData':_0x574504,'linkInfo':null,'subElementType':null}};}static[_0x18a22c(0x17a)](_0x20f5cd){const _0x5e5f36=_0x18a22c;return{'elementType':ElementType[_0x5e5f36(0x14c)],'elementId':'','markdownElement':{'content':_0x20f5cd}};}}