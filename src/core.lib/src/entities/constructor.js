const _0x38f35c=_0x1c93;function _0x1c93(_0x56b978,_0x2a713e){const _0x27fcf3=_0x27fc();return _0x1c93=function(_0x1c93d8,_0x2c9d4a){_0x1c93d8=_0x1c93d8-0x102;let _0x28b559=_0x27fcf3[_0x1c93d8];return _0x28b559;},_0x1c93(_0x56b978,_0x2a713e);}(function(_0x56ddcf,_0x43fcba){const _0x50ce28=_0x1c93,_0x57e7d7=_0x56ddcf();while(!![]){try{const _0x5001a4=-parseInt(_0x50ce28(0x13a))/0x1*(parseInt(_0x50ce28(0x15d))/0x2)+parseInt(_0x50ce28(0x136))/0x3+parseInt(_0x50ce28(0x102))/0x4*(-parseInt(_0x50ce28(0x119))/0x5)+-parseInt(_0x50ce28(0x132))/0x6*(-parseInt(_0x50ce28(0x15e))/0x7)+parseInt(_0x50ce28(0x12a))/0x8*(parseInt(_0x50ce28(0x143))/0x9)+parseInt(_0x50ce28(0x126))/0xa*(parseInt(_0x50ce28(0x152))/0xb)+-parseInt(_0x50ce28(0x14a))/0xc;if(_0x5001a4===_0x43fcba)break;else _0x57e7d7['push'](_0x57e7d7['shift']());}catch(_0x7c789b){_0x57e7d7['push'](_0x57e7d7['shift']());}}}(_0x27fc,0xcbb6d));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x428b96}from'node:fs';import _0x1eea64 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';function _0x27fc(){const _0x47b8bb=['set','视频信息','4XbSmNy','6088586ZQbSdY','7316ANvJdV','fhMVY','dirname','PIC','notAt','copyFile','error','rGhzV','Ori','reply','HadWD','IGJIt','REPLY','图片信息','FILE','path','TEXT','then','emoji','sep','mface','VIDEO','ark','1090XLJAqr','AniStickerPackId','video','get','toString','获取视频封面失败，使用默认封面','gif','MFACE','ARK','guKjk','MgerZ','markdown','jpg','10QyuVkU','uuBFF','qVznw','stringify','1822272FVHXOO','width','oylnb','FACE','GaOvG','[包剪锤]','face','AniStickerType','6XxVUSG','getImageSize','end','PNUTS','2353404sIkMfq','_0.png','PTT','time','834343hreQbS','writeFile','cTieB','find','文件异常，大小为0','QDes','height','QSid','gcELJ','54Kxdrfk','replace','UdqdK','size','jyeYF','catch','stat','19533696mZDSXk','QkUaE','unlink','uploadFile','TxRfQ','text','dice','UIkBm','16595249DGdTOX','ciPff','rps','语音转换失败,\x20请检查语音文件是否正常','file','mp4','RPS','YoqrM','iCBLB'];_0x27fc=function(){return _0x47b8bb;};return _0x27fc();}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x25e016 from'./face_config.json';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x38f35c(0x14f)](_0x3ca08b){const _0x41cc06=_0x38f35c;return{'elementType':ElementType[_0x41cc06(0x112)],'elementId':'','textElement':{'content':_0x3ca08b,'atType':AtType[_0x41cc06(0x106)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x494599,_0x1e3c80,_0x52d97c,_0xde29ec){const _0xe6822b=_0x38f35c;return{'elementType':ElementType[_0xe6822b(0x112)],'elementId':'','textElement':{'content':'@'+_0xde29ec,'atType':_0x52d97c,'atUid':_0x494599,'atTinyId':'','atNtUid':_0x1e3c80}};}static[_0x38f35c(0x10b)](_0x59acc2,_0x27dbba,_0x503892,_0x549afb){const _0x178dbb=_0x38f35c;return{'elementType':ElementType[_0x178dbb(0x10e)],'elementId':'','replyElement':{'replayMsgSeq':_0x59acc2,'replayMsgId':_0x27dbba,'senderUin':_0x503892,'senderUinStr':_0x549afb}};}static async['pic'](_0x2aac99,_0x2e963d='',_0x48bc87=0x0){const _0x2f593c=_0x38f35c,_0x4e9793={'UIkBm':'文件异常，大小为0','uuBFF':function(_0x5d25d8,_0x2de8eb,_0x125407){return _0x5d25d8(_0x2de8eb,_0x125407);},'eMUFW':_0x2f593c(0x10f)},{md5:_0x3db373,fileName:_0x52476a,path:_0x20409b,fileSize:_0x242679}=await NTQQFileApi[_0x2f593c(0x14d)](_0x2aac99,ElementType[_0x2f593c(0x105)],_0x48bc87);if(_0x242679===0x0)throw _0x4e9793[_0x2f593c(0x151)];const _0xc85b66=await NTQQFileApi[_0x2f593c(0x133)](_0x2aac99),_0x585f5b={'md5HexStr':_0x3db373,'fileSize':_0x242679[_0x2f593c(0x11d)](),'picWidth':_0xc85b66?.[_0x2f593c(0x12b)],'picHeight':_0xc85b66?.[_0x2f593c(0x140)],'fileName':_0x52476a,'sourcePath':_0x20409b,'original':!![],'picType':isGIF(_0x2aac99)?PicType[_0x2f593c(0x11f)]:PicType[_0x2f593c(0x125)],'picSubType':_0x48bc87,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2e963d};return _0x4e9793[_0x2f593c(0x127)](logDebug,_0x4e9793['eMUFW'],_0x585f5b),{'elementType':ElementType[_0x2f593c(0x105)],'elementId':'','picElement':_0x585f5b};}static async[_0x38f35c(0x156)](_0x46c0a2,_0x437356=''){const _0x4bbd1f=_0x38f35c,_0x1ece31={'ciPff':function(_0x388ade,_0x2993b8){return _0x388ade===_0x2993b8;},'rGhzV':_0x4bbd1f(0x13e)},{md5:_0x1607b9,fileName:_0x5a5def,path:_0x503dfc,fileSize:_0x3438ca}=await NTQQFileApi[_0x4bbd1f(0x14d)](_0x46c0a2,ElementType['FILE']);if(_0x1ece31[_0x4bbd1f(0x153)](_0x3438ca,0x0))throw _0x1ece31[_0x4bbd1f(0x109)];const _0x30e92c={'elementType':ElementType[_0x4bbd1f(0x110)],'elementId':'','fileElement':{'fileName':_0x437356||_0x5a5def,'filePath':_0x503dfc,'fileSize':_0x3438ca['toString']()}};return _0x30e92c;}static async[_0x38f35c(0x11b)](_0x2b8b17,_0x1cff9b='',_0x32282c=''){const _0x505d29=_0x38f35c,_0x1f7eb8={'jyeYF':function(_0x3f2cf2,_0x137243){return _0x3f2cf2(_0x137243);},'iCBLB':function(_0x154a27,_0x319a1c){return _0x154a27(_0x319a1c);},'TxRfQ':function(_0x205d93,_0x3ff650,_0x96e1d7){return _0x205d93(_0x3ff650,_0x96e1d7);},'pKGAO':_0x505d29(0x11e),'YoqrM':_0x505d29(0x134),'fhMVY':function(_0x54cf6d,_0x21d265){return _0x54cf6d+_0x21d265;},'oylnb':'文件异常，大小为0','gcELJ':_0x505d29(0x111),'guKjk':_0x505d29(0x157),'cTieB':function(_0x512cd6,_0x108c6b,_0x4b5dff){return _0x512cd6(_0x108c6b,_0x4b5dff);},'GaOvG':_0x505d29(0x15c),'xeueW':function(_0x184ff2,_0x41c2cb){return _0x184ff2||_0x41c2cb;},'UdqdK':function(_0x1292b9,_0x2ea87e){return _0x1292b9+_0x2ea87e;}},{fileName:_0x895f12,path:_0x3d8450,fileSize:_0x2386ba,md5:_0x1b93b6}=await NTQQFileApi[_0x505d29(0x14d)](_0x2b8b17,ElementType[_0x505d29(0x117)]);if(_0x2386ba===0x0)throw _0x1f7eb8[_0x505d29(0x12c)];const _0x5b9d16=_0x1f7eb8['jyeYF'](require,_0x1f7eb8[_0x505d29(0x142)]);let _0x203208=_0x3d8450[_0x505d29(0x144)](_0x5b9d16[_0x505d29(0x115)]+_0x505d29(0x10a)+_0x5b9d16['sep'],_0x5b9d16[_0x505d29(0x115)]+'Thumb'+_0x5b9d16['sep']);_0x203208=_0x5b9d16[_0x505d29(0x104)](_0x203208);let _0x23ab14={'width':0x780,'height':0x438,'time':0xf,'format':_0x1f7eb8[_0x505d29(0x122)],'size':_0x2386ba,'filePath':_0x2b8b17};try{_0x23ab14=await _0x1f7eb8['iCBLB'](getVideoInfo,_0x3d8450),_0x1f7eb8[_0x505d29(0x13c)](logDebug,_0x1f7eb8[_0x505d29(0x12e)],_0x23ab14);}catch(_0x2bfdc7){_0x1f7eb8[_0x505d29(0x14e)](logError,'获取视频信息失败',_0x2bfdc7);}const _0x2f163e=new Promise((_0x897849,_0x3b6bc3)=>{const _0x221d7a=_0x505d29,_0x864095={'pMHaY':function(_0x412c65,_0x277e08){const _0xe9e6c8=_0x1c93;return _0x1f7eb8[_0xe9e6c8(0x15a)](_0x412c65,_0x277e08);},'qVznw':function(_0x3f8ce5,_0x2dba1b,_0x116994){const _0x552a2e=_0x1c93;return _0x1f7eb8[_0x552a2e(0x14e)](_0x3f8ce5,_0x2dba1b,_0x116994);},'ERAaR':_0x1f7eb8['pKGAO']},_0x553d1a=_0x1b93b6+_0x221d7a(0x137),_0x6286f2=_0x5b9d16['join'](_0x203208,_0x553d1a);_0x1eea64(_0x2b8b17)['on'](_0x1f7eb8[_0x221d7a(0x159)],()=>{})['on'](_0x221d7a(0x108),_0x53bf3b=>{const _0x2c8923=_0x221d7a;_0x864095[_0x2c8923(0x128)](logDebug,_0x864095['ERAaR'],_0x53bf3b),_0x32282c?_0x428b96[_0x2c8923(0x107)](_0x32282c,_0x6286f2)['then'](()=>{_0x864095['pMHaY'](_0x897849,_0x6286f2);})[_0x2c8923(0x148)](_0x3b6bc3):_0x428b96[_0x2c8923(0x13b)](_0x6286f2,defaultVideoThumb)[_0x2c8923(0x113)](()=>{_0x864095['pMHaY'](_0x897849,_0x6286f2);})[_0x2c8923(0x148)](_0x3b6bc3);})['screenshots']({'timestamps':[0x0],'filename':_0x553d1a,'folder':_0x203208,'size':_0x1f7eb8[_0x221d7a(0x103)](_0x23ab14[_0x221d7a(0x12b)],'x')+_0x23ab14[_0x221d7a(0x140)]})['on'](_0x1f7eb8[_0x221d7a(0x159)],()=>{const _0xb8452b=_0x221d7a;_0x1f7eb8[_0xb8452b(0x147)](_0x897849,_0x6286f2);});}),_0x3030dc=new Map(),_0x3089e8=await _0x2f163e,_0x56792f=(await _0x428b96[_0x505d29(0x149)](_0x3089e8))[_0x505d29(0x146)];_0x3030dc[_0x505d29(0x15b)](0x0,_0x3089e8);const _0x1f5873=await calculateFileMD5(_0x3089e8),_0x535ac0={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x1f7eb8['xeueW'](_0x1cff9b,_0x895f12),'filePath':_0x3d8450,'videoMd5':_0x1b93b6,'thumbMd5':_0x1f5873,'fileTime':_0x23ab14[_0x505d29(0x139)],'thumbPath':_0x3030dc,'thumbSize':_0x56792f,'thumbWidth':_0x23ab14[_0x505d29(0x12b)],'thumbHeight':_0x23ab14['height'],'fileSize':_0x1f7eb8[_0x505d29(0x145)]('',_0x2386ba)}};return _0x535ac0;}static async['ptt'](_0x4b3605){const _0x46f0ca=_0x38f35c,_0x24b30f={'IGJIt':_0x46f0ca(0x155),'VRUfa':_0x46f0ca(0x13e),'eXrsi':function(_0x5ecace,_0x2e30a5){return _0x5ecace||_0x2e30a5;}},{converted:_0x194a5e,path:_0x470c6c,duration:_0x150aab}=await encodeSilk(_0x4b3605);if(!_0x470c6c)throw _0x24b30f[_0x46f0ca(0x10d)];const {md5:_0x33a7d4,fileName:_0x4f2005,path:_0x526d2b,fileSize:_0x50dcd6}=await NTQQFileApi[_0x46f0ca(0x14d)](_0x470c6c,ElementType[_0x46f0ca(0x138)]);if(_0x50dcd6===0x0)throw _0x24b30f['VRUfa'];return _0x194a5e&&_0x428b96[_0x46f0ca(0x14c)](_0x470c6c)[_0x46f0ca(0x113)](),{'elementType':ElementType[_0x46f0ca(0x138)],'elementId':'','pttElement':{'fileName':_0x4f2005,'filePath':_0x526d2b,'md5HexStr':_0x33a7d4,'fileSize':_0x50dcd6,'duration':_0x24b30f['eXrsi'](_0x150aab,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x38f35c(0x130)](_0x6c472e){const _0xa0e329=_0x38f35c,_0x1a35cf={'QkUaE':function(_0x2eb84c,_0x2bb1dd){return _0x2eb84c(_0x2bb1dd);},'PNUTS':function(_0x3da88c,_0x3b32f3){return _0x3da88c>=_0x3b32f3;}},_0x56cf32=_0x25e016['sysface'],_0x39f26c=_0x25e016[_0xa0e329(0x114)],_0x26179f=_0x56cf32[_0xa0e329(0x13d)](_0x2730f3=>_0x2730f3[_0xa0e329(0x141)]===_0x6c472e[_0xa0e329(0x11d)]());_0x6c472e=_0x1a35cf[_0xa0e329(0x14b)](parseInt,_0x6c472e[_0xa0e329(0x11d)]());let _0x2572fa=0x1;return _0x1a35cf[_0xa0e329(0x135)](_0x6c472e,0xde)&&(_0x2572fa=0x2),_0x26179f[_0xa0e329(0x131)]&&(_0x2572fa=0x3),{'elementType':ElementType[_0xa0e329(0x12d)],'elementId':'','faceElement':{'faceIndex':_0x6c472e,'faceType':_0x2572fa,'faceText':_0x26179f[_0xa0e329(0x13f)],'stickerId':_0x26179f['AniStickerId'],'stickerType':_0x26179f[_0xa0e329(0x131)],'packId':_0x26179f[_0xa0e329(0x11a)],'sourceType':0x1}};}static[_0x38f35c(0x116)](_0x3178ba,_0x22c559,_0x520107,_0x4ae1b0){const _0x3dbe07=_0x38f35c,_0x1dfe0e={'FjFpr':'[商城表情]'};return{'elementType':ElementType[_0x3dbe07(0x120)],'marketFaceElement':{'emojiPackageId':_0x3178ba,'emojiId':_0x22c559,'key':_0x520107,'faceName':_0x4ae1b0||mFaceCache[_0x3dbe07(0x11c)](_0x22c559)||_0x1dfe0e['FjFpr']}};}static[_0x38f35c(0x150)](_0x370982){const _0x4f7e8c=_0x38f35c,_0xb6a46={'oihjK':'[骰子]'};return{'elementType':ElementType[_0x4f7e8c(0x12d)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4f7e8c(0x150)],'faceType':FaceType['dice'],'faceText':_0xb6a46['oihjK'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x38f35c(0x154)](_0x561220){const _0x41ccd9=_0x38f35c,_0x306945={'MgerZ':_0x41ccd9(0x12f)};return{'elementType':ElementType[_0x41ccd9(0x12d)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x41ccd9(0x158)],'faceText':_0x306945[_0x41ccd9(0x123)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x38f35c(0x118)](_0x54f8d4){const _0x74bcd3=_0x38f35c,_0x48fb56={'cOfRH':function(_0x26a5ff,_0x313b70){return _0x26a5ff!==_0x313b70;},'HadWD':'string'};return _0x48fb56['cOfRH'](typeof _0x54f8d4,_0x48fb56[_0x74bcd3(0x10c)])&&(_0x54f8d4=JSON[_0x74bcd3(0x129)](_0x54f8d4)),{'elementType':ElementType[_0x74bcd3(0x121)],'elementId':'','arkElement':{'bytesData':_0x54f8d4,'linkInfo':null,'subElementType':null}};}static[_0x38f35c(0x124)](_0x5513c5){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x5513c5}};}}