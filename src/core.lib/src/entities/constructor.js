const _0x173afa=_0x7d2c;(function(_0xbbda81,_0x478ca8){const _0x3d657f=_0x7d2c,_0x28f3c8=_0xbbda81();while(!![]){try{const _0x30995b=parseInt(_0x3d657f(0x95))/0x1*(-parseInt(_0x3d657f(0x9c))/0x2)+-parseInt(_0x3d657f(0x87))/0x3+-parseInt(_0x3d657f(0xaf))/0x4*(-parseInt(_0x3d657f(0x9f))/0x5)+parseInt(_0x3d657f(0x96))/0x6+-parseInt(_0x3d657f(0xd5))/0x7*(parseInt(_0x3d657f(0x86))/0x8)+-parseInt(_0x3d657f(0xcf))/0x9+-parseInt(_0x3d657f(0xd2))/0xa*(-parseInt(_0x3d657f(0x98))/0xb);if(_0x30995b===_0x478ca8)break;else _0x28f3c8['push'](_0x28f3c8['shift']());}catch(_0x37624a){_0x28f3c8['push'](_0x28f3c8['shift']());}}}(_0x3050,0xe54d7));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x1676d5}from'node:fs';import _0x2e093e from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x3050(){const _0x125af2=['FILE','writeFile','语音转换失败,\x20请检查语音文件是否正常','NHUgK','maOmy','RPS','sysface','end','text','toString','CbONM','zxIHf','PHpFw','stringify','134072EbmhWG','1234686gopkcv','ark','[骰子]','QDes','获取视频封面失败，使用默认封面','mface','string','error','rqDXm','AIEFz','replace','cePLt','gPCPE','JFxgc','13pxDqUA','5781918AowJlr','emoji','99NyJEnJ','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','reply','ROfpO','9974HTsVyQ','MARKDOWN','FACE','2500yoDagq','get','[商城表情]','dice','APGcV','iXbQe','AniStickerId','jpg','qPAfZ','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','video','sep','PTT','lGgyh','VYyVA','face','11328BtPMPH','dirname','mp4','hnMsj','time','screenshots','Ori','copyFile','width','markdown','unlink','AniStickerType','catch','VIDEO','size','find','miniapp','rps','uploadFile','notAt','Bot\x20Test','getImageSize','file','pic','then','TEXT','文件异常，大小为0','join','fRGNc','REPLY','QJHaj','WsCPW','9623799KdVgzJ','PIC','height','2109430IvdfNH','ARK','SFFuH','749DtDcGW'];_0x3050=function(){return _0x125af2;};return _0x3050();}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x4b53b1 from'./face_config.json';import*as _0x43d789 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();function _0x7d2c(_0x3c0545,_0x1dca83){const _0x30509d=_0x3050();return _0x7d2c=function(_0x7d2cb9,_0x1742f2){_0x7d2cb9=_0x7d2cb9-0x79;let _0x3c38db=_0x30509d[_0x7d2cb9];return _0x3c38db;},_0x7d2c(_0x3c0545,_0x1dca83);}export class SendMsgElementConstructor{static[_0x173afa(0x80)](_0x4968cc){const _0xd22d5e=_0x173afa;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x4968cc,'atType':AtType[_0xd22d5e(0xc2)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4ee219,_0x423d8e,_0x5eed39,_0x3ce04c){const _0x2d8d4a=_0x173afa;return{'elementType':ElementType[_0x2d8d4a(0xc8)],'elementId':'','textElement':{'content':'@'+_0x3ce04c,'atType':_0x5eed39,'atUid':_0x4ee219,'atTinyId':'','atNtUid':_0x423d8e}};}static[_0x173afa(0x9a)](_0x53f49a,_0x8a8a76,_0x267667,_0x1228b6){const _0x46e227=_0x173afa;return{'elementType':ElementType[_0x46e227(0xcc)],'elementId':'','replyElement':{'replayMsgSeq':_0x53f49a,'replayMsgId':_0x8a8a76,'senderUin':_0x267667,'senderUinStr':_0x1228b6}};}static async[_0x173afa(0xc6)](_0x552dc6,_0x22ed64='',_0x5a31ec=0x0){const _0xc4c0fa=_0x173afa,_0x31f159={'rQDTp':function(_0x471885,_0xebfcc0){return _0x471885===_0xebfcc0;},'eAnAn':_0xc4c0fa(0xc9),'ZzJiF':function(_0x4e190c,_0x2a6730){return _0x4e190c(_0x2a6730);}},{md5:_0x3cb239,fileName:_0x511dcc,path:_0x25a0bc,fileSize:_0x6284aa}=await NTQQFileApi[_0xc4c0fa(0xc1)](_0x552dc6,ElementType[_0xc4c0fa(0xd0)],_0x5a31ec);if(_0x31f159['rQDTp'](_0x6284aa,0x0))throw _0x31f159['eAnAn'];const _0x2de761=await NTQQFileApi[_0xc4c0fa(0xc4)](_0x552dc6),_0x2c78d5={'md5HexStr':_0x3cb239,'fileSize':_0x6284aa['toString'](),'picWidth':_0x2de761?.[_0xc4c0fa(0xb7)],'picHeight':_0x2de761?.[_0xc4c0fa(0xd1)],'fileName':_0x511dcc,'sourcePath':_0x25a0bc,'original':!![],'picType':_0x31f159['ZzJiF'](isGIF,_0x552dc6)?PicType['gif']:PicType[_0xc4c0fa(0xa6)],'picSubType':_0x5a31ec,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x22ed64};return{'elementType':ElementType[_0xc4c0fa(0xd0)],'elementId':'','picElement':_0x2c78d5};}static async[_0x173afa(0xc5)](_0x113d4f,_0x1f2cf2=''){const _0x38b83f=_0x173afa,_0x2b1b20={'hFYht':function(_0xbb1f0b,_0x46a4b6){return _0xbb1f0b||_0x46a4b6;}},{md5:_0x536402,fileName:_0x350242,path:_0x11068c,fileSize:_0xc62c4e}=await NTQQFileApi[_0x38b83f(0xc1)](_0x113d4f,ElementType[_0x38b83f(0xd6)]);if(_0xc62c4e===0x0)throw'文件异常，大小为0';const _0x373623={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x2b1b20['hFYht'](_0x1f2cf2,_0x350242),'filePath':_0x11068c,'fileSize':_0xc62c4e[_0x38b83f(0x81)]()}};return _0x373623;}static async[_0x173afa(0xa9)](_0x35a2f6,_0x2280dc='',_0x2a78b0=''){const _0x60fe6a=_0x173afa,_0x1d1061={'NHUgK':function(_0x472816,_0x5de5ad){return _0x472816(_0x5de5ad);},'APGcV':function(_0x2913cc,_0x3962e7,_0x3be057){return _0x2913cc(_0x3962e7,_0x3be057);},'JFxgc':_0x60fe6a(0x7f),'iXbQe':_0x60fe6a(0x8e),'AIEFz':function(_0x495aad,_0x42db6a){return _0x495aad+_0x42db6a;},'WsCPW':function(_0x3d866f,_0x167dee){return _0x3d866f===_0x167dee;},'rqDXm':_0x60fe6a(0xc9),'maOmy':_0x60fe6a(0xb1),'fRGNc':function(_0x16f7b6,_0x4fa47e,_0x13411e){return _0x16f7b6(_0x4fa47e,_0x13411e);},'gPCPE':'获取视频信息失败'},{fileName:_0x272275,path:_0x5e4296,fileSize:_0xcf13b9,md5:_0xbaa23e}=await NTQQFileApi['uploadFile'](_0x35a2f6,ElementType[_0x60fe6a(0xbc)]);if(_0x1d1061[_0x60fe6a(0xce)](_0xcf13b9,0x0))throw _0x1d1061[_0x60fe6a(0x8f)];let _0x22243a=_0x5e4296[_0x60fe6a(0x91)](_0x43d789['sep']+_0x60fe6a(0xb5)+_0x43d789[_0x60fe6a(0xaa)],_0x43d789[_0x60fe6a(0xaa)]+'Thumb'+_0x43d789['sep']);_0x22243a=_0x43d789[_0x60fe6a(0xb0)](_0x22243a);let _0x6089c1={'width':0x780,'height':0x438,'time':0xf,'format':_0x1d1061[_0x60fe6a(0x7c)],'size':_0xcf13b9,'filePath':_0x35a2f6};try{_0x6089c1=await getVideoInfo(_0x5e4296);}catch(_0x29b82d){_0x1d1061[_0x60fe6a(0xcb)](logError,_0x1d1061[_0x60fe6a(0x93)],_0x29b82d);}const _0xbdf056=new Promise((_0x21b2be,_0x3be151)=>{const _0x826a39=_0x60fe6a,_0x49080c=_0xbaa23e+'_0.png',_0x5db846=_0x43d789[_0x826a39(0xca)](_0x22243a,_0x49080c);_0x1d1061['NHUgK'](_0x2e093e,_0x35a2f6)['on'](_0x1d1061['JFxgc'],()=>{})['on'](_0x1d1061[_0x826a39(0xa4)],_0x4ff4d7=>{const _0x1f30a1=_0x826a39,_0x1496ab={'hnMsj':function(_0x57cbb2,_0x31fdc3){const _0x4bc5f2=_0x7d2c;return _0x1d1061[_0x4bc5f2(0x7b)](_0x57cbb2,_0x31fdc3);}};_0x1d1061[_0x1f30a1(0xa3)](logDebug,_0x1f30a1(0x8b),_0x4ff4d7),_0x2a78b0?_0x1676d5[_0x1f30a1(0xb6)](_0x2a78b0,_0x5db846)['then'](()=>{_0x21b2be(_0x5db846);})[_0x1f30a1(0xbb)](_0x3be151):_0x1676d5[_0x1f30a1(0x79)](_0x5db846,defaultVideoThumb)[_0x1f30a1(0xc7)](()=>{const _0x28152c=_0x1f30a1;_0x1496ab[_0x28152c(0xb2)](_0x21b2be,_0x5db846);})[_0x1f30a1(0xbb)](_0x3be151);})[_0x826a39(0xb4)]({'timestamps':[0x0],'filename':_0x49080c,'folder':_0x22243a,'size':_0x1d1061[_0x826a39(0x90)](_0x6089c1[_0x826a39(0xb7)],'x')+_0x6089c1[_0x826a39(0xd1)]})['on'](_0x1d1061[_0x826a39(0x94)],()=>{_0x21b2be(_0x5db846);});}),_0x33bb2e=new Map(),_0x3de7e4=await _0xbdf056,_0x270f9f=(await _0x1676d5['stat'](_0x3de7e4))[_0x60fe6a(0xbd)];_0x33bb2e['set'](0x0,_0x3de7e4);const _0x198359=await _0x1d1061[_0x60fe6a(0x7b)](calculateFileMD5,_0x3de7e4),_0x2554f8={'elementType':ElementType[_0x60fe6a(0xbc)],'elementId':'','videoElement':{'fileName':_0x2280dc||_0x272275,'filePath':_0x5e4296,'videoMd5':_0xbaa23e,'thumbMd5':_0x198359,'fileTime':_0x6089c1[_0x60fe6a(0xb3)],'thumbPath':_0x33bb2e,'thumbSize':_0x270f9f,'thumbWidth':_0x6089c1[_0x60fe6a(0xb7)],'thumbHeight':_0x6089c1['height'],'fileSize':_0x1d1061[_0x60fe6a(0x90)]('',_0xcf13b9)}};return _0x2554f8;}static async['ptt'](_0x18dd0b){const _0x29c9cc=_0x173afa,_0x66a705={'PHpFw':function(_0x544652,_0x5c6de9){return _0x544652(_0x5c6de9);},'QJHaj':_0x29c9cc(0x7a),'SFFuH':'文件异常，大小为0'},{converted:_0x3aaf34,path:_0x3391b7,duration:_0x3bcf44}=await _0x66a705[_0x29c9cc(0x84)](encodeSilk,_0x18dd0b);if(!_0x3391b7)throw _0x66a705[_0x29c9cc(0xcd)];const {md5:_0x4dff4c,fileName:_0x554882,path:_0x1a0e9a,fileSize:_0x4ded2d}=await NTQQFileApi[_0x29c9cc(0xc1)](_0x3391b7,ElementType[_0x29c9cc(0xab)]);if(_0x4ded2d===0x0)throw _0x66a705[_0x29c9cc(0xd4)];return _0x3aaf34&&_0x1676d5[_0x29c9cc(0xb9)](_0x3391b7)[_0x29c9cc(0xc7)](),{'elementType':ElementType[_0x29c9cc(0xab)],'elementId':'','pttElement':{'fileName':_0x554882,'filePath':_0x1a0e9a,'md5HexStr':_0x4dff4c,'fileSize':_0x4ded2d,'duration':_0x3bcf44||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x173afa(0xae)](_0x49dbdb){const _0x3c7ef3=_0x173afa,_0xfaed43={'xOXua':function(_0x16ec52,_0x5f2057){return _0x16ec52>=_0x5f2057;}},_0x35aacf=_0x4b53b1[_0x3c7ef3(0x7e)],_0x57993f=_0x4b53b1[_0x3c7ef3(0x97)],_0x55e7e3=_0x35aacf[_0x3c7ef3(0xbe)](_0x3438ba=>_0x3438ba['QSid']===_0x49dbdb[_0x3c7ef3(0x81)]());_0x49dbdb=parseInt(_0x49dbdb['toString']());let _0xb93d47=0x1;return _0xfaed43['xOXua'](_0x49dbdb,0xde)&&(_0xb93d47=0x2),_0x55e7e3[_0x3c7ef3(0xba)]&&(_0xb93d47=0x3),{'elementType':ElementType[_0x3c7ef3(0x9e)],'elementId':'','faceElement':{'faceIndex':_0x49dbdb,'faceType':_0xb93d47,'faceText':_0x55e7e3[_0x3c7ef3(0x8a)],'stickerId':_0x55e7e3[_0x3c7ef3(0xa5)],'stickerType':_0x55e7e3[_0x3c7ef3(0xba)],'packId':_0x55e7e3['AniStickerPackId'],'sourceType':0x1}};}static[_0x173afa(0x8c)](_0x3b18e0,_0x48fed3,_0x2aeea0,_0x53ce66){const _0x4125ff=_0x173afa,_0x2d93f9={'lGgyh':_0x4125ff(0xa1)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x3b18e0,'emojiId':_0x48fed3,'key':_0x2aeea0,'faceName':_0x53ce66||mFaceCache[_0x4125ff(0xa0)](_0x48fed3)||_0x2d93f9[_0x4125ff(0xac)]}};}static[_0x173afa(0xa2)](_0x142e0a){const _0x120865=_0x173afa;return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x120865(0xa2)],'faceType':FaceType['dice'],'faceText':_0x120865(0x89),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x173afa(0xc0)](_0x35068d){const _0x373ab3=_0x173afa;return{'elementType':ElementType[_0x373ab3(0x9e)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x373ab3(0x7d)],'faceText':'[包剪锤]','faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x173afa(0x88)](_0x5514fb){const _0x292fdc=_0x173afa,_0x21cba6={'CbONM':function(_0x48cf5f,_0x19d8b1){return _0x48cf5f!==_0x19d8b1;},'qPAfZ':_0x292fdc(0x8d)};return _0x21cba6[_0x292fdc(0x82)](typeof _0x5514fb,_0x21cba6[_0x292fdc(0xa7)])&&(_0x5514fb=JSON[_0x292fdc(0x85)](_0x5514fb)),{'elementType':ElementType[_0x292fdc(0xd3)],'elementId':'','arkElement':{'bytesData':_0x5514fb,'linkInfo':null,'subElementType':null}};}static[_0x173afa(0xb8)](_0x17f405){const _0x9fc54e=_0x173afa;return{'elementType':ElementType[_0x9fc54e(0x9d)],'elementId':'','markdownElement':{'content':_0x17f405}};}static async[_0x173afa(0xbf)](){const _0x1965f9=_0x173afa,_0x5671ef={'StwDI':function(_0x508e63,_0x2ab001){return _0x508e63(_0x2ab001);},'VYyVA':_0x1965f9(0xc3),'zxIHf':_0x1965f9(0xa8),'cePLt':'https://www.bilibili.com/','ROfpO':_0x1965f9(0x99)};let _0x5662a4=await _0x5671ef['StwDI'](SignMiniApp,{'prompt':_0x5671ef['VYyVA'],'title':'Bot\x20Test','preview':_0x5671ef[_0x1965f9(0x83)],'jumpUrl':_0x5671ef[_0x1965f9(0x92)],'tag':_0x5671ef[_0x1965f9(0xad)],'tagIcon':_0x5671ef[_0x1965f9(0x9b)],'source':_0x5671ef['VYyVA'],'sourcelogo':_0x1965f9(0x99)});return{'elementType':ElementType[_0x1965f9(0xd3)],'elementId':'','arkElement':{'bytesData':_0x5662a4,'linkInfo':null,'subElementType':null}};}}