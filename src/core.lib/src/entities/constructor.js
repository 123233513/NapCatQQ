const _0x10b31b=_0x188f;(function(_0x3c01a0,_0xc2f464){const _0x2c22fe=_0x188f,_0x739fca=_0x3c01a0();while(!![]){try{const _0x4975b7=parseInt(_0x2c22fe(0x17b))/0x1*(-parseInt(_0x2c22fe(0x149))/0x2)+parseInt(_0x2c22fe(0x166))/0x3*(-parseInt(_0x2c22fe(0x180))/0x4)+-parseInt(_0x2c22fe(0x14d))/0x5*(-parseInt(_0x2c22fe(0x165))/0x6)+-parseInt(_0x2c22fe(0x15e))/0x7*(-parseInt(_0x2c22fe(0x189))/0x8)+parseInt(_0x2c22fe(0x13e))/0x9*(parseInt(_0x2c22fe(0x14f))/0xa)+-parseInt(_0x2c22fe(0x159))/0xb+parseInt(_0x2c22fe(0x161))/0xc;if(_0x4975b7===_0xc2f464)break;else _0x739fca['push'](_0x739fca['shift']());}catch(_0x13181f){_0x739fca['push'](_0x739fca['shift']());}}}(_0x286b,0x2d315));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x30d1e5}from'node:fs';import _0x185399 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x4dc413 from'./face_config.json';import*as _0x2ed34a from'node:path';function _0x188f(_0x1d5ac6,_0x133903){const _0x286b3c=_0x286b();return _0x188f=function(_0x188fee,_0x390b62){_0x188fee=_0x188fee-0x12e;let _0x5e3252=_0x286b3c[_0x188fee];return _0x5e3252;},_0x188f(_0x1d5ac6,_0x133903);}import{SignMiniApp}from'../apis';function _0x286b(){const _0x281063=['kqOmo','5naDCnu','mKsFN','2128580mdGHdk','stat','MARKDOWN','DbOvo','FACE','mKMiq','WMODp','getImageSize','[包剪锤]','_0.png','2098756FXKaEB','mp4','zGUyq','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','XMTgF','2365923eCwGrY','gPifQ','unlink','3505260UTKDwK','https://www.bilibili.com/','gif','Ori','58062yPvRvt','11478iQhTgh','markdown','error','end','find','QSid','xIson','uploadFile','width','PIC','file','mhTaI','文件异常，大小为0','gfFhn','ark','aOnSl','then','xZxZa','join','emoji','mface','14RCsmUO','sysface','IOZBU','toString','NMWVe','332lwiHeh','Thumb','pic','set','jgTBf','ARK','PTT','语音转换失败,\x20请检查语音文件是否正常','XWPCc','8TcOGVz','bgFQR','SZZby','QDes','miniapp','ByGBk','size','catch','dice','PSNYD','gXUGP','MFACE','REPLY','rps','text','RPS','height','VIDEO','get','notAt','JuXPw','replace','dirname','获取视频封面失败，使用默认封面','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','9dKTfsx','FILE','face','AniStickerType','TSCaP','Bot\x20Test','nNXST','sep','dVxwD','ptt','NFWab','22738sHiBIc','AniStickerPackId','jpg'];_0x286b=function(){return _0x281063;};return _0x286b();}export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x10b31b(0x133)](_0xa6f3b5){const _0x1b5418=_0x10b31b;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0xa6f3b5,'atType':AtType[_0x1b5418(0x138)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x12a461,_0x17cd4c,_0x362dac,_0x23c5c6){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x23c5c6,'atType':_0x362dac,'atUid':_0x12a461,'atTinyId':'','atNtUid':_0x17cd4c}};}static['reply'](_0x42200c,_0x1b25c3,_0x933d6a,_0x52d7c9){const _0x1d482e=_0x10b31b;return{'elementType':ElementType[_0x1d482e(0x131)],'elementId':'','replyElement':{'replayMsgSeq':_0x42200c,'replayMsgId':_0x1b25c3,'senderUin':_0x933d6a,'senderUinStr':_0x52d7c9}};}static async[_0x10b31b(0x182)](_0x38e693,_0x3691fa='',_0x2fc1a8=0x0){const _0x2197e8=_0x10b31b,_0x2e73e0={'mhTaI':function(_0xcf08f7,_0x60e024){return _0xcf08f7===_0x60e024;},'TSCaP':'文件异常，大小为0','NFWab':function(_0x5beafd,_0x5596f5){return _0x5beafd(_0x5596f5);}},{md5:_0x2fa1e6,fileName:_0x1fc787,path:_0xcc6aa7,fileSize:_0x1c91fb}=await NTQQFileApi['uploadFile'](_0x38e693,ElementType[_0x2197e8(0x16f)],_0x2fc1a8);if(_0x2e73e0[_0x2197e8(0x171)](_0x1c91fb,0x0))throw _0x2e73e0[_0x2197e8(0x142)];const _0x555235=await NTQQFileApi[_0x2197e8(0x156)](_0x38e693),_0x54157a={'md5HexStr':_0x2fa1e6,'fileSize':_0x1c91fb[_0x2197e8(0x17e)](),'picWidth':_0x555235?.[_0x2197e8(0x16e)],'picHeight':_0x555235?.['height'],'fileName':_0x1fc787,'sourcePath':_0xcc6aa7,'original':!![],'picType':_0x2e73e0[_0x2197e8(0x148)](isGIF,_0x38e693)?PicType[_0x2197e8(0x163)]:PicType[_0x2197e8(0x14b)],'picSubType':_0x2fc1a8,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3691fa};return{'elementType':ElementType[_0x2197e8(0x16f)],'elementId':'','picElement':_0x54157a};}static async[_0x10b31b(0x170)](_0xd23165,_0x482eac='',_0xd11249=''){const _0x27cd5f=_0x10b31b,_0x5b9898={'kqOmo':function(_0x3cca18,_0x49d827){return _0x3cca18===_0x49d827;},'dVxwD':_0x27cd5f(0x172),'QRfnI':function(_0x422d48,_0x11326d){return _0x422d48||_0x11326d;}},{md5:_0x45a623,fileName:_0x22b7cc,path:_0xcd6789,fileSize:_0x79769e}=await NTQQFileApi['uploadFile'](_0xd23165,ElementType[_0x27cd5f(0x13f)]);if(_0x5b9898[_0x27cd5f(0x14c)](_0x79769e,0x0))throw _0x5b9898[_0x27cd5f(0x146)];const _0x309ce6={'elementType':ElementType[_0x27cd5f(0x13f)],'elementId':'','fileElement':{'fileName':_0x5b9898['QRfnI'](_0x482eac,_0x22b7cc),'folderId':_0xd11249,'filePath':_0xcd6789,'fileSize':_0x79769e['toString']()}};return _0x309ce6;}static async['video'](_0x342c54,_0x2f802a='',_0x4d60f8=''){const _0x3ab55d=_0x10b31b,_0x452da4={'IdiBf':_0x3ab55d(0x13c),'jgTBf':function(_0x594576,_0x581a78){return _0x594576(_0x581a78);},'PSNYD':_0x3ab55d(0x169),'xIson':_0x3ab55d(0x168),'zGUyq':function(_0x4a99d4,_0x346aae){return _0x4a99d4+_0x346aae;},'XMTgF':function(_0x1f6358,_0x11d762){return _0x1f6358===_0x11d762;},'IOZBU':_0x3ab55d(0x172),'bgFQR':_0x3ab55d(0x15a),'gfFhn':function(_0x28bb76,_0x1f23cb,_0x387b53){return _0x28bb76(_0x1f23cb,_0x387b53);},'UUWsQ':function(_0x2a7660,_0x3c2454){return _0x2a7660(_0x3c2454);},'gXUGP':function(_0x154534,_0x2d33cd){return _0x154534||_0x2d33cd;},'DbOvo':function(_0x256d93,_0x244439){return _0x256d93+_0x244439;}},{fileName:_0x3f5af4,path:_0x4d91e0,fileSize:_0x28a6c1,md5:_0x29c659}=await NTQQFileApi[_0x3ab55d(0x16d)](_0x342c54,ElementType['VIDEO']);if(_0x452da4[_0x3ab55d(0x15d)](_0x28a6c1,0x0))throw _0x452da4[_0x3ab55d(0x17d)];let _0x1bdf0f=_0x4d91e0[_0x3ab55d(0x13a)](_0x2ed34a[_0x3ab55d(0x145)]+_0x3ab55d(0x164)+_0x2ed34a['sep'],_0x2ed34a[_0x3ab55d(0x145)]+_0x3ab55d(0x181)+_0x2ed34a[_0x3ab55d(0x145)]);_0x1bdf0f=_0x2ed34a[_0x3ab55d(0x13b)](_0x1bdf0f);let _0x2a090e={'width':0x780,'height':0x438,'time':0xf,'format':_0x452da4[_0x3ab55d(0x18a)],'size':_0x28a6c1,'filePath':_0x342c54};try{_0x2a090e=await _0x452da4['jgTBf'](getVideoInfo,_0x4d91e0);}catch(_0x478c55){_0x452da4[_0x3ab55d(0x173)](logError,'获取视频信息失败',_0x478c55);}const _0x9ef66c=new Promise((_0x58b559,_0xafb66c)=>{const _0x2032a6=_0x3ab55d,_0x1e795c={'JuXPw':function(_0x14d2e1,_0x31c482){const _0x87b90f=_0x188f;return _0x452da4[_0x87b90f(0x184)](_0x14d2e1,_0x31c482);}},_0x4a2e6b=_0x29c659+_0x2032a6(0x158),_0x2bd327=_0x2ed34a[_0x2032a6(0x178)](_0x1bdf0f,_0x4a2e6b);_0x452da4[_0x2032a6(0x184)](_0x185399,_0x342c54)['on'](_0x452da4[_0x2032a6(0x12e)],()=>{})['on'](_0x452da4[_0x2032a6(0x16c)],_0x21325b=>{const _0x1512ac=_0x2032a6;logDebug(_0x452da4['IdiBf'],_0x21325b),_0x4d60f8?_0x30d1e5['copyFile'](_0x4d60f8,_0x2bd327)[_0x1512ac(0x176)](()=>{_0x58b559(_0x2bd327);})[_0x1512ac(0x190)](_0xafb66c):_0x30d1e5['writeFile'](_0x2bd327,defaultVideoThumb)[_0x1512ac(0x176)](()=>{const _0x3e8e1d=_0x1512ac;_0x1e795c[_0x3e8e1d(0x139)](_0x58b559,_0x2bd327);})[_0x1512ac(0x190)](_0xafb66c);})['screenshots']({'timestamps':[0x0],'filename':_0x4a2e6b,'folder':_0x1bdf0f,'size':_0x452da4[_0x2032a6(0x15b)](_0x2a090e['width'],'x')+_0x2a090e[_0x2032a6(0x135)]})['on'](_0x452da4['PSNYD'],()=>{_0x1e795c['JuXPw'](_0x58b559,_0x2bd327);});}),_0x1cce02=new Map(),_0x107ad0=await _0x9ef66c,_0x29508a=(await _0x30d1e5[_0x3ab55d(0x150)](_0x107ad0))[_0x3ab55d(0x18f)];_0x1cce02[_0x3ab55d(0x183)](0x0,_0x107ad0);const _0x3dca77=await _0x452da4['UUWsQ'](calculateFileMD5,_0x107ad0),_0x3a6bc0={'elementType':ElementType[_0x3ab55d(0x136)],'elementId':'','videoElement':{'fileName':_0x452da4[_0x3ab55d(0x12f)](_0x2f802a,_0x3f5af4),'filePath':_0x4d91e0,'videoMd5':_0x29c659,'thumbMd5':_0x3dca77,'fileTime':_0x2a090e['time'],'thumbPath':_0x1cce02,'thumbSize':_0x29508a,'thumbWidth':_0x2a090e[_0x3ab55d(0x16e)],'thumbHeight':_0x2a090e[_0x3ab55d(0x135)],'fileSize':_0x452da4[_0x3ab55d(0x152)]('',_0x28a6c1)}};return _0x3a6bc0;}static async[_0x10b31b(0x147)](_0x3c316d){const _0x52ff53=_0x10b31b,_0x290674={'NMWVe':function(_0x58a9fe,_0x4422ba){return _0x58a9fe(_0x4422ba);},'EQcqO':_0x52ff53(0x187),'dkGKT':function(_0x34ed6e,_0x2146bc){return _0x34ed6e===_0x2146bc;},'aOnSl':function(_0x2c9120,_0x5f5594){return _0x2c9120||_0x5f5594;}},{converted:_0x443e1c,path:_0x3a33d2,duration:_0x226378}=await _0x290674[_0x52ff53(0x17f)](encodeSilk,_0x3c316d);if(!_0x3a33d2)throw _0x290674['EQcqO'];const {md5:_0x525980,fileName:_0x5803fe,path:_0xb894f3,fileSize:_0x327495}=await NTQQFileApi[_0x52ff53(0x16d)](_0x3a33d2,ElementType[_0x52ff53(0x186)]);if(_0x290674['dkGKT'](_0x327495,0x0))throw _0x52ff53(0x172);return _0x443e1c&&_0x30d1e5[_0x52ff53(0x160)](_0x3a33d2)[_0x52ff53(0x176)](),{'elementType':ElementType[_0x52ff53(0x186)],'elementId':'','pttElement':{'fileName':_0x5803fe,'filePath':_0xb894f3,'md5HexStr':_0x525980,'fileSize':_0x327495,'duration':_0x290674[_0x52ff53(0x175)](_0x226378,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x10b31b(0x140)](_0x24a50e){const _0x58f2c2=_0x10b31b,_0x179c3c={'SZZby':function(_0x37eb86,_0x2ba951){return _0x37eb86(_0x2ba951);}},_0x4f1c6f=_0x4dc413[_0x58f2c2(0x17c)],_0x45370c=_0x4dc413[_0x58f2c2(0x179)],_0x253cc2=_0x4f1c6f[_0x58f2c2(0x16a)](_0x4b78c8=>_0x4b78c8[_0x58f2c2(0x16b)]===_0x24a50e[_0x58f2c2(0x17e)]());_0x24a50e=_0x179c3c[_0x58f2c2(0x18b)](parseInt,_0x24a50e[_0x58f2c2(0x17e)]());let _0x3b02cf=0x1;return _0x24a50e>=0xde&&(_0x3b02cf=0x2),_0x253cc2[_0x58f2c2(0x141)]&&(_0x3b02cf=0x3),{'elementType':ElementType[_0x58f2c2(0x153)],'elementId':'','faceElement':{'faceIndex':_0x24a50e,'faceType':_0x3b02cf,'faceText':_0x253cc2[_0x58f2c2(0x18c)],'stickerId':_0x253cc2['AniStickerId'],'stickerType':_0x253cc2[_0x58f2c2(0x141)],'packId':_0x253cc2[_0x58f2c2(0x14a)],'sourceType':0x1}};}static[_0x10b31b(0x17a)](_0x308dce,_0x4e3536,_0x4109b3,_0x20b5cf){const _0x2fa207=_0x10b31b,_0x3ab63e={'nNXST':'[商城表情]'};return{'elementType':ElementType[_0x2fa207(0x130)],'marketFaceElement':{'emojiPackageId':_0x308dce,'emojiId':_0x4e3536,'key':_0x4109b3,'faceName':_0x20b5cf||mFaceCache[_0x2fa207(0x137)](_0x4e3536)||_0x3ab63e[_0x2fa207(0x144)]}};}static['dice'](_0x4a813f){const _0x5a5b83=_0x10b31b,_0x2c712e={'xZxZa':'[骰子]'};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x5a5b83(0x191)],'faceType':FaceType[_0x5a5b83(0x191)],'faceText':_0x2c712e[_0x5a5b83(0x177)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x10b31b(0x132)](_0x5349c0){const _0x5707a6=_0x10b31b,_0x41072d={'mKsFN':_0x5707a6(0x157)};return{'elementType':ElementType[_0x5707a6(0x153)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x5707a6(0x134)],'faceText':_0x41072d[_0x5707a6(0x14e)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x10b31b(0x174)](_0x3d0735){const _0x5eb862=_0x10b31b,_0x11ba24={'mKMiq':'string'};return typeof _0x3d0735!==_0x11ba24[_0x5eb862(0x154)]&&(_0x3d0735=JSON['stringify'](_0x3d0735)),{'elementType':ElementType[_0x5eb862(0x185)],'elementId':'','arkElement':{'bytesData':_0x3d0735,'linkInfo':null,'subElementType':null}};}static[_0x10b31b(0x167)](_0x52a93a){const _0xdba129=_0x10b31b;return{'elementType':ElementType[_0xdba129(0x151)],'elementId':'','markdownElement':{'content':_0x52a93a}};}static async[_0x10b31b(0x18d)](){const _0x413823=_0x10b31b,_0x16b67f={'WMODp':_0x413823(0x143),'gPifQ':_0x413823(0x13d),'XWPCc':_0x413823(0x162),'ByGBk':_0x413823(0x15c)};let _0x45f142=await SignMiniApp({'prompt':_0x16b67f[_0x413823(0x155)],'title':_0x16b67f[_0x413823(0x155)],'preview':_0x16b67f[_0x413823(0x15f)],'jumpUrl':_0x16b67f[_0x413823(0x188)],'tag':_0x413823(0x143),'tagIcon':_0x413823(0x15c),'source':_0x413823(0x143),'sourcelogo':_0x16b67f[_0x413823(0x18e)]});return{'elementType':ElementType[_0x413823(0x185)],'elementId':'','arkElement':{'bytesData':_0x45f142,'linkInfo':null,'subElementType':null}};}}