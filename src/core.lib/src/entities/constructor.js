const _0x511d3a=_0x2e8a;(function(_0x44af4e,_0x221560){const _0x5bc22d=_0x2e8a,_0x2f9b04=_0x44af4e();while(!![]){try{const _0x5d606a=-parseInt(_0x5bc22d(0x122))/0x1*(parseInt(_0x5bc22d(0x17b))/0x2)+parseInt(_0x5bc22d(0x15c))/0x3+-parseInt(_0x5bc22d(0x13c))/0x4*(parseInt(_0x5bc22d(0x15a))/0x5)+-parseInt(_0x5bc22d(0x150))/0x6*(-parseInt(_0x5bc22d(0x13b))/0x7)+parseInt(_0x5bc22d(0x152))/0x8+-parseInt(_0x5bc22d(0x148))/0x9*(-parseInt(_0x5bc22d(0x149))/0xa)+-parseInt(_0x5bc22d(0x12c))/0xb*(parseInt(_0x5bc22d(0x166))/0xc);if(_0x5d606a===_0x221560)break;else _0x2f9b04['push'](_0x2f9b04['shift']());}catch(_0x119583){_0x2f9b04['push'](_0x2f9b04['shift']());}}}(_0x14f6,0x7f5b3));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x145507}from'node:fs';import _0x114969 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x14f6(){const _0x43c516=['rMHBl','face','ark','normal','OPhsV','yJVmp','4764AJxAMk','width','join','dice','视频信息','end','catch','获取视频信息失败','ljalJ','PIC','pic','KIuad','FACE','markdown','jpg','replace','文件异常，大小为0','then','sep','rps','vhbYe','1002QSMwdh','string','307XBIyMw','kfcHC','PTT','YEFDo','[包剪锤]','bIBhy','mp4','RYNEg','[商城表情]','[骰子]','27929KGxVdP','REPLY','图片信息','time','FILE','VIDEO','WaABo','fSFkV','Thumb','video','RPS','IExgw','stringify','ptt','uploadFile','43477kvElXI','284KctFxX','getImageSize','reply','path','ApQQW','TEXT','unlink','xpvOU','CQNAK','YRPom','语音转换失败,\x20请检查语音文件是否正常','error','823131KunaSy','20SVoHuS','enfya','NjihB','NJNXY','text','ARK','writeFile','690LLyXuP','notAt','6801664dmryNa','stat','WLoin','dGJcx','MARKDOWN','Ori','WhAwA','file','35305wTINbd','_0.png','1312143iEtZGG','pJsMX','gwJvD','height'];_0x14f6=function(){return _0x43c516;};return _0x14f6();}import{calculateFileMD5,isGIF}from'@/common/utils/file';function _0x2e8a(_0x120814,_0x3bff73){const _0x14f670=_0x14f6();return _0x2e8a=function(_0x2e8a35,_0x2150dd){_0x2e8a35=_0x2e8a35-0x121;let _0x213023=_0x14f670[_0x2e8a35];return _0x213023;},_0x2e8a(_0x120814,_0x3bff73);}import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x511d3a(0x14d)](_0x1c546f){const _0x4e63b5=_0x511d3a;return{'elementType':ElementType[_0x4e63b5(0x141)],'elementId':'','textElement':{'content':_0x1c546f,'atType':AtType[_0x4e63b5(0x151)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4ab41a,_0x24e413,_0x49d02a,_0x13898a){const _0x146178=_0x511d3a;return{'elementType':ElementType[_0x146178(0x141)],'elementId':'','textElement':{'content':'@'+_0x13898a,'atType':_0x49d02a,'atUid':_0x4ab41a,'atTinyId':'','atNtUid':_0x24e413}};}static[_0x511d3a(0x13e)](_0x2b5db6,_0x58c894,_0x8ed06d,_0x200fde){const _0x5097a3=_0x511d3a;return{'elementType':ElementType[_0x5097a3(0x12d)],'elementId':'','replyElement':{'replayMsgSeq':_0x2b5db6,'replayMsgId':_0x58c894,'senderUin':_0x8ed06d,'senderUinStr':_0x200fde}};}static async[_0x511d3a(0x170)](_0x23bf62,_0x2abf07='',_0x14d425=0x0){const _0x3198fa=_0x511d3a,_0x4e4f98={'dGJcx':function(_0x3a8651,_0x5dfc84){return _0x3a8651===_0x5dfc84;},'vhbYe':'文件异常，大小为0','WLoin':function(_0x5d8f61,_0x66fca9){return _0x5d8f61(_0x66fca9);},'enfya':function(_0x5789b8,_0x4de5a3,_0x283d33){return _0x5789b8(_0x4de5a3,_0x283d33);},'udefF':_0x3198fa(0x12e)},{md5:_0x1a1289,fileName:_0x14ec97,path:_0x135378,fileSize:_0x3f913b}=await NTQQFileApi[_0x3198fa(0x13a)](_0x23bf62,ElementType[_0x3198fa(0x16f)],_0x14d425);if(_0x4e4f98[_0x3198fa(0x155)](_0x3f913b,0x0))throw _0x4e4f98[_0x3198fa(0x17a)];const _0x214dea=await NTQQFileApi[_0x3198fa(0x13d)](_0x23bf62),_0x5d6d7e={'md5HexStr':_0x1a1289,'fileSize':_0x3f913b['toString'](),'picWidth':_0x214dea?.['width'],'picHeight':_0x214dea?.[_0x3198fa(0x15f)],'fileName':_0x14ec97,'sourcePath':_0x135378,'original':!![],'picType':_0x4e4f98[_0x3198fa(0x154)](isGIF,_0x23bf62)?PicType['gif']:PicType[_0x3198fa(0x174)],'picSubType':_0x14d425,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2abf07};return _0x4e4f98[_0x3198fa(0x14a)](logDebug,_0x4e4f98['udefF'],_0x5d6d7e),{'elementType':ElementType[_0x3198fa(0x16f)],'elementId':'','picElement':_0x5d6d7e};}static async[_0x511d3a(0x159)](_0x2b53aa,_0x4c2fb3=''){const _0x48592b=_0x511d3a,_0x13ddca={'YRPom':function(_0x1bdc6e,_0x3908bd){return _0x1bdc6e===_0x3908bd;},'bIBhy':'文件异常，大小为0','WaABo':function(_0xc44dc8,_0x12e927){return _0xc44dc8||_0x12e927;}},{md5:_0x593112,fileName:_0x5c8c11,path:_0x4d522e,fileSize:_0x361e21}=await NTQQFileApi[_0x48592b(0x13a)](_0x2b53aa,ElementType[_0x48592b(0x130)]);if(_0x13ddca[_0x48592b(0x145)](_0x361e21,0x0))throw _0x13ddca[_0x48592b(0x127)];const _0x31621d={'elementType':ElementType[_0x48592b(0x130)],'elementId':'','fileElement':{'fileName':_0x13ddca[_0x48592b(0x132)](_0x4c2fb3,_0x5c8c11),'filePath':_0x4d522e,'fileSize':_0x361e21['toString']()}};return _0x31621d;}static async[_0x511d3a(0x135)](_0x5191c6,_0x166481='',_0x277937=''){const _0x202319=_0x511d3a,_0x391ab3={'rMHBl':function(_0x11511a,_0x28861f){return _0x11511a(_0x28861f);},'IExgw':'获取视频封面失败，使用默认封面','kfcHC':function(_0x24c4a0,_0xcbcac2){return _0x24c4a0(_0xcbcac2);},'RYNEg':_0x202319(0x16b),'NjihB':_0x202319(0x147),'OPhsV':function(_0x536140,_0x540294){return _0x536140+_0x540294;},'CQNAK':function(_0x18a8d4,_0x5f2569){return _0x18a8d4===_0x5f2569;},'GBHfo':'文件异常，大小为0','KIuad':_0x202319(0x13f),'zeiAo':_0x202319(0x128),'gwJvD':function(_0x29bc52,_0x24f490,_0x11d5a9){return _0x29bc52(_0x24f490,_0x11d5a9);},'ApQQW':_0x202319(0x16a),'yJVmp':_0x202319(0x16d)},{fileName:_0xd827bb,path:_0x1ab0bc,fileSize:_0x157f47,md5:_0x2f2493}=await NTQQFileApi['uploadFile'](_0x5191c6,ElementType[_0x202319(0x131)]);if(_0x391ab3[_0x202319(0x144)](_0x157f47,0x0))throw _0x391ab3['GBHfo'];const _0x1f8f6a=_0x391ab3[_0x202319(0x160)](require,_0x391ab3[_0x202319(0x171)]);let _0x2cb778=_0x1ab0bc[_0x202319(0x175)](_0x1f8f6a[_0x202319(0x178)]+_0x202319(0x157)+_0x1f8f6a[_0x202319(0x178)],_0x1f8f6a[_0x202319(0x178)]+_0x202319(0x134)+_0x1f8f6a[_0x202319(0x178)]);_0x2cb778=_0x1f8f6a['dirname'](_0x2cb778);let _0x4b7eea={'width':0x780,'height':0x438,'time':0xf,'format':_0x391ab3['zeiAo'],'size':_0x157f47,'filePath':_0x5191c6};try{_0x4b7eea=await _0x391ab3[_0x202319(0x160)](getVideoInfo,_0x1ab0bc),_0x391ab3[_0x202319(0x15e)](logDebug,_0x391ab3[_0x202319(0x140)],_0x4b7eea);}catch(_0x3307b4){_0x391ab3[_0x202319(0x15e)](logError,_0x391ab3[_0x202319(0x165)],_0x3307b4);}const _0x4cbeca=new Promise((_0x5e3093,_0x121fec)=>{const _0x19182a=_0x202319,_0x17ff7f={'fSFkV':function(_0x47b9de,_0x23e643){const _0x2b5c89=_0x2e8a;return _0x391ab3[_0x2b5c89(0x160)](_0x47b9de,_0x23e643);},'pJsMX':function(_0x3e5666,_0x30fad1,_0x3d6b2a){return _0x3e5666(_0x30fad1,_0x3d6b2a);},'ljalJ':_0x391ab3[_0x19182a(0x137)]},_0x2854cb=_0x2f2493+_0x19182a(0x15b),_0x5ae98a=_0x1f8f6a[_0x19182a(0x168)](_0x2cb778,_0x2854cb);_0x391ab3[_0x19182a(0x123)](_0x114969,_0x5191c6)['on'](_0x391ab3[_0x19182a(0x129)],()=>{})['on'](_0x391ab3[_0x19182a(0x14b)],_0x367188=>{const _0x27a3a9=_0x19182a;_0x17ff7f[_0x27a3a9(0x15d)](logDebug,_0x17ff7f[_0x27a3a9(0x16e)],_0x367188),_0x277937?_0x145507['copyFile'](_0x277937,_0x5ae98a)['then'](()=>{const _0x9d8a72=_0x27a3a9;_0x17ff7f[_0x9d8a72(0x133)](_0x5e3093,_0x5ae98a);})[_0x27a3a9(0x16c)](_0x121fec):_0x145507[_0x27a3a9(0x14f)](_0x5ae98a,defaultVideoThumb)[_0x27a3a9(0x177)](()=>{_0x5e3093(_0x5ae98a);})['catch'](_0x121fec);})['screenshots']({'timestamps':[0x0],'filename':_0x2854cb,'folder':_0x2cb778,'size':_0x391ab3[_0x19182a(0x164)](_0x4b7eea[_0x19182a(0x167)]+'x',_0x4b7eea[_0x19182a(0x15f)])})['on'](_0x391ab3[_0x19182a(0x129)],()=>{const _0x5338ad=_0x19182a;_0x17ff7f[_0x5338ad(0x133)](_0x5e3093,_0x5ae98a);});}),_0xf9c4d9=new Map(),_0x3c45eb=await _0x4cbeca,_0xd65ca6=(await _0x145507[_0x202319(0x153)](_0x3c45eb))['size'];_0xf9c4d9['set'](0x0,_0x3c45eb);const _0x49f7dc=await _0x391ab3[_0x202319(0x160)](calculateFileMD5,_0x3c45eb),_0x422ede={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x166481||_0xd827bb,'filePath':_0x1ab0bc,'videoMd5':_0x2f2493,'thumbMd5':_0x49f7dc,'fileTime':_0x4b7eea[_0x202319(0x12f)],'thumbPath':_0xf9c4d9,'thumbSize':_0xd65ca6,'thumbWidth':_0x4b7eea[_0x202319(0x167)],'thumbHeight':_0x4b7eea[_0x202319(0x15f)],'fileSize':_0x391ab3[_0x202319(0x164)]('',_0x157f47)}};return _0x422ede;}static async[_0x511d3a(0x139)](_0x184c34){const _0x5e83aa=_0x511d3a,_0x2b5ce3={'sCQar':function(_0xf95fbb,_0x3bfbaf){return _0xf95fbb(_0x3bfbaf);},'YEFDo':_0x5e83aa(0x146),'NyBQd':function(_0x274449,_0x17a4f0){return _0x274449===_0x17a4f0;},'ejTFu':_0x5e83aa(0x176),'WhAwA':function(_0x115f09,_0xcd342d){return _0x115f09||_0xcd342d;}},{converted:_0x1619c9,path:_0x97f63e,duration:_0x96a0e}=await _0x2b5ce3['sCQar'](encodeSilk,_0x184c34);if(!_0x97f63e)throw _0x2b5ce3[_0x5e83aa(0x125)];const {md5:_0x4acd3e,fileName:_0x40ba81,path:_0x125ae4,fileSize:_0x5a14ba}=await NTQQFileApi['uploadFile'](_0x97f63e,ElementType['PTT']);if(_0x2b5ce3['NyBQd'](_0x5a14ba,0x0))throw _0x2b5ce3['ejTFu'];return _0x1619c9&&_0x145507[_0x5e83aa(0x142)](_0x97f63e)[_0x5e83aa(0x177)](),{'elementType':ElementType[_0x5e83aa(0x124)],'elementId':'','pttElement':{'fileName':_0x40ba81,'filePath':_0x125ae4,'md5HexStr':_0x4acd3e,'fileSize':_0x5a14ba,'duration':_0x2b5ce3[_0x5e83aa(0x158)](_0x96a0e,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x511d3a(0x161)](_0xc1e257){const _0x4fa038=_0x511d3a;return{'elementType':ElementType[_0x4fa038(0x172)],'elementId':'','faceElement':{'faceIndex':_0xc1e257,'faceType':_0xc1e257<0xde?FaceType[_0x4fa038(0x163)]:FaceType['normal2']}};}static['mface'](_0x2d8c5b,_0x51c9f8,_0x2587d6,_0x2d3542){const _0x27f8b5=_0x511d3a,_0x3dd963={'YJxAC':_0x27f8b5(0x12a)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x2d8c5b,'emojiId':_0x51c9f8,'key':_0x2587d6,'faceName':_0x2d3542||mFaceCache['get'](_0x51c9f8)||_0x3dd963['YJxAC']}};}static['dice'](_0x29dc9e){const _0x3c002f=_0x511d3a,_0xd7c10c={'qoyRt':_0x3c002f(0x12b)};return{'elementType':ElementType[_0x3c002f(0x172)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x3c002f(0x169)],'faceText':_0xd7c10c['qoyRt'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x511d3a(0x179)](_0x32b3a0){const _0xea73bb=_0x511d3a,_0x13efab={'xpvOU':_0xea73bb(0x126)};return{'elementType':ElementType[_0xea73bb(0x172)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0xea73bb(0x136)],'faceText':_0x13efab[_0xea73bb(0x143)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x511d3a(0x162)](_0x228057){const _0x276ae9=_0x511d3a,_0x407ec7={'NJNXY':_0x276ae9(0x121)};return typeof _0x228057!==_0x407ec7[_0x276ae9(0x14c)]&&(_0x228057=JSON[_0x276ae9(0x138)](_0x228057)),{'elementType':ElementType[_0x276ae9(0x14e)],'elementId':'','arkElement':{'bytesData':_0x228057,'linkInfo':null,'subElementType':null}};}static[_0x511d3a(0x173)](_0x1991a4){const _0x51fe36=_0x511d3a;return{'elementType':ElementType[_0x51fe36(0x156)],'elementId':'','markdownElement':{'content':_0x1991a4}};}}