const _0x3139ba=_0x2665;(function(_0x5d5eb4,_0x4def2d){const _0x30db90=_0x2665,_0x4adc7b=_0x5d5eb4();while(!![]){try{const _0x4619a1=-parseInt(_0x30db90(0x13a))/0x1+-parseInt(_0x30db90(0x12d))/0x2+-parseInt(_0x30db90(0x10c))/0x3*(parseInt(_0x30db90(0xfc))/0x4)+parseInt(_0x30db90(0x115))/0x5*(parseInt(_0x30db90(0x148))/0x6)+parseInt(_0x30db90(0x13f))/0x7*(parseInt(_0x30db90(0x10a))/0x8)+parseInt(_0x30db90(0x122))/0x9*(parseInt(_0x30db90(0x133))/0xa)+-parseInt(_0x30db90(0x143))/0xb*(-parseInt(_0x30db90(0x106))/0xc);if(_0x4619a1===_0x4def2d)break;else _0x4adc7b['push'](_0x4adc7b['shift']());}catch(_0x51818e){_0x4adc7b['push'](_0x4adc7b['shift']());}}}(_0x49ed,0x617fa));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x5b50c0}from'node:fs';import _0x1987a3 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x2665(_0x3b504e,_0x59286c){const _0x49ede3=_0x49ed();return _0x2665=function(_0x2665de,_0x2168c5){_0x2665de=_0x2665de-0xed;let _0x8a080d=_0x49ede3[_0x2665de];return _0x8a080d;},_0x2665(_0x3b504e,_0x59286c);}import{encodeSilk}from'@/common/utils/audio';import _0x49eeac from'./face_config.json';function _0x49ed(){const _0x3d32e9=['end','file','emoji','564026xpbLoR','[骰子]','sysface','TEXT','RPS','518GaVjcv','Bot\x20Test','jpg','MFACE','902jKraZT','TgjLB','find','height','sep','2892NZhYcI','saWWs','replace','ptt','FPOMY','video','miniapp','FILE','size','join','asWmZ','dirname','nTksU','WCokw','markdown','amBna','getImageSize','hoSUC','136RGIsZX','error','HzLKA','screenshots','string','face','jAvKp','dice','bvyCp','gyQGq','184596aMDgTv','stat','PIC','set','392HWoKLW','[包剪锤]','31197SEqAFf','mface','lWqMJ','Ori','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','_0.png','unlink','width','rTMBQ','2260WGdZsw','stringify','VIDEO','REPLY','reply','get','语音转换失败,\x20请检查语音文件是否正常','dLLVu','REPid','writeFile','FACE','https://www.bilibili.com/','toString','45Wvanyc','mHptD','gif','QSid','[商城表情]','catch','wpSfx','获取视频信息失败','pic','AniStickerType','文件异常，大小为0','1523010fbOCxA','then','uploadFile','QDes','LmwTs','mp4','1191110srAWnK','Thumb','copyFile','bRIDs'];_0x49ed=function(){return _0x3d32e9;};return _0x49ed();}import*as _0x393019 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x555c6e){const _0x53c0f1=_0x2665;return{'elementType':ElementType[_0x53c0f1(0x13d)],'elementId':'','textElement':{'content':_0x555c6e,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4ca4cd,_0x378810,_0x29543b,_0x261830){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x261830,'atType':_0x29543b,'atUid':_0x4ca4cd,'atTinyId':'','atNtUid':_0x378810}};}static[_0x3139ba(0x119)](_0x30f436,_0x19411c,_0xd2d2df,_0xfcd2d9){const _0x1647ae=_0x3139ba;return{'elementType':ElementType[_0x1647ae(0x118)],'elementId':'','replyElement':{'replayMsgSeq':_0x30f436,'replayMsgId':_0x19411c,'senderUin':_0xd2d2df,'senderUinStr':_0xfcd2d9}};}static async[_0x3139ba(0x12a)](_0x120f1b,_0x41e389='',_0x28c3e2=0x0){const _0x5c53b7=_0x3139ba,_0x4023b9={'FKnew':function(_0x1b44ab,_0x225cb4){return _0x1b44ab===_0x225cb4;},'nTksU':'文件异常，大小为0','WCokw':function(_0x63ee76,_0x55be9d){return _0x63ee76(_0x55be9d);}},{md5:_0x199fdc,fileName:_0x3f2c15,path:_0x406467,fileSize:_0x90c209}=await NTQQFileApi[_0x5c53b7(0x12f)](_0x120f1b,ElementType[_0x5c53b7(0x108)],_0x28c3e2);if(_0x4023b9['FKnew'](_0x90c209,0x0))throw _0x4023b9[_0x5c53b7(0xf6)];const _0x34a085=await NTQQFileApi[_0x5c53b7(0xfa)](_0x120f1b),_0x325f7f={'md5HexStr':_0x199fdc,'fileSize':_0x90c209[_0x5c53b7(0x121)](),'picWidth':_0x34a085?.['width'],'picHeight':_0x34a085?.[_0x5c53b7(0x146)],'fileName':_0x3f2c15,'sourcePath':_0x406467,'original':!![],'picType':_0x4023b9[_0x5c53b7(0xf7)](isGIF,_0x120f1b)?PicType[_0x5c53b7(0x124)]:PicType[_0x5c53b7(0x141)],'picSubType':_0x28c3e2,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x41e389};return{'elementType':ElementType[_0x5c53b7(0x108)],'elementId':'','picElement':_0x325f7f};}static async[_0x3139ba(0x138)](_0x386845,_0x2f33b9='',_0x6c8e32=''){const _0x48d784=_0x3139ba,_0x2dc242={'asWmZ':function(_0x360835,_0x464048){return _0x360835===_0x464048;},'sKnqB':_0x48d784(0x12c),'lWqMJ':function(_0x329537,_0x59a271){return _0x329537||_0x59a271;}},{md5:_0x4b18cc,fileName:_0x19e413,path:_0x59954e,fileSize:_0x18d6d2}=await NTQQFileApi[_0x48d784(0x12f)](_0x386845,ElementType[_0x48d784(0xf1)]);if(_0x2dc242[_0x48d784(0xf4)](_0x18d6d2,0x0))throw _0x2dc242['sKnqB'];const _0x29da2a={'elementType':ElementType[_0x48d784(0xf1)],'elementId':'','fileElement':{'fileName':_0x2dc242[_0x48d784(0x10e)](_0x2f33b9,_0x19e413),'folderId':_0x6c8e32,'filePath':_0x59954e,'fileSize':_0x18d6d2[_0x48d784(0x121)]()}};return _0x29da2a;}static async[_0x3139ba(0xef)](_0x2274b8,_0x2d1c7b='',_0x10f5f6=''){const _0x282a83=_0x3139ba,_0x54ce83={'TgjLB':function(_0x1e6263,_0x1b02c9,_0x46bdb9){return _0x1e6263(_0x1b02c9,_0x46bdb9);},'amBna':'获取视频封面失败，使用默认封面','mHptD':function(_0x8f6d47,_0x5beabd){return _0x8f6d47(_0x5beabd);},'hwZtA':function(_0x4587ad,_0x446c20){return _0x4587ad(_0x446c20);},'REPid':_0x282a83(0x137),'bvyCp':function(_0x49713b,_0x18715a){return _0x49713b+_0x18715a;},'KGNMR':function(_0x98270d,_0x598163){return _0x98270d===_0x598163;},'jAvKp':_0x282a83(0x132),'xSrnO':function(_0x50861a,_0x315767){return _0x50861a(_0x315767);},'dLLVu':_0x282a83(0x129),'FrQbv':function(_0x42a019,_0x215406){return _0x42a019||_0x215406;}},{fileName:_0x1b80cb,path:_0x2bcb97,fileSize:_0x3d84a4,md5:_0x426354}=await NTQQFileApi['uploadFile'](_0x2274b8,ElementType[_0x282a83(0x117)]);if(_0x54ce83['KGNMR'](_0x3d84a4,0x0))throw _0x282a83(0x12c);let _0x26d60a=_0x2bcb97[_0x282a83(0x14a)](_0x393019[_0x282a83(0x147)]+_0x282a83(0x10f)+_0x393019[_0x282a83(0x147)],_0x393019[_0x282a83(0x147)]+_0x282a83(0x134)+_0x393019[_0x282a83(0x147)]);_0x26d60a=_0x393019[_0x282a83(0xf5)](_0x26d60a);let _0x34f17e={'width':0x780,'height':0x438,'time':0xf,'format':_0x54ce83[_0x282a83(0x102)],'size':_0x3d84a4,'filePath':_0x2274b8};try{_0x34f17e=await _0x54ce83['xSrnO'](getVideoInfo,_0x2bcb97);}catch(_0x4d798a){_0x54ce83['TgjLB'](logError,_0x54ce83[_0x282a83(0x11c)],_0x4d798a);}const _0x196ba8=new Promise((_0x4637f2,_0x2b88d8)=>{const _0x4a4789=_0x282a83,_0xde9402={'adIMd':function(_0x174025,_0x49f24e){const _0x32e56e=_0x2665;return _0x54ce83[_0x32e56e(0x123)](_0x174025,_0x49f24e);}},_0x528509=_0x426354+_0x4a4789(0x111),_0x53d9d1=_0x393019[_0x4a4789(0xf3)](_0x26d60a,_0x528509);_0x54ce83['hwZtA'](_0x1987a3,_0x2274b8)['on'](_0x54ce83[_0x4a4789(0x11d)],()=>{})['on'](_0x4a4789(0xfd),_0x4011ab=>{const _0x45950a=_0x4a4789;_0x54ce83[_0x45950a(0x144)](logDebug,_0x54ce83[_0x45950a(0xf9)],_0x4011ab),_0x10f5f6?_0x5b50c0[_0x45950a(0x135)](_0x10f5f6,_0x53d9d1)[_0x45950a(0x12e)](()=>{_0x4637f2(_0x53d9d1);})[_0x45950a(0x127)](_0x2b88d8):_0x5b50c0[_0x45950a(0x11e)](_0x53d9d1,defaultVideoThumb)[_0x45950a(0x12e)](()=>{_0x4637f2(_0x53d9d1);})[_0x45950a(0x127)](_0x2b88d8);})[_0x4a4789(0xff)]({'timestamps':[0x0],'filename':_0x528509,'folder':_0x26d60a,'size':_0x54ce83[_0x4a4789(0x104)](_0x34f17e[_0x4a4789(0x113)]+'x',_0x34f17e['height'])})['on'](_0x54ce83[_0x4a4789(0x11d)],()=>{_0xde9402['adIMd'](_0x4637f2,_0x53d9d1);});}),_0x915a71=new Map(),_0x353869=await _0x196ba8,_0x31691b=(await _0x5b50c0[_0x282a83(0x107)](_0x353869))[_0x282a83(0xf2)];_0x915a71[_0x282a83(0x109)](0x0,_0x353869);const _0x58e969=await calculateFileMD5(_0x353869),_0x375144={'elementType':ElementType[_0x282a83(0x117)],'elementId':'','videoElement':{'fileName':_0x54ce83['FrQbv'](_0x2d1c7b,_0x1b80cb),'filePath':_0x2bcb97,'videoMd5':_0x426354,'thumbMd5':_0x58e969,'fileTime':_0x34f17e['time'],'thumbPath':_0x915a71,'thumbSize':_0x31691b,'thumbWidth':_0x34f17e['width'],'thumbHeight':_0x34f17e[_0x282a83(0x146)],'fileSize':_0x54ce83[_0x282a83(0x104)]('',_0x3d84a4)}};return _0x375144;}static async[_0x3139ba(0xed)](_0x1bb877){const _0x339c0c=_0x3139ba,_0x3e3bb3={'saWWs':function(_0x2852ad,_0x39c717){return _0x2852ad(_0x39c717);},'wpSfx':_0x339c0c(0x11b),'hoSUC':function(_0xeb99f6,_0x366d65){return _0xeb99f6===_0x366d65;},'eoEsT':function(_0x36def8,_0x2f3583){return _0x36def8||_0x2f3583;}},{converted:_0x7edb47,path:_0x3fd88e,duration:_0x2880d6}=await _0x3e3bb3[_0x339c0c(0x149)](encodeSilk,_0x1bb877);if(!_0x3fd88e)throw _0x3e3bb3[_0x339c0c(0x128)];const {md5:_0x48de22,fileName:_0x3981a2,path:_0x5d3e3f,fileSize:_0x417d65}=await NTQQFileApi['uploadFile'](_0x3fd88e,ElementType['PTT']);if(_0x3e3bb3[_0x339c0c(0xfb)](_0x417d65,0x0))throw _0x339c0c(0x12c);return _0x7edb47&&_0x5b50c0[_0x339c0c(0x112)](_0x3fd88e)[_0x339c0c(0x12e)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x3981a2,'filePath':_0x5d3e3f,'md5HexStr':_0x48de22,'fileSize':_0x417d65,'duration':_0x3e3bb3['eoEsT'](_0x2880d6,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x3139ba(0x101)](_0x13d8ea){const _0x4e6bb7=_0x3139ba,_0x44f959={'rTMBQ':function(_0xd59ff8,_0x41389e){return _0xd59ff8>=_0x41389e;}},_0xc69f60=_0x49eeac[_0x4e6bb7(0x13c)],_0x3b15b9=_0x49eeac[_0x4e6bb7(0x139)],_0x54f0fa=_0xc69f60[_0x4e6bb7(0x145)](_0x4c355a=>_0x4c355a[_0x4e6bb7(0x125)]===_0x13d8ea[_0x4e6bb7(0x121)]());_0x13d8ea=parseInt(_0x13d8ea[_0x4e6bb7(0x121)]());let _0x2189e7=0x1;return _0x44f959[_0x4e6bb7(0x114)](_0x13d8ea,0xde)&&(_0x2189e7=0x2),_0x54f0fa[_0x4e6bb7(0x12b)]&&(_0x2189e7=0x3),{'elementType':ElementType[_0x4e6bb7(0x11f)],'elementId':'','faceElement':{'faceIndex':_0x13d8ea,'faceType':_0x2189e7,'faceText':_0x54f0fa[_0x4e6bb7(0x130)],'stickerId':_0x54f0fa['AniStickerId'],'stickerType':_0x54f0fa['AniStickerType'],'packId':_0x54f0fa['AniStickerPackId'],'sourceType':0x1}};}static[_0x3139ba(0x10d)](_0x92fc18,_0x1f9199,_0x5875ef,_0x4dcac2){const _0x4ac3b4=_0x3139ba;return{'elementType':ElementType[_0x4ac3b4(0x142)],'marketFaceElement':{'emojiPackageId':_0x92fc18,'emojiId':_0x1f9199,'key':_0x5875ef,'faceName':_0x4dcac2||mFaceCache[_0x4ac3b4(0x11a)](_0x1f9199)||_0x4ac3b4(0x126)}};}static['dice'](_0xcccadc){const _0x57fd63=_0x3139ba,_0x2cbd46={'HzLKA':_0x57fd63(0x13b)};return{'elementType':ElementType[_0x57fd63(0x11f)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x57fd63(0x103)],'faceType':FaceType[_0x57fd63(0x103)],'faceText':_0x2cbd46[_0x57fd63(0xfe)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x505b49){const _0x37df76=_0x3139ba,_0x14a655={'LmwTs':_0x37df76(0x10b)};return{'elementType':ElementType[_0x37df76(0x11f)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x37df76(0x13e)],'faceText':_0x14a655[_0x37df76(0x131)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x2b70e6){const _0x3bf686=_0x3139ba,_0x22aca1={'FPOMY':function(_0x2e55eb,_0x2263ae){return _0x2e55eb!==_0x2263ae;}};return _0x22aca1[_0x3bf686(0xee)](typeof _0x2b70e6,_0x3bf686(0x100))&&(_0x2b70e6=JSON[_0x3bf686(0x116)](_0x2b70e6)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x2b70e6,'linkInfo':null,'subElementType':null}};}static[_0x3139ba(0xf8)](_0xbdc69c){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0xbdc69c}};}static async[_0x3139ba(0xf0)](){const _0x224d62=_0x3139ba,_0x55792a={'dscvi':function(_0x527118,_0x55d9ea){return _0x527118(_0x55d9ea);},'gyQGq':_0x224d62(0x140),'Lkaje':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','bRIDs':_0x224d62(0x120)};let _0xd36444=await _0x55792a['dscvi'](SignMiniApp,{'prompt':_0x224d62(0x140),'title':_0x55792a['gyQGq'],'preview':_0x55792a['Lkaje'],'jumpUrl':_0x55792a[_0x224d62(0x136)],'tag':_0x55792a[_0x224d62(0x105)],'tagIcon':_0x224d62(0x110),'source':_0x55792a[_0x224d62(0x105)],'sourcelogo':_0x224d62(0x110)});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0xd36444,'linkInfo':null,'subElementType':null}};}}