const _0x35fbf6=_0xaba9;function _0xa694(){const _0x7e8e34=['replace','normal2','视频信息','ITFtf','get','set','721265hYjVcF','rps','ARK','[商城表情]','lnKNd','[包剪锤]','PIC','zNjtQ','lZikK','unlink','face','14019kItTuY','TEXT','toString','10171854bDKbjb','height','rrTQk','dyzUj','width','Ori','获取视频信息失败','文件异常，大小为0','hcBuL','uploadFile','图片信息','pic','end','ark','_0.png','MFACE','53606YoOJUp','normal','then','path','ujnFJ','Llfnk','markdown','sep','error','size','time','moBLu','4475152kGUPIK','VDGvj','FACE','PTT','语音转换失败,\x20请检查语音文件是否正常','ptt','OkptB','FILE','dVKQY','getImageSize','pEXVa','string','WermL','10FjMIdU','2845332SUyjLi','18hQTQAX','jpg','LlQUQ','DORzQ','244IWiBie','stringify','MARKDOWN','reply','REPLY','1221336BuBAud','pkuru','aFjTB','file','zWipB','join','RPS','dice','JPofO','writeFile','dirname','NWHOc','[骰子]','catch','17ILOqBd'];_0xa694=function(){return _0x7e8e34;};return _0xa694();}function _0xaba9(_0xca338,_0x1f9d32){const _0xa6940a=_0xa694();return _0xaba9=function(_0xaba916,_0x2171a8){_0xaba916=_0xaba916-0x90;let _0x550e6e=_0xa6940a[_0xaba916];return _0x550e6e;},_0xaba9(_0xca338,_0x1f9d32);}(function(_0x15c45f,_0x29127b){const _0x345a2f=_0xaba9,_0x26b78c=_0x15c45f();while(!![]){try{const _0x223a5a=parseInt(_0x345a2f(0xb6))/0x1*(-parseInt(_0x345a2f(0xdb))/0x2)+-parseInt(_0x345a2f(0xc8))/0x3*(parseInt(_0x345a2f(0xa3))/0x4)+parseInt(_0x345a2f(0xbd))/0x5*(parseInt(_0x345a2f(0x9f))/0x6)+parseInt(_0x345a2f(0x9e))/0x7+-parseInt(_0x345a2f(0x90))/0x8+-parseInt(_0x345a2f(0xa8))/0x9*(parseInt(_0x345a2f(0x9d))/0xa)+parseInt(_0x345a2f(0xcb))/0xb;if(_0x223a5a===_0x29127b)break;else _0x26b78c['push'](_0x26b78c['shift']());}catch(_0x249e90){_0x26b78c['push'](_0x26b78c['shift']());}}}(_0xa694,0x501d3));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x12992a}from'node:fs';import _0x495410 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x9edce6){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x9edce6,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x41add2,_0x38f7cf,_0x27991c,_0x1832fd){const _0x26458b=_0xaba9;return{'elementType':ElementType[_0x26458b(0xc9)],'elementId':'','textElement':{'content':'@'+_0x1832fd,'atType':_0x27991c,'atUid':_0x41add2,'atTinyId':'','atNtUid':_0x38f7cf}};}static[_0x35fbf6(0xa6)](_0x480a23,_0x5d429d,_0x2b11ed,_0x414f94){const _0x3fb7e0=_0x35fbf6;return{'elementType':ElementType[_0x3fb7e0(0xa7)],'elementId':'','replyElement':{'replayMsgSeq':_0x480a23,'replayMsgId':_0x5d429d,'senderUin':_0x2b11ed,'senderUinStr':_0x414f94}};}static async[_0x35fbf6(0xd6)](_0x2481be,_0x551b08='',_0x2039c3=0x0){const _0x1fa7b9=_0x35fbf6,_0x1f4ea3={'KssvV':function(_0x176a0f,_0x12f070){return _0x176a0f===_0x12f070;},'ujnFJ':_0x1fa7b9(0xd2),'pEXVa':function(_0x11beea,_0x20c63d){return _0x11beea(_0x20c63d);},'ITFtf':function(_0x45819b,_0x5e1fd8,_0x10dcec){return _0x45819b(_0x5e1fd8,_0x10dcec);},'aFjTB':_0x1fa7b9(0xd5)},{md5:_0x25c7ea,fileName:_0x737029,path:_0x396a74,fileSize:_0x26449b}=await NTQQFileApi[_0x1fa7b9(0xd4)](_0x2481be,ElementType[_0x1fa7b9(0xc3)],_0x2039c3);if(_0x1f4ea3['KssvV'](_0x26449b,0x0))throw _0x1f4ea3[_0x1fa7b9(0xdf)];const _0x1a5f5b=await NTQQFileApi[_0x1fa7b9(0x99)](_0x2481be),_0x2b7297={'md5HexStr':_0x25c7ea,'fileSize':_0x26449b[_0x1fa7b9(0xca)](),'picWidth':_0x1a5f5b?.[_0x1fa7b9(0xcf)],'picHeight':_0x1a5f5b?.['height'],'fileName':_0x737029,'sourcePath':_0x396a74,'original':!![],'picType':_0x1f4ea3[_0x1fa7b9(0x9a)](isGIF,_0x2481be)?PicType['gif']:PicType[_0x1fa7b9(0xa0)],'picSubType':_0x2039c3,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x551b08};return _0x1f4ea3[_0x1fa7b9(0xba)](logDebug,_0x1f4ea3[_0x1fa7b9(0xaa)],_0x2b7297),{'elementType':ElementType[_0x1fa7b9(0xc3)],'elementId':'','picElement':_0x2b7297};}static async[_0x35fbf6(0xab)](_0x95b6c,_0x4f864f=''){const _0x19ac52=_0x35fbf6,_0x37c587={'jsdrD':function(_0x2caadb,_0x2bda7e){return _0x2caadb===_0x2bda7e;},'zNjtQ':'文件异常，大小为0'},{md5:_0x8d2aad,fileName:_0x1c8aba,path:_0x1d2761,fileSize:_0x95a00b}=await NTQQFileApi[_0x19ac52(0xd4)](_0x95b6c,ElementType[_0x19ac52(0x97)]);if(_0x37c587['jsdrD'](_0x95a00b,0x0))throw _0x37c587[_0x19ac52(0xc4)];const _0x5640ae={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x4f864f||_0x1c8aba,'filePath':_0x1d2761,'fileSize':_0x95a00b[_0x19ac52(0xca)]()}};return _0x5640ae;}static async['video'](_0x4b9dde,_0x13bde3='',_0xc70447=''){const _0x335ddf=_0x35fbf6,_0x1735f7={'lnKNd':function(_0x522f3e,_0x462fdf,_0x51cdac){return _0x522f3e(_0x462fdf,_0x51cdac);},'DORzQ':_0x335ddf(0xd7),'OkptB':function(_0x3e9ce3,_0x4d52cb){return _0x3e9ce3+_0x4d52cb;},'rrTQk':function(_0xc94eed,_0x15ae30){return _0xc94eed+_0x15ae30;},'hcBuL':function(_0x5e9843,_0x5c611f){return _0x5e9843===_0x5c611f;},'Llfnk':_0x335ddf(0xd2),'pkuru':function(_0x3ab7a2,_0x1ec6a8){return _0x3ab7a2(_0x1ec6a8);},'qXfTN':_0x335ddf(0xde),'moBLu':'mp4','NqKiR':_0x335ddf(0xb9),'XIBLh':_0x335ddf(0xd1),'dyzUj':function(_0x5f7242,_0x5ad6d8){return _0x5f7242||_0x5ad6d8;},'rhLXz':function(_0xbef942,_0x41aa25){return _0xbef942+_0x41aa25;}},{fileName:_0x1975b4,path:_0x172e1f,fileSize:_0x448bec,md5:_0x4aa930}=await NTQQFileApi[_0x335ddf(0xd4)](_0x4b9dde,ElementType['VIDEO']);if(_0x1735f7[_0x335ddf(0xd3)](_0x448bec,0x0))throw _0x1735f7[_0x335ddf(0xe0)];const _0x164ae2=_0x1735f7[_0x335ddf(0xa9)](require,_0x1735f7['qXfTN']);let _0x5a4d6c=_0x172e1f[_0x335ddf(0xb7)](_0x164ae2['sep']+_0x335ddf(0xd0)+_0x164ae2['sep'],_0x164ae2[_0x335ddf(0xe2)]+'Thumb'+_0x164ae2['sep']);_0x5a4d6c=_0x164ae2[_0x335ddf(0xb2)](_0x5a4d6c);let _0x54ece4={'width':0x780,'height':0x438,'time':0xf,'format':_0x1735f7[_0x335ddf(0xe6)],'size':_0x448bec,'filePath':_0x4b9dde};try{_0x54ece4=await _0x1735f7['pkuru'](getVideoInfo,_0x172e1f),_0x1735f7[_0x335ddf(0xc1)](logDebug,_0x1735f7['NqKiR'],_0x54ece4);}catch(_0x367497){_0x1735f7[_0x335ddf(0xc1)](logError,_0x1735f7['XIBLh'],_0x367497);}const _0x44e8f4=new Promise((_0x505ca1,_0x1b44f6)=>{const _0x201f40=_0x335ddf,_0x22ebae={'dPrMp':function(_0x336c1e,_0x5a7a89){return _0x336c1e(_0x5a7a89);},'WermL':function(_0x2376b2,_0x4cafbc,_0xf8a3e){const _0x1ba1e9=_0xaba9;return _0x1735f7[_0x1ba1e9(0xc1)](_0x2376b2,_0x4cafbc,_0xf8a3e);}},_0x4bb1fc=_0x4aa930+_0x201f40(0xd9),_0x3822f2=_0x164ae2[_0x201f40(0xad)](_0x5a4d6c,_0x4bb1fc);_0x495410(_0x4b9dde)['on'](_0x1735f7[_0x201f40(0xa2)],()=>{})['on'](_0x201f40(0xe3),_0x44bf3e=>{const _0x3979ca=_0x201f40,_0x501d9b={'VDGvj':function(_0x128b68,_0x3ea32e){return _0x22ebae['dPrMp'](_0x128b68,_0x3ea32e);}};_0x22ebae[_0x3979ca(0x9c)](logDebug,'获取视频封面失败，使用默认封面',_0x44bf3e),_0xc70447?_0x12992a['copyFile'](_0xc70447,_0x3822f2)['then'](()=>{_0x505ca1(_0x3822f2);})[_0x3979ca(0xb5)](_0x1b44f6):_0x12992a[_0x3979ca(0xb1)](_0x3822f2,defaultVideoThumb)[_0x3979ca(0xdd)](()=>{const _0x1e731f=_0x3979ca;_0x501d9b[_0x1e731f(0x91)](_0x505ca1,_0x3822f2);})[_0x3979ca(0xb5)](_0x1b44f6);})['screenshots']({'timestamps':[0x0],'filename':_0x4bb1fc,'folder':_0x5a4d6c,'size':_0x1735f7[_0x201f40(0x96)](_0x1735f7[_0x201f40(0xcd)](_0x54ece4[_0x201f40(0xcf)],'x'),_0x54ece4[_0x201f40(0xcc)])})['on'](_0x1735f7['DORzQ'],()=>{_0x505ca1(_0x3822f2);});}),_0x48cb1f=new Map(),_0x351cd2=await _0x44e8f4,_0x25de7c=(await _0x12992a['stat'](_0x351cd2))[_0x335ddf(0xe4)];_0x48cb1f[_0x335ddf(0xbc)](0x0,_0x351cd2);const _0x179a57=await _0x1735f7[_0x335ddf(0xa9)](calculateFileMD5,_0x351cd2),_0xd7bb83={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x1735f7[_0x335ddf(0xce)](_0x13bde3,_0x1975b4),'filePath':_0x172e1f,'videoMd5':_0x4aa930,'thumbMd5':_0x179a57,'fileTime':_0x54ece4[_0x335ddf(0xe5)],'thumbPath':_0x48cb1f,'thumbSize':_0x25de7c,'thumbWidth':_0x54ece4['width'],'thumbHeight':_0x54ece4[_0x335ddf(0xcc)],'fileSize':_0x1735f7['rhLXz']('',_0x448bec)}};return _0xd7bb83;}static async[_0x35fbf6(0x95)](_0x37d5fc){const _0x4c021d=_0x35fbf6,_0x119098={'lZikK':function(_0x196e81,_0xa15b77){return _0x196e81(_0xa15b77);},'LlQUQ':_0x4c021d(0x94),'NWHOc':_0x4c021d(0xd2)},{converted:_0x569130,path:_0x32fa70,duration:_0x80f802}=await _0x119098[_0x4c021d(0xc5)](encodeSilk,_0x37d5fc);if(!_0x32fa70)throw _0x119098[_0x4c021d(0xa1)];const {md5:_0xdf0783,fileName:_0x5e9849,path:_0x400667,fileSize:_0x1fb1bd}=await NTQQFileApi[_0x4c021d(0xd4)](_0x32fa70,ElementType['PTT']);if(_0x1fb1bd===0x0)throw _0x119098[_0x4c021d(0xb3)];return _0x569130&&_0x12992a[_0x4c021d(0xc6)](_0x32fa70)[_0x4c021d(0xdd)](),{'elementType':ElementType[_0x4c021d(0x93)],'elementId':'','pttElement':{'fileName':_0x5e9849,'filePath':_0x400667,'md5HexStr':_0xdf0783,'fileSize':_0x1fb1bd,'duration':_0x80f802||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x35fbf6(0xc7)](_0x5851fd){const _0x5b7803=_0x35fbf6,_0x250542={'dVKQY':function(_0xf18d2f,_0x63525){return _0xf18d2f<_0x63525;}};return{'elementType':ElementType[_0x5b7803(0x92)],'elementId':'','faceElement':{'faceIndex':_0x5851fd,'faceType':_0x250542[_0x5b7803(0x98)](_0x5851fd,0xde)?FaceType[_0x5b7803(0xdc)]:FaceType[_0x5b7803(0xb8)]}};}static['mface'](_0x36bfaa,_0x245cb4,_0x406fe3,_0x4b5bc8){const _0x50950a=_0x35fbf6;return{'elementType':ElementType[_0x50950a(0xda)],'marketFaceElement':{'emojiPackageId':_0x36bfaa,'emojiId':_0x245cb4,'key':_0x406fe3,'faceName':_0x4b5bc8||mFaceCache[_0x50950a(0xbb)](_0x245cb4)||_0x50950a(0xc0)}};}static[_0x35fbf6(0xaf)](_0x3fe095){const _0x5e4c19=_0x35fbf6,_0x81b3e9={'gqjdY':_0x5e4c19(0xb4)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x5e4c19(0xaf)],'faceType':FaceType[_0x5e4c19(0xaf)],'faceText':_0x81b3e9['gqjdY'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x35fbf6(0xbe)](_0x5d4951){const _0x875864=_0x35fbf6,_0x44d163={'zWipB':_0x875864(0xc2)};return{'elementType':ElementType[_0x875864(0x92)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x875864(0xae)],'faceText':_0x44d163[_0x875864(0xac)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x35fbf6(0xd8)](_0x5bfd0b){const _0x4ccd8f=_0x35fbf6,_0x5062e2={'znfqN':function(_0x2bba75,_0xd2b0ca){return _0x2bba75!==_0xd2b0ca;},'JPofO':_0x4ccd8f(0x9b)};return _0x5062e2['znfqN'](typeof _0x5bfd0b,_0x5062e2[_0x4ccd8f(0xb0)])&&(_0x5bfd0b=JSON[_0x4ccd8f(0xa4)](_0x5bfd0b)),{'elementType':ElementType[_0x4ccd8f(0xbf)],'elementId':'','arkElement':{'bytesData':_0x5bfd0b,'linkInfo':null,'subElementType':null}};}static[_0x35fbf6(0xe1)](_0x3704fa){const _0x287505=_0x35fbf6;return{'elementType':ElementType[_0x287505(0xa5)],'elementId':'','markdownElement':{'content':_0x3704fa}};}}