const _0x4106ca=_0x23a8;function _0x15fd(){const _0x83e752=['end','hpPph','MFACE','string','[骰子]','TEXT','视频信息','writeFile','dCAzT','mface','set','4ForXKG','JlnMC','path','normal2','get','Ori','normal','copyFile','3105696UkHVvr','file','1939287IwSILo','sep','then','width','size','PTT','uqLUn','OKooD','notAt','wTUrI','RPS','uploadFile','replace','1448390TVcKFD','HNskd','726006eYxPtG','DDYJz','SSije','获取视频信息失败','FILE','Thumb','rNTDp','MARKDOWN','PIC','eBNMR','screenshots','time','27gkeeRL','pic','unlink','FACE','dirname','pftPV','video','1GaAaqO','nSNGi','join','xJOFh','获取视频封面失败，使用默认封面','ark','232968isYXVD','face','_0.png','mp4','xqOil','45495NTknXZ','getImageSize','toString','dice','ptt','catch','文件异常，大小为0','语音转换失败,\x20请检查语音文件是否正常','reply','OwpNq','2651904atQpei','VIDEO','ARK','stringify','kbuqm','sYrPZ','REPLY','height'];_0x15fd=function(){return _0x83e752;};return _0x15fd();}(function(_0x699a83,_0x1da9e7){const _0x2ffda8=_0x23a8,_0x1cfa67=_0x699a83();while(!![]){try{const _0x468de9=-parseInt(_0x2ffda8(0xf0))/0x1*(-parseInt(_0x2ffda8(0xdd))/0x2)+parseInt(_0x2ffda8(0xf6))/0x3*(parseInt(_0x2ffda8(0xc4))/0x4)+parseInt(_0x2ffda8(0xfb))/0x5+-parseInt(_0x2ffda8(0x105))/0x6+parseInt(_0x2ffda8(0xce))/0x7+parseInt(_0x2ffda8(0xcc))/0x8+parseInt(_0x2ffda8(0xe9))/0x9*(-parseInt(_0x2ffda8(0xdb))/0xa);if(_0x468de9===_0x1da9e7)break;else _0x1cfa67['push'](_0x1cfa67['shift']());}catch(_0x37e319){_0x1cfa67['push'](_0x1cfa67['shift']());}}}(_0x15fd,0x3a3ae));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x38af6c}from'node:fs';import _0x93bcfb from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();function _0x23a8(_0x598b55,_0x47f2ad){const _0x15fdf4=_0x15fd();return _0x23a8=function(_0x23a838,_0x54684a){_0x23a838=_0x23a838-0xb9;let _0x245998=_0x15fdf4[_0x23a838];return _0x245998;},_0x23a8(_0x598b55,_0x47f2ad);}export class SendMsgElementConstructor{static['text'](_0x1eb5af){const _0x11d08b=_0x23a8;return{'elementType':ElementType[_0x11d08b(0xbe)],'elementId':'','textElement':{'content':_0x1eb5af,'atType':AtType[_0x11d08b(0xd6)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x54a174,_0x53d014,_0x1c2005,_0x5aa762){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x5aa762,'atType':_0x1c2005,'atUid':_0x54a174,'atTinyId':'','atNtUid':_0x53d014}};}static[_0x4106ca(0x103)](_0x5b1534,_0x2abeef,_0x3c3fb7,_0x550883){const _0x521dc1=_0x4106ca;return{'elementType':ElementType[_0x521dc1(0x10b)],'elementId':'','replyElement':{'replayMsgSeq':_0x5b1534,'replayMsgId':_0x2abeef,'senderUin':_0x3c3fb7,'senderUinStr':_0x550883}};}static async[_0x4106ca(0xea)](_0x707244,_0x422116='',_0x3ac61f=0x0){const _0x2261a4=_0x4106ca,_0x30903f={'LKyQY':function(_0xa94b6d,_0x5774f8){return _0xa94b6d===_0x5774f8;},'CQHeo':_0x2261a4(0x101),'rBooq':function(_0x55e221,_0x4e8edc){return _0x55e221(_0x4e8edc);},'pfQXh':function(_0x3b9cc9,_0x1029da,_0x575d2b){return _0x3b9cc9(_0x1029da,_0x575d2b);},'xJOFh':'图片信息'},{md5:_0x2c7fc8,fileName:_0x2a00da,path:_0x1b987d,fileSize:_0x17d308}=await NTQQFileApi[_0x2261a4(0xd9)](_0x707244,ElementType[_0x2261a4(0xe5)],_0x3ac61f);if(_0x30903f['LKyQY'](_0x17d308,0x0))throw _0x30903f['CQHeo'];const _0x2c38ca=await NTQQFileApi[_0x2261a4(0xfc)](_0x707244),_0x1af250={'md5HexStr':_0x2c7fc8,'fileSize':_0x17d308[_0x2261a4(0xfd)](),'picWidth':_0x2c38ca?.[_0x2261a4(0xd1)],'picHeight':_0x2c38ca?.[_0x2261a4(0x10c)],'fileName':_0x2a00da,'sourcePath':_0x1b987d,'original':!![],'picType':_0x30903f['rBooq'](isGIF,_0x707244)?PicType['gif']:PicType['jpg'],'picSubType':_0x3ac61f,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x422116};return _0x30903f['pfQXh'](logDebug,_0x30903f[_0x2261a4(0xf3)],_0x1af250),{'elementType':ElementType[_0x2261a4(0xe5)],'elementId':'','picElement':_0x1af250};}static async[_0x4106ca(0xcd)](_0x2b899f,_0x17a20f=''){const _0x4b8af4=_0x4106ca,_0x5ceba2={'OwpNq':function(_0x5a3deb,_0x1460cf){return _0x5a3deb===_0x1460cf;},'hpPph':_0x4b8af4(0x101),'xCRhC':function(_0x432288,_0x31f92d){return _0x432288||_0x31f92d;}},{md5:_0x1f63ee,fileName:_0x4a39f8,path:_0x203d2f,fileSize:_0x136a13}=await NTQQFileApi['uploadFile'](_0x2b899f,ElementType[_0x4b8af4(0xe1)]);if(_0x5ceba2[_0x4b8af4(0x104)](_0x136a13,0x0))throw _0x5ceba2[_0x4b8af4(0xba)];const _0x52f04e={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x5ceba2['xCRhC'](_0x17a20f,_0x4a39f8),'filePath':_0x203d2f,'fileSize':_0x136a13[_0x4b8af4(0xfd)]()}};return _0x52f04e;}static async[_0x4106ca(0xef)](_0x2e678b,_0x346b5b='',_0xf238b9=''){const _0x21b8fd=_0x4106ca,_0x32cfc3={'OKooD':function(_0x4c9826,_0x4c3d7b){return _0x4c9826(_0x4c3d7b);},'zehJa':function(_0x1b22c9,_0x17fade){return _0x1b22c9(_0x17fade);},'eBNMR':function(_0x5e4d0c,_0x463c4c){return _0x5e4d0c(_0x463c4c);},'SKGxl':_0x21b8fd(0xb9),'sYrPZ':'error','OSrfk':'文件异常，大小为0','wTUrI':_0x21b8fd(0xc6),'dCAzT':_0x21b8fd(0xf9),'nSNGi':function(_0x210b13,_0x3eef8c,_0x7bf88){return _0x210b13(_0x3eef8c,_0x7bf88);},'uqLUn':_0x21b8fd(0xbf),'kbuqm':_0x21b8fd(0xe0),'rNTDp':function(_0x465ad9,_0x2f0578){return _0x465ad9||_0x2f0578;}},{fileName:_0x1929cb,path:_0x217acc,fileSize:_0x93df83,md5:_0x435f0d}=await NTQQFileApi[_0x21b8fd(0xd9)](_0x2e678b,ElementType[_0x21b8fd(0x106)]);if(_0x93df83===0x0)throw _0x32cfc3['OSrfk'];const _0x2e98f1=_0x32cfc3[_0x21b8fd(0xe6)](require,_0x32cfc3[_0x21b8fd(0xd7)]);let _0x2b6dbc=_0x217acc[_0x21b8fd(0xda)](_0x2e98f1[_0x21b8fd(0xcf)]+_0x21b8fd(0xc9)+_0x2e98f1[_0x21b8fd(0xcf)],_0x2e98f1['sep']+_0x21b8fd(0xe2)+_0x2e98f1[_0x21b8fd(0xcf)]);_0x2b6dbc=_0x2e98f1[_0x21b8fd(0xed)](_0x2b6dbc);let _0x5a6ec4={'width':0x780,'height':0x438,'time':0xf,'format':_0x32cfc3[_0x21b8fd(0xc1)],'size':_0x93df83,'filePath':_0x2e678b};try{_0x5a6ec4=await _0x32cfc3[_0x21b8fd(0xd5)](getVideoInfo,_0x217acc),_0x32cfc3[_0x21b8fd(0xf1)](logDebug,_0x32cfc3[_0x21b8fd(0xd4)],_0x5a6ec4);}catch(_0x4c7b62){logError(_0x32cfc3[_0x21b8fd(0x109)],_0x4c7b62);}const _0x551e41=new Promise((_0x328e5e,_0x3567aa)=>{const _0xe20052=_0x21b8fd,_0x2646a8={'tGTTz':function(_0x4e61b9,_0x19a9a2){return _0x32cfc3['OKooD'](_0x4e61b9,_0x19a9a2);}},_0x4b7cb8=_0x435f0d+_0xe20052(0xf8),_0x3fe22c=_0x2e98f1[_0xe20052(0xf2)](_0x2b6dbc,_0x4b7cb8);_0x32cfc3['eBNMR'](_0x93bcfb,_0x2e678b)['on'](_0x32cfc3['SKGxl'],()=>{})['on'](_0x32cfc3[_0xe20052(0x10a)],_0xc328e8=>{const _0x422826=_0xe20052,_0x30fcc7={'pftPV':function(_0x5bd732,_0x5fb1fa){const _0x113279=_0x23a8;return _0x32cfc3[_0x113279(0xd5)](_0x5bd732,_0x5fb1fa);}};logDebug(_0x422826(0xf4),_0xc328e8),_0xf238b9?_0x38af6c[_0x422826(0xcb)](_0xf238b9,_0x3fe22c)[_0x422826(0xd0)](()=>{const _0xf8a0fa=_0x422826;_0x30fcc7[_0xf8a0fa(0xee)](_0x328e5e,_0x3fe22c);})[_0x422826(0x100)](_0x3567aa):_0x38af6c[_0x422826(0xc0)](_0x3fe22c,defaultVideoThumb)[_0x422826(0xd0)](()=>{_0x2646a8['tGTTz'](_0x328e5e,_0x3fe22c);})[_0x422826(0x100)](_0x3567aa);})[_0xe20052(0xe7)]({'timestamps':[0x0],'filename':_0x4b7cb8,'folder':_0x2b6dbc,'size':_0x5a6ec4[_0xe20052(0xd1)]+'x'+_0x5a6ec4[_0xe20052(0x10c)]})['on'](_0x32cfc3['SKGxl'],()=>{_0x32cfc3['zehJa'](_0x328e5e,_0x3fe22c);});}),_0x1dd461=new Map(),_0x37dfb1=await _0x551e41,_0x1fbfb3=(await _0x38af6c['stat'](_0x37dfb1))[_0x21b8fd(0xd2)];_0x1dd461[_0x21b8fd(0xc3)](0x0,_0x37dfb1);const _0xef61=await calculateFileMD5(_0x37dfb1),_0x2d46e2={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x32cfc3[_0x21b8fd(0xe3)](_0x346b5b,_0x1929cb),'filePath':_0x217acc,'videoMd5':_0x435f0d,'thumbMd5':_0xef61,'fileTime':_0x5a6ec4[_0x21b8fd(0xe8)],'thumbPath':_0x1dd461,'thumbSize':_0x1fbfb3,'thumbWidth':_0x5a6ec4[_0x21b8fd(0xd1)],'thumbHeight':_0x5a6ec4[_0x21b8fd(0x10c)],'fileSize':''+_0x93df83}};return _0x2d46e2;}static async[_0x4106ca(0xff)](_0x3c3e4d){const _0x62f568=_0x4106ca,_0x3afda3={'BOtbK':_0x62f568(0x102)},{converted:_0x45f226,path:_0x3f7392,duration:_0x1a53b2}=await encodeSilk(_0x3c3e4d);if(!_0x3f7392)throw _0x3afda3['BOtbK'];const {md5:_0x328ddf,fileName:_0x4b179f,path:_0x4909e7,fileSize:_0x3e7c39}=await NTQQFileApi[_0x62f568(0xd9)](_0x3f7392,ElementType['PTT']);if(_0x3e7c39===0x0)throw _0x62f568(0x101);return _0x45f226&&_0x38af6c[_0x62f568(0xeb)](_0x3f7392)[_0x62f568(0xd0)](),{'elementType':ElementType[_0x62f568(0xd3)],'elementId':'','pttElement':{'fileName':_0x4b179f,'filePath':_0x4909e7,'md5HexStr':_0x328ddf,'fileSize':_0x3e7c39,'duration':_0x1a53b2||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4106ca(0xf7)](_0x3e7675){const _0x37c43b=_0x4106ca,_0x18cd7c={'xqOil':function(_0x5455c2,_0x127c06){return _0x5455c2<_0x127c06;}};return{'elementType':ElementType[_0x37c43b(0xec)],'elementId':'','faceElement':{'faceIndex':_0x3e7675,'faceType':_0x18cd7c[_0x37c43b(0xfa)](_0x3e7675,0xde)?FaceType[_0x37c43b(0xca)]:FaceType[_0x37c43b(0xc7)]}};}static[_0x4106ca(0xc2)](_0x28e2c4,_0x12071e,_0x5f4849,_0x1b737d){const _0x3d1a54=_0x4106ca,_0x167cbe={'HNskd':'[商城表情]'};return{'elementType':ElementType[_0x3d1a54(0xbb)],'marketFaceElement':{'emojiPackageId':_0x28e2c4,'emojiId':_0x12071e,'key':_0x5f4849,'faceName':_0x1b737d||mFaceCache[_0x3d1a54(0xc8)](_0x12071e)||_0x167cbe[_0x3d1a54(0xdc)]}};}static[_0x4106ca(0xfe)](_0x40abe0){const _0x55878c=_0x4106ca,_0x25be4c={'iDzaH':_0x55878c(0xbd)};return{'elementType':ElementType[_0x55878c(0xec)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x55878c(0xfe)],'faceType':FaceType[_0x55878c(0xfe)],'faceText':_0x25be4c['iDzaH'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x29efa9){const _0x162426=_0x4106ca,_0x1011ab={'DDYJz':'[包剪锤]'};return{'elementType':ElementType[_0x162426(0xec)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x162426(0xd8)],'faceText':_0x1011ab[_0x162426(0xde)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4106ca(0xf5)](_0xb76389){const _0x3843b1=_0x4106ca,_0x2a3662={'JlnMC':function(_0x34c7fd,_0x3b4628){return _0x34c7fd!==_0x3b4628;},'SSije':_0x3843b1(0xbc)};return _0x2a3662[_0x3843b1(0xc5)](typeof _0xb76389,_0x2a3662[_0x3843b1(0xdf)])&&(_0xb76389=JSON[_0x3843b1(0x108)](_0xb76389)),{'elementType':ElementType[_0x3843b1(0x107)],'elementId':'','arkElement':{'bytesData':_0xb76389,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x3062be){const _0x13214e=_0x4106ca;return{'elementType':ElementType[_0x13214e(0xe4)],'elementId':'','markdownElement':{'content':_0x3062be}};}}