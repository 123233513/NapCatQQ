const _0x3e2e7f=_0x3170;(function(_0x5bf13c,_0x2d5534){const _0x4b489c=_0x3170,_0x32152b=_0x5bf13c();while(!![]){try{const _0x407e0a=-parseInt(_0x4b489c(0xc2))/0x1+-parseInt(_0x4b489c(0xde))/0x2+-parseInt(_0x4b489c(0xd7))/0x3*(parseInt(_0x4b489c(0xd1))/0x4)+parseInt(_0x4b489c(0xc6))/0x5*(-parseInt(_0x4b489c(0xd5))/0x6)+parseInt(_0x4b489c(0xeb))/0x7+-parseInt(_0x4b489c(0xb8))/0x8*(parseInt(_0x4b489c(0xad))/0x9)+parseInt(_0x4b489c(0xd8))/0xa*(parseInt(_0x4b489c(0xf3))/0xb);if(_0x407e0a===_0x2d5534)break;else _0x32152b['push'](_0x32152b['shift']());}catch(_0x1ecfc2){_0x32152b['push'](_0x32152b['shift']());}}}(_0x1e8b,0x3f54d));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x437127}from'node:fs';function _0x3170(_0x388d19,_0x2e8a92){const _0x1e8b9e=_0x1e8b();return _0x3170=function(_0x317035,_0xdab5b2){_0x317035=_0x317035-0x9b;let _0x74b564=_0x1e8b9e[_0x317035];return _0x74b564;},_0x3170(_0x388d19,_0x2e8a92);}import _0x6b24c7 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x40f180 from'./face_config.json';function _0x1e8b(){const _0x5b7337=['Ttheg','PTT','eCFUf','PIC','388572tvYmhE','replace','AniStickerType','mface','200435mAhsxg','get','REPLY','qjFOi','end','TEXT','sysface','ARK','pic','_0.png','time','8hShsns','hxQFc','then','ptt','24jjVXUW','file','482082nFVlKE','1987430mcMOcI','toString','fSsXi','eEQaC','PhFgq','kaTkc','775104BnbRrI','hMXrl','PDXsP','文件异常，大小为0','mCflg','dice','markdown','jpg','https://www.bilibili.com/','stringify','[包剪锤]','InFVm','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','2513833tQyKOJ','mp4','zBmzd','Thumb','PXtId','ShtLc','FACE','screenshots','88lqvUJj','zfpro','LhOkA','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','[商城表情]','QDes','Tloag','find','qyHLX','sep','reply','获取视频封面失败，使用默认封面','catch','height','text','ark','HDziS','QSid','writeFile','FILE','[骰子]','1943091VcnzjL','error','CPUTf','width','CDoID','set','语音转换失败,\x20请检查语音文件是否正常','MFACE','uploadFile','VIDEO','getImageSize','16TEAQop','dBrxw','XhrmW','FRayh','svOOQ','size'];_0x1e8b=function(){return _0x5b7337;};return _0x1e8b();}import*as _0x471201 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x3e2e7f(0xa6)](_0x291580){const _0x372221=_0x3e2e7f;return{'elementType':ElementType[_0x372221(0xcb)],'elementId':'','textElement':{'content':_0x291580,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x1d77c4,_0x4cb618,_0x1254dc,_0x44405c){const _0x46c83e=_0x3e2e7f;return{'elementType':ElementType[_0x46c83e(0xcb)],'elementId':'','textElement':{'content':'@'+_0x44405c,'atType':_0x1254dc,'atUid':_0x1d77c4,'atTinyId':'','atNtUid':_0x4cb618}};}static[_0x3e2e7f(0xa2)](_0x370559,_0x3e8e7c,_0x3ebd49,_0x1c9d04){const _0x4cf800=_0x3e2e7f;return{'elementType':ElementType[_0x4cf800(0xc8)],'elementId':'','replyElement':{'replayMsgSeq':_0x370559,'replayMsgId':_0x3e8e7c,'senderUin':_0x3ebd49,'senderUinStr':_0x1c9d04}};}static async[_0x3e2e7f(0xce)](_0x3ee2ec,_0x1d53f8='',_0x2d2a4e=0x0){const _0x1e91ec=_0x3e2e7f,_0x212f89={'fSsXi':function(_0xefb81d,_0x3b1e80){return _0xefb81d===_0x3b1e80;},'CPUTf':'文件异常，大小为0','Nhmtd':function(_0x11fb96,_0x979ab9){return _0x11fb96(_0x979ab9);}},{md5:_0x2289c4,fileName:_0x4223f7,path:_0x5566cc,fileSize:_0xcd62e7}=await NTQQFileApi[_0x1e91ec(0xb5)](_0x3ee2ec,ElementType[_0x1e91ec(0xc1)],_0x2d2a4e);if(_0x212f89[_0x1e91ec(0xda)](_0xcd62e7,0x0))throw _0x212f89[_0x1e91ec(0xaf)];const _0x341171=await NTQQFileApi[_0x1e91ec(0xb7)](_0x3ee2ec),_0x123565={'md5HexStr':_0x2289c4,'fileSize':_0xcd62e7[_0x1e91ec(0xd9)](),'picWidth':_0x341171?.[_0x1e91ec(0xb0)],'picHeight':_0x341171?.[_0x1e91ec(0xa5)],'fileName':_0x4223f7,'sourcePath':_0x5566cc,'original':!![],'picType':_0x212f89['Nhmtd'](isGIF,_0x3ee2ec)?PicType['gif']:PicType[_0x1e91ec(0xe5)],'picSubType':_0x2d2a4e,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x1d53f8};return{'elementType':ElementType[_0x1e91ec(0xc1)],'elementId':'','picElement':_0x123565};}static async[_0x3e2e7f(0xd6)](_0x49b6a6,_0x41374c='',_0x37e313=''){const _0xcafd22=_0x3e2e7f,_0x5f5263={'LhOkA':_0xcafd22(0xe1),'dBrxw':function(_0x53ce94,_0x4d054f){return _0x53ce94||_0x4d054f;}},{md5:_0x26342b,fileName:_0x165e67,path:_0x95655f,fileSize:_0x510aa4}=await NTQQFileApi[_0xcafd22(0xb5)](_0x49b6a6,ElementType[_0xcafd22(0xab)]);if(_0x510aa4===0x0)throw _0x5f5263[_0xcafd22(0xf5)];const _0x3c40c0={'elementType':ElementType[_0xcafd22(0xab)],'elementId':'','fileElement':{'fileName':_0x5f5263[_0xcafd22(0xb9)](_0x41374c,_0x165e67),'folderId':_0x37e313,'filePath':_0x95655f,'fileSize':_0x510aa4['toString']()}};return _0x3c40c0;}static async['video'](_0x403851,_0x1edb44='',_0x5a42e8=''){const _0x4b0e8d=_0x3e2e7f,_0x5e674b={'zfpro':function(_0x592fa3,_0x44c71b,_0x24c1d3){return _0x592fa3(_0x44c71b,_0x24c1d3);},'kaTkc':_0x4b0e8d(0xa3),'eEQaC':function(_0x3e482f,_0x41a4bf){return _0x3e482f(_0x41a4bf);},'KeZOo':_0x4b0e8d(0xae),'hMXrl':function(_0x3753f7,_0x28fd3d){return _0x3753f7+_0x28fd3d;},'ShtLc':_0x4b0e8d(0xca),'zBmzd':function(_0x583638,_0x5bc511){return _0x583638===_0x5bc511;},'FRayh':_0x4b0e8d(0xe1),'PDXsP':_0x4b0e8d(0xec),'Tloag':'获取视频信息失败','bZgWH':function(_0x1c6049,_0x5a2415){return _0x1c6049(_0x5a2415);},'CDoID':function(_0x365fae,_0x4aafdf){return _0x365fae||_0x4aafdf;},'uDUzx':function(_0x5175eb,_0x322aa8){return _0x5175eb+_0x322aa8;}},{fileName:_0x1e295f,path:_0x551b1e,fileSize:_0xc84740,md5:_0x2f7434}=await NTQQFileApi[_0x4b0e8d(0xb5)](_0x403851,ElementType[_0x4b0e8d(0xb6)]);if(_0x5e674b[_0x4b0e8d(0xed)](_0xc84740,0x0))throw _0x5e674b[_0x4b0e8d(0xbb)];let _0x44bd99=_0x551b1e[_0x4b0e8d(0xc3)](_0x471201[_0x4b0e8d(0xa1)]+'Ori'+_0x471201['sep'],_0x471201['sep']+_0x4b0e8d(0xee)+_0x471201[_0x4b0e8d(0xa1)]);_0x44bd99=_0x471201['dirname'](_0x44bd99);let _0x2c4ca6={'width':0x780,'height':0x438,'time':0xf,'format':_0x5e674b[_0x4b0e8d(0xe0)],'size':_0xc84740,'filePath':_0x403851};try{_0x2c4ca6=await getVideoInfo(_0x551b1e);}catch(_0xe6a438){_0x5e674b[_0x4b0e8d(0xf4)](logError,_0x5e674b[_0x4b0e8d(0x9e)],_0xe6a438);}const _0x33ba52=new Promise((_0x4844ee,_0x39924f)=>{const _0x3c21a1=_0x4b0e8d,_0x2e40cf={'XhrmW':function(_0x37fdb4,_0x245e1d){return _0x5e674b['eEQaC'](_0x37fdb4,_0x245e1d);},'uBxCh':function(_0x559d01,_0x9acfe0){return _0x559d01(_0x9acfe0);}},_0x3c9215=_0x2f7434+_0x3c21a1(0xcf),_0x190c2e=_0x471201['join'](_0x44bd99,_0x3c9215);_0x5e674b[_0x3c21a1(0xdb)](_0x6b24c7,_0x403851)['on']('end',()=>{})['on'](_0x5e674b['KeZOo'],_0x3ceec1=>{const _0x19c624=_0x3c21a1;_0x5e674b['zfpro'](logDebug,_0x5e674b[_0x19c624(0xdd)],_0x3ceec1),_0x5a42e8?_0x437127['copyFile'](_0x5a42e8,_0x190c2e)[_0x19c624(0xd3)](()=>{const _0x484520=_0x19c624;_0x2e40cf[_0x484520(0xba)](_0x4844ee,_0x190c2e);})[_0x19c624(0xa4)](_0x39924f):_0x437127[_0x19c624(0xaa)](_0x190c2e,defaultVideoThumb)[_0x19c624(0xd3)](()=>{_0x2e40cf['uBxCh'](_0x4844ee,_0x190c2e);})[_0x19c624(0xa4)](_0x39924f);})[_0x3c21a1(0xf2)]({'timestamps':[0x0],'filename':_0x3c9215,'folder':_0x44bd99,'size':_0x5e674b[_0x3c21a1(0xdf)](_0x2c4ca6[_0x3c21a1(0xb0)]+'x',_0x2c4ca6[_0x3c21a1(0xa5)])})['on'](_0x5e674b[_0x3c21a1(0xf0)],()=>{_0x2e40cf['XhrmW'](_0x4844ee,_0x190c2e);});}),_0x5b7b3e=new Map(),_0x4ddb9c=await _0x33ba52,_0x388c18=(await _0x437127['stat'](_0x4ddb9c))[_0x4b0e8d(0xbd)];_0x5b7b3e[_0x4b0e8d(0xb2)](0x0,_0x4ddb9c);const _0xebf6e3=await _0x5e674b['bZgWH'](calculateFileMD5,_0x4ddb9c),_0x532924={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x5e674b[_0x4b0e8d(0xb1)](_0x1edb44,_0x1e295f),'filePath':_0x551b1e,'videoMd5':_0x2f7434,'thumbMd5':_0xebf6e3,'fileTime':_0x2c4ca6[_0x4b0e8d(0xd0)],'thumbPath':_0x5b7b3e,'thumbSize':_0x388c18,'thumbWidth':_0x2c4ca6[_0x4b0e8d(0xb0)],'thumbHeight':_0x2c4ca6[_0x4b0e8d(0xa5)],'fileSize':_0x5e674b['uDUzx']('',_0xc84740)}};return _0x532924;}static async[_0x3e2e7f(0xd4)](_0x53af54){const _0x122ffc=_0x3e2e7f,_0x10cab7={'qyHLX':_0x122ffc(0xb3),'InFVm':function(_0x149698,_0x430234){return _0x149698===_0x430234;},'hxQFc':_0x122ffc(0xe1),'svOOQ':function(_0x544dac,_0x440886){return _0x544dac||_0x440886;}},{converted:_0x2cc214,path:_0x318d09,duration:_0x3e0aec}=await encodeSilk(_0x53af54);if(!_0x318d09)throw _0x10cab7[_0x122ffc(0xa0)];const {md5:_0x44d682,fileName:_0x45a660,path:_0x37bd10,fileSize:_0x457927}=await NTQQFileApi[_0x122ffc(0xb5)](_0x318d09,ElementType[_0x122ffc(0xbf)]);if(_0x10cab7[_0x122ffc(0xe9)](_0x457927,0x0))throw _0x10cab7[_0x122ffc(0xd2)];return _0x2cc214&&_0x437127['unlink'](_0x318d09)[_0x122ffc(0xd3)](),{'elementType':ElementType[_0x122ffc(0xbf)],'elementId':'','pttElement':{'fileName':_0x45a660,'filePath':_0x37bd10,'md5HexStr':_0x44d682,'fileSize':_0x457927,'duration':_0x10cab7[_0x122ffc(0xbc)](_0x3e0aec,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x4e2feb){const _0x22e166=_0x3e2e7f,_0x452302={'HDziS':function(_0x1ce93e,_0x29dc9c){return _0x1ce93e>=_0x29dc9c;}},_0x5db382=_0x40f180[_0x22e166(0xcc)],_0xd0f5c7=_0x40f180['emoji'],_0x4782ff=_0x5db382[_0x22e166(0x9f)](_0x4b67af=>_0x4b67af[_0x22e166(0xa9)]===_0x4e2feb[_0x22e166(0xd9)]());_0x4e2feb=parseInt(_0x4e2feb['toString']());let _0x24ee98=0x1;return _0x452302[_0x22e166(0xa8)](_0x4e2feb,0xde)&&(_0x24ee98=0x2),_0x4782ff['AniStickerType']&&(_0x24ee98=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x4e2feb,'faceType':_0x24ee98,'faceText':_0x4782ff[_0x22e166(0x9d)],'stickerId':_0x4782ff['AniStickerId'],'stickerType':_0x4782ff[_0x22e166(0xc4)],'packId':_0x4782ff['AniStickerPackId'],'sourceType':0x1}};}static[_0x3e2e7f(0xc5)](_0x44decd,_0x53d885,_0x443e18,_0x5cd546){const _0xd1f51e=_0x3e2e7f,_0x2af485={'qjFOi':_0xd1f51e(0x9c)};return{'elementType':ElementType[_0xd1f51e(0xb4)],'marketFaceElement':{'emojiPackageId':_0x44decd,'emojiId':_0x53d885,'key':_0x443e18,'faceName':_0x5cd546||mFaceCache[_0xd1f51e(0xc7)](_0x53d885)||_0x2af485[_0xd1f51e(0xc9)]}};}static['dice'](_0x2923d7){const _0x9b57bd=_0x3e2e7f;return{'elementType':ElementType[_0x9b57bd(0xf1)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x9b57bd(0xe3)],'faceType':FaceType[_0x9b57bd(0xe3)],'faceText':_0x9b57bd(0xac),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x571226){const _0x3872b7=_0x3e2e7f;return{'elementType':ElementType[_0x3872b7(0xf1)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x3872b7(0xe8),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3e2e7f(0xa7)](_0x3f1619){const _0x3f662a=_0x3e2e7f,_0x5a22c7={'PhFgq':function(_0x38caa6,_0x23e448){return _0x38caa6!==_0x23e448;},'mCflg':'string'};return _0x5a22c7[_0x3f662a(0xdc)](typeof _0x3f1619,_0x5a22c7[_0x3f662a(0xe2)])&&(_0x3f1619=JSON[_0x3f662a(0xe7)](_0x3f1619)),{'elementType':ElementType[_0x3f662a(0xcd)],'elementId':'','arkElement':{'bytesData':_0x3f1619,'linkInfo':null,'subElementType':null}};}static[_0x3e2e7f(0xe4)](_0x11b7ed){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x11b7ed}};}static async['miniapp'](){const _0x39db12=_0x3e2e7f,_0x1b39b6={'eCFUf':function(_0x246767,_0x3d42ab){return _0x246767(_0x3d42ab);},'PXtId':'Bot\x20Test','Ttheg':_0x39db12(0xea)};let _0x3f7434=await _0x1b39b6[_0x39db12(0xc0)](SignMiniApp,{'prompt':_0x1b39b6[_0x39db12(0xef)],'title':'Bot\x20Test','preview':_0x39db12(0x9b),'jumpUrl':_0x39db12(0xe6),'tag':_0x1b39b6['PXtId'],'tagIcon':_0x1b39b6['Ttheg'],'source':_0x1b39b6['PXtId'],'sourcelogo':_0x1b39b6[_0x39db12(0xbe)]});return{'elementType':ElementType[_0x39db12(0xcd)],'elementId':'','arkElement':{'bytesData':_0x3f7434,'linkInfo':null,'subElementType':null}};}}