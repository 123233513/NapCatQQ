const _0x5294ca=_0x18e6;(function(_0x2d8590,_0x446afd){const _0x18e06e=_0x18e6,_0x7505c8=_0x2d8590();while(!![]){try{const _0x141aa6=parseInt(_0x18e06e(0x134))/0x1*(parseInt(_0x18e06e(0x10b))/0x2)+parseInt(_0x18e06e(0x118))/0x3*(-parseInt(_0x18e06e(0x11a))/0x4)+-parseInt(_0x18e06e(0x109))/0x5+-parseInt(_0x18e06e(0x112))/0x6*(-parseInt(_0x18e06e(0x132))/0x7)+-parseInt(_0x18e06e(0xfb))/0x8+-parseInt(_0x18e06e(0xfe))/0x9+parseInt(_0x18e06e(0x127))/0xa;if(_0x141aa6===_0x446afd)break;else _0x7505c8['push'](_0x7505c8['shift']());}catch(_0x56f768){_0x7505c8['push'](_0x7505c8['shift']());}}}(_0x351b,0xca069));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';function _0x351b(){const _0x6b943c=['4151295nYCLSj','Hjwbk','18brkMAu','time','AfzYK','Ori','PIC','BHYQr','CGgjz','234hCbrBO','replace','VIDEO','markdown','PTT','width','3210558VtmdXk','FACE','4IVdNsQ','LOHZz','end','Thumb','uploadFile','语音转换失败,\x20请检查语音文件是否正常','获取视频信息失败','dXWYb','getImageSize','video','normal','join','normal2','27748070uwOyZh','then','copyFile','face','coJQO','cLYMb','FILE','catch','EEHHs','视频信息','vzOqM','105959ZxWfip','aoQJA','29881JkJouT','jlleq','vfzxE','height','TEXT','notAt','MARKDOWN','rcfhh','stringify','文件异常，大小为0','mp4','text','ark','JrFvM','path','error','TcEmn','snNjF','string','ptt','jpg','_0.png','获取视频封面失败，使用默认封面','iOhgo','writeFile','screenshots','[骰子]','4903016inUSnK','dice','set','2639340fJkPVu','XLNFE','ejXwy','图片信息','file','sep','toString','RPS','gif','dirname','mucvy'];_0x351b=function(){return _0x6b943c;};return _0x351b();}import{promises as _0x1ac955}from'node:fs';import _0xebb3d2 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x18e6(_0x32258a,_0x5c46c7){const _0x351bb4=_0x351b();return _0x18e6=function(_0x18e693,_0x540fe9){_0x18e693=_0x18e693-0xed;let _0x4105af=_0x351bb4[_0x18e693];return _0x4105af;},_0x18e6(_0x32258a,_0x5c46c7);}export class SendMsgElementConstructor{static[_0x5294ca(0x13f)](_0x20ecd2){const _0x360791=_0x5294ca;return{'elementType':ElementType[_0x360791(0x138)],'elementId':'','textElement':{'content':_0x20ecd2,'atType':AtType[_0x360791(0x139)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x52642d,_0x3f00a2,_0x4f0b79,_0x50d213){const _0x1e0cf0=_0x5294ca;return{'elementType':ElementType[_0x1e0cf0(0x138)],'elementId':'','textElement':{'content':'@'+_0x50d213,'atType':_0x4f0b79,'atUid':_0x52642d,'atTinyId':'','atNtUid':_0x3f00a2}};}static['reply'](_0x5e2854,_0x54d363,_0x55cbab,_0xc60292){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x5e2854,'replayMsgId':_0x54d363,'senderUin':_0x55cbab,'senderUinStr':_0xc60292}};}static async['pic'](_0x339774,_0x3636ef='',_0xd3e49c=0x0){const _0x4fd27c=_0x5294ca,_0x3f7189={'mucvy':function(_0x27a557,_0x2740a6){return _0x27a557===_0x2740a6;},'rcfhh':_0x4fd27c(0x13d),'jlJIe':function(_0x58eb69,_0x580c4c){return _0x58eb69(_0x580c4c);},'XLNFE':function(_0xbea493,_0x14fc17,_0x1abea2){return _0xbea493(_0x14fc17,_0x1abea2);}},{md5:_0x312b99,fileName:_0xa87643,path:_0x4586a9,fileSize:_0x107b2d}=await NTQQFileApi['uploadFile'](_0x339774,ElementType[_0x4fd27c(0x10f)],_0xd3e49c);if(_0x3f7189[_0x4fd27c(0x108)](_0x107b2d,0x0))throw _0x3f7189[_0x4fd27c(0x13b)];const _0x3d7c8b=await NTQQFileApi[_0x4fd27c(0x122)](_0x339774),_0x25325d={'md5HexStr':_0x312b99,'fileSize':_0x107b2d[_0x4fd27c(0x104)](),'picWidth':_0x3d7c8b?.[_0x4fd27c(0x117)],'picHeight':_0x3d7c8b?.[_0x4fd27c(0x137)],'fileName':_0xa87643,'sourcePath':_0x4586a9,'original':!![],'picType':_0x3f7189['jlJIe'](isGIF,_0x339774)?PicType[_0x4fd27c(0x106)]:PicType[_0x4fd27c(0xf4)],'picSubType':_0xd3e49c,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3636ef};return _0x3f7189[_0x4fd27c(0xff)](logDebug,_0x4fd27c(0x101),_0x25325d),{'elementType':ElementType[_0x4fd27c(0x10f)],'elementId':'','picElement':_0x25325d};}static async[_0x5294ca(0x102)](_0x5bbb6a,_0x23dc64=''){const _0x49fd8b=_0x5294ca,_0x2dc23c={'KaaDl':function(_0x57d3a4,_0x2cd101){return _0x57d3a4||_0x2cd101;}},{md5:_0x88a9b8,fileName:_0x6e8e7a,path:_0x9ae96a,fileSize:_0x40ddbd}=await NTQQFileApi[_0x49fd8b(0x11e)](_0x5bbb6a,ElementType[_0x49fd8b(0x12d)]);if(_0x40ddbd===0x0)throw _0x49fd8b(0x13d);const _0x1004e7={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x2dc23c['KaaDl'](_0x23dc64,_0x6e8e7a),'filePath':_0x9ae96a,'fileSize':_0x40ddbd[_0x49fd8b(0x104)]()}};return _0x1004e7;}static async[_0x5294ca(0x123)](_0x5693e7,_0x29c2f8='',_0x5ae564=''){const _0x254cf4=_0x5294ca,_0x411d51={'LOHZz':function(_0x5f2f68,_0x3b60d8){return _0x5f2f68(_0x3b60d8);},'CGgjz':_0x254cf4(0xf6),'EEHHs':function(_0x38c522,_0x2ba941){return _0x38c522(_0x2ba941);},'dXWYb':_0x254cf4(0x11c),'jlleq':_0x254cf4(0xef),'BHYQr':function(_0x4bea7e,_0x7a6ce4){return _0x4bea7e+_0x7a6ce4;},'Hjwbk':function(_0xaf7ac0,_0x1c0413){return _0xaf7ac0===_0x1c0413;},'TcEmn':_0x254cf4(0x13d),'vfzxE':_0x254cf4(0xee),'ejXwy':_0x254cf4(0x13e),'iOhgo':function(_0x4e8aa6,_0x3730ae,_0x39cbc4){return _0x4e8aa6(_0x3730ae,_0x39cbc4);},'cLYMb':_0x254cf4(0x120)},{fileName:_0x23e46d,path:_0x46c7ae,fileSize:_0x3c905e,md5:_0x591f28}=await NTQQFileApi[_0x254cf4(0x11e)](_0x5693e7,ElementType[_0x254cf4(0x114)]);if(_0x411d51[_0x254cf4(0x10a)](_0x3c905e,0x0))throw _0x411d51[_0x254cf4(0xf0)];const _0x270fc6=_0x411d51[_0x254cf4(0x11b)](require,_0x411d51[_0x254cf4(0x136)]);let _0x1d83f5=_0x46c7ae[_0x254cf4(0x113)](_0x270fc6[_0x254cf4(0x103)]+_0x254cf4(0x10e)+_0x270fc6[_0x254cf4(0x103)],_0x270fc6[_0x254cf4(0x103)]+_0x254cf4(0x11d)+_0x270fc6['sep']);_0x1d83f5=_0x270fc6[_0x254cf4(0x107)](_0x1d83f5);let _0x55aaea={'width':0x780,'height':0x438,'time':0xf,'format':_0x411d51[_0x254cf4(0x100)],'size':_0x3c905e,'filePath':_0x5693e7};try{_0x55aaea=await _0x411d51[_0x254cf4(0x12f)](getVideoInfo,_0x46c7ae),_0x411d51[_0x254cf4(0xf7)](logDebug,_0x254cf4(0x130),_0x55aaea);}catch(_0x4b6f2f){_0x411d51[_0x254cf4(0xf7)](logError,_0x411d51[_0x254cf4(0x12c)],_0x4b6f2f);}const _0x4cd681=new Promise((_0x3701e1,_0x5f2fce)=>{const _0x2e7932=_0x254cf4,_0x355e91={'JrFvM':function(_0x2b180d,_0x2c042d){const _0x58cdf5=_0x18e6;return _0x411d51[_0x58cdf5(0x11b)](_0x2b180d,_0x2c042d);}},_0x59736a=_0x591f28+_0x2e7932(0xf5),_0x1f967d=_0x270fc6[_0x2e7932(0x125)](_0x1d83f5,_0x59736a);_0x411d51[_0x2e7932(0x12f)](_0xebb3d2,_0x5693e7)['on'](_0x411d51[_0x2e7932(0x121)],()=>{})['on'](_0x411d51[_0x2e7932(0x135)],_0x59ead4=>{const _0x40ad1c=_0x2e7932,_0x29d7d0={'vzOqM':function(_0x229bf5,_0xaa812c){const _0x307544=_0x18e6;return _0x411d51[_0x307544(0x11b)](_0x229bf5,_0xaa812c);}};logDebug(_0x411d51[_0x40ad1c(0x111)],_0x59ead4),_0x5ae564?_0x1ac955[_0x40ad1c(0x129)](_0x5ae564,_0x1f967d)['then'](()=>{const _0x1211a1=_0x40ad1c;_0x29d7d0[_0x1211a1(0x131)](_0x3701e1,_0x1f967d);})[_0x40ad1c(0x12e)](_0x5f2fce):_0x1ac955[_0x40ad1c(0xf8)](_0x1f967d,defaultVideoThumb)['then'](()=>{const _0x391c48=_0x40ad1c;_0x29d7d0[_0x391c48(0x131)](_0x3701e1,_0x1f967d);})[_0x40ad1c(0x12e)](_0x5f2fce);})[_0x2e7932(0xf9)]({'timestamps':[0x0],'filename':_0x59736a,'folder':_0x1d83f5,'size':_0x411d51[_0x2e7932(0x110)](_0x55aaea['width']+'x',_0x55aaea[_0x2e7932(0x137)])})['on'](_0x411d51[_0x2e7932(0x121)],()=>{const _0x51dd87=_0x2e7932;_0x355e91[_0x51dd87(0xed)](_0x3701e1,_0x1f967d);});}),_0x10848d=new Map(),_0x1ee739=await _0x4cd681,_0xf7560a=(await _0x1ac955['stat'](_0x1ee739))['size'];_0x10848d[_0x254cf4(0xfd)](0x0,_0x1ee739);const _0x5a88cc=await calculateFileMD5(_0x1ee739),_0x4cb28e={'elementType':ElementType[_0x254cf4(0x114)],'elementId':'','videoElement':{'fileName':_0x29c2f8||_0x23e46d,'filePath':_0x46c7ae,'videoMd5':_0x591f28,'thumbMd5':_0x5a88cc,'fileTime':_0x55aaea[_0x254cf4(0x10c)],'thumbPath':_0x10848d,'thumbSize':_0xf7560a,'thumbWidth':_0x55aaea['width'],'thumbHeight':_0x55aaea['height'],'fileSize':''+_0x3c905e}};return _0x4cb28e;}static async[_0x5294ca(0xf3)](_0x4ce23c){const _0x6f09f1=_0x5294ca,_0x5c6b67={'AfzYK':function(_0x2dc061,_0x2a666f){return _0x2dc061(_0x2a666f);},'HxICh':_0x6f09f1(0x11f),'coJQO':function(_0x629cd1,_0x419a4e){return _0x629cd1===_0x419a4e;},'aiYXW':_0x6f09f1(0x13d)},{converted:_0x5bcf30,path:_0x53fc3b,duration:_0x118c67}=await _0x5c6b67[_0x6f09f1(0x10d)](encodeSilk,_0x4ce23c);if(!_0x53fc3b)throw _0x5c6b67['HxICh'];const {md5:_0x33bab4,fileName:_0x323d51,path:_0x1d2af8,fileSize:_0x421e14}=await NTQQFileApi[_0x6f09f1(0x11e)](_0x53fc3b,ElementType[_0x6f09f1(0x116)]);if(_0x5c6b67[_0x6f09f1(0x12b)](_0x421e14,0x0))throw _0x5c6b67['aiYXW'];return _0x5bcf30&&_0x1ac955['unlink'](_0x53fc3b)[_0x6f09f1(0x128)](),{'elementType':ElementType[_0x6f09f1(0x116)],'elementId':'','pttElement':{'fileName':_0x323d51,'filePath':_0x1d2af8,'md5HexStr':_0x33bab4,'fileSize':_0x421e14,'duration':_0x118c67||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x5294ca(0x12a)](_0x1bf5f5){const _0x2921d1=_0x5294ca;return{'elementType':ElementType[_0x2921d1(0x119)],'elementId':'','faceElement':{'faceIndex':_0x1bf5f5,'faceType':_0x1bf5f5<0xde?FaceType[_0x2921d1(0x124)]:FaceType[_0x2921d1(0x126)]}};}static[_0x5294ca(0xfc)](_0x525fa0){const _0x1ab916=_0x5294ca,_0x286f4e={'aoQJA':_0x1ab916(0xfa)};return{'elementType':ElementType[_0x1ab916(0x119)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1ab916(0xfc)],'faceType':FaceType[_0x1ab916(0xfc)],'faceText':_0x286f4e[_0x1ab916(0x133)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x1264c2){const _0x1956bc=_0x5294ca,_0x5b3936={'snNjF':'[包剪锤]'};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1956bc(0x105)],'faceText':_0x5b3936[_0x1956bc(0xf1)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5294ca(0x140)](_0x2f0741){const _0xe0c16b=_0x5294ca,_0x536daa={'NskSF':function(_0x3e4aeb,_0x4bc036){return _0x3e4aeb!==_0x4bc036;},'zzfOx':_0xe0c16b(0xf2)};return _0x536daa['NskSF'](typeof _0x2f0741,_0x536daa['zzfOx'])&&(_0x2f0741=JSON[_0xe0c16b(0x13c)](_0x2f0741)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x2f0741,'linkInfo':null,'subElementType':null}};}static[_0x5294ca(0x115)](_0x1e9934){const _0xce017d=_0x5294ca;return{'elementType':ElementType[_0xce017d(0x13a)],'elementId':'','markdownElement':{'content':_0x1e9934}};}}