const _0x5d8d63=_0x4f61;(function(_0x14eebb,_0x5105a8){const _0x49c520=_0x4f61,_0xcc655=_0x14eebb();while(!![]){try{const _0xa56118=-parseInt(_0x49c520(0x87))/0x1*(parseInt(_0x49c520(0x8a))/0x2)+-parseInt(_0x49c520(0x96))/0x3*(parseInt(_0x49c520(0x8e))/0x4)+parseInt(_0x49c520(0xb5))/0x5*(parseInt(_0x49c520(0x82))/0x6)+parseInt(_0x49c520(0x8c))/0x7*(-parseInt(_0x49c520(0x73))/0x8)+parseInt(_0x49c520(0xae))/0x9*(parseInt(_0x49c520(0xc6))/0xa)+parseInt(_0x49c520(0x95))/0xb*(parseInt(_0x49c520(0x81))/0xc)+parseInt(_0x49c520(0x89))/0xd;if(_0xa56118===_0x5105a8)break;else _0xcc655['push'](_0xcc655['shift']());}catch(_0x2fa5d9){_0xcc655['push'](_0xcc655['shift']());}}}(_0xe651,0x55987));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x4467ce}from'node:fs';function _0xe651(){const _0x22b986=['notAt','uploadFile','DNWSU','ZOzEA','edLdz','https://www.bilibili.com/','oXdzv','end','48XUtQnz','46890dOVNXZ','join','KEPWI','HWIre','video','79QadlNF','QDes','14663675TVWkYB','17036BCdHqU','then','3968251cUTyXI','get','4BGjuwq','stringify','BqsQO','ptt','EqRNm','mEKnd','XVhsp','1573396DRJUfE','1343214xpgslI','copyFile','jpg','REPLY','fWcVF','_0.png','fOgTe','reply','getImageSize','eeWSE','GEkVy','screenshots','width','replace','MSkrN','ARK','AniStickerPackId','find','zPHdN','MFACE','WwVRC','获取视频封面失败，使用默认封面','LBgqG','toString','18bLrbrb','AMNpY','WoorC','OQbsl','mp4','height','time','185cTiutG','MARKDOWN','RPS','[包剪锤]','miniapp','VKjhf','PTT','FACE','PIC','unlink','zXODt','AniStickerId','TEXT','pic','catch','writeFile','dice','244390IbgaQF','获取视频信息失败','DnWsQ','[商城表情]','gif','stat','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','Kjboh','Thumb','VIDEO','[骰子]','ark','error','emoji','AniStickerType','sep','size','BoKNf','FILE','8CkffMB','pyGyE','fPgDZ','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','语音转换失败,\x20请检查语音文件是否正常','NMVXs'];_0xe651=function(){return _0x22b986;};return _0xe651();}import _0x4bf459 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x3894ed from'./face_config.json';import*as _0x5b6c6e from'node:path';function _0x4f61(_0x44cefa,_0x1df44d){const _0xe651df=_0xe651();return _0x4f61=function(_0x4f6142,_0x32c554){_0x4f6142=_0x4f6142-0x69;let _0x3b2451=_0xe651df[_0x4f6142];return _0x3b2451;},_0x4f61(_0x44cefa,_0x1df44d);}import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x229230){const _0x239be6=_0x4f61;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x229230,'atType':AtType[_0x239be6(0x79)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x58de53,_0x1a70c9,_0x3dc342,_0x21ec63){const _0x246776=_0x4f61;return{'elementType':ElementType[_0x246776(0xc1)],'elementId':'','textElement':{'content':'@'+_0x21ec63,'atType':_0x3dc342,'atUid':_0x58de53,'atTinyId':'','atNtUid':_0x1a70c9}};}static[_0x5d8d63(0x9d)](_0x4db0e4,_0x4193dd,_0x1fb576,_0x219a92){const _0x465857=_0x5d8d63;return{'elementType':ElementType[_0x465857(0x99)],'elementId':'','replyElement':{'replayMsgSeq':_0x4db0e4,'replayMsgId':_0x4193dd,'senderUin':_0x1fb576,'senderUinStr':_0x219a92}};}static async[_0x5d8d63(0xc2)](_0x35a756,_0x45b722='',_0x342eb8=0x0){const _0x1ed5a3=_0x5d8d63,_0x398fe5={'ZOzEA':function(_0x431f06,_0x5a9720){return _0x431f06===_0x5a9720;},'YUWSv':'文件异常，大小为0'},{md5:_0x425de9,fileName:_0x5c7122,path:_0x2516b6,fileSize:_0x584300}=await NTQQFileApi[_0x1ed5a3(0x7a)](_0x35a756,ElementType['PIC'],_0x342eb8);if(_0x398fe5[_0x1ed5a3(0x7c)](_0x584300,0x0))throw _0x398fe5['YUWSv'];const _0x599cb9=await NTQQFileApi[_0x1ed5a3(0x9e)](_0x35a756),_0x40f0ae={'md5HexStr':_0x425de9,'fileSize':_0x584300['toString'](),'picWidth':_0x599cb9?.[_0x1ed5a3(0xa2)],'picHeight':_0x599cb9?.['height'],'fileName':_0x5c7122,'sourcePath':_0x2516b6,'original':!![],'picType':isGIF(_0x35a756)?PicType[_0x1ed5a3(0xca)]:PicType[_0x1ed5a3(0x98)],'picSubType':_0x342eb8,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x45b722};return{'elementType':ElementType[_0x1ed5a3(0xbd)],'elementId':'','picElement':_0x40f0ae};}static async['file'](_0x2181c0,_0x15ff4c='',_0x8b5cdd=''){const _0x22dbe1=_0x5d8d63,_0x50e152={'DnWsQ':function(_0x22631d,_0x5e64d9){return _0x22631d===_0x5e64d9;},'NMVXs':function(_0x52f552,_0x3e4e13){return _0x52f552||_0x3e4e13;}},{md5:_0x178d2a,fileName:_0x3a0b7d,path:_0x35c2c0,fileSize:_0x46654c}=await NTQQFileApi[_0x22dbe1(0x7a)](_0x2181c0,ElementType['FILE']);if(_0x50e152[_0x22dbe1(0xc8)](_0x46654c,0x0))throw'文件异常，大小为0';const _0x3fa43c={'elementType':ElementType[_0x22dbe1(0x72)],'elementId':'','fileElement':{'fileName':_0x50e152[_0x22dbe1(0x78)](_0x15ff4c,_0x3a0b7d),'folderId':_0x8b5cdd,'filePath':_0x35c2c0,'fileSize':_0x46654c['toString']()}};return _0x3fa43c;}static async[_0x5d8d63(0x86)](_0x417e3b,_0x4d5e30='',_0x59be62=''){const _0x4b530d=_0x5d8d63,_0x35e902={'BqsQO':function(_0x16da7d,_0x5cc53b){return _0x16da7d(_0x5cc53b);},'WoorC':function(_0x3b9bb3,_0x113d36){return _0x3b9bb3(_0x113d36);},'QxmEg':function(_0x204628,_0x4d64a2){return _0x204628(_0x4d64a2);},'jhyJp':_0x4b530d(0x80),'fPgDZ':_0x4b530d(0x6c),'eeWSE':function(_0x44f3e1,_0x18a195){return _0x44f3e1+_0x18a195;},'HWIre':function(_0xadc118,_0x595e9c){return _0xadc118===_0x595e9c;},'OQbsl':'文件异常，大小为0','AMNpY':_0x4b530d(0xb2),'fOgTe':function(_0x18d9fa,_0x411aa6,_0x5be1ce){return _0x18d9fa(_0x411aa6,_0x5be1ce);},'oXdzv':_0x4b530d(0xc7),'pyGyE':function(_0x105ab4,_0x179167){return _0x105ab4||_0x179167;}},{fileName:_0x9c9f4a,path:_0x578440,fileSize:_0x74c41e,md5:_0x50a228}=await NTQQFileApi[_0x4b530d(0x7a)](_0x417e3b,ElementType[_0x4b530d(0x69)]);if(_0x35e902[_0x4b530d(0x85)](_0x74c41e,0x0))throw _0x35e902[_0x4b530d(0xb1)];let _0x41cad2=_0x578440[_0x4b530d(0xa3)](_0x5b6c6e[_0x4b530d(0x6f)]+'Ori'+_0x5b6c6e['sep'],_0x5b6c6e[_0x4b530d(0x6f)]+_0x4b530d(0xce)+_0x5b6c6e[_0x4b530d(0x6f)]);_0x41cad2=_0x5b6c6e['dirname'](_0x41cad2);let _0x2a3171={'width':0x780,'height':0x438,'time':0xf,'format':_0x35e902[_0x4b530d(0xaf)],'size':_0x74c41e,'filePath':_0x417e3b};try{_0x2a3171=await _0x35e902['QxmEg'](getVideoInfo,_0x578440);}catch(_0x468a67){_0x35e902[_0x4b530d(0x9c)](logError,_0x35e902[_0x4b530d(0x7f)],_0x468a67);}const _0x8a4fb7=new Promise((_0x37f754,_0x34273f)=>{const _0x3a57fb=_0x4b530d,_0x23c192={'zPHdN':function(_0x45a3fd,_0x1c0aa2){const _0x11c055=_0x4f61;return _0x35e902[_0x11c055(0x90)](_0x45a3fd,_0x1c0aa2);},'MSkrN':function(_0x5eea2c,_0x5e8981,_0x237cbe){return _0x5eea2c(_0x5e8981,_0x237cbe);},'VKjhf':_0x3a57fb(0xab),'sZWWX':function(_0x4710ca,_0x13c022){const _0x3911e1=_0x3a57fb;return _0x35e902[_0x3911e1(0xb0)](_0x4710ca,_0x13c022);}},_0x43a809=_0x50a228+_0x3a57fb(0x9b),_0x111a2d=_0x5b6c6e[_0x3a57fb(0x83)](_0x41cad2,_0x43a809);_0x35e902['QxmEg'](_0x4bf459,_0x417e3b)['on'](_0x35e902['jhyJp'],()=>{})['on'](_0x35e902[_0x3a57fb(0x75)],_0x22d6b8=>{const _0x3bf066=_0x3a57fb,_0x4ec8f8={'zXODt':function(_0x5e990e,_0x499218){const _0x19e79a=_0x4f61;return _0x23c192[_0x19e79a(0xa8)](_0x5e990e,_0x499218);}};_0x23c192[_0x3bf066(0xa4)](logDebug,_0x23c192[_0x3bf066(0xba)],_0x22d6b8),_0x59be62?_0x4467ce[_0x3bf066(0x97)](_0x59be62,_0x111a2d)[_0x3bf066(0x8b)](()=>{const _0x158826=_0x3bf066;_0x4ec8f8[_0x158826(0xbf)](_0x37f754,_0x111a2d);})[_0x3bf066(0xc3)](_0x34273f):_0x4467ce[_0x3bf066(0xc4)](_0x111a2d,defaultVideoThumb)[_0x3bf066(0x8b)](()=>{_0x23c192['zPHdN'](_0x37f754,_0x111a2d);})[_0x3bf066(0xc3)](_0x34273f);})[_0x3a57fb(0xa1)]({'timestamps':[0x0],'filename':_0x43a809,'folder':_0x41cad2,'size':_0x35e902[_0x3a57fb(0x9f)](_0x2a3171[_0x3a57fb(0xa2)],'x')+_0x2a3171['height']})['on']('end',()=>{_0x23c192['sZWWX'](_0x37f754,_0x111a2d);});}),_0x1c3c73=new Map(),_0x2cd679=await _0x8a4fb7,_0x29da6d=(await _0x4467ce[_0x4b530d(0xcb)](_0x2cd679))[_0x4b530d(0x70)];_0x1c3c73['set'](0x0,_0x2cd679);const _0xbd7751=await calculateFileMD5(_0x2cd679),_0x59f455={'elementType':ElementType[_0x4b530d(0x69)],'elementId':'','videoElement':{'fileName':_0x35e902[_0x4b530d(0x74)](_0x4d5e30,_0x9c9f4a),'filePath':_0x578440,'videoMd5':_0x50a228,'thumbMd5':_0xbd7751,'fileTime':_0x2a3171[_0x4b530d(0xb4)],'thumbPath':_0x1c3c73,'thumbSize':_0x29da6d,'thumbWidth':_0x2a3171[_0x4b530d(0xa2)],'thumbHeight':_0x2a3171[_0x4b530d(0xb3)],'fileSize':''+_0x74c41e}};return _0x59f455;}static async[_0x5d8d63(0x91)](_0x5363ba){const _0x1405f8=_0x5d8d63,_0x28f9fa={'BoKNf':_0x1405f8(0x77),'Kjboh':function(_0x278870,_0x4cd7c3){return _0x278870===_0x4cd7c3;},'WwVRC':'文件异常，大小为0','KEPWI':function(_0x4eaeef,_0x5402cf){return _0x4eaeef||_0x5402cf;}},{converted:_0x4d456e,path:_0xafa79a,duration:_0x54b5c7}=await encodeSilk(_0x5363ba);if(!_0xafa79a)throw _0x28f9fa[_0x1405f8(0x71)];const {md5:_0x3f5e61,fileName:_0xe1353a,path:_0x4f4df6,fileSize:_0x597b4f}=await NTQQFileApi[_0x1405f8(0x7a)](_0xafa79a,ElementType['PTT']);if(_0x28f9fa[_0x1405f8(0xcd)](_0x597b4f,0x0))throw _0x28f9fa[_0x1405f8(0xaa)];return _0x4d456e&&_0x4467ce[_0x1405f8(0xbe)](_0xafa79a)[_0x1405f8(0x8b)](),{'elementType':ElementType[_0x1405f8(0xbb)],'elementId':'','pttElement':{'fileName':_0xe1353a,'filePath':_0x4f4df6,'md5HexStr':_0x3f5e61,'fileSize':_0x597b4f,'duration':_0x28f9fa[_0x1405f8(0x84)](_0x54b5c7,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x366877){const _0x57fd2a=_0x5d8d63,_0x3e02a9={'LBgqG':function(_0x39352a,_0x41f949){return _0x39352a(_0x41f949);},'XVhsp':function(_0x1964a8,_0x3ad0e0){return _0x1964a8>=_0x3ad0e0;}},_0x3dd023=_0x3894ed['sysface'],_0x5cff87=_0x3894ed[_0x57fd2a(0x6d)],_0x25edce=_0x3dd023[_0x57fd2a(0xa7)](_0x5e5284=>_0x5e5284['QSid']===_0x366877[_0x57fd2a(0xad)]());_0x366877=_0x3e02a9[_0x57fd2a(0xac)](parseInt,_0x366877['toString']());let _0x5d8342=0x1;return _0x3e02a9[_0x57fd2a(0x94)](_0x366877,0xde)&&(_0x5d8342=0x2),_0x25edce[_0x57fd2a(0x6e)]&&(_0x5d8342=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x366877,'faceType':_0x5d8342,'faceText':_0x25edce[_0x57fd2a(0x88)],'stickerId':_0x25edce[_0x57fd2a(0xc0)],'stickerType':_0x25edce['AniStickerType'],'packId':_0x25edce[_0x57fd2a(0xa6)],'sourceType':0x1}};}static['mface'](_0x41c933,_0x40defa,_0x303bd2,_0x396da4){const _0x5ad9ae=_0x5d8d63;return{'elementType':ElementType[_0x5ad9ae(0xa9)],'marketFaceElement':{'emojiPackageId':_0x41c933,'emojiId':_0x40defa,'key':_0x303bd2,'faceName':_0x396da4||mFaceCache[_0x5ad9ae(0x8d)](_0x40defa)||_0x5ad9ae(0xc9)}};}static['dice'](_0x6943a6){const _0x158360=_0x5d8d63,_0x4020f0={'fWcVF':_0x158360(0x6a)};return{'elementType':ElementType[_0x158360(0xbc)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x158360(0xc5)],'faceType':FaceType['dice'],'faceText':_0x4020f0[_0x158360(0x9a)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x40d72f){const _0x305f83=_0x5d8d63,_0xa3b0f0={'GEkVy':_0x305f83(0xb8)};return{'elementType':ElementType[_0x305f83(0xbc)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x305f83(0xb7)],'faceText':_0xa3b0f0[_0x305f83(0xa0)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5d8d63(0x6b)](_0x2a22ea){const _0x320982=_0x5d8d63,_0x49527a={'edLdz':function(_0x5cd25e,_0x12c57e){return _0x5cd25e!==_0x12c57e;}};return _0x49527a[_0x320982(0x7d)](typeof _0x2a22ea,'string')&&(_0x2a22ea=JSON[_0x320982(0x8f)](_0x2a22ea)),{'elementType':ElementType[_0x320982(0xa5)],'elementId':'','arkElement':{'bytesData':_0x2a22ea,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x33db2a){const _0x49e3b5=_0x5d8d63;return{'elementType':ElementType[_0x49e3b5(0xb6)],'elementId':'','markdownElement':{'content':_0x33db2a}};}static async[_0x5d8d63(0xb9)](){const _0x144a8e=_0x5d8d63,_0x4b3c76={'EqRNm':'Bot\x20Test','mEKnd':_0x144a8e(0x7e),'DNWSU':_0x144a8e(0xcc)};let _0x268d76=await SignMiniApp({'prompt':_0x4b3c76[_0x144a8e(0x92)],'title':_0x4b3c76[_0x144a8e(0x92)],'preview':_0x144a8e(0x76),'jumpUrl':_0x4b3c76[_0x144a8e(0x93)],'tag':_0x4b3c76[_0x144a8e(0x92)],'tagIcon':_0x4b3c76['DNWSU'],'source':_0x4b3c76[_0x144a8e(0x92)],'sourcelogo':_0x4b3c76[_0x144a8e(0x7b)]});return{'elementType':ElementType[_0x144a8e(0xa5)],'elementId':'','arkElement':{'bytesData':_0x268d76,'linkInfo':null,'subElementType':null}};}}