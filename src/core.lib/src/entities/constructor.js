function _0x74e8(_0x409848,_0x147ff5){const _0x550150=_0x5501();return _0x74e8=function(_0x74e8ec,_0x114bde){_0x74e8ec=_0x74e8ec-0xc9;let _0x1ce0ec=_0x550150[_0x74e8ec];return _0x1ce0ec;},_0x74e8(_0x409848,_0x147ff5);}const _0x9764eb=_0x74e8;(function(_0x5a77c1,_0x66a1c8){const _0xa0074=_0x74e8,_0xcc5c0=_0x5a77c1();while(!![]){try{const _0x5cdc8e=parseInt(_0xa0074(0xe9))/0x1*(parseInt(_0xa0074(0x110))/0x2)+parseInt(_0xa0074(0xfe))/0x3+-parseInt(_0xa0074(0xcf))/0x4*(-parseInt(_0xa0074(0xf6))/0x5)+parseInt(_0xa0074(0xf0))/0x6*(-parseInt(_0xa0074(0xf4))/0x7)+-parseInt(_0xa0074(0x106))/0x8*(parseInt(_0xa0074(0x127))/0x9)+-parseInt(_0xa0074(0xdb))/0xa+-parseInt(_0xa0074(0xe0))/0xb*(-parseInt(_0xa0074(0xf2))/0xc);if(_0x5cdc8e===_0x66a1c8)break;else _0xcc5c0['push'](_0xcc5c0['shift']());}catch(_0x11ffd2){_0xcc5c0['push'](_0xcc5c0['shift']());}}}(_0x5501,0xef266));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x775ab1}from'node:fs';import _0x2266a2 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';function _0x5501(){const _0xc66152=['getImageSize','sep','BoNlP','join','Bot\x20Test','set','REPLY','aauBi','10535680eZftiB','ptt','Ori','dxfyB','notAt','5688716kgMJjv','[骰子]','fgLfS','find','string','[商城表情]','FACE','text','https://www.bilibili.com/','1PZWkZW','error','ynRCo','jyGyS','rps','reply','emoji','1258128SJNaBD','DoiYb','48xgKfal','sysface','14yYCtHg','oliar','3505bnLfbd','toString','dirname','ytfil','file','ARK','miniapp','TEXT','3285216Vyyfcw','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','DbWZm','获取视频封面失败，使用默认封面','fXIMs','AniStickerId','tidKM','copyFile','1277624ZmoLxS','stat','HcVts','PTT','FILE','vSksh','文件异常，大小为0','jpg','mp4','stringify','763634rCVFVm','PIC','AniStickerType','RPS','OOpfX','_0.png','markdown','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','MFACE','pxRfx','Idezn','uploadFile','qEgEE','catch','pic','语音转换失败,\x20请检查语音文件是否正常','ark','get','[包剪锤]','unlink','mface','gPlVI','replace','90NmjIhM','width','acLun','NzmHd','VIDEO','then','wUzrI','tCFNI','dice','rcyiP','2876RKBsPs','LHYmG','lZAcH','face'];_0x5501=function(){return _0xc66152;};return _0x5501();}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x4e186e from'./face_config.json';import*as _0xdbc921 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x9764eb(0xe7)](_0x3fec8d){const _0x4c6af1=_0x9764eb;return{'elementType':ElementType[_0x4c6af1(0xfd)],'elementId':'','textElement':{'content':_0x3fec8d,'atType':AtType[_0x4c6af1(0xdf)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x5185e5,_0x4d3c4c,_0xbbf0c,_0x5377c8){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x5377c8,'atType':_0xbbf0c,'atUid':_0x5185e5,'atTinyId':'','atNtUid':_0x4d3c4c}};}static[_0x9764eb(0xee)](_0x15a039,_0x14fb61,_0x34bf14,_0x1b3575){const _0xa73712=_0x9764eb;return{'elementType':ElementType[_0xa73712(0xd9)],'elementId':'','replyElement':{'replayMsgSeq':_0x15a039,'replayMsgId':_0x14fb61,'senderUin':_0x34bf14,'senderUinStr':_0x1b3575}};}static async[_0x9764eb(0x11e)](_0x18434a,_0x377bdf='',_0xcbba17=0x0){const _0x17ecef=_0x9764eb,_0x49ede6={'rcyiP':function(_0x484b9c,_0x3623c8){return _0x484b9c===_0x3623c8;},'MhCfh':_0x17ecef(0x10c)},{md5:_0x28a618,fileName:_0x476178,path:_0x1e3639,fileSize:_0x53a569}=await NTQQFileApi['uploadFile'](_0x18434a,ElementType[_0x17ecef(0x111)],_0xcbba17);if(_0x49ede6[_0x17ecef(0xce)](_0x53a569,0x0))throw _0x49ede6['MhCfh'];const _0x22f644=await NTQQFileApi[_0x17ecef(0xd3)](_0x18434a),_0x1cb702={'md5HexStr':_0x28a618,'fileSize':_0x53a569[_0x17ecef(0xf7)](),'picWidth':_0x22f644?.[_0x17ecef(0x128)],'picHeight':_0x22f644?.['height'],'fileName':_0x476178,'sourcePath':_0x1e3639,'original':!![],'picType':isGIF(_0x18434a)?PicType['gif']:PicType[_0x17ecef(0x10d)],'picSubType':_0xcbba17,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x377bdf};return{'elementType':ElementType[_0x17ecef(0x111)],'elementId':'','picElement':_0x1cb702};}static async[_0x9764eb(0xfa)](_0xbe6441,_0xc74bc9='',_0x556286=''){const _0x1b6264=_0x9764eb,_0x573d55={'fXIMs':function(_0x22fc30,_0x7d914e){return _0x22fc30===_0x7d914e;},'aauBi':'文件异常，大小为0','lZAcH':function(_0x57e2b5,_0x11442b){return _0x57e2b5||_0x11442b;}},{md5:_0x1b2202,fileName:_0x1353e6,path:_0x1a3032,fileSize:_0x302afb}=await NTQQFileApi[_0x1b6264(0x11b)](_0xbe6441,ElementType[_0x1b6264(0x10a)]);if(_0x573d55[_0x1b6264(0x102)](_0x302afb,0x0))throw _0x573d55[_0x1b6264(0xda)];const _0x281f07={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x573d55[_0x1b6264(0xd1)](_0xc74bc9,_0x1353e6),'folderId':_0x556286,'filePath':_0x1a3032,'fileSize':_0x302afb['toString']()}};return _0x281f07;}static async['video'](_0x41f854,_0x3f3771='',_0x1cd82a=''){const _0x14865f=_0x9764eb,_0x18192e={'dxfyB':function(_0x1a5d81,_0x15609d){return _0x1a5d81(_0x15609d);},'tidKM':function(_0x455d03,_0x40b9d2,_0x2a4639){return _0x455d03(_0x40b9d2,_0x2a4639);},'OOpfX':_0x14865f(0x101),'LHYmG':'end','gPlVI':_0x14865f(0xea),'vSksh':function(_0x42aca4,_0x28d8bf){return _0x42aca4+_0x28d8bf;},'BoNlP':'文件异常，大小为0','wUzrI':_0x14865f(0x10e),'HcVts':function(_0x5c4ed3,_0x1c6628,_0x4f310a){return _0x5c4ed3(_0x1c6628,_0x4f310a);},'NzmHd':'获取视频信息失败','fdOYV':function(_0x15c4ce,_0x35ea2a){return _0x15c4ce||_0x35ea2a;}},{fileName:_0x3fb994,path:_0x30fc32,fileSize:_0x105298,md5:_0x4a8084}=await NTQQFileApi['uploadFile'](_0x41f854,ElementType[_0x14865f(0xc9)]);if(_0x105298===0x0)throw _0x18192e[_0x14865f(0xd5)];let _0x3a1029=_0x30fc32[_0x14865f(0x126)](_0xdbc921['sep']+_0x14865f(0xdd)+_0xdbc921[_0x14865f(0xd4)],_0xdbc921[_0x14865f(0xd4)]+'Thumb'+_0xdbc921['sep']);_0x3a1029=_0xdbc921[_0x14865f(0xf8)](_0x3a1029);let _0x69f03d={'width':0x780,'height':0x438,'time':0xf,'format':_0x18192e[_0x14865f(0xcb)],'size':_0x105298,'filePath':_0x41f854};try{_0x69f03d=await _0x18192e[_0x14865f(0xde)](getVideoInfo,_0x30fc32);}catch(_0x1ab12e){_0x18192e[_0x14865f(0x108)](logError,_0x18192e[_0x14865f(0x12a)],_0x1ab12e);}const _0x1b466f=new Promise((_0x5b3ce7,_0x4c8870)=>{const _0x84ac2=_0x14865f,_0xac4a22={'fgLfS':function(_0x8374c,_0x44bb4c){const _0x1d261c=_0x74e8;return _0x18192e[_0x1d261c(0xde)](_0x8374c,_0x44bb4c);},'oliar':function(_0x30762a,_0x4b2f23,_0x391401){const _0x29b520=_0x74e8;return _0x18192e[_0x29b520(0x104)](_0x30762a,_0x4b2f23,_0x391401);},'zlnln':_0x18192e[_0x84ac2(0x114)]},_0x119c2c=_0x4a8084+_0x84ac2(0x115),_0x472b2b=_0xdbc921[_0x84ac2(0xd6)](_0x3a1029,_0x119c2c);_0x18192e[_0x84ac2(0xde)](_0x2266a2,_0x41f854)['on'](_0x18192e[_0x84ac2(0xd0)],()=>{})['on'](_0x18192e[_0x84ac2(0x125)],_0x1d841c=>{const _0x31189d=_0x84ac2,_0x31c808={'tCFNI':function(_0x1a99ab,_0x2972c8){const _0x4cb5a2=_0x74e8;return _0xac4a22[_0x4cb5a2(0xe2)](_0x1a99ab,_0x2972c8);}};_0xac4a22[_0x31189d(0xf5)](logDebug,_0xac4a22['zlnln'],_0x1d841c),_0x1cd82a?_0x775ab1[_0x31189d(0x105)](_0x1cd82a,_0x472b2b)[_0x31189d(0xca)](()=>{_0x5b3ce7(_0x472b2b);})[_0x31189d(0x11d)](_0x4c8870):_0x775ab1['writeFile'](_0x472b2b,defaultVideoThumb)['then'](()=>{const _0x307479=_0x31189d;_0x31c808[_0x307479(0xcc)](_0x5b3ce7,_0x472b2b);})[_0x31189d(0x11d)](_0x4c8870);})['screenshots']({'timestamps':[0x0],'filename':_0x119c2c,'folder':_0x3a1029,'size':_0x18192e[_0x84ac2(0x10b)](_0x18192e[_0x84ac2(0x10b)](_0x69f03d[_0x84ac2(0x128)],'x'),_0x69f03d['height'])})['on'](_0x18192e[_0x84ac2(0xd0)],()=>{_0xac4a22['fgLfS'](_0x5b3ce7,_0x472b2b);});}),_0x26b2e2=new Map(),_0x1992ab=await _0x1b466f,_0x142459=(await _0x775ab1[_0x14865f(0x107)](_0x1992ab))['size'];_0x26b2e2[_0x14865f(0xd8)](0x0,_0x1992ab);const _0x2a3aa7=await calculateFileMD5(_0x1992ab),_0x32e87a={'elementType':ElementType[_0x14865f(0xc9)],'elementId':'','videoElement':{'fileName':_0x18192e['fdOYV'](_0x3f3771,_0x3fb994),'filePath':_0x30fc32,'videoMd5':_0x4a8084,'thumbMd5':_0x2a3aa7,'fileTime':_0x69f03d['time'],'thumbPath':_0x26b2e2,'thumbSize':_0x142459,'thumbWidth':_0x69f03d[_0x14865f(0x128)],'thumbHeight':_0x69f03d['height'],'fileSize':_0x18192e['vSksh']('',_0x105298)}};return _0x32e87a;}static async[_0x9764eb(0xdc)](_0x46a433){const _0x552394=_0x9764eb,_0x4bc506={'pxRfx':function(_0x4c210c,_0x5170cd){return _0x4c210c(_0x5170cd);},'jyGyS':function(_0x467b41,_0x5b8465){return _0x467b41===_0x5b8465;},'ytfil':_0x552394(0x10c),'ZEAkb':function(_0x1f0b0e,_0x31fe7c){return _0x1f0b0e||_0x31fe7c;}},{converted:_0x1f2517,path:_0x522097,duration:_0x8c6046}=await _0x4bc506[_0x552394(0x119)](encodeSilk,_0x46a433);if(!_0x522097)throw _0x552394(0x11f);const {md5:_0x34914e,fileName:_0x26a6e3,path:_0x517321,fileSize:_0x86c922}=await NTQQFileApi['uploadFile'](_0x522097,ElementType[_0x552394(0x109)]);if(_0x4bc506[_0x552394(0xec)](_0x86c922,0x0))throw _0x4bc506[_0x552394(0xf9)];return _0x1f2517&&_0x775ab1[_0x552394(0x123)](_0x522097)[_0x552394(0xca)](),{'elementType':ElementType[_0x552394(0x109)],'elementId':'','pttElement':{'fileName':_0x26a6e3,'filePath':_0x517321,'md5HexStr':_0x34914e,'fileSize':_0x86c922,'duration':_0x4bc506['ZEAkb'](_0x8c6046,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x9764eb(0xd2)](_0x2f78f9){const _0x35e02e=_0x9764eb,_0x3a92c2={'SpVys':function(_0x4821c2,_0x16d157){return _0x4821c2>=_0x16d157;}},_0x116fc8=_0x4e186e[_0x35e02e(0xf3)],_0x35a058=_0x4e186e[_0x35e02e(0xef)],_0x45f5d5=_0x116fc8[_0x35e02e(0xe3)](_0x211993=>_0x211993['QSid']===_0x2f78f9[_0x35e02e(0xf7)]());_0x2f78f9=parseInt(_0x2f78f9['toString']());let _0xb85a76=0x1;return _0x3a92c2['SpVys'](_0x2f78f9,0xde)&&(_0xb85a76=0x2),_0x45f5d5[_0x35e02e(0x112)]&&(_0xb85a76=0x3),{'elementType':ElementType[_0x35e02e(0xe6)],'elementId':'','faceElement':{'faceIndex':_0x2f78f9,'faceType':_0xb85a76,'faceText':_0x45f5d5['QDes'],'stickerId':_0x45f5d5[_0x35e02e(0x103)],'stickerType':_0x45f5d5['AniStickerType'],'packId':_0x45f5d5['AniStickerPackId'],'sourceType':0x1}};}static[_0x9764eb(0x124)](_0x1e24e7,_0x2357a9,_0x1bd2b6,_0x2227f5){const _0x100037=_0x9764eb,_0x254c18={'uIcSX':_0x100037(0xe5)};return{'elementType':ElementType[_0x100037(0x118)],'marketFaceElement':{'emojiPackageId':_0x1e24e7,'emojiId':_0x2357a9,'key':_0x1bd2b6,'faceName':_0x2227f5||mFaceCache[_0x100037(0x121)](_0x2357a9)||_0x254c18['uIcSX']}};}static[_0x9764eb(0xcd)](_0xaf2264){const _0x40b36d=_0x9764eb,_0x150056={'ynRCo':_0x40b36d(0xe1)};return{'elementType':ElementType[_0x40b36d(0xe6)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x40b36d(0xcd)],'faceType':FaceType[_0x40b36d(0xcd)],'faceText':_0x150056[_0x40b36d(0xeb)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x9764eb(0xed)](_0x49a607){const _0x56b0c6=_0x9764eb,_0x4ff91f={'WZBGF':_0x56b0c6(0x122)};return{'elementType':ElementType[_0x56b0c6(0xe6)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x56b0c6(0x113)],'faceText':_0x4ff91f['WZBGF'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x9764eb(0x120)](_0x4f874c){const _0x4bf1d5=_0x9764eb,_0x3fbf69={'qEgEE':function(_0x22ff92,_0x456a82){return _0x22ff92!==_0x456a82;}};return _0x3fbf69[_0x4bf1d5(0x11c)](typeof _0x4f874c,_0x4bf1d5(0xe4))&&(_0x4f874c=JSON[_0x4bf1d5(0x10f)](_0x4f874c)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x4f874c,'linkInfo':null,'subElementType':null}};}static[_0x9764eb(0x116)](_0xa97603){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0xa97603}};}static async[_0x9764eb(0xfc)](){const _0x502ed3=_0x9764eb,_0x2e994c={'acLun':function(_0x30c71b,_0x37a826){return _0x30c71b(_0x37a826);},'DoiYb':_0x502ed3(0xd7),'DbWZm':_0x502ed3(0x117),'Idezn':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0x4f3099=await _0x2e994c[_0x502ed3(0x129)](SignMiniApp,{'prompt':_0x2e994c[_0x502ed3(0xf1)],'title':_0x2e994c['DoiYb'],'preview':_0x2e994c[_0x502ed3(0x100)],'jumpUrl':_0x502ed3(0xe8),'tag':_0x502ed3(0xd7),'tagIcon':_0x2e994c[_0x502ed3(0x11a)],'source':_0x2e994c[_0x502ed3(0xf1)],'sourcelogo':_0x502ed3(0xff)});return{'elementType':ElementType[_0x502ed3(0xfb)],'elementId':'','arkElement':{'bytesData':_0x4f3099,'linkInfo':null,'subElementType':null}};}}