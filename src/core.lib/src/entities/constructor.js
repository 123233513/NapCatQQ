const _0x6b8328=_0x51bd;(function(_0x5e96e2,_0x22472d){const _0xbb3c88=_0x51bd,_0x4d9d23=_0x5e96e2();while(!![]){try{const _0x162341=parseInt(_0xbb3c88(0x179))/0x1*(parseInt(_0xbb3c88(0x139))/0x2)+-parseInt(_0xbb3c88(0x138))/0x3*(-parseInt(_0xbb3c88(0x136))/0x4)+parseInt(_0xbb3c88(0x16a))/0x5*(-parseInt(_0xbb3c88(0x164))/0x6)+-parseInt(_0xbb3c88(0x173))/0x7*(-parseInt(_0xbb3c88(0x15f))/0x8)+-parseInt(_0xbb3c88(0x14b))/0x9*(parseInt(_0xbb3c88(0x146))/0xa)+-parseInt(_0xbb3c88(0x135))/0xb*(parseInt(_0xbb3c88(0x14d))/0xc)+parseInt(_0xbb3c88(0x153))/0xd;if(_0x162341===_0x22472d)break;else _0x4d9d23['push'](_0x4d9d23['shift']());}catch(_0x3d44b2){_0x4d9d23['push'](_0x4d9d23['shift']());}}}(_0x19d3,0xa0d81));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x26f051}from'node:fs';import _0x416b28 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x6b8328(0x177)](_0x36102c){const _0x52b253=_0x6b8328;return{'elementType':ElementType[_0x52b253(0x158)],'elementId':'','textElement':{'content':_0x36102c,'atType':AtType[_0x52b253(0x13e)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0xb372b6,_0x3789ed,_0x4a7d31,_0x3d5dd9){const _0x33f50c=_0x6b8328;return{'elementType':ElementType[_0x33f50c(0x158)],'elementId':'','textElement':{'content':'@'+_0x3d5dd9,'atType':_0x4a7d31,'atUid':_0xb372b6,'atTinyId':'','atNtUid':_0x3789ed}};}static['reply'](_0x38118b,_0x52b2ba,_0x2a4a22,_0x265cdf){const _0x57d3f6=_0x6b8328;return{'elementType':ElementType[_0x57d3f6(0x132)],'elementId':'','replyElement':{'replayMsgSeq':_0x38118b,'replayMsgId':_0x52b2ba,'senderUin':_0x2a4a22,'senderUinStr':_0x265cdf}};}static async[_0x6b8328(0x127)](_0x1d5a5a,_0x2e4fb4='',_0x3978b7=0x0){const _0x757261=_0x6b8328,_0x5a8ab6={'XENyC':_0x757261(0x13d),'pXbPt':function(_0xf1689d,_0x4f90ed){return _0xf1689d(_0x4f90ed);},'kzqcA':function(_0xe8b5db,_0x509a58,_0x1e7d4a){return _0xe8b5db(_0x509a58,_0x1e7d4a);},'QaKvH':_0x757261(0x141)},{md5:_0x28f7a4,fileName:_0x43a319,path:_0x51d3d5,fileSize:_0x59b1ad}=await NTQQFileApi['uploadFile'](_0x1d5a5a,ElementType[_0x757261(0x16d)],_0x3978b7);if(_0x59b1ad===0x0)throw _0x5a8ab6['XENyC'];const _0x17278e=await NTQQFileApi['getImageSize'](_0x1d5a5a),_0x5501d0={'md5HexStr':_0x28f7a4,'fileSize':_0x59b1ad[_0x757261(0x178)](),'picWidth':_0x17278e?.['width'],'picHeight':_0x17278e?.['height'],'fileName':_0x43a319,'sourcePath':_0x51d3d5,'original':!![],'picType':_0x5a8ab6[_0x757261(0x168)](isGIF,_0x1d5a5a)?PicType[_0x757261(0x159)]:PicType[_0x757261(0x165)],'picSubType':_0x3978b7,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2e4fb4};return _0x5a8ab6['kzqcA'](logDebug,_0x5a8ab6[_0x757261(0x150)],_0x5501d0),{'elementType':ElementType[_0x757261(0x16d)],'elementId':'','picElement':_0x5501d0};}static async['file'](_0x52a936,_0x3c8e2a=''){const _0x54c122=_0x6b8328,_0x3932ab={'FaUyU':function(_0x2dcfe0,_0x40727b){return _0x2dcfe0===_0x40727b;},'upvpN':function(_0x53f3f9,_0x3f8758){return _0x53f3f9||_0x3f8758;}},{md5:_0x2791c2,fileName:_0x4491b6,path:_0x323017,fileSize:_0x3da00c}=await NTQQFileApi['uploadFile'](_0x52a936,ElementType[_0x54c122(0x142)]);if(_0x3932ab[_0x54c122(0x12b)](_0x3da00c,0x0))throw _0x54c122(0x13d);const _0x3ce134={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x3932ab[_0x54c122(0x15e)](_0x3c8e2a,_0x4491b6),'filePath':_0x323017,'fileSize':_0x3da00c[_0x54c122(0x178)]()}};return _0x3ce134;}static async['video'](_0x210984,_0x4f16f9='',_0x59fed0=''){const _0x10241f=_0x6b8328,_0x4c44ae={'ApTgB':function(_0x418013,_0x20b2f5){return _0x418013(_0x20b2f5);},'rMHTp':function(_0x628b1c,_0x57d5bb){return _0x628b1c(_0x57d5bb);},'Lmshg':_0x10241f(0x137),'bJhWU':'error','uEsXo':function(_0x26efb8,_0x567604){return _0x26efb8+_0x567604;},'XvAjn':function(_0x21fcf3,_0x206c06){return _0x21fcf3===_0x206c06;},'cktmr':_0x10241f(0x13d),'EVmPr':'path','UczgR':_0x10241f(0x12c),'daKnG':function(_0x71142f,_0x4c4dda,_0x352a67){return _0x71142f(_0x4c4dda,_0x352a67);},'mrJYe':_0x10241f(0x134),'gxlJZ':function(_0x4b75d7,_0x49fb00){return _0x4b75d7||_0x49fb00;}},{fileName:_0x340cbd,path:_0x3f3448,fileSize:_0x45d2b7,md5:_0x48a633}=await NTQQFileApi['uploadFile'](_0x210984,ElementType[_0x10241f(0x131)]);if(_0x4c44ae[_0x10241f(0x12f)](_0x45d2b7,0x0))throw _0x4c44ae['cktmr'];const _0x159b74=require(_0x4c44ae['EVmPr']);let _0x544bc3=_0x3f3448[_0x10241f(0x12e)](_0x159b74['sep']+_0x10241f(0x169)+_0x159b74[_0x10241f(0x140)],_0x159b74[_0x10241f(0x140)]+_0x10241f(0x130)+_0x159b74[_0x10241f(0x140)]);_0x544bc3=_0x159b74[_0x10241f(0x14e)](_0x544bc3);let _0xaa0a63={'width':0x780,'height':0x438,'time':0xf,'format':_0x4c44ae[_0x10241f(0x126)],'size':_0x45d2b7,'filePath':_0x210984};try{_0xaa0a63=await getVideoInfo(_0x3f3448),logDebug(_0x10241f(0x171),_0xaa0a63);}catch(_0x1fe4f3){_0x4c44ae[_0x10241f(0x175)](logError,_0x4c44ae[_0x10241f(0x172)],_0x1fe4f3);}const _0x41d871=new Promise((_0x27ea2f,_0x4ffff9)=>{const _0x389c3a=_0x10241f,_0x30536e={'Rxqux':function(_0x5a6205,_0x6b76de){const _0x857c62=_0x51bd;return _0x4c44ae[_0x857c62(0x16c)](_0x5a6205,_0x6b76de);}},_0xe4950d=_0x48a633+_0x389c3a(0x144),_0x288ed2=_0x159b74['join'](_0x544bc3,_0xe4950d);_0x4c44ae[_0x389c3a(0x155)](_0x416b28,_0x210984)['on'](_0x4c44ae[_0x389c3a(0x129)],()=>{})['on'](_0x4c44ae['bJhWU'],_0x25cafc=>{const _0x1624b8=_0x389c3a,_0x1032c3={'EeEqv':function(_0x25bd42,_0x146393){return _0x25bd42(_0x146393);}};logDebug('获取视频封面失败，使用默认封面',_0x25cafc),_0x59fed0?_0x26f051[_0x1624b8(0x16f)](_0x59fed0,_0x288ed2)[_0x1624b8(0x15c)](()=>{_0x1032c3['EeEqv'](_0x27ea2f,_0x288ed2);})[_0x1624b8(0x152)](_0x4ffff9):_0x26f051[_0x1624b8(0x13b)](_0x288ed2,defaultVideoThumb)['then'](()=>{_0x30536e['Rxqux'](_0x27ea2f,_0x288ed2);})['catch'](_0x4ffff9);})[_0x389c3a(0x166)]({'timestamps':[0x0],'filename':_0xe4950d,'folder':_0x544bc3,'size':_0x4c44ae[_0x389c3a(0x145)](_0x4c44ae['uEsXo'](_0xaa0a63[_0x389c3a(0x14a)],'x'),_0xaa0a63[_0x389c3a(0x13c)])})['on'](_0x4c44ae['Lmshg'],()=>{_0x27ea2f(_0x288ed2);});}),_0x19fdae=new Map(),_0x9e3ad1=await _0x41d871,_0x38e6ac=(await _0x26f051['stat'](_0x9e3ad1))[_0x10241f(0x161)];_0x19fdae[_0x10241f(0x170)](0x0,_0x9e3ad1);const _0x44071f=await _0x4c44ae['rMHTp'](calculateFileMD5,_0x9e3ad1),_0x2cb986={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x4c44ae[_0x10241f(0x15d)](_0x4f16f9,_0x340cbd),'filePath':_0x3f3448,'videoMd5':_0x48a633,'thumbMd5':_0x44071f,'fileTime':_0xaa0a63[_0x10241f(0x14c)],'thumbPath':_0x19fdae,'thumbSize':_0x38e6ac,'thumbWidth':_0xaa0a63[_0x10241f(0x14a)],'thumbHeight':_0xaa0a63[_0x10241f(0x13c)],'fileSize':''+_0x45d2b7}};return _0x2cb986;}static async[_0x6b8328(0x12d)](_0x583fdf){const _0x4f8abb=_0x6b8328,_0x424115={'UVPwg':_0x4f8abb(0x13a),'FqScp':function(_0x473d89,_0x510019){return _0x473d89===_0x510019;},'uCLMl':function(_0x26c415,_0x48587a){return _0x26c415||_0x48587a;}},{converted:_0x439ed2,path:_0x1c0d72,duration:_0x24b5c6}=await encodeSilk(_0x583fdf);if(!_0x1c0d72)throw _0x424115['UVPwg'];const {md5:_0x2e0833,fileName:_0x36d0e5,path:_0x56c186,fileSize:_0x316156}=await NTQQFileApi[_0x4f8abb(0x176)](_0x1c0d72,ElementType[_0x4f8abb(0x149)]);if(_0x424115['FqScp'](_0x316156,0x0))throw _0x4f8abb(0x13d);return _0x439ed2&&_0x26f051[_0x4f8abb(0x12a)](_0x1c0d72)[_0x4f8abb(0x15c)](),{'elementType':ElementType[_0x4f8abb(0x149)],'elementId':'','pttElement':{'fileName':_0x36d0e5,'filePath':_0x56c186,'md5HexStr':_0x2e0833,'fileSize':_0x316156,'duration':_0x424115[_0x4f8abb(0x154)](_0x24b5c6,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x6b8328(0x14f)](_0x1c1173){const _0x537e76=_0x6b8328;return{'elementType':ElementType[_0x537e76(0x13f)],'elementId':'','faceElement':{'faceIndex':_0x1c1173,'faceType':_0x1c1173<0xde?FaceType['normal']:FaceType['normal2']}};}static[_0x6b8328(0x148)](_0x301cc5,_0x4a969b,_0x1aa0d4,_0x5703ad){const _0x15c4d0=_0x6b8328,_0x2e88c7={'JFjEY':_0x15c4d0(0x128)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x301cc5,'emojiId':_0x4a969b,'key':_0x1aa0d4,'faceName':_0x5703ad||mFaceCache[_0x15c4d0(0x16b)](_0x4a969b)||_0x2e88c7[_0x15c4d0(0x163)]}};}static[_0x6b8328(0x160)](_0x330c9f){const _0x18060d=_0x6b8328,_0x32fe2d={'uVway':_0x18060d(0x157)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x18060d(0x160)],'faceType':FaceType[_0x18060d(0x160)],'faceText':_0x32fe2d[_0x18060d(0x151)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x6b8328(0x162)](_0xcb5b4b){const _0x51b727=_0x6b8328,_0x2a4d03={'JbJFF':_0x51b727(0x156)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x51b727(0x147)],'faceText':_0x2a4d03[_0x51b727(0x133)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x6b8328(0x143)](_0x56e893){const _0x5a3a34=_0x6b8328,_0x126cd8={'vfwzs':function(_0x33a175,_0x1dda45){return _0x33a175!==_0x1dda45;},'ZPpDn':'string'};return _0x126cd8[_0x5a3a34(0x15a)](typeof _0x56e893,_0x126cd8['ZPpDn'])&&(_0x56e893=JSON[_0x5a3a34(0x174)](_0x56e893)),{'elementType':ElementType[_0x5a3a34(0x16e)],'elementId':'','arkElement':{'bytesData':_0x56e893,'linkInfo':null,'subElementType':null}};}static[_0x6b8328(0x15b)](_0xe6eb69){const _0x50e698=_0x6b8328;return{'elementType':ElementType[_0x50e698(0x167)],'elementId':'','markdownElement':{'content':_0xe6eb69}};}}function _0x51bd(_0x1d8cca,_0xfa8e3){const _0x19d323=_0x19d3();return _0x51bd=function(_0x51bdb8,_0x42ea36){_0x51bdb8=_0x51bdb8-0x126;let _0x44bd1b=_0x19d323[_0x51bdb8];return _0x44bd1b;},_0x51bd(_0x1d8cca,_0xfa8e3);}function _0x19d3(){const _0x56496b=['XvAjn','Thumb','VIDEO','REPLY','JbJFF','获取视频信息失败','121grzEYX','36faGoZO','end','379917uVjGCL','15026lPOTjv','语音转换失败,\x20请检查语音文件是否正常','writeFile','height','文件异常，大小为0','notAt','FACE','sep','图片信息','FILE','ark','_0.png','uEsXo','9395840WfFsQo','RPS','mface','PTT','width','9ODSIsC','time','420924hFZkvC','dirname','face','QaKvH','uVway','catch','7893106yNDPGJ','uCLMl','rMHTp','[包剪锤]','[骰子]','TEXT','gif','vfwzs','markdown','then','gxlJZ','upvpN','5073632ZReSlf','dice','size','rps','JFjEY','6aDVLZT','jpg','screenshots','MARKDOWN','pXbPt','Ori','3073730zSSchP','get','ApTgB','PIC','ARK','copyFile','set','视频信息','mrJYe','7AwDNuM','stringify','daKnG','uploadFile','text','toString','29HIrAfp','UczgR','pic','[商城表情]','Lmshg','unlink','FaUyU','mp4','ptt','replace'];_0x19d3=function(){return _0x56496b;};return _0x19d3();}