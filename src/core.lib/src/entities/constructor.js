const _0x30de49=_0x66e7;(function(_0x33cda1,_0x11ad41){const _0x3cce1f=_0x66e7,_0x3d818e=_0x33cda1();while(!![]){try{const _0x3fb20e=parseInt(_0x3cce1f(0x1e1))/0x1*(-parseInt(_0x3cce1f(0x1e5))/0x2)+parseInt(_0x3cce1f(0x1a2))/0x3+parseInt(_0x3cce1f(0x1cd))/0x4+-parseInt(_0x3cce1f(0x1d2))/0x5+parseInt(_0x3cce1f(0x1c3))/0x6*(-parseInt(_0x3cce1f(0x1d4))/0x7)+parseInt(_0x3cce1f(0x1a6))/0x8+parseInt(_0x3cce1f(0x1b5))/0x9*(parseInt(_0x3cce1f(0x1eb))/0xa);if(_0x3fb20e===_0x11ad41)break;else _0x3d818e['push'](_0x3d818e['shift']());}catch(_0x2d4609){_0x3d818e['push'](_0x3d818e['shift']());}}}(_0x5d14,0xb752f));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x37c6c9}from'node:fs';function _0x5d14(){const _0x3a20c2=['yIqEn','jpg','QDes','Bot\x20Test','notAt','获取视频封面失败，使用默认封面','503OIdnpa','text','writeFile','语音转换失败,\x20请检查语音文件是否正常','5830JiZwqG','FtcUY','ark','FFwSq','FACE','error','22199440umTCtk','[包剪锤]','[骰子]','face','ARK','getImageSize','JZxVI','rIrDB','find','bwXQj','lqKkb','FILE','toString','size','NwdLN','miniapp','aoecz','gif','copyFile','set','dice','then','NUkuS','markdown','hWSVy','height','https://www.bilibili.com/','2560671ZUMQtc','YCQcL','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','rps','752040NvnfHe','RPS','fKmYq','NaNlw','PTT','pic','cHtdq','ptt','uWlgq','sysface','dirname','replace','文件异常，大小为0','reply','time','9hAnDoh','iYoXR','AniStickerType','sep','width','YaASp','AniStickerId','unlink','mp4','Thumb','cCevc','string','VIDEO','uploadFile','5499042xhyKVb','stat','mFMRI','REPLY','end','video','get','[商城表情]','PIC','szgXB','724548nFytot','join','taHhZ','QSid','获取视频信息失败','1074980TDvoay','MFACE','7LFxhPx','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','catch','AniStickerPackId','mface','screenshots','stringify'];_0x5d14=function(){return _0x3a20c2;};return _0x5d14();}import _0x4ed488 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x2e101e from'./face_config.json';function _0x66e7(_0x2ea2d4,_0x35671f){const _0x5d146e=_0x5d14();return _0x66e7=function(_0x66e7c,_0x2f6b3f){_0x66e7c=_0x66e7c-0x193;let _0x15a725=_0x5d146e[_0x66e7c];return _0x15a725;},_0x66e7(_0x2ea2d4,_0x35671f);}import*as _0x3bbb48 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x30de49(0x1e2)](_0xd1cc07){const _0x4bef83=_0x30de49;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0xd1cc07,'atType':AtType[_0x4bef83(0x1df)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x1e8257,_0x12bef8,_0x3ded7f,_0x3f960f){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x3f960f,'atType':_0x3ded7f,'atUid':_0x1e8257,'atTinyId':'','atNtUid':_0x12bef8}};}static[_0x30de49(0x1b3)](_0x500151,_0x1820bc,_0x221cdc,_0x3af677){const _0x4c8dcc=_0x30de49;return{'elementType':ElementType[_0x4c8dcc(0x1c6)],'elementId':'','replyElement':{'replayMsgSeq':_0x500151,'replayMsgId':_0x1820bc,'senderUin':_0x221cdc,'senderUinStr':_0x3af677}};}static async[_0x30de49(0x1ab)](_0x549a50,_0x478953='',_0x3a0b7c=0x0){const _0x3b465a=_0x30de49,_0x8fca02={'FtcUY':function(_0x46399e,_0x351e65){return _0x46399e===_0x351e65;},'mFMRI':function(_0x463340,_0x4795f1){return _0x463340(_0x4795f1);}},{md5:_0x37632c,fileName:_0x4dbbd6,path:_0x215e18,fileSize:_0x2fd491}=await NTQQFileApi['uploadFile'](_0x549a50,ElementType['PIC'],_0x3a0b7c);if(_0x8fca02[_0x3b465a(0x1e6)](_0x2fd491,0x0))throw _0x3b465a(0x1b2);const _0x5babde=await NTQQFileApi[_0x3b465a(0x1f0)](_0x549a50),_0xc4d936={'md5HexStr':_0x37632c,'fileSize':_0x2fd491[_0x3b465a(0x193)](),'picWidth':_0x5babde?.[_0x3b465a(0x1b9)],'picHeight':_0x5babde?.[_0x3b465a(0x1a0)],'fileName':_0x4dbbd6,'sourcePath':_0x215e18,'original':!![],'picType':_0x8fca02[_0x3b465a(0x1c5)](isGIF,_0x549a50)?PicType[_0x3b465a(0x198)]:PicType[_0x3b465a(0x1dc)],'picSubType':_0x3a0b7c,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x478953};return{'elementType':ElementType[_0x3b465a(0x1cb)],'elementId':'','picElement':_0xc4d936};}static async['file'](_0xbee274,_0x30a1d8='',_0x26b11f=''){const _0x157914=_0x30de49,_0x57ddc1={'fdpiM':_0x157914(0x1b2),'aoecz':function(_0x5ddc6f,_0x189943){return _0x5ddc6f||_0x189943;}},{md5:_0x1d784a,fileName:_0x13f5e6,path:_0x2e377a,fileSize:_0x3c7e3f}=await NTQQFileApi[_0x157914(0x1c2)](_0xbee274,ElementType[_0x157914(0x1f6)]);if(_0x3c7e3f===0x0)throw _0x57ddc1['fdpiM'];const _0x3a6b88={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x57ddc1[_0x157914(0x197)](_0x30a1d8,_0x13f5e6),'folderId':_0x26b11f,'filePath':_0x2e377a,'fileSize':_0x3c7e3f[_0x157914(0x193)]()}};return _0x3a6b88;}static async[_0x30de49(0x1c8)](_0x39f2bd,_0x4df934='',_0x114421=''){const _0x2f8dc2=_0x30de49,_0x2de0b4={'iYoXR':function(_0x39714d,_0x4c5551,_0x29bf93){return _0x39714d(_0x4c5551,_0x29bf93);},'RYLPW':_0x2f8dc2(0x1e0),'fKmYq':function(_0x1082f3,_0x4de464){return _0x1082f3(_0x4de464);},'hWSVy':function(_0x39a7bc,_0x5cbf22){return _0x39a7bc(_0x5cbf22);},'hMbpP':_0x2f8dc2(0x1c7),'YAEQr':function(_0x2a944e,_0x252523){return _0x2a944e+_0x252523;},'YCQcL':function(_0x11f041,_0x2d7103){return _0x11f041+_0x2d7103;},'NUkuS':function(_0x38917d,_0x555c21){return _0x38917d===_0x555c21;},'cHtdq':_0x2f8dc2(0x1b2),'FFwSq':_0x2f8dc2(0x1bd),'rIrDB':function(_0x53b82b,_0x33c8a4){return _0x53b82b(_0x33c8a4);},'NaNlw':function(_0x2bec3c,_0x157e0a){return _0x2bec3c||_0x157e0a;}},{fileName:_0x566d2c,path:_0x2af651,fileSize:_0x54241e,md5:_0x2d4b30}=await NTQQFileApi['uploadFile'](_0x39f2bd,ElementType['VIDEO']);if(_0x2de0b4[_0x2f8dc2(0x19d)](_0x54241e,0x0))throw _0x2de0b4[_0x2f8dc2(0x1ac)];let _0xd96bed=_0x2af651[_0x2f8dc2(0x1b1)](_0x3bbb48[_0x2f8dc2(0x1b8)]+'Ori'+_0x3bbb48[_0x2f8dc2(0x1b8)],_0x3bbb48[_0x2f8dc2(0x1b8)]+_0x2f8dc2(0x1be)+_0x3bbb48[_0x2f8dc2(0x1b8)]);_0xd96bed=_0x3bbb48[_0x2f8dc2(0x1b0)](_0xd96bed);let _0x33153a={'width':0x780,'height':0x438,'time':0xf,'format':_0x2de0b4[_0x2f8dc2(0x1e8)],'size':_0x54241e,'filePath':_0x39f2bd};try{_0x33153a=await _0x2de0b4[_0x2f8dc2(0x1a8)](getVideoInfo,_0x2af651);}catch(_0x19b036){_0x2de0b4[_0x2f8dc2(0x1b6)](logError,_0x2f8dc2(0x1d1),_0x19b036);}const _0x4ded3f=new Promise((_0x8a6909,_0x86d34e)=>{const _0x198537=_0x2f8dc2,_0x3dc384={'uWlgq':function(_0x4ad835,_0x37583e,_0x1117ce){const _0x42af05=_0x66e7;return _0x2de0b4[_0x42af05(0x1b6)](_0x4ad835,_0x37583e,_0x1117ce);},'szgXB':_0x2de0b4['RYLPW'],'JZxVI':function(_0x350fb4,_0x509bec){return _0x2de0b4['fKmYq'](_0x350fb4,_0x509bec);}},_0xf59e40=_0x2d4b30+'_0.png',_0x815cb4=_0x3bbb48[_0x198537(0x1ce)](_0xd96bed,_0xf59e40);_0x2de0b4[_0x198537(0x19f)](_0x4ed488,_0x39f2bd)['on'](_0x2de0b4['hMbpP'],()=>{})['on'](_0x198537(0x1ea),_0x4b65a2=>{const _0x1f928f=_0x198537,_0x5e54b={'yIqEn':function(_0x230977,_0x4ac22f){return _0x230977(_0x4ac22f);}};_0x3dc384[_0x1f928f(0x1ae)](logDebug,_0x3dc384[_0x1f928f(0x1cc)],_0x4b65a2),_0x114421?_0x37c6c9[_0x1f928f(0x199)](_0x114421,_0x815cb4)['then'](()=>{const _0xe3ea14=_0x1f928f;_0x5e54b[_0xe3ea14(0x1db)](_0x8a6909,_0x815cb4);})[_0x1f928f(0x1d6)](_0x86d34e):_0x37c6c9[_0x1f928f(0x1e3)](_0x815cb4,defaultVideoThumb)['then'](()=>{const _0x4786ac=_0x1f928f;_0x5e54b[_0x4786ac(0x1db)](_0x8a6909,_0x815cb4);})[_0x1f928f(0x1d6)](_0x86d34e);})[_0x198537(0x1d9)]({'timestamps':[0x0],'filename':_0xf59e40,'folder':_0xd96bed,'size':_0x2de0b4['YAEQr'](_0x2de0b4[_0x198537(0x1a3)](_0x33153a[_0x198537(0x1b9)],'x'),_0x33153a[_0x198537(0x1a0)])})['on'](_0x2de0b4['hMbpP'],()=>{const _0x42219f=_0x198537;_0x3dc384[_0x42219f(0x1f1)](_0x8a6909,_0x815cb4);});}),_0xaa87d9=new Map(),_0x42dc22=await _0x4ded3f,_0x4b3370=(await _0x37c6c9[_0x2f8dc2(0x1c4)](_0x42dc22))[_0x2f8dc2(0x194)];_0xaa87d9[_0x2f8dc2(0x19a)](0x0,_0x42dc22);const _0x35280e=await _0x2de0b4[_0x2f8dc2(0x1f2)](calculateFileMD5,_0x42dc22),_0x45137c={'elementType':ElementType[_0x2f8dc2(0x1c1)],'elementId':'','videoElement':{'fileName':_0x2de0b4[_0x2f8dc2(0x1a9)](_0x4df934,_0x566d2c),'filePath':_0x2af651,'videoMd5':_0x2d4b30,'thumbMd5':_0x35280e,'fileTime':_0x33153a[_0x2f8dc2(0x1b4)],'thumbPath':_0xaa87d9,'thumbSize':_0x4b3370,'thumbWidth':_0x33153a[_0x2f8dc2(0x1b9)],'thumbHeight':_0x33153a[_0x2f8dc2(0x1a0)],'fileSize':_0x2de0b4['YAEQr']('',_0x54241e)}};return _0x45137c;}static async[_0x30de49(0x1ad)](_0x30dcc0){const _0x524542=_0x30de49,_0x503bba={'GKDEH':function(_0x568e68,_0x289f3e){return _0x568e68(_0x289f3e);},'UjjnA':_0x524542(0x1e4),'cCevc':function(_0x1b6d8b,_0x5434e6){return _0x1b6d8b===_0x5434e6;},'Iwnuf':_0x524542(0x1b2),'YaASp':function(_0x2a01f6,_0x48f017){return _0x2a01f6||_0x48f017;}},{converted:_0x2ad401,path:_0x13a7c8,duration:_0x26e15e}=await _0x503bba['GKDEH'](encodeSilk,_0x30dcc0);if(!_0x13a7c8)throw _0x503bba['UjjnA'];const {md5:_0x908956,fileName:_0x7808c7,path:_0x42ca3,fileSize:_0x147640}=await NTQQFileApi[_0x524542(0x1c2)](_0x13a7c8,ElementType[_0x524542(0x1aa)]);if(_0x503bba[_0x524542(0x1bf)](_0x147640,0x0))throw _0x503bba['Iwnuf'];return _0x2ad401&&_0x37c6c9[_0x524542(0x1bc)](_0x13a7c8)[_0x524542(0x19c)](),{'elementType':ElementType[_0x524542(0x1aa)],'elementId':'','pttElement':{'fileName':_0x7808c7,'filePath':_0x42ca3,'md5HexStr':_0x908956,'fileSize':_0x147640,'duration':_0x503bba[_0x524542(0x1ba)](_0x26e15e,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x30de49(0x1ee)](_0x3abc9b){const _0x46ae6b=_0x30de49,_0x3c379d={'taHhZ':function(_0x12043b,_0xe27a81){return _0x12043b>=_0xe27a81;}},_0x586119=_0x2e101e[_0x46ae6b(0x1af)],_0x1a164e=_0x2e101e['emoji'],_0x17f035=_0x586119[_0x46ae6b(0x1f3)](_0x99f5b4=>_0x99f5b4[_0x46ae6b(0x1d0)]===_0x3abc9b[_0x46ae6b(0x193)]());_0x3abc9b=parseInt(_0x3abc9b[_0x46ae6b(0x193)]());let _0x3f7bf6=0x1;return _0x3c379d[_0x46ae6b(0x1cf)](_0x3abc9b,0xde)&&(_0x3f7bf6=0x2),_0x17f035[_0x46ae6b(0x1b7)]&&(_0x3f7bf6=0x3),{'elementType':ElementType[_0x46ae6b(0x1e9)],'elementId':'','faceElement':{'faceIndex':_0x3abc9b,'faceType':_0x3f7bf6,'faceText':_0x17f035[_0x46ae6b(0x1dd)],'stickerId':_0x17f035[_0x46ae6b(0x1bb)],'stickerType':_0x17f035[_0x46ae6b(0x1b7)],'packId':_0x17f035[_0x46ae6b(0x1d7)],'sourceType':0x1}};}static[_0x30de49(0x1d8)](_0x5aa559,_0x2c92b3,_0x499631,_0x4d0841){const _0x2f81a8=_0x30de49;return{'elementType':ElementType[_0x2f81a8(0x1d3)],'marketFaceElement':{'emojiPackageId':_0x5aa559,'emojiId':_0x2c92b3,'key':_0x499631,'faceName':_0x4d0841||mFaceCache[_0x2f81a8(0x1c9)](_0x2c92b3)||_0x2f81a8(0x1ca)}};}static['dice'](_0x266782){const _0x2da0ea=_0x30de49,_0x5e503e={'lqKkb':_0x2da0ea(0x1ed)};return{'elementType':ElementType[_0x2da0ea(0x1e9)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x2da0ea(0x19b)],'faceType':FaceType[_0x2da0ea(0x19b)],'faceText':_0x5e503e[_0x2da0ea(0x1f5)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x30de49(0x1a5)](_0x997409){const _0x2a9290=_0x30de49,_0x302604={'KPvHP':_0x2a9290(0x1ec)};return{'elementType':ElementType[_0x2a9290(0x1e9)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x2a9290(0x1a7)],'faceText':_0x302604['KPvHP'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x30de49(0x1e7)](_0x48ec96){const _0x124c06=_0x30de49,_0x338cbe={'NwdLN':_0x124c06(0x1c0)};return typeof _0x48ec96!==_0x338cbe[_0x124c06(0x195)]&&(_0x48ec96=JSON[_0x124c06(0x1da)](_0x48ec96)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x48ec96,'linkInfo':null,'subElementType':null}};}static[_0x30de49(0x19e)](_0x2adad3){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x2adad3}};}static async[_0x30de49(0x196)](){const _0x5f25d2=_0x30de49,_0x5a9ce5={'URPEF':_0x5f25d2(0x1a4),'TutXM':_0x5f25d2(0x1a1),'bwXQj':_0x5f25d2(0x1de),'hXCuM':_0x5f25d2(0x1d5)};let _0x131b0d=await SignMiniApp({'prompt':'Bot\x20Test','title':_0x5f25d2(0x1de),'preview':_0x5a9ce5['URPEF'],'jumpUrl':_0x5a9ce5['TutXM'],'tag':_0x5a9ce5[_0x5f25d2(0x1f4)],'tagIcon':_0x5a9ce5['hXCuM'],'source':_0x5a9ce5['bwXQj'],'sourcelogo':_0x5a9ce5['hXCuM']});return{'elementType':ElementType[_0x5f25d2(0x1ef)],'elementId':'','arkElement':{'bytesData':_0x131b0d,'linkInfo':null,'subElementType':null}};}}