const _0x564699=_0x2b21;(function(_0x3cfff5,_0x29ec99){const _0x517f26=_0x2b21,_0x324111=_0x3cfff5();while(!![]){try{const _0x3ed328=parseInt(_0x517f26(0xf7))/0x1*(parseInt(_0x517f26(0xbc))/0x2)+parseInt(_0x517f26(0xcd))/0x3*(-parseInt(_0x517f26(0xe2))/0x4)+-parseInt(_0x517f26(0xbb))/0x5*(-parseInt(_0x517f26(0xb8))/0x6)+parseInt(_0x517f26(0xbf))/0x7+parseInt(_0x517f26(0xb2))/0x8+parseInt(_0x517f26(0xb5))/0x9*(-parseInt(_0x517f26(0xeb))/0xa)+-parseInt(_0x517f26(0xed))/0xb;if(_0x3ed328===_0x29ec99)break;else _0x324111['push'](_0x324111['shift']());}catch(_0x2095de){_0x324111['push'](_0x324111['shift']());}}}(_0x4875,0x93f3c));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x33d3b0}from'node:fs';import _0x451c9b from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x4875(){const _0x5a3677=['33256HzhUhQ','QxSLB','sysface','join','REPLY','dice','https://www.bilibili.com/','get','toString','491280DzcxnU','rps','13438601jSadVF','gwiCd','Bot\x20Test','video','IpReZ','文件异常，大小为0','unlink','MFACE','VIDEO','DsiOj','26963ceGzJE','xlzvs','mp4','sep','[商城表情]','FACE','getImageSize','CsKtN','AniStickerType','stat','IeZZZ','TEXT','screenshots','JMgWo','Ori','nCZYL','mface','KkJGa','RVYgS','copyFile','vkUTc','writeFile','uploadFile','5505288EGmSUZ','eZNlI','siYpR','9QVQLlA','find','set','3389784lzxaDo','PTT','qDnXy','5DOKTeF','38fZJLcq','AniStickerId','YUNJt','5959485srgHZU','swLeN','size','Thumb','width','[骰子]','ljzUb','catch','ARK','RvDUw','markdown','auaFE','reply','height','267BYhjAs','[包剪锤]','uGTbC','获取视频信息失败','stringify','QSid','file','QDes','fjgwx','PIC','then','notAt','ieDhB','end','FILE','XLars','CXXGr','time','_0.png','MdUxB','SToyb'];_0x4875=function(){return _0x5a3677;};return _0x4875();}import{encodeSilk}from'@/common/utils/audio';import _0x2dda2b from'./face_config.json';import*as _0x5f10df from'node:path';function _0x2b21(_0x2932e4,_0x8c5fec){const _0x4875d0=_0x4875();return _0x2b21=function(_0x2b21fa,_0x4e6935){_0x2b21fa=_0x2b21fa-0xa1;let _0x307215=_0x4875d0[_0x2b21fa];return _0x307215;},_0x2b21(_0x2932e4,_0x8c5fec);}import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x4a12a8){const _0x29b43d=_0x2b21;return{'elementType':ElementType[_0x29b43d(0xa6)],'elementId':'','textElement':{'content':_0x4a12a8,'atType':AtType[_0x29b43d(0xd8)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x19215d,_0x562c51,_0x50582d,_0x85cbd4){const _0xd875e9=_0x2b21;return{'elementType':ElementType[_0xd875e9(0xa6)],'elementId':'','textElement':{'content':'@'+_0x85cbd4,'atType':_0x50582d,'atUid':_0x19215d,'atTinyId':'','atNtUid':_0x562c51}};}static[_0x564699(0xcb)](_0x130bd4,_0x441d75,_0x4c6527,_0x5428a7){const _0x503096=_0x564699;return{'elementType':ElementType[_0x503096(0xe6)],'elementId':'','replyElement':{'replayMsgSeq':_0x130bd4,'replayMsgId':_0x441d75,'senderUin':_0x4c6527,'senderUinStr':_0x5428a7}};}static async['pic'](_0x2e3ffa,_0x25ed2b='',_0x592db6=0x0){const _0x1ba1a5=_0x564699,_0x4f9143={'OaCPf':function(_0x15f5f4,_0xd7c51b){return _0x15f5f4===_0xd7c51b;},'LYwWV':_0x1ba1a5(0xf2),'ljzUb':function(_0x556c94,_0x5e36f8){return _0x556c94(_0x5e36f8);}},{md5:_0x37d3fa,fileName:_0x432806,path:_0x381e29,fileSize:_0x97151f}=await NTQQFileApi['uploadFile'](_0x2e3ffa,ElementType[_0x1ba1a5(0xd6)],_0x592db6);if(_0x4f9143['OaCPf'](_0x97151f,0x0))throw _0x4f9143['LYwWV'];const _0x4d1191=await NTQQFileApi[_0x1ba1a5(0xa1)](_0x2e3ffa),_0x500f16={'md5HexStr':_0x37d3fa,'fileSize':_0x97151f[_0x1ba1a5(0xea)](),'picWidth':_0x4d1191?.['width'],'picHeight':_0x4d1191?.[_0x1ba1a5(0xcc)],'fileName':_0x432806,'sourcePath':_0x381e29,'original':!![],'picType':_0x4f9143[_0x1ba1a5(0xc5)](isGIF,_0x2e3ffa)?PicType['gif']:PicType['jpg'],'picSubType':_0x592db6,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x25ed2b};return{'elementType':ElementType[_0x1ba1a5(0xd6)],'elementId':'','picElement':_0x500f16};}static async[_0x564699(0xd3)](_0x2fb5be,_0xcd3407='',_0x2d629d=''){const _0x3c8510=_0x564699,_0x2d5afb={'RvDUw':function(_0x3bf917,_0x19964e){return _0x3bf917===_0x19964e;},'nCZYL':_0x3c8510(0xf2)},{md5:_0x334124,fileName:_0x112938,path:_0x2be26d,fileSize:_0x2386bc}=await NTQQFileApi[_0x3c8510(0xb1)](_0x2fb5be,ElementType[_0x3c8510(0xdb)]);if(_0x2d5afb[_0x3c8510(0xc8)](_0x2386bc,0x0))throw _0x2d5afb[_0x3c8510(0xaa)];const _0x291d8e={'elementType':ElementType[_0x3c8510(0xdb)],'elementId':'','fileElement':{'fileName':_0xcd3407||_0x112938,'folderId':_0x2d629d,'filePath':_0x2be26d,'fileSize':_0x2386bc[_0x3c8510(0xea)]()}};return _0x291d8e;}static async[_0x564699(0xf0)](_0x2424cf,_0x2ce855='',_0xd7be7e=''){const _0x3e84a2=_0x564699,_0x28adeb={'KkJGa':function(_0x2486a5,_0x4ee37f,_0x1bafc2){return _0x2486a5(_0x4ee37f,_0x1bafc2);},'YUNJt':'获取视频封面失败，使用默认封面','SToyb':function(_0x394a89,_0xabc8a8){return _0x394a89(_0xabc8a8);},'DsiOj':function(_0x5b2216,_0x3aaa03){return _0x5b2216(_0x3aaa03);},'RVYgS':_0x3e84a2(0xda),'QxSLB':'error','auaFE':function(_0xa42763,_0x1bcd47){return _0xa42763+_0x1bcd47;},'xlzvs':function(_0x10598b,_0xe8f160){return _0x10598b+_0xe8f160;},'CXXGr':function(_0x428bba,_0x4718ed){return _0x428bba===_0x4718ed;},'ieDhB':_0x3e84a2(0xf2),'qDnXy':_0x3e84a2(0xf9),'MdUxB':_0x3e84a2(0xd0),'fjgwx':function(_0xa720c9,_0x3667b4){return _0xa720c9||_0x3667b4;}},{fileName:_0x2215a4,path:_0x1179c8,fileSize:_0x57ffe0,md5:_0x4c5aca}=await NTQQFileApi[_0x3e84a2(0xb1)](_0x2424cf,ElementType[_0x3e84a2(0xf5)]);if(_0x28adeb[_0x3e84a2(0xdd)](_0x57ffe0,0x0))throw _0x28adeb[_0x3e84a2(0xd9)];let _0x2ccd21=_0x1179c8['replace'](_0x5f10df[_0x3e84a2(0xfa)]+_0x3e84a2(0xa9)+_0x5f10df['sep'],_0x5f10df[_0x3e84a2(0xfa)]+_0x3e84a2(0xc2)+_0x5f10df[_0x3e84a2(0xfa)]);_0x2ccd21=_0x5f10df['dirname'](_0x2ccd21);let _0x4af69d={'width':0x780,'height':0x438,'time':0xf,'format':_0x28adeb[_0x3e84a2(0xba)],'size':_0x57ffe0,'filePath':_0x2424cf};try{_0x4af69d=await _0x28adeb['SToyb'](getVideoInfo,_0x1179c8);}catch(_0x11abbe){logError(_0x28adeb[_0x3e84a2(0xe0)],_0x11abbe);}const _0x5835e0=new Promise((_0x4ad6a4,_0x1c1a79)=>{const _0x52b7bf=_0x3e84a2,_0xa16db1={'IpReZ':function(_0x61eec4,_0x389248){const _0x4b3f16=_0x2b21;return _0x28adeb[_0x4b3f16(0xe1)](_0x61eec4,_0x389248);}},_0x11d9b9=_0x4c5aca+_0x52b7bf(0xdf),_0x38f66e=_0x5f10df[_0x52b7bf(0xe5)](_0x2ccd21,_0x11d9b9);_0x28adeb[_0x52b7bf(0xf6)](_0x451c9b,_0x2424cf)['on'](_0x28adeb['RVYgS'],()=>{})['on'](_0x28adeb[_0x52b7bf(0xe3)],_0x31d5af=>{const _0x4547a2=_0x52b7bf;_0x28adeb[_0x4547a2(0xac)](logDebug,_0x28adeb[_0x4547a2(0xbe)],_0x31d5af),_0xd7be7e?_0x33d3b0[_0x4547a2(0xae)](_0xd7be7e,_0x38f66e)[_0x4547a2(0xd7)](()=>{_0x4ad6a4(_0x38f66e);})[_0x4547a2(0xc6)](_0x1c1a79):_0x33d3b0[_0x4547a2(0xb0)](_0x38f66e,defaultVideoThumb)[_0x4547a2(0xd7)](()=>{const _0x48a782=_0x4547a2;_0xa16db1[_0x48a782(0xf1)](_0x4ad6a4,_0x38f66e);})['catch'](_0x1c1a79);})[_0x52b7bf(0xa7)]({'timestamps':[0x0],'filename':_0x11d9b9,'folder':_0x2ccd21,'size':_0x28adeb[_0x52b7bf(0xca)](_0x28adeb[_0x52b7bf(0xf8)](_0x4af69d[_0x52b7bf(0xc3)],'x'),_0x4af69d[_0x52b7bf(0xcc)])})['on'](_0x28adeb[_0x52b7bf(0xad)],()=>{const _0xbe4bfe=_0x52b7bf;_0xa16db1[_0xbe4bfe(0xf1)](_0x4ad6a4,_0x38f66e);});}),_0x2f058=new Map(),_0x4ea8ee=await _0x5835e0,_0x4524a2=(await _0x33d3b0[_0x3e84a2(0xa4)](_0x4ea8ee))[_0x3e84a2(0xc1)];_0x2f058[_0x3e84a2(0xb7)](0x0,_0x4ea8ee);const _0x598ce2=await _0x28adeb['DsiOj'](calculateFileMD5,_0x4ea8ee),_0x55b439={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x28adeb[_0x3e84a2(0xd5)](_0x2ce855,_0x2215a4),'filePath':_0x1179c8,'videoMd5':_0x4c5aca,'thumbMd5':_0x598ce2,'fileTime':_0x4af69d[_0x3e84a2(0xde)],'thumbPath':_0x2f058,'thumbSize':_0x4524a2,'thumbWidth':_0x4af69d[_0x3e84a2(0xc3)],'thumbHeight':_0x4af69d['height'],'fileSize':''+_0x57ffe0}};return _0x55b439;}static async['ptt'](_0x5c3a64){const _0x37ec37=_0x564699,_0x1f93b4={'QwIMY':'语音转换失败,\x20请检查语音文件是否正常','swLeN':'文件异常，大小为0','HzXhj':function(_0x51227c,_0x2f5712){return _0x51227c||_0x2f5712;}},{converted:_0x4ae360,path:_0x274321,duration:_0x587fdf}=await encodeSilk(_0x5c3a64);if(!_0x274321)throw _0x1f93b4['QwIMY'];const {md5:_0x5c2952,fileName:_0x2e69ba,path:_0x5cec94,fileSize:_0x3ea590}=await NTQQFileApi[_0x37ec37(0xb1)](_0x274321,ElementType[_0x37ec37(0xb9)]);if(_0x3ea590===0x0)throw _0x1f93b4[_0x37ec37(0xc0)];return _0x4ae360&&_0x33d3b0[_0x37ec37(0xf3)](_0x274321)[_0x37ec37(0xd7)](),{'elementType':ElementType[_0x37ec37(0xb9)],'elementId':'','pttElement':{'fileName':_0x2e69ba,'filePath':_0x5cec94,'md5HexStr':_0x5c2952,'fileSize':_0x3ea590,'duration':_0x1f93b4['HzXhj'](_0x587fdf,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x1e7545){const _0x3c4550=_0x564699,_0x57c8de={'UyNfG':function(_0x190626,_0x3caeb6){return _0x190626(_0x3caeb6);},'vkUTc':function(_0x586b4f,_0x3811f5){return _0x586b4f>=_0x3811f5;}},_0x20da3b=_0x2dda2b[_0x3c4550(0xe4)],_0x29462f=_0x2dda2b['emoji'],_0x53d56a=_0x20da3b[_0x3c4550(0xb6)](_0x39c194=>_0x39c194[_0x3c4550(0xd2)]===_0x1e7545[_0x3c4550(0xea)]());_0x1e7545=_0x57c8de['UyNfG'](parseInt,_0x1e7545[_0x3c4550(0xea)]());let _0x25dc1d=0x1;return _0x57c8de[_0x3c4550(0xaf)](_0x1e7545,0xde)&&(_0x25dc1d=0x2),_0x53d56a['AniStickerType']&&(_0x25dc1d=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x1e7545,'faceType':_0x25dc1d,'faceText':_0x53d56a[_0x3c4550(0xd4)],'stickerId':_0x53d56a[_0x3c4550(0xbd)],'stickerType':_0x53d56a[_0x3c4550(0xa3)],'packId':_0x53d56a['AniStickerPackId'],'sourceType':0x1}};}static[_0x564699(0xab)](_0x470b44,_0xdfb28e,_0x573d74,_0x1a2661){const _0x5c7fb1=_0x564699,_0x47213f={'CsKtN':_0x5c7fb1(0xfb)};return{'elementType':ElementType[_0x5c7fb1(0xf4)],'marketFaceElement':{'emojiPackageId':_0x470b44,'emojiId':_0xdfb28e,'key':_0x573d74,'faceName':_0x1a2661||mFaceCache[_0x5c7fb1(0xe9)](_0xdfb28e)||_0x47213f[_0x5c7fb1(0xa2)]}};}static[_0x564699(0xe7)](_0x4dbee9){const _0x3219b7=_0x564699,_0x4e91a2={'uGTbC':_0x3219b7(0xc4)};return{'elementType':ElementType[_0x3219b7(0xfc)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':_0x4e91a2[_0x3219b7(0xcf)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x564699(0xec)](_0x3928db){const _0x2212ee=_0x564699,_0x22d026={'DKRvs':_0x2212ee(0xce)};return{'elementType':ElementType[_0x2212ee(0xfc)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x22d026['DKRvs'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x471e5e){const _0x48e862=_0x564699,_0xbbf8d8={'JMgWo':function(_0xe3b699,_0x2aee1f){return _0xe3b699!==_0x2aee1f;},'SNOFX':'string'};return _0xbbf8d8[_0x48e862(0xa8)](typeof _0x471e5e,_0xbbf8d8['SNOFX'])&&(_0x471e5e=JSON[_0x48e862(0xd1)](_0x471e5e)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x471e5e,'linkInfo':null,'subElementType':null}};}static[_0x564699(0xc9)](_0x2bd819){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x2bd819}};}static async['miniapp'](){const _0x2b530a=_0x564699,_0x2ba076={'gwiCd':function(_0x14aa39,_0x231d7b){return _0x14aa39(_0x231d7b);},'IeZZZ':_0x2b530a(0xef),'XLars':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','eZNlI':_0x2b530a(0xe8),'siYpR':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0x4c7ffe=await _0x2ba076[_0x2b530a(0xee)](SignMiniApp,{'prompt':_0x2ba076[_0x2b530a(0xa5)],'title':_0x2ba076[_0x2b530a(0xa5)],'preview':_0x2ba076[_0x2b530a(0xdc)],'jumpUrl':_0x2ba076[_0x2b530a(0xb3)],'tag':_0x2ba076[_0x2b530a(0xa5)],'tagIcon':_0x2ba076['siYpR'],'source':_0x2ba076[_0x2b530a(0xa5)],'sourcelogo':_0x2ba076[_0x2b530a(0xb4)]});return{'elementType':ElementType[_0x2b530a(0xc7)],'elementId':'','arkElement':{'bytesData':_0x4c7ffe,'linkInfo':null,'subElementType':null}};}}