const _0x3fa4b5=_0x394b;(function(_0x437c48,_0x31f52d){const _0x20b7a9=_0x394b,_0x53a576=_0x437c48();while(!![]){try{const _0x2868ab=-parseInt(_0x20b7a9(0x1f5))/0x1*(-parseInt(_0x20b7a9(0x1f1))/0x2)+parseInt(_0x20b7a9(0x22f))/0x3*(parseInt(_0x20b7a9(0x236))/0x4)+-parseInt(_0x20b7a9(0x228))/0x5+-parseInt(_0x20b7a9(0x1dd))/0x6+parseInt(_0x20b7a9(0x200))/0x7+-parseInt(_0x20b7a9(0x1e3))/0x8*(parseInt(_0x20b7a9(0x20b))/0x9)+parseInt(_0x20b7a9(0x220))/0xa;if(_0x2868ab===_0x31f52d)break;else _0x53a576['push'](_0x53a576['shift']());}catch(_0x554e25){_0x53a576['push'](_0x53a576['shift']());}}}(_0x5c12,0xef68d));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x1d960e}from'node:fs';import _0x3f65a2 from'fluent-ffmpeg';function _0x5c12(){const _0x1040bc=['dice','yNwQz','6940692QtHOHq','MFACE','string','sep','Thumb','get','8888016MlcBYJ','set','QDes','Tsgqk','time','stat','KjZtS','then','PTT','RPS','width','end','file','hWeWW','84hsiGdL','GvCnd','AEPsu','[骰子]','37646GStzxx','screenshots','emoji','ptt','rps','AniStickerType','YOejT','ZGaUu','mLIqp','VIDEO','PzMOr','6805309ZgHKyq','catch','text','height','pic','jpg','https://www.bilibili.com/','CyKMv','QSid','TEXT','gif','9TqULby','Bot\x20Test','_0.png','sysface','dirname','Ori','获取视频信息失败','XdeZv','find','FMAUY','hHkvw','OwLMF','face','FACE','FILE','join','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','AniStickerPackId','PIC','miniapp','atouG','20147060zPqzeg','文件异常，大小为0','uploadFile','utfhs','uXLVX','bMMUI','ARK','mKeLK','7657725ZphMfc','ysbym','MARKDOWN','CcMku','video','mrRTV','AniStickerId','105gdahpC','size','EfuPD','hvTDV','iZLuV','mp4','markdown','24220TJDlYR','toString'];_0x5c12=function(){return _0x1040bc;};return _0x5c12();}import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';function _0x394b(_0x55035e,_0x4f0e79){const _0x5c1233=_0x5c12();return _0x394b=function(_0x394b39,_0x33cc11){_0x394b39=_0x394b39-0x1dc;let _0x2927b7=_0x5c1233[_0x394b39];return _0x2927b7;},_0x394b(_0x55035e,_0x4f0e79);}import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x5e2333 from'./face_config.json';import*as _0x4751ff from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x3fa4b5(0x202)](_0x586261){const _0x21292d=_0x3fa4b5;return{'elementType':ElementType[_0x21292d(0x209)],'elementId':'','textElement':{'content':_0x586261,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x42866e,_0xee56b0,_0x14adb0,_0x50a609){const _0x4f74e0=_0x3fa4b5;return{'elementType':ElementType[_0x4f74e0(0x209)],'elementId':'','textElement':{'content':'@'+_0x50a609,'atType':_0x14adb0,'atUid':_0x42866e,'atTinyId':'','atNtUid':_0xee56b0}};}static['reply'](_0x3957ab,_0x325397,_0x5357,_0x44b272){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x3957ab,'replayMsgId':_0x325397,'senderUin':_0x5357,'senderUinStr':_0x44b272}};}static async[_0x3fa4b5(0x204)](_0x275265,_0x304363='',_0x3e7448=0x0){const _0x194835=_0x3fa4b5,_0x4329db={'mrRTV':function(_0x2fd8cb,_0x3af0db){return _0x2fd8cb===_0x3af0db;},'qqisR':_0x194835(0x221),'PzMOr':function(_0x22e254,_0x1670ed){return _0x22e254(_0x1670ed);}},{md5:_0x2ba1e6,fileName:_0x58c414,path:_0x486f8f,fileSize:_0x299fb8}=await NTQQFileApi[_0x194835(0x222)](_0x275265,ElementType[_0x194835(0x21d)],_0x3e7448);if(_0x4329db[_0x194835(0x22d)](_0x299fb8,0x0))throw _0x4329db['qqisR'];const _0xa3af67=await NTQQFileApi['getImageSize'](_0x275265),_0xefa5e5={'md5HexStr':_0x2ba1e6,'fileSize':_0x299fb8['toString'](),'picWidth':_0xa3af67?.[_0x194835(0x1ed)],'picHeight':_0xa3af67?.['height'],'fileName':_0x58c414,'sourcePath':_0x486f8f,'original':!![],'picType':_0x4329db[_0x194835(0x1ff)](isGIF,_0x275265)?PicType[_0x194835(0x20a)]:PicType[_0x194835(0x205)],'picSubType':_0x3e7448,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x304363};return{'elementType':ElementType[_0x194835(0x21d)],'elementId':'','picElement':_0xefa5e5};}static async[_0x3fa4b5(0x1ef)](_0x3bdf53,_0x1485b8=''){const _0x3d5be2=_0x3fa4b5,_0x26f886={'KjZtS':function(_0x46cf35,_0x2ea299){return _0x46cf35||_0x2ea299;}},{md5:_0x557c35,fileName:_0x4aba5c,path:_0x4f4c3f,fileSize:_0x3e9ead}=await NTQQFileApi['uploadFile'](_0x3bdf53,ElementType[_0x3d5be2(0x219)]);if(_0x3e9ead===0x0)throw _0x3d5be2(0x221);const _0x53910d={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x26f886[_0x3d5be2(0x1e9)](_0x1485b8,_0x4aba5c),'filePath':_0x4f4c3f,'fileSize':_0x3e9ead[_0x3d5be2(0x237)]()}};return _0x53910d;}static async[_0x3fa4b5(0x22c)](_0x1c76e6,_0x4775e7='',_0x108697=''){const _0x140e97=_0x3fa4b5,_0x41b2f8={'ThDJD':function(_0x3ed110,_0x3a36bf,_0x453065){return _0x3ed110(_0x3a36bf,_0x453065);},'hWeWW':function(_0x345004,_0xc7931a){return _0x345004(_0xc7931a);},'ysbym':'error','tnArA':function(_0x14c0a7,_0x49f7c7){return _0x14c0a7+_0x49f7c7;},'yNwQz':_0x140e97(0x1ee),'hHkvw':function(_0x169149,_0x104f46){return _0x169149===_0x104f46;},'mKeLK':_0x140e97(0x221),'iZLuV':_0x140e97(0x211),'XdeZv':function(_0xfdac8c,_0x4bf3a6){return _0xfdac8c||_0x4bf3a6;},'hvTDV':function(_0x415c12,_0x59d447){return _0x415c12+_0x59d447;}},{fileName:_0x4bcfc9,path:_0x1ff252,fileSize:_0x57f557,md5:_0x31d8dc}=await NTQQFileApi[_0x140e97(0x222)](_0x1c76e6,ElementType['VIDEO']);if(_0x41b2f8[_0x140e97(0x215)](_0x57f557,0x0))throw _0x41b2f8[_0x140e97(0x227)];let _0x3e5819=_0x1ff252['replace'](_0x4751ff[_0x140e97(0x1e0)]+_0x140e97(0x210)+_0x4751ff[_0x140e97(0x1e0)],_0x4751ff[_0x140e97(0x1e0)]+_0x140e97(0x1e1)+_0x4751ff[_0x140e97(0x1e0)]);_0x3e5819=_0x4751ff[_0x140e97(0x20f)](_0x3e5819);let _0x3a0398={'width':0x780,'height':0x438,'time':0xf,'format':_0x140e97(0x234),'size':_0x57f557,'filePath':_0x1c76e6};try{_0x3a0398=await _0x41b2f8[_0x140e97(0x1f0)](getVideoInfo,_0x1ff252);}catch(_0x4fdb16){logError(_0x41b2f8[_0x140e97(0x233)],_0x4fdb16);}const _0x38bb8f=new Promise((_0x4205cb,_0xab9d09)=>{const _0x41fd0c=_0x140e97,_0x212d88=_0x31d8dc+_0x41fd0c(0x20d),_0x3238a4=_0x4751ff[_0x41fd0c(0x21a)](_0x3e5819,_0x212d88);_0x41b2f8[_0x41fd0c(0x1f0)](_0x3f65a2,_0x1c76e6)['on']('end',()=>{})['on'](_0x41b2f8[_0x41fd0c(0x229)],_0x3c8a3b=>{const _0x342ab7=_0x41fd0c,_0x1a50b2={'atouG':function(_0x1270ab,_0x1526d6){return _0x1270ab(_0x1526d6);}};_0x41b2f8['ThDJD'](logDebug,'获取视频封面失败，使用默认封面',_0x3c8a3b),_0x108697?_0x1d960e['copyFile'](_0x108697,_0x3238a4)['then'](()=>{const _0x224a72=_0x394b;_0x1a50b2[_0x224a72(0x21f)](_0x4205cb,_0x3238a4);})[_0x342ab7(0x201)](_0xab9d09):_0x1d960e['writeFile'](_0x3238a4,defaultVideoThumb)[_0x342ab7(0x1ea)](()=>{_0x4205cb(_0x3238a4);})[_0x342ab7(0x201)](_0xab9d09);})[_0x41fd0c(0x1f6)]({'timestamps':[0x0],'filename':_0x212d88,'folder':_0x3e5819,'size':_0x41b2f8['tnArA'](_0x3a0398[_0x41fd0c(0x1ed)],'x')+_0x3a0398[_0x41fd0c(0x203)]})['on'](_0x41b2f8[_0x41fd0c(0x1dc)],()=>{_0x4205cb(_0x3238a4);});}),_0x28fcf3=new Map(),_0x22bcfa=await _0x38bb8f,_0x5f307a=(await _0x1d960e[_0x140e97(0x1e8)](_0x22bcfa))[_0x140e97(0x230)];_0x28fcf3[_0x140e97(0x1e4)](0x0,_0x22bcfa);const _0x25c186=await _0x41b2f8['hWeWW'](calculateFileMD5,_0x22bcfa),_0x549c7e={'elementType':ElementType[_0x140e97(0x1fe)],'elementId':'','videoElement':{'fileName':_0x41b2f8[_0x140e97(0x212)](_0x4775e7,_0x4bcfc9),'filePath':_0x1ff252,'videoMd5':_0x31d8dc,'thumbMd5':_0x25c186,'fileTime':_0x3a0398[_0x140e97(0x1e7)],'thumbPath':_0x28fcf3,'thumbSize':_0x5f307a,'thumbWidth':_0x3a0398[_0x140e97(0x1ed)],'thumbHeight':_0x3a0398[_0x140e97(0x203)],'fileSize':_0x41b2f8[_0x140e97(0x232)]('',_0x57f557)}};return _0x549c7e;}static async[_0x3fa4b5(0x1f8)](_0x5a56ea){const _0x36e830=_0x3fa4b5,_0x844750={'ZGaUu':function(_0xa28195,_0x41780a){return _0xa28195(_0x41780a);},'OwLMF':'语音转换失败,\x20请检查语音文件是否正常','mLIqp':function(_0x2eb9f1,_0x3237f8){return _0x2eb9f1===_0x3237f8;},'CyKMv':_0x36e830(0x221),'uXLVX':function(_0x20955b,_0x37a763){return _0x20955b||_0x37a763;}},{converted:_0x75dbc1,path:_0x3a030d,duration:_0x19aaf6}=await _0x844750[_0x36e830(0x1fc)](encodeSilk,_0x5a56ea);if(!_0x3a030d)throw _0x844750[_0x36e830(0x216)];const {md5:_0x21f91c,fileName:_0x37f4e0,path:_0x5f57f6,fileSize:_0x30ab67}=await NTQQFileApi[_0x36e830(0x222)](_0x3a030d,ElementType[_0x36e830(0x1eb)]);if(_0x844750[_0x36e830(0x1fd)](_0x30ab67,0x0))throw _0x844750[_0x36e830(0x207)];return _0x75dbc1&&_0x1d960e['unlink'](_0x3a030d)[_0x36e830(0x1ea)](),{'elementType':ElementType[_0x36e830(0x1eb)],'elementId':'','pttElement':{'fileName':_0x37f4e0,'filePath':_0x5f57f6,'md5HexStr':_0x21f91c,'fileSize':_0x30ab67,'duration':_0x844750[_0x36e830(0x224)](_0x19aaf6,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x3fa4b5(0x217)](_0x5ba664){const _0x248592=_0x3fa4b5,_0x1af7a8={'EfuPD':function(_0x26ee70,_0x202a75){return _0x26ee70(_0x202a75);},'YOejT':function(_0x30e026,_0x18b5ad){return _0x30e026>=_0x18b5ad;}},_0x417bf7=_0x5e2333[_0x248592(0x20e)],_0x3a2518=_0x5e2333[_0x248592(0x1f7)],_0x462a39=_0x417bf7[_0x248592(0x213)](_0x50d7ff=>_0x50d7ff[_0x248592(0x208)]===_0x5ba664[_0x248592(0x237)]());_0x5ba664=_0x1af7a8[_0x248592(0x231)](parseInt,_0x5ba664['toString']());let _0xe2aea7=0x1;return _0x1af7a8[_0x248592(0x1fb)](_0x5ba664,0xde)&&(_0xe2aea7=0x2),_0x462a39[_0x248592(0x1fa)]&&(_0xe2aea7=0x3),{'elementType':ElementType[_0x248592(0x218)],'elementId':'','faceElement':{'faceIndex':_0x5ba664,'faceType':_0xe2aea7,'faceText':_0x462a39[_0x248592(0x1e5)],'stickerId':_0x462a39[_0x248592(0x22e)],'stickerType':_0x462a39[_0x248592(0x1fa)],'packId':_0x462a39[_0x248592(0x21c)],'sourceType':0x1}};}static['mface'](_0x41e1f2,_0x404388,_0xa87a2a,_0x26d6c1){const _0x4498df=_0x3fa4b5;return{'elementType':ElementType[_0x4498df(0x1de)],'marketFaceElement':{'emojiPackageId':_0x41e1f2,'emojiId':_0x404388,'key':_0xa87a2a,'faceName':_0x26d6c1||mFaceCache[_0x4498df(0x1e2)](_0x404388)||'[商城表情]'}};}static[_0x3fa4b5(0x238)](_0x5a9622){const _0x130885=_0x3fa4b5,_0x2c541f={'bMMUI':_0x130885(0x1f4)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x130885(0x238)],'faceType':FaceType[_0x130885(0x238)],'faceText':_0x2c541f[_0x130885(0x225)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3fa4b5(0x1f9)](_0x2ff702){const _0x176893=_0x3fa4b5,_0x56a7b1={'CcMku':'[包剪锤]'};return{'elementType':ElementType[_0x176893(0x218)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x176893(0x1ec)],'faceText':_0x56a7b1[_0x176893(0x22b)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x530129){const _0x2b0e60=_0x3fa4b5,_0xe098eb={'ZCJEJ':function(_0x4b4494,_0x5272de){return _0x4b4494!==_0x5272de;},'GvCnd':_0x2b0e60(0x1df)};return _0xe098eb['ZCJEJ'](typeof _0x530129,_0xe098eb[_0x2b0e60(0x1f2)])&&(_0x530129=JSON['stringify'](_0x530129)),{'elementType':ElementType[_0x2b0e60(0x226)],'elementId':'','arkElement':{'bytesData':_0x530129,'linkInfo':null,'subElementType':null}};}static[_0x3fa4b5(0x235)](_0x178fe9){const _0x2ce190=_0x3fa4b5;return{'elementType':ElementType[_0x2ce190(0x22a)],'elementId':'','markdownElement':{'content':_0x178fe9}};}static async[_0x3fa4b5(0x21e)](){const _0x3dd9fb=_0x3fa4b5,_0x4cbb6d={'FMAUY':function(_0x24a78f,_0x53345b){return _0x24a78f(_0x53345b);},'utfhs':_0x3dd9fb(0x206),'Tsgqk':_0x3dd9fb(0x20c),'AEPsu':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0x1ead9f=await _0x4cbb6d[_0x3dd9fb(0x214)](SignMiniApp,{'prompt':'Bot\x20Test','title':'Bot\x20Test','preview':_0x3dd9fb(0x21b),'jumpUrl':_0x4cbb6d[_0x3dd9fb(0x223)],'tag':_0x4cbb6d[_0x3dd9fb(0x1e6)],'tagIcon':_0x4cbb6d[_0x3dd9fb(0x1f3)],'source':_0x4cbb6d[_0x3dd9fb(0x1e6)],'sourcelogo':_0x4cbb6d[_0x3dd9fb(0x1f3)]});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x1ead9f,'linkInfo':null,'subElementType':null}};}}