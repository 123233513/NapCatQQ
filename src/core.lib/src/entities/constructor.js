const _0x29b812=_0x2bba;(function(_0x49b9e2,_0x13013b){const _0x4e922a=_0x2bba,_0x2932ab=_0x49b9e2();while(!![]){try{const _0x13221d=-parseInt(_0x4e922a(0x213))/0x1*(parseInt(_0x4e922a(0x22e))/0x2)+parseInt(_0x4e922a(0x221))/0x3*(parseInt(_0x4e922a(0x23c))/0x4)+parseInt(_0x4e922a(0x1f6))/0x5*(parseInt(_0x4e922a(0x1f5))/0x6)+-parseInt(_0x4e922a(0x220))/0x7*(parseInt(_0x4e922a(0x22d))/0x8)+-parseInt(_0x4e922a(0x225))/0x9+-parseInt(_0x4e922a(0x227))/0xa+-parseInt(_0x4e922a(0x23f))/0xb*(-parseInt(_0x4e922a(0x216))/0xc);if(_0x13221d===_0x13013b)break;else _0x2932ab['push'](_0x2932ab['shift']());}catch(_0x170b45){_0x2932ab['push'](_0x2932ab['shift']());}}}(_0x42dd,0x19bc1));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x2e7715}from'node:fs';function _0x42dd(){const _0x5798a8=['replace','IzDvQ','sysface','AniStickerId','2LsUgQY','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','QDes','12BMVIeC','Bot\x20Test','time','ARK','reply','unlink','thOKJ','miniapp','文件异常，大小为0','ptt','14zOzjam','230313xdrOqK','width','SvagZ','[包剪锤]','1500750IxjRyq','jpg','510040ALwmHj','oRAbt','catch','gkMEn','Ori','IwDps','206376wPHcfG','15182mvKcBj','xaKlV','AniStickerType','VIDEO','find','then','video','语音转换失败,\x20请检查语音文件是否正常','QSid','height','face','PTT','RPS','cqtJK','4GAJuBO','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','cuJfa','2297647WyRExa','screenshots','SxjWF','FIhtr','https://www.bilibili.com/','[商城表情]','MFACE','stat','uploadFile','Thumb','AniStickerPackId','TEXT','set','pfluQ','toString','writeFile','FILE','oMTVQ','end','32934HhIBAP','95DLJAzg','GwDzc','rps','MTqvM','FACE','mp4','error','GsEId','sep','RwcLc','text','yDngx','获取视频信息失败','FEfsK','KMhnW','PIC','XLrxw','markdown','VbHcm','file','size','ark','MARKDOWN','get','dice'];_0x42dd=function(){return _0x5798a8;};return _0x42dd();}function _0x2bba(_0x372693,_0x221025){const _0x42dd2c=_0x42dd();return _0x2bba=function(_0x2bba47,_0x575337){_0x2bba47=_0x2bba47-0x1ec;let _0x5742e6=_0x42dd2c[_0x2bba47];return _0x5742e6;},_0x2bba(_0x372693,_0x221025);}import _0x4d30f2 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0xdc8a5b from'./face_config.json';import*as _0x5cfedc from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x29b812(0x200)](_0x57fdf4){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x57fdf4,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x58ab5d,_0x40ecea,_0x9d588d,_0x17f72e){const _0x17d765=_0x29b812;return{'elementType':ElementType[_0x17d765(0x1ed)],'elementId':'','textElement':{'content':'@'+_0x17f72e,'atType':_0x9d588d,'atUid':_0x58ab5d,'atTinyId':'','atNtUid':_0x40ecea}};}static[_0x29b812(0x21a)](_0x48b8fa,_0x139028,_0x5e1341,_0x20c32b){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x48b8fa,'replayMsgId':_0x139028,'senderUin':_0x5e1341,'senderUinStr':_0x20c32b}};}static async['pic'](_0x5edee5,_0x59dd25='',_0x52cfec=0x0){const _0x58c1b7=_0x29b812,_0x43b403={'xaKlV':function(_0x531d70,_0x4407a3){return _0x531d70===_0x4407a3;}},{md5:_0x3cc2e7,fileName:_0x2b11de,path:_0x129220,fileSize:_0x3f7081}=await NTQQFileApi[_0x58c1b7(0x247)](_0x5edee5,ElementType[_0x58c1b7(0x205)],_0x52cfec);if(_0x43b403[_0x58c1b7(0x22f)](_0x3f7081,0x0))throw _0x58c1b7(0x21e);const _0x43c205=await NTQQFileApi['getImageSize'](_0x5edee5),_0x24e08a={'md5HexStr':_0x3cc2e7,'fileSize':_0x3f7081[_0x58c1b7(0x1f0)](),'picWidth':_0x43c205?.['width'],'picHeight':_0x43c205?.['height'],'fileName':_0x2b11de,'sourcePath':_0x129220,'original':!![],'picType':isGIF(_0x5edee5)?PicType['gif']:PicType[_0x58c1b7(0x226)],'picSubType':_0x52cfec,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x59dd25};return{'elementType':ElementType[_0x58c1b7(0x205)],'elementId':'','picElement':_0x24e08a};}static async[_0x29b812(0x209)](_0x4c4f66,_0xe9d930='',_0x4c4b24=''){const _0x5a01ed=_0x29b812,_0x532772={'IwDps':function(_0x12547f,_0x515bce){return _0x12547f||_0x515bce;}},{md5:_0x37ddcb,fileName:_0x5b23fd,path:_0x55d842,fileSize:_0x6bbb1d}=await NTQQFileApi[_0x5a01ed(0x247)](_0x4c4f66,ElementType[_0x5a01ed(0x1f2)]);if(_0x6bbb1d===0x0)throw _0x5a01ed(0x21e);const _0x1d983f={'elementType':ElementType[_0x5a01ed(0x1f2)],'elementId':'','fileElement':{'fileName':_0x532772[_0x5a01ed(0x22c)](_0xe9d930,_0x5b23fd),'folderId':_0x4c4b24,'filePath':_0x55d842,'fileSize':_0x6bbb1d[_0x5a01ed(0x1f0)]()}};return _0x1d983f;}static async[_0x29b812(0x234)](_0x4a1e7b,_0x3fdfe6='',_0x2ae14d=''){const _0x13dc2c=_0x29b812,_0x4644a6={'MTqvM':function(_0x5c61e0,_0x576a2c){return _0x5c61e0(_0x576a2c);},'yDngx':'获取视频封面失败，使用默认封面','SxjWF':_0x13dc2c(0x1f4),'pfluQ':_0x13dc2c(0x1fc),'KMhnW':function(_0x4d5fbf,_0x157b0a){return _0x4d5fbf+_0x157b0a;},'thOKJ':function(_0x21f925,_0x529505){return _0x21f925===_0x529505;},'cqtJK':_0x13dc2c(0x21e),'oMTVQ':function(_0x7b9a75,_0x801ef7,_0x17cefa){return _0x7b9a75(_0x801ef7,_0x17cefa);},'GsEId':_0x13dc2c(0x202),'gkMEn':function(_0x2e4f3a,_0x74c432){return _0x2e4f3a||_0x74c432;}},{fileName:_0x27e19d,path:_0x3a9137,fileSize:_0x54ffce,md5:_0x3f3359}=await NTQQFileApi[_0x13dc2c(0x247)](_0x4a1e7b,ElementType[_0x13dc2c(0x231)]);if(_0x4644a6[_0x13dc2c(0x21c)](_0x54ffce,0x0))throw _0x4644a6[_0x13dc2c(0x23b)];let _0x56a651=_0x3a9137[_0x13dc2c(0x20f)](_0x5cfedc[_0x13dc2c(0x1fe)]+_0x13dc2c(0x22b)+_0x5cfedc[_0x13dc2c(0x1fe)],_0x5cfedc['sep']+_0x13dc2c(0x248)+_0x5cfedc[_0x13dc2c(0x1fe)]);_0x56a651=_0x5cfedc['dirname'](_0x56a651);let _0x520297={'width':0x780,'height':0x438,'time':0xf,'format':_0x13dc2c(0x1fb),'size':_0x54ffce,'filePath':_0x4a1e7b};try{_0x520297=await getVideoInfo(_0x3a9137);}catch(_0xfea553){_0x4644a6[_0x13dc2c(0x1f3)](logError,_0x4644a6[_0x13dc2c(0x1fd)],_0xfea553);}const _0x3790de=new Promise((_0x17f971,_0x171a8d)=>{const _0x4d4a76=_0x13dc2c,_0x2e09fd={'FEfsK':function(_0x190abf,_0x2873f8){const _0x233096=_0x2bba;return _0x4644a6[_0x233096(0x1f9)](_0x190abf,_0x2873f8);},'fvVEP':function(_0x3f4f32,_0x2e1492,_0x51113a){return _0x3f4f32(_0x2e1492,_0x51113a);},'GwDzc':_0x4644a6[_0x4d4a76(0x201)]},_0x3240fb=_0x3f3359+'_0.png',_0x4259e7=_0x5cfedc['join'](_0x56a651,_0x3240fb);_0x4644a6['MTqvM'](_0x4d30f2,_0x4a1e7b)['on'](_0x4644a6[_0x4d4a76(0x241)],()=>{})['on'](_0x4644a6[_0x4d4a76(0x1ef)],_0x1a551a=>{const _0x2ed9c2=_0x4d4a76;_0x2e09fd['fvVEP'](logDebug,_0x2e09fd[_0x2ed9c2(0x1f7)],_0x1a551a),_0x2ae14d?_0x2e7715['copyFile'](_0x2ae14d,_0x4259e7)[_0x2ed9c2(0x233)](()=>{const _0x2f6d9d=_0x2ed9c2;_0x2e09fd[_0x2f6d9d(0x203)](_0x17f971,_0x4259e7);})['catch'](_0x171a8d):_0x2e7715[_0x2ed9c2(0x1f1)](_0x4259e7,defaultVideoThumb)[_0x2ed9c2(0x233)](()=>{_0x17f971(_0x4259e7);})[_0x2ed9c2(0x229)](_0x171a8d);})[_0x4d4a76(0x240)]({'timestamps':[0x0],'filename':_0x3240fb,'folder':_0x56a651,'size':_0x4644a6[_0x4d4a76(0x204)](_0x4644a6[_0x4d4a76(0x204)](_0x520297['width'],'x'),_0x520297[_0x4d4a76(0x237)])})['on'](_0x4644a6['SxjWF'],()=>{const _0x361a1a=_0x4d4a76;_0x2e09fd[_0x361a1a(0x203)](_0x17f971,_0x4259e7);});}),_0x237d25=new Map(),_0x5bdc19=await _0x3790de,_0x21adeb=(await _0x2e7715[_0x13dc2c(0x246)](_0x5bdc19))[_0x13dc2c(0x20a)];_0x237d25[_0x13dc2c(0x1ee)](0x0,_0x5bdc19);const _0x3bfa69=await _0x4644a6[_0x13dc2c(0x1f9)](calculateFileMD5,_0x5bdc19),_0x4b2b34={'elementType':ElementType[_0x13dc2c(0x231)],'elementId':'','videoElement':{'fileName':_0x4644a6[_0x13dc2c(0x22a)](_0x3fdfe6,_0x27e19d),'filePath':_0x3a9137,'videoMd5':_0x3f3359,'thumbMd5':_0x3bfa69,'fileTime':_0x520297[_0x13dc2c(0x218)],'thumbPath':_0x237d25,'thumbSize':_0x21adeb,'thumbWidth':_0x520297[_0x13dc2c(0x222)],'thumbHeight':_0x520297[_0x13dc2c(0x237)],'fileSize':_0x4644a6['KMhnW']('',_0x54ffce)}};return _0x4b2b34;}static async[_0x29b812(0x21f)](_0x1ea36c){const _0x26ff74=_0x29b812,_0x483611={'FIhtr':function(_0x34ca6a,_0x5513a7){return _0x34ca6a===_0x5513a7;},'FQGfB':function(_0x54de3f,_0x1cab52){return _0x54de3f||_0x1cab52;}},{converted:_0x43b450,path:_0x5ba745,duration:_0x55a8af}=await encodeSilk(_0x1ea36c);if(!_0x5ba745)throw _0x26ff74(0x235);const {md5:_0x2dd63c,fileName:_0xbf5cb9,path:_0x5c99e4,fileSize:_0x51a540}=await NTQQFileApi[_0x26ff74(0x247)](_0x5ba745,ElementType[_0x26ff74(0x239)]);if(_0x483611[_0x26ff74(0x242)](_0x51a540,0x0))throw _0x26ff74(0x21e);return _0x43b450&&_0x2e7715[_0x26ff74(0x21b)](_0x5ba745)['then'](),{'elementType':ElementType[_0x26ff74(0x239)],'elementId':'','pttElement':{'fileName':_0xbf5cb9,'filePath':_0x5c99e4,'md5HexStr':_0x2dd63c,'fileSize':_0x51a540,'duration':_0x483611['FQGfB'](_0x55a8af,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x29b812(0x238)](_0x154bba){const _0x5e06e2=_0x29b812,_0x5857d4={'NuQxC':function(_0x2cf605,_0x36d61b){return _0x2cf605>=_0x36d61b;}},_0x5399d0=_0xdc8a5b[_0x5e06e2(0x211)],_0x15b985=_0xdc8a5b['emoji'],_0x477ff1=_0x5399d0[_0x5e06e2(0x232)](_0x182467=>_0x182467[_0x5e06e2(0x236)]===_0x154bba[_0x5e06e2(0x1f0)]());_0x154bba=parseInt(_0x154bba[_0x5e06e2(0x1f0)]());let _0x97e9a7=0x1;return _0x5857d4['NuQxC'](_0x154bba,0xde)&&(_0x97e9a7=0x2),_0x477ff1[_0x5e06e2(0x230)]&&(_0x97e9a7=0x3),{'elementType':ElementType[_0x5e06e2(0x1fa)],'elementId':'','faceElement':{'faceIndex':_0x154bba,'faceType':_0x97e9a7,'faceText':_0x477ff1[_0x5e06e2(0x215)],'stickerId':_0x477ff1[_0x5e06e2(0x212)],'stickerType':_0x477ff1['AniStickerType'],'packId':_0x477ff1[_0x5e06e2(0x1ec)],'sourceType':0x1}};}static['mface'](_0x2577a,_0x57ee72,_0x5e09c8,_0x49f45e){const _0x2d4984=_0x29b812,_0x4fb378={'cuJfa':_0x2d4984(0x244)};return{'elementType':ElementType[_0x2d4984(0x245)],'marketFaceElement':{'emojiPackageId':_0x2577a,'emojiId':_0x57ee72,'key':_0x5e09c8,'faceName':_0x49f45e||mFaceCache[_0x2d4984(0x20d)](_0x57ee72)||_0x4fb378[_0x2d4984(0x23e)]}};}static[_0x29b812(0x20e)](_0x50b7c6){const _0x1bc2d1=_0x29b812,_0x3ccf5d={'oRAbt':'[骰子]'};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1bc2d1(0x20e)],'faceType':FaceType[_0x1bc2d1(0x20e)],'faceText':_0x3ccf5d[_0x1bc2d1(0x228)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x29b812(0x1f8)](_0x56b820){const _0x466079=_0x29b812,_0x4413cf={'MrnAP':_0x466079(0x224)};return{'elementType':ElementType[_0x466079(0x1fa)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x466079(0x23a)],'faceText':_0x4413cf['MrnAP'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x29b812(0x20b)](_0x535ec4){const _0x4400a2=_0x29b812,_0x5e82c8={'XLrxw':function(_0x2ae2b3,_0x18868a){return _0x2ae2b3!==_0x18868a;},'IzDvQ':'string'};return _0x5e82c8[_0x4400a2(0x206)](typeof _0x535ec4,_0x5e82c8[_0x4400a2(0x210)])&&(_0x535ec4=JSON['stringify'](_0x535ec4)),{'elementType':ElementType[_0x4400a2(0x219)],'elementId':'','arkElement':{'bytesData':_0x535ec4,'linkInfo':null,'subElementType':null}};}static[_0x29b812(0x207)](_0x47c06a){const _0x23c0cc=_0x29b812;return{'elementType':ElementType[_0x23c0cc(0x20c)],'elementId':'','markdownElement':{'content':_0x47c06a}};}static async[_0x29b812(0x21d)](){const _0x521258=_0x29b812,_0x3189f4={'SvagZ':function(_0x292335,_0x5b0b6d){return _0x292335(_0x5b0b6d);},'UJFlN':'Bot\x20Test','RwcLc':_0x521258(0x243),'VbHcm':_0x521258(0x214)};let _0x3d3e24=await _0x3189f4[_0x521258(0x223)](SignMiniApp,{'prompt':_0x3189f4['UJFlN'],'title':_0x521258(0x217),'preview':_0x521258(0x23d),'jumpUrl':_0x3189f4[_0x521258(0x1ff)],'tag':_0x3189f4['UJFlN'],'tagIcon':_0x3189f4[_0x521258(0x208)],'source':_0x3189f4['UJFlN'],'sourcelogo':_0x3189f4[_0x521258(0x208)]});return{'elementType':ElementType[_0x521258(0x219)],'elementId':'','arkElement':{'bytesData':_0x3d3e24,'linkInfo':null,'subElementType':null}};}}