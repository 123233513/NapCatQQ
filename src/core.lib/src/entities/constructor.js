const _0x43787c=_0x1651;(function(_0x41f7b6,_0x5386f4){const _0x12ebeb=_0x1651,_0x3c4738=_0x41f7b6();while(!![]){try{const _0xb6b28c=parseInt(_0x12ebeb(0x1e8))/0x1+-parseInt(_0x12ebeb(0x1f3))/0x2*(-parseInt(_0x12ebeb(0x204))/0x3)+-parseInt(_0x12ebeb(0x1f5))/0x4*(-parseInt(_0x12ebeb(0x210))/0x5)+parseInt(_0x12ebeb(0x1f4))/0x6+parseInt(_0x12ebeb(0x1e6))/0x7*(-parseInt(_0x12ebeb(0x225))/0x8)+-parseInt(_0x12ebeb(0x217))/0x9*(parseInt(_0x12ebeb(0x206))/0xa)+-parseInt(_0x12ebeb(0x20e))/0xb;if(_0xb6b28c===_0x5386f4)break;else _0x3c4738['push'](_0x3c4738['shift']());}catch(_0x52abba){_0x3c4738['push'](_0x3c4738['shift']());}}}(_0x23de,0x1a2ab));function _0x23de(){const _0x5eb24a=['16869PRuogd','catch','940090CfWiXr','text','文件异常，大小为0','uploadFile','aFZHT','gwavv','sep','error','2439459MIBeau','toString','10wVgvmu','REPLY','join','copyFile','pLmrL','markdown','cxwVr','9SwDJzP','width','RPS','height','VIDEO','Ori','zNCIG','FILE','rps','cENwr','dice','ptt','laYnh','ByYHn','167096AtLgzf','BsTzR','ExjDq','ark','FACE','tbYGX','string','fXwWC','视频信息','end','PTT','28opfqes','riYnX','17001mvPHGR','lxCun','wkMYm','XJnyJ','TEXT','jDZyE','path','normal2','file','jMlXi','Thumb','58BemWbV','919926tleAAx','346232DGsXQb','writeFile','ARK','stat','mp4','normal','PIC','PbEtN','jpg','[骰子]','gif','HGLiU','kpZUW','PrLdF','then'];_0x23de=function(){return _0x5eb24a;};return _0x23de();}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x3b99a9}from'node:fs';import _0x181cfc from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';function _0x1651(_0x5c7561,_0x34c55d){const _0x23de60=_0x23de();return _0x1651=function(_0x165191,_0x4d6a7d){_0x165191=_0x165191-0x1dd;let _0x2a36fe=_0x23de60[_0x165191];return _0x2a36fe;},_0x1651(_0x5c7561,_0x34c55d);}import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static[_0x43787c(0x207)](_0x525cfd){const _0x2da302=_0x43787c;return{'elementType':ElementType[_0x2da302(0x1ec)],'elementId':'','textElement':{'content':_0x525cfd,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x24776e,_0x5f43b7,_0xb11773,_0xeea5b6){const _0x2d9923=_0x43787c;return{'elementType':ElementType[_0x2d9923(0x1ec)],'elementId':'','textElement':{'content':'@'+_0xeea5b6,'atType':_0xb11773,'atUid':_0x24776e,'atTinyId':'','atNtUid':_0x5f43b7}};}static['reply'](_0x1435d9,_0x59e7ba,_0x1942a5,_0x586bfb){const _0xcfb700=_0x43787c;return{'elementType':ElementType[_0xcfb700(0x211)],'elementId':'','replyElement':{'replayMsgSeq':_0x1435d9,'replayMsgId':_0x59e7ba,'senderUin':_0x1942a5,'senderUinStr':_0x586bfb}};}static async['pic'](_0x187750,_0x10b417='',_0x1941f9=0x0){const _0x15dde0=_0x43787c,_0x379b65={'XJnyJ':function(_0x22e7f1,_0x1fa736){return _0x22e7f1===_0x1fa736;},'sMbfV':'文件异常，大小为0','pLmrL':function(_0x296a8f,_0x3b0496,_0x4203ad){return _0x296a8f(_0x3b0496,_0x4203ad);},'cENwr':'图片信息'},{md5:_0x492ed1,fileName:_0x20a3c3,path:_0x3f2602,fileSize:_0x4cdc0a}=await NTQQFileApi[_0x15dde0(0x209)](_0x187750,ElementType[_0x15dde0(0x1fb)],_0x1941f9);if(_0x379b65[_0x15dde0(0x1eb)](_0x4cdc0a,0x0))throw _0x379b65['sMbfV'];const _0x581fcd=await NTQQFileApi['getImageSize'](_0x187750),_0x51dc6b={'md5HexStr':_0x492ed1,'fileSize':_0x4cdc0a['toString'](),'picWidth':_0x581fcd?.[_0x15dde0(0x218)],'picHeight':_0x581fcd?.[_0x15dde0(0x21a)],'fileName':_0x20a3c3,'sourcePath':_0x3f2602,'original':!![],'picType':isGIF(_0x187750)?PicType[_0x15dde0(0x1ff)]:PicType[_0x15dde0(0x1fd)],'picSubType':_0x1941f9,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x10b417};return _0x379b65[_0x15dde0(0x214)](logDebug,_0x379b65[_0x15dde0(0x220)],_0x51dc6b),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x51dc6b};}static async[_0x43787c(0x1f0)](_0x2f67e7,_0x5ea593=''){const _0x2b96f7=_0x43787c,_0x4633d4={'gwavv':function(_0x2e8bdd,_0x216472){return _0x2e8bdd===_0x216472;},'BQEGP':_0x2b96f7(0x208),'jDZyE':function(_0x20a610,_0x395ecc){return _0x20a610||_0x395ecc;}},{md5:_0x2458f1,fileName:_0x3525f1,path:_0x1a3cdb,fileSize:_0x1f9634}=await NTQQFileApi[_0x2b96f7(0x209)](_0x2f67e7,ElementType[_0x2b96f7(0x21e)]);if(_0x4633d4[_0x2b96f7(0x20b)](_0x1f9634,0x0))throw _0x4633d4['BQEGP'];const _0x301686={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x4633d4[_0x2b96f7(0x1ed)](_0x5ea593,_0x3525f1),'filePath':_0x1a3cdb,'fileSize':_0x1f9634[_0x2b96f7(0x20f)]()}};return _0x301686;}static async['video'](_0x30a8f4,_0x56b453='',_0x245c11=''){const _0x571fd5=_0x43787c,_0x22f7b3={'wkMYm':function(_0x24be1d,_0x4f3b9e){return _0x24be1d(_0x4f3b9e);},'ByYHn':function(_0x31cbd5,_0x2bba93,_0x358707){return _0x31cbd5(_0x2bba93,_0x358707);},'ptTMs':_0x571fd5(0x20d),'kpZUW':'end','PbEtN':_0x571fd5(0x208),'fXwWC':_0x571fd5(0x1ee),'oaPUn':_0x571fd5(0x1f9),'UQPLg':function(_0x44d29e,_0x1f197c){return _0x44d29e(_0x1f197c);},'MEReq':function(_0x316cfd,_0x30c5eb,_0x393559){return _0x316cfd(_0x30c5eb,_0x393559);},'zNCIG':'获取视频信息失败','riYnX':function(_0x3ba8e3,_0x255f68){return _0x3ba8e3(_0x255f68);},'tbYGX':function(_0x5dfa86,_0xf30593){return _0x5dfa86+_0xf30593;}},{fileName:_0x387ba8,path:_0x3befa0,fileSize:_0x3c74ac,md5:_0x3c1479}=await NTQQFileApi[_0x571fd5(0x209)](_0x30a8f4,ElementType[_0x571fd5(0x21b)]);if(_0x3c74ac===0x0)throw _0x22f7b3[_0x571fd5(0x1fc)];const _0x53f0f5=_0x22f7b3[_0x571fd5(0x1ea)](require,_0x22f7b3[_0x571fd5(0x1e2)]);let _0xfdc1ed=_0x3befa0['replace'](_0x53f0f5[_0x571fd5(0x20c)]+_0x571fd5(0x21c)+_0x53f0f5[_0x571fd5(0x20c)],_0x53f0f5['sep']+_0x571fd5(0x1f2)+_0x53f0f5[_0x571fd5(0x20c)]);_0xfdc1ed=_0x53f0f5['dirname'](_0xfdc1ed);let _0x6ccaf1={'width':0x780,'height':0x438,'time':0xf,'format':_0x22f7b3['oaPUn'],'size':_0x3c74ac,'filePath':_0x30a8f4};try{_0x6ccaf1=await _0x22f7b3['UQPLg'](getVideoInfo,_0x3befa0),_0x22f7b3['ByYHn'](logDebug,_0x571fd5(0x1e3),_0x6ccaf1);}catch(_0x4842b6){_0x22f7b3['MEReq'](logError,_0x22f7b3[_0x571fd5(0x21d)],_0x4842b6);}const _0x5a479b=new Promise((_0x120e68,_0x290629)=>{const _0x5e06ff=_0x571fd5,_0x452dae=_0x3c1479+'_0.png',_0x2b36f4=_0x53f0f5[_0x5e06ff(0x212)](_0xfdc1ed,_0x452dae);_0x181cfc(_0x30a8f4)['on'](_0x5e06ff(0x1e4),()=>{})['on'](_0x22f7b3['ptTMs'],_0x2a8fe6=>{const _0x387e90=_0x5e06ff,_0x5abfba={'Hmjav':function(_0x2f05d2,_0x45a855){return _0x2f05d2(_0x45a855);},'PKfbF':function(_0x42d374,_0x2f85d7){return _0x22f7b3['wkMYm'](_0x42d374,_0x2f85d7);}};_0x22f7b3[_0x387e90(0x224)](logDebug,'获取视频封面失败，使用默认封面',_0x2a8fe6),_0x245c11?_0x3b99a9[_0x387e90(0x213)](_0x245c11,_0x2b36f4)[_0x387e90(0x203)](()=>{_0x5abfba['Hmjav'](_0x120e68,_0x2b36f4);})['catch'](_0x290629):_0x3b99a9[_0x387e90(0x1f6)](_0x2b36f4,defaultVideoThumb)['then'](()=>{_0x5abfba['PKfbF'](_0x120e68,_0x2b36f4);})[_0x387e90(0x205)](_0x290629);})['screenshots']({'timestamps':[0x0],'filename':_0x452dae,'folder':_0xfdc1ed,'size':_0x6ccaf1[_0x5e06ff(0x218)]+'x'+_0x6ccaf1[_0x5e06ff(0x21a)]})['on'](_0x22f7b3[_0x5e06ff(0x201)],()=>{_0x120e68(_0x2b36f4);});}),_0x513ecb=new Map(),_0x30eb3e=await _0x5a479b,_0x44da7d=(await _0x3b99a9[_0x571fd5(0x1f8)](_0x30eb3e))['size'];_0x513ecb['set'](0x0,_0x30eb3e);const _0x24ca5b=await _0x22f7b3[_0x571fd5(0x1e7)](calculateFileMD5,_0x30eb3e),_0x56842b={'elementType':ElementType[_0x571fd5(0x21b)],'elementId':'','videoElement':{'fileName':_0x56b453||_0x387ba8,'filePath':_0x3befa0,'videoMd5':_0x3c1479,'thumbMd5':_0x24ca5b,'fileTime':_0x6ccaf1['time'],'thumbPath':_0x513ecb,'thumbSize':_0x44da7d,'thumbWidth':_0x6ccaf1[_0x571fd5(0x218)],'thumbHeight':_0x6ccaf1['height'],'fileSize':_0x22f7b3[_0x571fd5(0x1e0)]('',_0x3c74ac)}};return _0x56842b;}static async[_0x43787c(0x222)](_0x3719b8){const _0x12f7f3=_0x43787c,_0x2dd12d={'PrLdF':function(_0x5383aa,_0x2f702c){return _0x5383aa(_0x2f702c);},'cxwVr':'语音转换失败,\x20请检查语音文件是否正常','lxCun':function(_0x309460,_0x499537){return _0x309460===_0x499537;},'jMlXi':_0x12f7f3(0x208),'laYnh':function(_0x23137e,_0x5dec20){return _0x23137e||_0x5dec20;}},{converted:_0x6fcd25,path:_0x4efd5d,duration:_0x1b7763}=await _0x2dd12d[_0x12f7f3(0x202)](encodeSilk,_0x3719b8);if(!_0x4efd5d)throw _0x2dd12d[_0x12f7f3(0x216)];const {md5:_0x4011ff,fileName:_0x5a8992,path:_0x272d6a,fileSize:_0x3843db}=await NTQQFileApi[_0x12f7f3(0x209)](_0x4efd5d,ElementType[_0x12f7f3(0x1e5)]);if(_0x2dd12d[_0x12f7f3(0x1e9)](_0x3843db,0x0))throw _0x2dd12d[_0x12f7f3(0x1f1)];return _0x6fcd25&&_0x3b99a9['unlink'](_0x4efd5d)['then'](),{'elementType':ElementType[_0x12f7f3(0x1e5)],'elementId':'','pttElement':{'fileName':_0x5a8992,'filePath':_0x272d6a,'md5HexStr':_0x4011ff,'fileSize':_0x3843db,'duration':_0x2dd12d[_0x12f7f3(0x223)](_0x1b7763,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x395b62){const _0x18d854=_0x43787c,_0x2e95be={'BsTzR':function(_0x3f2392,_0x4faaf0){return _0x3f2392<_0x4faaf0;}};return{'elementType':ElementType[_0x18d854(0x1df)],'elementId':'','faceElement':{'faceIndex':_0x395b62,'faceType':_0x2e95be[_0x18d854(0x226)](_0x395b62,0xde)?FaceType[_0x18d854(0x1fa)]:FaceType[_0x18d854(0x1ef)]}};}static[_0x43787c(0x221)](_0x56932e){const _0x28d4b4=_0x43787c,_0x58b66a={'ObVGj':_0x28d4b4(0x1fe)};return{'elementType':ElementType[_0x28d4b4(0x1df)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x28d4b4(0x221)],'faceType':FaceType[_0x28d4b4(0x221)],'faceText':_0x58b66a['ObVGj'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x43787c(0x21f)](_0x572f38){const _0x23a8df=_0x43787c,_0x371b23={'HGLiU':'[包剪锤]'};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x23a8df(0x219)],'faceText':_0x371b23[_0x23a8df(0x200)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x43787c(0x1de)](_0x57520e){const _0x31451b=_0x43787c,_0x3b0101={'aFZHT':function(_0x3d7f9f,_0x2f6550){return _0x3d7f9f!==_0x2f6550;},'ExjDq':_0x31451b(0x1e1)};return _0x3b0101[_0x31451b(0x20a)](typeof _0x57520e,_0x3b0101[_0x31451b(0x1dd)])&&(_0x57520e=JSON['stringify'](_0x57520e)),{'elementType':ElementType[_0x31451b(0x1f7)],'elementId':'','arkElement':{'bytesData':_0x57520e,'linkInfo':null,'subElementType':null}};}static[_0x43787c(0x215)](_0x1a88d3){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x1a88d3}};}}