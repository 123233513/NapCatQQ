const _0x5b59b2=_0x5147;(function(_0x11ee18,_0x16c5ac){const _0x22367a=_0x5147,_0x1536aa=_0x11ee18();while(!![]){try{const _0x15f636=parseInt(_0x22367a(0x1c5))/0x1*(parseInt(_0x22367a(0x1a9))/0x2)+-parseInt(_0x22367a(0x195))/0x3+-parseInt(_0x22367a(0x1d1))/0x4*(parseInt(_0x22367a(0x1c2))/0x5)+-parseInt(_0x22367a(0x182))/0x6*(-parseInt(_0x22367a(0x1ce))/0x7)+parseInt(_0x22367a(0x18b))/0x8+parseInt(_0x22367a(0x18e))/0x9+parseInt(_0x22367a(0x1c7))/0xa*(parseInt(_0x22367a(0x1a5))/0xb);if(_0x15f636===_0x16c5ac)break;else _0x1536aa['push'](_0x1536aa['shift']());}catch(_0x5a4ec8){_0x1536aa['push'](_0x1536aa['shift']());}}}(_0x5e20,0x3eb3a));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x2af7f4}from'node:fs';import _0x2ed6e2 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x5147(_0x376e51,_0xb7f5a9){const _0x5e209d=_0x5e20();return _0x5147=function(_0x514732,_0x3895bc){_0x514732=_0x514732-0x173;let _0x2888fb=_0x5e209d[_0x514732];return _0x2888fb;},_0x5147(_0x376e51,_0xb7f5a9);}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x5e20(){const _0x2cfa45=['222IlvsRy','text','screenshots','FFnzI','AniStickerType','iDDYA','catch','QlbzR','AniStickerId','1341784rBlMxV','DdonP','uploadFile','3158928wQWoUr','markdown','VIDEO','FDZHz','https://www.bilibili.com/','toString','notAt','1057182OwFZrN','dice','stat','emoji','fqtDK','string','TEXT','_0.png','[包剪锤]','mface','DIkJv','writeFile','FACE','UBeUe','ark','FILE','22SNTyqf','width','MlDMy','PlUdw','76060qOSBqC','face','QxIkl','rps','ARK','GHDiI','ptt','sep','REPLY','qWbIZ','JAmwy','join','aJUUB','NkoSk','jpg','file','XcgQk','WndpN','cJqZb','Ori','PIC','ramBn','YYaPB','获取视频信息失败','PTT','180gHzYrh','Bot\x20Test','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','4BMCuXw','error','1733140aTLIxA','文件异常，大小为0','height','MOcsq','NTAGX','HOnMw','pic','7035eFoLTS','语音转换失败,\x20请检查语音文件是否正常','find','49492KxCBVG','end','set','hcrqq','video','mwmxm','get','then','time','ofcOw','size','replace','unlink','stringify','RPS','aIiue','reply'];_0x5e20=function(){return _0x2cfa45;};return _0x5e20();}import _0x4e1ad3 from'./face_config.json';import*as _0x2dc826 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x5b59b2(0x183)](_0x2efced){const _0x50df93=_0x5b59b2;return{'elementType':ElementType[_0x50df93(0x19b)],'elementId':'','textElement':{'content':_0x2efced,'atType':AtType[_0x50df93(0x194)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x337f51,_0x5bb13d,_0x11e3f1,_0x203ae3){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x203ae3,'atType':_0x11e3f1,'atUid':_0x337f51,'atTinyId':'','atNtUid':_0x5bb13d}};}static[_0x5b59b2(0x181)](_0x5612d9,_0x4228ec,_0x1151bf,_0x501297){const _0xd730b7=_0x5b59b2;return{'elementType':ElementType[_0xd730b7(0x1b1)],'elementId':'','replyElement':{'replayMsgSeq':_0x5612d9,'replayMsgId':_0x4228ec,'senderUin':_0x1151bf,'senderUinStr':_0x501297}};}static async[_0x5b59b2(0x1cd)](_0x50155b,_0xf271f8='',_0x312e13=0x0){const _0x58e8cc=_0x5b59b2,_0xc83d8c={'mwmxm':function(_0x1ff380,_0x15b6ec){return _0x1ff380===_0x15b6ec;},'aIiue':_0x58e8cc(0x1c8)},{md5:_0x2e526b,fileName:_0x1087bc,path:_0x5aa414,fileSize:_0x1054e0}=await NTQQFileApi[_0x58e8cc(0x18d)](_0x50155b,ElementType[_0x58e8cc(0x1bd)],_0x312e13);if(_0xc83d8c[_0x58e8cc(0x176)](_0x1054e0,0x0))throw _0xc83d8c[_0x58e8cc(0x180)];const _0x54e60a=await NTQQFileApi['getImageSize'](_0x50155b),_0x1028b9={'md5HexStr':_0x2e526b,'fileSize':_0x1054e0[_0x58e8cc(0x193)](),'picWidth':_0x54e60a?.[_0x58e8cc(0x1a6)],'picHeight':_0x54e60a?.['height'],'fileName':_0x1087bc,'sourcePath':_0x5aa414,'original':!![],'picType':isGIF(_0x50155b)?PicType['gif']:PicType[_0x58e8cc(0x1b7)],'picSubType':_0x312e13,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0xf271f8};return{'elementType':ElementType[_0x58e8cc(0x1bd)],'elementId':'','picElement':_0x1028b9};}static async[_0x5b59b2(0x1b8)](_0x29a200,_0x52a64c='',_0x321679=''){const _0x519a2d=_0x5b59b2,_0x27a8f6={'lSBxZ':function(_0x2c6349,_0x320b7d){return _0x2c6349===_0x320b7d;},'PlUdw':_0x519a2d(0x1c8),'DdonP':function(_0x43de7c,_0x24be37){return _0x43de7c||_0x24be37;}},{md5:_0x1fc292,fileName:_0x317a44,path:_0x39e337,fileSize:_0x35bc27}=await NTQQFileApi[_0x519a2d(0x18d)](_0x29a200,ElementType[_0x519a2d(0x1a4)]);if(_0x27a8f6['lSBxZ'](_0x35bc27,0x0))throw _0x27a8f6[_0x519a2d(0x1a8)];const _0x4bca0f={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x27a8f6[_0x519a2d(0x18c)](_0x52a64c,_0x317a44),'folderId':_0x321679,'filePath':_0x39e337,'fileSize':_0x35bc27[_0x519a2d(0x193)]()}};return _0x4bca0f;}static async[_0x5b59b2(0x175)](_0x38126c,_0x56ebf0='',_0x40fc49=''){const _0x485ad7=_0x5b59b2,_0x4d30ab={'NkoSk':function(_0x20ccba,_0x46444a){return _0x20ccba(_0x46444a);},'NTAGX':function(_0x5cc2bd,_0x5cd58a){return _0x5cc2bd(_0x5cd58a);},'UBeUe':function(_0x421063,_0x49bc0c,_0x14e170){return _0x421063(_0x49bc0c,_0x14e170);},'qWbIZ':_0x485ad7(0x1d2),'wjPcF':_0x485ad7(0x1c6),'GHDiI':function(_0x196b83,_0x35f8e9){return _0x196b83+_0x35f8e9;},'iDDYA':function(_0x4c9a3a,_0x482140){return _0x4c9a3a===_0x482140;},'ypbZb':_0x485ad7(0x1c8),'KCBNy':'mp4','ExikU':_0x485ad7(0x1c0),'ofcOw':function(_0x829df0,_0x2938d0){return _0x829df0(_0x2938d0);},'QxIkl':function(_0x595796,_0x5899da){return _0x595796||_0x5899da;}},{fileName:_0x20b843,path:_0x329bdb,fileSize:_0x4a4d9e,md5:_0x14c730}=await NTQQFileApi[_0x485ad7(0x18d)](_0x38126c,ElementType[_0x485ad7(0x190)]);if(_0x4d30ab[_0x485ad7(0x187)](_0x4a4d9e,0x0))throw _0x4d30ab['ypbZb'];let _0xdad26a=_0x329bdb[_0x485ad7(0x17c)](_0x2dc826[_0x485ad7(0x1b0)]+_0x485ad7(0x1bc)+_0x2dc826[_0x485ad7(0x1b0)],_0x2dc826[_0x485ad7(0x1b0)]+'Thumb'+_0x2dc826['sep']);_0xdad26a=_0x2dc826['dirname'](_0xdad26a);let _0x2bc524={'width':0x780,'height':0x438,'time':0xf,'format':_0x4d30ab['KCBNy'],'size':_0x4a4d9e,'filePath':_0x38126c};try{_0x2bc524=await getVideoInfo(_0x329bdb);}catch(_0x395c7e){_0x4d30ab[_0x485ad7(0x1a2)](logError,_0x4d30ab['ExikU'],_0x395c7e);}const _0x46c45f=new Promise((_0x2af7ea,_0x25a0e7)=>{const _0x48b867=_0x485ad7,_0x5b5811={'ramBn':function(_0x85dd90,_0x152eaa){const _0x417ebe=_0x5147;return _0x4d30ab[_0x417ebe(0x1cb)](_0x85dd90,_0x152eaa);},'hcrqq':function(_0x1f850f,_0x105b28,_0x2a01dd){return _0x4d30ab['UBeUe'](_0x1f850f,_0x105b28,_0x2a01dd);},'WndpN':'获取视频封面失败，使用默认封面'},_0x15f564=_0x14c730+_0x48b867(0x19c),_0x50de04=_0x2dc826[_0x48b867(0x1b4)](_0xdad26a,_0x15f564);_0x4d30ab['NTAGX'](_0x2ed6e2,_0x38126c)['on'](_0x4d30ab['qWbIZ'],()=>{})['on'](_0x4d30ab['wjPcF'],_0x200e1d=>{const _0x4d22e5=_0x48b867,_0x3826f8={'QlbzR':function(_0x28b0dd,_0x5455e2){return _0x28b0dd(_0x5455e2);}};_0x5b5811[_0x4d22e5(0x174)](logDebug,_0x5b5811[_0x4d22e5(0x1ba)],_0x200e1d),_0x40fc49?_0x2af7f4['copyFile'](_0x40fc49,_0x50de04)[_0x4d22e5(0x178)](()=>{const _0x21f230=_0x4d22e5;_0x5b5811[_0x21f230(0x1be)](_0x2af7ea,_0x50de04);})[_0x4d22e5(0x188)](_0x25a0e7):_0x2af7f4[_0x4d22e5(0x1a0)](_0x50de04,defaultVideoThumb)['then'](()=>{const _0x143fae=_0x4d22e5;_0x3826f8[_0x143fae(0x189)](_0x2af7ea,_0x50de04);})[_0x4d22e5(0x188)](_0x25a0e7);})[_0x48b867(0x184)]({'timestamps':[0x0],'filename':_0x15f564,'folder':_0xdad26a,'size':_0x4d30ab[_0x48b867(0x1ae)](_0x2bc524['width'],'x')+_0x2bc524['height']})['on'](_0x4d30ab[_0x48b867(0x1b2)],()=>{const _0x139b1f=_0x48b867;_0x4d30ab[_0x139b1f(0x1b6)](_0x2af7ea,_0x50de04);});}),_0x21b38d=new Map(),_0x9ad027=await _0x46c45f,_0x5c736c=(await _0x2af7f4[_0x485ad7(0x197)](_0x9ad027))[_0x485ad7(0x17b)];_0x21b38d[_0x485ad7(0x173)](0x0,_0x9ad027);const _0x3865bb=await _0x4d30ab[_0x485ad7(0x17a)](calculateFileMD5,_0x9ad027),_0x20d3dd={'elementType':ElementType[_0x485ad7(0x190)],'elementId':'','videoElement':{'fileName':_0x4d30ab[_0x485ad7(0x1ab)](_0x56ebf0,_0x20b843),'filePath':_0x329bdb,'videoMd5':_0x14c730,'thumbMd5':_0x3865bb,'fileTime':_0x2bc524[_0x485ad7(0x179)],'thumbPath':_0x21b38d,'thumbSize':_0x5c736c,'thumbWidth':_0x2bc524[_0x485ad7(0x1a6)],'thumbHeight':_0x2bc524[_0x485ad7(0x1c9)],'fileSize':_0x4d30ab[_0x485ad7(0x1ae)]('',_0x4a4d9e)}};return _0x20d3dd;}static async[_0x5b59b2(0x1af)](_0x56a066){const _0x1ac0bd=_0x5b59b2,_0x51094e={'YYaPB':function(_0x2ec28d,_0x584011){return _0x2ec28d(_0x584011);},'MlDMy':_0x1ac0bd(0x1cf),'FDZHz':function(_0x550d3e,_0x57bc48){return _0x550d3e===_0x57bc48;},'DIkJv':'文件异常，大小为0'},{converted:_0x159ca9,path:_0x4df105,duration:_0x3a7a4f}=await _0x51094e[_0x1ac0bd(0x1bf)](encodeSilk,_0x56a066);if(!_0x4df105)throw _0x51094e[_0x1ac0bd(0x1a7)];const {md5:_0x4b9bfa,fileName:_0x2f6d71,path:_0x2f7ded,fileSize:_0x367e3e}=await NTQQFileApi[_0x1ac0bd(0x18d)](_0x4df105,ElementType[_0x1ac0bd(0x1c1)]);if(_0x51094e[_0x1ac0bd(0x191)](_0x367e3e,0x0))throw _0x51094e[_0x1ac0bd(0x19f)];return _0x159ca9&&_0x2af7f4[_0x1ac0bd(0x17d)](_0x4df105)[_0x1ac0bd(0x178)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x2f6d71,'filePath':_0x2f7ded,'md5HexStr':_0x4b9bfa,'fileSize':_0x367e3e,'duration':_0x3a7a4f||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x5b59b2(0x1aa)](_0x1e67b2){const _0x1ee9cc=_0x5b59b2,_0x35cc7a={'XcgQk':function(_0xa4b2f5,_0x265df4){return _0xa4b2f5(_0x265df4);}},_0x178dbe=_0x4e1ad3['sysface'],_0x13daa3=_0x4e1ad3[_0x1ee9cc(0x198)],_0xa9f15=_0x178dbe[_0x1ee9cc(0x1d0)](_0x22cdf9=>_0x22cdf9['QSid']===_0x1e67b2[_0x1ee9cc(0x193)]());_0x1e67b2=_0x35cc7a[_0x1ee9cc(0x1b9)](parseInt,_0x1e67b2['toString']());let _0x1e45a6=0x1;return _0x1e67b2>=0xde&&(_0x1e45a6=0x2),_0xa9f15[_0x1ee9cc(0x186)]&&(_0x1e45a6=0x3),{'elementType':ElementType[_0x1ee9cc(0x1a1)],'elementId':'','faceElement':{'faceIndex':_0x1e67b2,'faceType':_0x1e45a6,'faceText':_0xa9f15['QDes'],'stickerId':_0xa9f15[_0x1ee9cc(0x18a)],'stickerType':_0xa9f15[_0x1ee9cc(0x186)],'packId':_0xa9f15['AniStickerPackId'],'sourceType':0x1}};}static[_0x5b59b2(0x19e)](_0x4c9d26,_0x5249b4,_0x5d37ba,_0x3483b0){const _0x2b98a7=_0x5b59b2,_0x1a4745={'cJqZb':'[商城表情]'};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x4c9d26,'emojiId':_0x5249b4,'key':_0x5d37ba,'faceName':_0x3483b0||mFaceCache[_0x2b98a7(0x177)](_0x5249b4)||_0x1a4745[_0x2b98a7(0x1bb)]}};}static[_0x5b59b2(0x196)](_0x46edf1){const _0x55c2c8=_0x5b59b2,_0x49e225={'aJUUB':'[骰子]'};return{'elementType':ElementType[_0x55c2c8(0x1a1)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x55c2c8(0x196)],'faceType':FaceType[_0x55c2c8(0x196)],'faceText':_0x49e225[_0x55c2c8(0x1b5)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5b59b2(0x1ac)](_0x2165c8){const _0x11fe9a=_0x5b59b2,_0x23ad4d={'jaNGF':_0x11fe9a(0x19d)};return{'elementType':ElementType[_0x11fe9a(0x1a1)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x11fe9a(0x17f)],'faceText':_0x23ad4d['jaNGF'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5b59b2(0x1a3)](_0x3da107){const _0x2b2150=_0x5b59b2,_0x4dc432={'hqWWA':function(_0x4ed626,_0x567075){return _0x4ed626!==_0x567075;}};return _0x4dc432['hqWWA'](typeof _0x3da107,_0x2b2150(0x19a))&&(_0x3da107=JSON[_0x2b2150(0x17e)](_0x3da107)),{'elementType':ElementType[_0x2b2150(0x1ad)],'elementId':'','arkElement':{'bytesData':_0x3da107,'linkInfo':null,'subElementType':null}};}static[_0x5b59b2(0x18f)](_0xe14f2){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0xe14f2}};}static async['miniapp'](){const _0x14e5b8=_0x5b59b2,_0x2f7b32={'JAmwy':function(_0x47bfa0,_0x414f51){return _0x47bfa0(_0x414f51);},'HOnMw':'Bot\x20Test','fqtDK':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','MOcsq':_0x14e5b8(0x192),'FFnzI':_0x14e5b8(0x1c4)};let _0x44b9a4=await _0x2f7b32[_0x14e5b8(0x1b3)](SignMiniApp,{'prompt':_0x2f7b32[_0x14e5b8(0x1cc)],'title':_0x2f7b32[_0x14e5b8(0x1cc)],'preview':_0x2f7b32[_0x14e5b8(0x199)],'jumpUrl':_0x2f7b32[_0x14e5b8(0x1ca)],'tag':_0x2f7b32['HOnMw'],'tagIcon':_0x2f7b32['FFnzI'],'source':_0x14e5b8(0x1c3),'sourcelogo':_0x2f7b32[_0x14e5b8(0x185)]});return{'elementType':ElementType[_0x14e5b8(0x1ad)],'elementId':'','arkElement':{'bytesData':_0x44b9a4,'linkInfo':null,'subElementType':null}};}}