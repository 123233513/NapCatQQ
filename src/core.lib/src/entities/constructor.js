const _0x2151c7=_0x4445;(function(_0x2b27f8,_0x20ae54){const _0x1df64c=_0x4445,_0x335c92=_0x2b27f8();while(!![]){try{const _0xea9956=-parseInt(_0x1df64c(0xb7))/0x1*(parseInt(_0x1df64c(0xa5))/0x2)+-parseInt(_0x1df64c(0xda))/0x3*(-parseInt(_0x1df64c(0xd4))/0x4)+parseInt(_0x1df64c(0xe2))/0x5*(-parseInt(_0x1df64c(0xd3))/0x6)+-parseInt(_0x1df64c(0xbd))/0x7+-parseInt(_0x1df64c(0xba))/0x8*(parseInt(_0x1df64c(0xe9))/0x9)+-parseInt(_0x1df64c(0xd5))/0xa+parseInt(_0x1df64c(0xa2))/0xb;if(_0xea9956===_0x20ae54)break;else _0x335c92['push'](_0x335c92['shift']());}catch(_0x454bd2){_0x335c92['push'](_0x335c92['shift']());}}}(_0x21c9,0x92d0a));function _0x4445(_0x3b7dcb,_0x266c17){const _0x21c9cb=_0x21c9();return _0x4445=function(_0x44455d,_0x496185){_0x44455d=_0x44455d-0xa1;let _0x24cf70=_0x21c9cb[_0x44455d];return _0x24cf70;},_0x4445(_0x3b7dcb,_0x266c17);}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x3837aa}from'node:fs';import _0x215996 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';function _0x21c9(){const _0xf31ac=['uqVzR','iUYng','stringify','VIDEO','60635GAbMOp','dice','face','pic','AglfC','文件异常，大小为0','[骰子]','4194zpmGdM','writeFile','error','mface','uJwwR','TrCwO','IFQJk','UxgRv','NwHLf','mp4','CnQvk','viPmG','toString','获取视频信息失败','DesZU','39535166VXpZoN','语音转换失败,\x20请检查语音文件是否正常','图片信息','60908daFTsG','path','screenshots','bzwDc','notAt','EVUrE','xazsm','ptt','text','dirname','replace','FACE','GPNdt','normal','[商城表情]','etFpY','PTT','Ori','1LBAzRZ','video','height','14264TITlvb','pRIja','then','5875254fZDucU','time','unlink','uulxR','file','reply','string','ark','获取视频封面失败，使用默认封面','FILE','dEMfs','getImageSize','catch','sep','TEXT','uploadFile','rps','视频信息','width','quQtL','ARK','end','402CtyLZl','262916dGIaNZ','6110470wqYhpV','gxShc','size','VDIPV','qXzxU','6iRZCKN','set','[包剪锤]','ZQXnp'];_0x21c9=function(){return _0xf31ac;};return _0x21c9();}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x2151c7(0xad)](_0x132f5b){const _0x5bd5dc=_0x2151c7;return{'elementType':ElementType[_0x5bd5dc(0xcb)],'elementId':'','textElement':{'content':_0x132f5b,'atType':AtType[_0x5bd5dc(0xa9)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x19a66a,_0x16429f,_0x2dbccd,_0x2c28f3){const _0xd5a9f=_0x2151c7;return{'elementType':ElementType[_0xd5a9f(0xcb)],'elementId':'','textElement':{'content':'@'+_0x2c28f3,'atType':_0x2dbccd,'atUid':_0x19a66a,'atTinyId':'','atNtUid':_0x16429f}};}static[_0x2151c7(0xc2)](_0x4670e1,_0x28459d,_0x37f2ee,_0x1ce38d){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x4670e1,'replayMsgId':_0x28459d,'senderUin':_0x37f2ee,'senderUinStr':_0x1ce38d}};}static async[_0x2151c7(0xe5)](_0x3b56ec,_0x598523='',_0x5a3c06=0x0){const _0x121ab6=_0x2151c7,_0x157af1={'etFpY':function(_0x37886e,_0x32d633){return _0x37886e===_0x32d633;},'iUYng':'文件异常，大小为0','IFQJk':function(_0x291d47,_0x33dd05){return _0x291d47(_0x33dd05);},'quQtL':function(_0x3975b3,_0x1799f7,_0x38682f){return _0x3975b3(_0x1799f7,_0x38682f);},'zDXUr':_0x121ab6(0xa4)},{md5:_0x44bcdb,fileName:_0x354ae8,path:_0x3cbbad,fileSize:_0x11416f}=await NTQQFileApi[_0x121ab6(0xcc)](_0x3b56ec,ElementType['PIC'],_0x5a3c06);if(_0x157af1[_0x121ab6(0xb4)](_0x11416f,0x0))throw _0x157af1[_0x121ab6(0xdf)];const _0x5ea6de=await NTQQFileApi[_0x121ab6(0xc8)](_0x3b56ec),_0x5b1c94={'md5HexStr':_0x44bcdb,'fileSize':_0x11416f[_0x121ab6(0xf5)](),'picWidth':_0x5ea6de?.[_0x121ab6(0xcf)],'picHeight':_0x5ea6de?.['height'],'fileName':_0x354ae8,'sourcePath':_0x3cbbad,'original':!![],'picType':_0x157af1[_0x121ab6(0xef)](isGIF,_0x3b56ec)?PicType['gif']:PicType['jpg'],'picSubType':_0x5a3c06,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x598523};return _0x157af1[_0x121ab6(0xd0)](logDebug,_0x157af1['zDXUr'],_0x5b1c94),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x5b1c94};}static async[_0x2151c7(0xc1)](_0x31980e,_0x47c924=''){const _0x4d0044=_0x2151c7,_0x14f7c9={'pRIja':'文件异常，大小为0'},{md5:_0x9df140,fileName:_0x1507ed,path:_0x5ee1e7,fileSize:_0x527f27}=await NTQQFileApi['uploadFile'](_0x31980e,ElementType[_0x4d0044(0xc6)]);if(_0x527f27===0x0)throw _0x14f7c9[_0x4d0044(0xbb)];const _0xec28d0={'elementType':ElementType[_0x4d0044(0xc6)],'elementId':'','fileElement':{'fileName':_0x47c924||_0x1507ed,'filePath':_0x5ee1e7,'fileSize':_0x527f27['toString']()}};return _0xec28d0;}static async[_0x2151c7(0xb8)](_0x92a40d,_0x49f7f8='',_0x4887ae=''){const _0x52662e=_0x2151c7,_0x94727d={'loGza':function(_0x439997,_0x52bd03){return _0x439997(_0x52bd03);},'dEMfs':function(_0x2e7c64,_0x5dee99,_0x4bee93){return _0x2e7c64(_0x5dee99,_0x4bee93);},'CnQvk':_0x52662e(0xc5),'hGUeQ':function(_0x2b3d72,_0x11f96d){return _0x2b3d72(_0x11f96d);},'uJwwR':_0x52662e(0xd2),'uqVzR':function(_0x59eee5,_0x4371a3){return _0x59eee5+_0x4371a3;},'TrCwO':function(_0xc83645,_0x112f10){return _0xc83645===_0x112f10;},'wYNGZ':_0x52662e(0xe7),'VDIPV':function(_0x140d11,_0x2c95e4){return _0x140d11(_0x2c95e4);},'gxShc':_0x52662e(0xa6),'UxgRv':_0x52662e(0xf2),'GPNdt':function(_0xcd187b,_0x5ee268,_0x176f2f){return _0xcd187b(_0x5ee268,_0x176f2f);},'DesZU':_0x52662e(0xce),'ZQXnp':_0x52662e(0xf6),'qXzxU':function(_0x36ca4f,_0x15f1c2){return _0x36ca4f||_0x15f1c2;}},{fileName:_0x3ab3ec,path:_0x2ade46,fileSize:_0x2d3996,md5:_0x4c6fe9}=await NTQQFileApi[_0x52662e(0xcc)](_0x92a40d,ElementType[_0x52662e(0xe1)]);if(_0x94727d[_0x52662e(0xee)](_0x2d3996,0x0))throw _0x94727d['wYNGZ'];const _0x246ee6=_0x94727d[_0x52662e(0xd8)](require,_0x94727d[_0x52662e(0xd6)]);let _0x76e449=_0x2ade46[_0x52662e(0xaf)](_0x246ee6[_0x52662e(0xca)]+_0x52662e(0xb6)+_0x246ee6[_0x52662e(0xca)],_0x246ee6[_0x52662e(0xca)]+'Thumb'+_0x246ee6[_0x52662e(0xca)]);_0x76e449=_0x246ee6[_0x52662e(0xae)](_0x76e449);let _0x16c07e={'width':0x780,'height':0x438,'time':0xf,'format':_0x94727d[_0x52662e(0xf0)],'size':_0x2d3996,'filePath':_0x92a40d};try{_0x16c07e=await getVideoInfo(_0x2ade46),_0x94727d[_0x52662e(0xb1)](logDebug,_0x94727d[_0x52662e(0xa1)],_0x16c07e);}catch(_0x17a4b0){logError(_0x94727d[_0x52662e(0xdd)],_0x17a4b0);}const _0xf0417e=new Promise((_0xc80297,_0x5046db)=>{const _0x145b95=_0x52662e,_0x5ebd7a={'EVUrE':function(_0x56c34c,_0x3c8506){return _0x94727d['loGza'](_0x56c34c,_0x3c8506);},'bzwDc':function(_0x4e27a8,_0x1a4969,_0x475868){const _0x5ab06e=_0x4445;return _0x94727d[_0x5ab06e(0xc7)](_0x4e27a8,_0x1a4969,_0x475868);},'AglfC':_0x94727d[_0x145b95(0xf3)]},_0xa56550=_0x4c6fe9+'_0.png',_0x35b14d=_0x246ee6['join'](_0x76e449,_0xa56550);_0x94727d['hGUeQ'](_0x215996,_0x92a40d)['on'](_0x94727d[_0x145b95(0xed)],()=>{})['on'](_0x145b95(0xeb),_0x13835b=>{const _0x45ad03=_0x145b95;_0x5ebd7a[_0x45ad03(0xa8)](logDebug,_0x5ebd7a[_0x45ad03(0xe6)],_0x13835b),_0x4887ae?_0x3837aa['copyFile'](_0x4887ae,_0x35b14d)['then'](()=>{const _0x3f3c34=_0x45ad03;_0x5ebd7a[_0x3f3c34(0xaa)](_0xc80297,_0x35b14d);})[_0x45ad03(0xc9)](_0x5046db):_0x3837aa[_0x45ad03(0xea)](_0x35b14d,defaultVideoThumb)[_0x45ad03(0xbc)](()=>{_0xc80297(_0x35b14d);})[_0x45ad03(0xc9)](_0x5046db);})[_0x145b95(0xa7)]({'timestamps':[0x0],'filename':_0xa56550,'folder':_0x76e449,'size':_0x94727d[_0x145b95(0xde)](_0x16c07e['width']+'x',_0x16c07e[_0x145b95(0xb9)])})['on'](_0x94727d[_0x145b95(0xed)],()=>{const _0x2faa55=_0x145b95;_0x5ebd7a[_0x2faa55(0xaa)](_0xc80297,_0x35b14d);});}),_0x58555c=new Map(),_0x1762bd=await _0xf0417e,_0x172d07=(await _0x3837aa['stat'](_0x1762bd))[_0x52662e(0xd7)];_0x58555c[_0x52662e(0xdb)](0x0,_0x1762bd);const _0x59993b=await calculateFileMD5(_0x1762bd),_0x3d8b88={'elementType':ElementType[_0x52662e(0xe1)],'elementId':'','videoElement':{'fileName':_0x94727d[_0x52662e(0xd9)](_0x49f7f8,_0x3ab3ec),'filePath':_0x2ade46,'videoMd5':_0x4c6fe9,'thumbMd5':_0x59993b,'fileTime':_0x16c07e[_0x52662e(0xbe)],'thumbPath':_0x58555c,'thumbSize':_0x172d07,'thumbWidth':_0x16c07e['width'],'thumbHeight':_0x16c07e[_0x52662e(0xb9)],'fileSize':''+_0x2d3996}};return _0x3d8b88;}static async[_0x2151c7(0xac)](_0x5d4586){const _0x54ab07=_0x2151c7,_0x50a420={'mVbPg':_0x54ab07(0xa3),'ZgjRi':_0x54ab07(0xe7)},{converted:_0xdb720f,path:_0x561b6d,duration:_0x4eed7a}=await encodeSilk(_0x5d4586);if(!_0x561b6d)throw _0x50a420['mVbPg'];const {md5:_0x2507d2,fileName:_0x53d7d2,path:_0x404aeb,fileSize:_0x2a48c8}=await NTQQFileApi[_0x54ab07(0xcc)](_0x561b6d,ElementType['PTT']);if(_0x2a48c8===0x0)throw _0x50a420['ZgjRi'];return _0xdb720f&&_0x3837aa[_0x54ab07(0xbf)](_0x561b6d)[_0x54ab07(0xbc)](),{'elementType':ElementType[_0x54ab07(0xb5)],'elementId':'','pttElement':{'fileName':_0x53d7d2,'filePath':_0x404aeb,'md5HexStr':_0x2507d2,'fileSize':_0x2a48c8,'duration':_0x4eed7a||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x2151c7(0xe4)](_0x58b571){const _0x301cba=_0x2151c7,_0x32d2e9={'NwHLf':function(_0x55ddb8,_0x13eafb){return _0x55ddb8<_0x13eafb;}};return{'elementType':ElementType[_0x301cba(0xb0)],'elementId':'','faceElement':{'faceIndex':_0x58b571,'faceType':_0x32d2e9[_0x301cba(0xf1)](_0x58b571,0xde)?FaceType[_0x301cba(0xb2)]:FaceType['normal2']}};}static[_0x2151c7(0xec)](_0x152124,_0xaa4048,_0x297ea0,_0x417518){const _0x4f1083=_0x2151c7,_0x367e61={'UAOoW':_0x4f1083(0xb3)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x152124,'emojiId':_0xaa4048,'key':_0x297ea0,'faceName':_0x417518||mFaceCache['get'](_0xaa4048)||_0x367e61['UAOoW']}};}static['dice'](_0x4b865d){const _0xe2ec27=_0x2151c7;return{'elementType':ElementType[_0xe2ec27(0xb0)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0xe2ec27(0xe3)],'faceType':FaceType['dice'],'faceText':_0xe2ec27(0xe8),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2151c7(0xcd)](_0x4c1382){const _0x510bb9=_0x2151c7,_0x32e6d0={'xazsm':_0x510bb9(0xdc)};return{'elementType':ElementType[_0x510bb9(0xb0)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x32e6d0[_0x510bb9(0xab)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2151c7(0xc4)](_0x27ee6d){const _0x210326=_0x2151c7,_0x476d71={'viPmG':function(_0x57720b,_0x13fd2d){return _0x57720b!==_0x13fd2d;},'uulxR':_0x210326(0xc3)};return _0x476d71[_0x210326(0xf4)](typeof _0x27ee6d,_0x476d71[_0x210326(0xc0)])&&(_0x27ee6d=JSON[_0x210326(0xe0)](_0x27ee6d)),{'elementType':ElementType[_0x210326(0xd1)],'elementId':'','arkElement':{'bytesData':_0x27ee6d,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x86ea89){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x86ea89}};}}