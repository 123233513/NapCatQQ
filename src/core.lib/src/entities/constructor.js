const _0x161809=_0x14c1;(function(_0x9ea8a2,_0x52e334){const _0x6fea95=_0x14c1,_0x48dc51=_0x9ea8a2();while(!![]){try{const _0x4c3d7c=-parseInt(_0x6fea95(0x162))/0x1+parseInt(_0x6fea95(0x14e))/0x2+parseInt(_0x6fea95(0x13b))/0x3+parseInt(_0x6fea95(0x125))/0x4*(-parseInt(_0x6fea95(0x131))/0x5)+-parseInt(_0x6fea95(0x163))/0x6*(-parseInt(_0x6fea95(0x145))/0x7)+parseInt(_0x6fea95(0x173))/0x8+-parseInt(_0x6fea95(0x11d))/0x9*(parseInt(_0x6fea95(0x123))/0xa);if(_0x4c3d7c===_0x52e334)break;else _0x48dc51['push'](_0x48dc51['shift']());}catch(_0x472587){_0x48dc51['push'](_0x48dc51['shift']());}}}(_0x2207,0xb6b75));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';function _0x2207(){const _0x4d2b66=['string','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','catch','uploadFile','21730jqfTXl','YtUSP','392404xKaLEc','syWDX','VIDEO','jVsao','notAt','dirname','获取视频信息失败','TEXT','miniapp','AniStickerPackId','ONcbC','dice','5eAzxad','FACE','jfIpd','sysface','replace','emoji','sep','jpg','_0.png','FILE','4471581sfXkHR','[包剪锤]','DOvsa','zYdiw','find','https://www.bilibili.com/','PAbAa','wEGek','svgYU','UXImF','7JUYZAk','MFACE','获取视频封面失败，使用默认封面','tWWnZ','set','[骰子]','RJxao','video','getImageSize','189284EpJmNh','QSid','UWkJQ','gif','iVKvY','ARK','GqCWl','HYwtI','Bot\x20Test','writeFile','face','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','PTT','Thumb','markdown','MARKDOWN','unlink','stat','PIC','KTjYI','900458fYtDqO','6797298BQFzTR','REPLY','AniStickerType','ptt','KBdUU','JIXaO','reply','mp4','then','hDwnd','copyFile','text','width','join','get','文件异常，大小为0','9267616pNUclf','NhjMr','toString','[商城表情]','QQnEP','pic','kudFj','stringify','QDes','height','8820stOeGK','size'];_0x2207=function(){return _0x4d2b66;};return _0x2207();}import{promises as _0x3b9366}from'node:fs';import _0x15e56d from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';function _0x14c1(_0x1062c9,_0x56decd){const _0x2207ad=_0x2207();return _0x14c1=function(_0x14c180,_0xfb54fe){_0x14c180=_0x14c180-0x119;let _0x38538d=_0x2207ad[_0x14c180];return _0x38538d;},_0x14c1(_0x1062c9,_0x56decd);}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0xb13331 from'./face_config.json';import*as _0x236c3e from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x161809(0x16e)](_0x5ce842){const _0x22f76c=_0x161809;return{'elementType':ElementType[_0x22f76c(0x12c)],'elementId':'','textElement':{'content':_0x5ce842,'atType':AtType[_0x22f76c(0x129)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x3cbcae,_0x54d88c,_0x1d4911,_0x217aeb){const _0x2b159b=_0x161809;return{'elementType':ElementType[_0x2b159b(0x12c)],'elementId':'','textElement':{'content':'@'+_0x217aeb,'atType':_0x1d4911,'atUid':_0x3cbcae,'atTinyId':'','atNtUid':_0x54d88c}};}static[_0x161809(0x169)](_0x3ef34f,_0x4f5bd7,_0x461577,_0x57c07f){const _0x8f3479=_0x161809;return{'elementType':ElementType[_0x8f3479(0x164)],'elementId':'','replyElement':{'replayMsgSeq':_0x3ef34f,'replayMsgId':_0x4f5bd7,'senderUin':_0x461577,'senderUinStr':_0x57c07f}};}static async[_0x161809(0x178)](_0x538dd5,_0x6d590c='',_0x2f56a5=0x0){const _0xe79668=_0x161809,_0x35042a={'kudFj':function(_0x36bdf9,_0x324418){return _0x36bdf9===_0x324418;},'YtUSP':_0xe79668(0x172),'gyYoS':function(_0x2792b8,_0x404f72){return _0x2792b8(_0x404f72);}},{md5:_0x5ed8d1,fileName:_0x2860d3,path:_0x113fd3,fileSize:_0x4089e5}=await NTQQFileApi[_0xe79668(0x122)](_0x538dd5,ElementType[_0xe79668(0x160)],_0x2f56a5);if(_0x35042a[_0xe79668(0x119)](_0x4089e5,0x0))throw _0x35042a[_0xe79668(0x124)];const _0x67c127=await NTQQFileApi[_0xe79668(0x14d)](_0x538dd5),_0x436ca9={'md5HexStr':_0x5ed8d1,'fileSize':_0x4089e5[_0xe79668(0x175)](),'picWidth':_0x67c127?.[_0xe79668(0x16f)],'picHeight':_0x67c127?.[_0xe79668(0x11c)],'fileName':_0x2860d3,'sourcePath':_0x113fd3,'original':!![],'picType':_0x35042a['gyYoS'](isGIF,_0x538dd5)?PicType[_0xe79668(0x151)]:PicType[_0xe79668(0x138)],'picSubType':_0x2f56a5,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x6d590c};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x436ca9};}static async['file'](_0x5c6f1c,_0x220801=''){const _0x17c75f=_0x161809,_0x10097e={'HYwtI':function(_0x3c2a1d,_0x2dbc87){return _0x3c2a1d===_0x2dbc87;},'RJxao':_0x17c75f(0x172),'JIXaO':function(_0x54e9c1,_0x55ee61){return _0x54e9c1||_0x55ee61;}},{md5:_0x1c116e,fileName:_0x4e3240,path:_0x5dccc8,fileSize:_0x284f10}=await NTQQFileApi['uploadFile'](_0x5c6f1c,ElementType[_0x17c75f(0x13a)]);if(_0x10097e[_0x17c75f(0x155)](_0x284f10,0x0))throw _0x10097e[_0x17c75f(0x14b)];const _0x46abfd={'elementType':ElementType[_0x17c75f(0x13a)],'elementId':'','fileElement':{'fileName':_0x10097e[_0x17c75f(0x168)](_0x220801,_0x4e3240),'filePath':_0x5dccc8,'fileSize':_0x284f10[_0x17c75f(0x175)]()}};return _0x46abfd;}static async[_0x161809(0x14c)](_0x7370d,_0x492d55='',_0x4df8a7=''){const _0x50a40b=_0x161809,_0x162f2f={'KBdUU':function(_0x4b5f61,_0x1bb277){return _0x4b5f61(_0x1bb277);},'UXImF':function(_0x5c8984,_0x281345){return _0x5c8984(_0x281345);},'NhjMr':'end','tWWnZ':'error','hDwnd':function(_0x159f83,_0x11dd84){return _0x159f83+_0x11dd84;},'jfIpd':function(_0x14da92,_0x21c2af){return _0x14da92===_0x21c2af;},'KTjYI':_0x50a40b(0x172),'DOvsa':function(_0x456a50,_0x1e1065){return _0x456a50(_0x1e1065);},'zYdiw':function(_0x3203c2,_0x4c88e4,_0x42b343){return _0x3203c2(_0x4c88e4,_0x42b343);},'ufMyZ':_0x50a40b(0x12b),'nsTuw':function(_0x37b0a4,_0x76ae27){return _0x37b0a4(_0x76ae27);}},{fileName:_0xf67e52,path:_0x8e1a78,fileSize:_0xda54dd,md5:_0x15b913}=await NTQQFileApi['uploadFile'](_0x7370d,ElementType[_0x50a40b(0x127)]);if(_0x162f2f[_0x50a40b(0x133)](_0xda54dd,0x0))throw _0x162f2f[_0x50a40b(0x161)];let _0x2ac37a=_0x8e1a78[_0x50a40b(0x135)](_0x236c3e[_0x50a40b(0x137)]+'Ori'+_0x236c3e['sep'],_0x236c3e['sep']+_0x50a40b(0x15b)+_0x236c3e[_0x50a40b(0x137)]);_0x2ac37a=_0x236c3e[_0x50a40b(0x12a)](_0x2ac37a);let _0x40e41a={'width':0x780,'height':0x438,'time':0xf,'format':_0x50a40b(0x16a),'size':_0xda54dd,'filePath':_0x7370d};try{_0x40e41a=await _0x162f2f[_0x50a40b(0x13d)](getVideoInfo,_0x8e1a78);}catch(_0x5a342d){_0x162f2f[_0x50a40b(0x13e)](logError,_0x162f2f['ufMyZ'],_0x5a342d);}const _0xf165ce=new Promise((_0x4b6009,_0x5a1969)=>{const _0x131a19=_0x50a40b,_0x2d140a={'NmCNc':function(_0x5e3fcd,_0x3f1261){const _0x51d715=_0x14c1;return _0x162f2f[_0x51d715(0x144)](_0x5e3fcd,_0x3f1261);}},_0x584b8c=_0x15b913+_0x131a19(0x139),_0x12551a=_0x236c3e[_0x131a19(0x170)](_0x2ac37a,_0x584b8c);_0x162f2f['UXImF'](_0x15e56d,_0x7370d)['on'](_0x162f2f[_0x131a19(0x174)],()=>{})['on'](_0x162f2f[_0x131a19(0x148)],_0x4e33a4=>{const _0x43103e=_0x131a19;logDebug(_0x43103e(0x147),_0x4e33a4),_0x4df8a7?_0x3b9366[_0x43103e(0x16d)](_0x4df8a7,_0x12551a)[_0x43103e(0x16b)](()=>{_0x4b6009(_0x12551a);})[_0x43103e(0x121)](_0x5a1969):_0x3b9366[_0x43103e(0x157)](_0x12551a,defaultVideoThumb)['then'](()=>{_0x2d140a['NmCNc'](_0x4b6009,_0x12551a);})[_0x43103e(0x121)](_0x5a1969);})['screenshots']({'timestamps':[0x0],'filename':_0x584b8c,'folder':_0x2ac37a,'size':_0x162f2f['hDwnd'](_0x162f2f[_0x131a19(0x16c)](_0x40e41a[_0x131a19(0x16f)],'x'),_0x40e41a[_0x131a19(0x11c)])})['on'](_0x162f2f[_0x131a19(0x174)],()=>{const _0x53f1da=_0x131a19;_0x162f2f[_0x53f1da(0x167)](_0x4b6009,_0x12551a);});}),_0x59a36f=new Map(),_0xf22b6b=await _0xf165ce,_0x4ede90=(await _0x3b9366[_0x50a40b(0x15f)](_0xf22b6b))[_0x50a40b(0x11e)];_0x59a36f[_0x50a40b(0x149)](0x0,_0xf22b6b);const _0x1c76e6=await _0x162f2f['nsTuw'](calculateFileMD5,_0xf22b6b),_0x440a9a={'elementType':ElementType[_0x50a40b(0x127)],'elementId':'','videoElement':{'fileName':_0x492d55||_0xf67e52,'filePath':_0x8e1a78,'videoMd5':_0x15b913,'thumbMd5':_0x1c76e6,'fileTime':_0x40e41a['time'],'thumbPath':_0x59a36f,'thumbSize':_0x4ede90,'thumbWidth':_0x40e41a[_0x50a40b(0x16f)],'thumbHeight':_0x40e41a[_0x50a40b(0x11c)],'fileSize':''+_0xda54dd}};return _0x440a9a;}static async[_0x161809(0x166)](_0x550b0d){const _0xce9785=_0x161809,_0x490ac7={'svgYU':function(_0x3ced1d,_0x1a98f6){return _0x3ced1d(_0x1a98f6);},'FMtYQ':'语音转换失败,\x20请检查语音文件是否正常','UWkJQ':function(_0x231256,_0x4cc1b9){return _0x231256===_0x4cc1b9;},'wEGek':function(_0xa78e43,_0x48f724){return _0xa78e43||_0x48f724;}},{converted:_0x18196a,path:_0x26b6d5,duration:_0x1d9d3f}=await _0x490ac7[_0xce9785(0x143)](encodeSilk,_0x550b0d);if(!_0x26b6d5)throw _0x490ac7['FMtYQ'];const {md5:_0x18f41b,fileName:_0x3113b6,path:_0x5ad735,fileSize:_0x3e508a}=await NTQQFileApi[_0xce9785(0x122)](_0x26b6d5,ElementType['PTT']);if(_0x490ac7[_0xce9785(0x150)](_0x3e508a,0x0))throw _0xce9785(0x172);return _0x18196a&&_0x3b9366[_0xce9785(0x15e)](_0x26b6d5)[_0xce9785(0x16b)](),{'elementType':ElementType[_0xce9785(0x15a)],'elementId':'','pttElement':{'fileName':_0x3113b6,'filePath':_0x5ad735,'md5HexStr':_0x18f41b,'fileSize':_0x3e508a,'duration':_0x490ac7[_0xce9785(0x142)](_0x1d9d3f,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x161809(0x158)](_0x343b54){const _0x688ef3=_0x161809,_0x1ab908={'PAbAa':function(_0x54982a,_0x10a664){return _0x54982a>=_0x10a664;}},_0x271b3e=_0xb13331[_0x688ef3(0x134)],_0x1722e7=_0xb13331[_0x688ef3(0x136)],_0x224c09=_0x271b3e[_0x688ef3(0x13f)](_0x39d9f2=>_0x39d9f2[_0x688ef3(0x14f)]===_0x343b54[_0x688ef3(0x175)]());_0x343b54=parseInt(_0x343b54[_0x688ef3(0x175)]());let _0x282ea1=0x1;return _0x1ab908[_0x688ef3(0x141)](_0x343b54,0xde)&&(_0x282ea1=0x2),_0x224c09[_0x688ef3(0x165)]&&(_0x282ea1=0x3),{'elementType':ElementType[_0x688ef3(0x132)],'elementId':'','faceElement':{'faceIndex':_0x343b54,'faceType':_0x282ea1,'faceText':_0x224c09[_0x688ef3(0x11b)],'stickerId':_0x224c09['AniStickerId'],'stickerType':_0x224c09['AniStickerType'],'packId':_0x224c09[_0x688ef3(0x12e)],'sourceType':0x1}};}static['mface'](_0x52597f,_0x2ecb6f,_0xc6bc5,_0xadb640){const _0x3e97e0=_0x161809;return{'elementType':ElementType[_0x3e97e0(0x146)],'marketFaceElement':{'emojiPackageId':_0x52597f,'emojiId':_0x2ecb6f,'key':_0xc6bc5,'faceName':_0xadb640||mFaceCache[_0x3e97e0(0x171)](_0x2ecb6f)||_0x3e97e0(0x176)}};}static[_0x161809(0x130)](_0x30b9ba){const _0x115fc9=_0x161809;return{'elementType':ElementType[_0x115fc9(0x132)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x115fc9(0x130)],'faceText':_0x115fc9(0x14a),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x31253f){const _0x120c6a=_0x161809,_0x5f267b={'iVKvY':_0x120c6a(0x13c)};return{'elementType':ElementType[_0x120c6a(0x132)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x5f267b[_0x120c6a(0x152)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x30a6df){const _0x298da4=_0x161809,_0x18a57f={'syWDX':_0x298da4(0x11f)};return typeof _0x30a6df!==_0x18a57f[_0x298da4(0x126)]&&(_0x30a6df=JSON[_0x298da4(0x11a)](_0x30a6df)),{'elementType':ElementType[_0x298da4(0x153)],'elementId':'','arkElement':{'bytesData':_0x30a6df,'linkInfo':null,'subElementType':null}};}static[_0x161809(0x15c)](_0x570a07){const _0x3f01a5=_0x161809;return{'elementType':ElementType[_0x3f01a5(0x15d)],'elementId':'','markdownElement':{'content':_0x570a07}};}static async[_0x161809(0x12d)](){const _0x19e046=_0x161809,_0x20369b={'QQnEP':function(_0x413b22,_0x29c5ad){return _0x413b22(_0x29c5ad);},'ONcbC':_0x19e046(0x156),'jVsao':_0x19e046(0x159),'tRKfE':_0x19e046(0x140),'GqCWl':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0x4be3e9=await _0x20369b[_0x19e046(0x177)](SignMiniApp,{'prompt':_0x19e046(0x156),'title':_0x20369b['ONcbC'],'preview':_0x20369b[_0x19e046(0x128)],'jumpUrl':_0x20369b['tRKfE'],'tag':_0x20369b[_0x19e046(0x12f)],'tagIcon':_0x19e046(0x120),'source':_0x20369b[_0x19e046(0x12f)],'sourcelogo':_0x20369b[_0x19e046(0x154)]});return{'elementType':ElementType[_0x19e046(0x153)],'elementId':'','arkElement':{'bytesData':_0x4be3e9,'linkInfo':null,'subElementType':null}};}}