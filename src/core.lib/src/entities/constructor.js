const _0x4f201b=_0x20da;(function(_0xc777a6,_0x1524cb){const _0x37e4fa=_0x20da,_0xdc1bdb=_0xc777a6();while(!![]){try{const _0x27deb2=parseInt(_0x37e4fa(0x16e))/0x1+-parseInt(_0x37e4fa(0x16b))/0x2*(parseInt(_0x37e4fa(0x15b))/0x3)+-parseInt(_0x37e4fa(0x148))/0x4*(-parseInt(_0x37e4fa(0x17f))/0x5)+-parseInt(_0x37e4fa(0x161))/0x6*(parseInt(_0x37e4fa(0x13f))/0x7)+-parseInt(_0x37e4fa(0x167))/0x8+parseInt(_0x37e4fa(0x184))/0x9*(parseInt(_0x37e4fa(0x180))/0xa)+parseInt(_0x37e4fa(0x165))/0xb*(-parseInt(_0x37e4fa(0x17a))/0xc);if(_0x27deb2===_0x1524cb)break;else _0xdc1bdb['push'](_0xdc1bdb['shift']());}catch(_0x555e53){_0xdc1bdb['push'](_0xdc1bdb['shift']());}}}(_0x526d,0x731df));function _0x20da(_0x4d3e46,_0xfdc2a5){const _0x526d8a=_0x526d();return _0x20da=function(_0x20da22,_0x476156){_0x20da22=_0x20da22-0x13a;let _0x18ec29=_0x526d8a[_0x20da22];return _0x18ec29;},_0x20da(_0x4d3e46,_0xfdc2a5);}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x9f2ce4}from'node:fs';import _0x3733ed from'fluent-ffmpeg';function _0x526d(){const _0x9ed8da=['JpJWq','GTFxq','time','6tkAfEW','MARKDOWN','MStqd','set','2576233CbbqfV','Ynhuy','66312UsrjCe','HFKfd','video','KpQTN','1488980KbQLkq','VZXOx','width','287892McGQWd','rps','getImageSize','ZHlVH','dlKOL','unlink','jpg','dice','ilIfc','QCTdm','PTT','sep','12SVPcsh','FACE','获取视频信息失败','soDQK','size','18310TxvHPw','430gfArMN','Ori','EtrNS','QXdjo','193374sCEWGG','copyFile','pic','height','PIC','toString','gif','CiShy','[包剪锤]','stringify','uploadFile','error','VHPIa','writeFile','reply','视频信息','TEXT','REPLY','normal2','notAt','2553901tfPXjq','LuBcy','ark','markdown','mp4','then','ygdTl','string','_0.png','668ppxSiP','wuSZm','UJnAr','FILE','ryNmP','path','获取视频封面失败，使用默认封面','ptt','ARK','[骰子]','dljMl','stat','oYHAW','face','screenshots','文件异常，大小为0','normal','file','iNZsE','3xkWYSY','VIDEO','hlhzv'];_0x526d=function(){return _0x9ed8da;};return _0x526d();}import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static['text'](_0x13c814){const _0x19e1d6=_0x20da;return{'elementType':ElementType[_0x19e1d6(0x13b)],'elementId':'','textElement':{'content':_0x13c814,'atType':AtType[_0x19e1d6(0x13e)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4dec1a,_0x5e5f50,_0xaea0ee,_0x1a96e){const _0x27a258=_0x20da;return{'elementType':ElementType[_0x27a258(0x13b)],'elementId':'','textElement':{'content':'@'+_0x1a96e,'atType':_0xaea0ee,'atUid':_0x4dec1a,'atTinyId':'','atNtUid':_0x5e5f50}};}static[_0x4f201b(0x192)](_0x37d0c7,_0x1adcc6,_0x43aca6,_0x17debd){const _0x1bcbdd=_0x4f201b;return{'elementType':ElementType[_0x1bcbdd(0x13c)],'elementId':'','replyElement':{'replayMsgSeq':_0x37d0c7,'replayMsgId':_0x1adcc6,'senderUin':_0x43aca6,'senderUinStr':_0x17debd}};}static async[_0x4f201b(0x186)](_0x26a8d1,_0x40df71='',_0x45afd2=0x0){const _0x4feb86=_0x4f201b,_0x13d1b0={'dljMl':_0x4feb86(0x157),'GTFxq':function(_0x4705a9,_0x511449){return _0x4705a9(_0x511449);},'MStqd':function(_0x3adac2,_0x425de3,_0x95f252){return _0x3adac2(_0x425de3,_0x95f252);},'ZbMKT':'图片信息'},{md5:_0x5b5830,fileName:_0x1d56c5,path:_0x4c5eb6,fileSize:_0x2e71f3}=await NTQQFileApi[_0x4feb86(0x18e)](_0x26a8d1,ElementType[_0x4feb86(0x188)],_0x45afd2);if(_0x2e71f3===0x0)throw _0x13d1b0[_0x4feb86(0x152)];const _0x3d2dae=await NTQQFileApi[_0x4feb86(0x170)](_0x26a8d1),_0x3a18f1={'md5HexStr':_0x5b5830,'fileSize':_0x2e71f3[_0x4feb86(0x189)](),'picWidth':_0x3d2dae?.[_0x4feb86(0x16d)],'picHeight':_0x3d2dae?.[_0x4feb86(0x187)],'fileName':_0x1d56c5,'sourcePath':_0x4c5eb6,'original':!![],'picType':_0x13d1b0[_0x4feb86(0x15f)](isGIF,_0x26a8d1)?PicType[_0x4feb86(0x18a)]:PicType[_0x4feb86(0x174)],'picSubType':_0x45afd2,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x40df71};return _0x13d1b0[_0x4feb86(0x163)](logDebug,_0x13d1b0['ZbMKT'],_0x3a18f1),{'elementType':ElementType[_0x4feb86(0x188)],'elementId':'','picElement':_0x3a18f1};}static async[_0x4f201b(0x159)](_0x5b357a,_0x522c76=''){const _0x550acc=_0x4f201b,_0x2e8b42={'droaY':function(_0x1af633,_0x1a8c30){return _0x1af633===_0x1a8c30;},'oYHAW':_0x550acc(0x157),'GjMgS':function(_0x59a3c6,_0x57fbb2){return _0x59a3c6||_0x57fbb2;}},{md5:_0x5b6073,fileName:_0x1c4eae,path:_0x35d4b3,fileSize:_0x1043a6}=await NTQQFileApi[_0x550acc(0x18e)](_0x5b357a,ElementType[_0x550acc(0x14b)]);if(_0x2e8b42['droaY'](_0x1043a6,0x0))throw _0x2e8b42[_0x550acc(0x154)];const _0x192a2c={'elementType':ElementType[_0x550acc(0x14b)],'elementId':'','fileElement':{'fileName':_0x2e8b42['GjMgS'](_0x522c76,_0x1c4eae),'filePath':_0x35d4b3,'fileSize':_0x1043a6['toString']()}};return _0x192a2c;}static async[_0x4f201b(0x169)](_0x3e2e65,_0xf02c44='',_0xb6095d=''){const _0x428742=_0x4f201b,_0x285c0c={'VHPIa':function(_0x10c9ac,_0xaa2ca0){return _0x10c9ac(_0xaa2ca0);},'wuSZm':function(_0x346fdf,_0x6ade5a,_0x5e724c){return _0x346fdf(_0x6ade5a,_0x5e724c);},'soDQK':_0x428742(0x14e),'EtrNS':'end','ryNmP':_0x428742(0x18f),'iNZsE':function(_0x2167ec,_0x1e3778){return _0x2167ec===_0x1e3778;},'dlKOL':_0x428742(0x17c),'QXdjo':function(_0x10fc51,_0x37b954){return _0x10fc51||_0x37b954;}},{fileName:_0x26010f,path:_0x2fa6ba,fileSize:_0x9011b1,md5:_0x39ad2e}=await NTQQFileApi[_0x428742(0x18e)](_0x3e2e65,ElementType['VIDEO']);if(_0x285c0c[_0x428742(0x15a)](_0x9011b1,0x0))throw _0x428742(0x157);const _0x5ee328=_0x285c0c[_0x428742(0x190)](require,_0x428742(0x14d));let _0x361992=_0x2fa6ba['replace'](_0x5ee328[_0x428742(0x179)]+_0x428742(0x181)+_0x5ee328[_0x428742(0x179)],_0x5ee328[_0x428742(0x179)]+'Thumb'+_0x5ee328[_0x428742(0x179)]);_0x361992=_0x5ee328['dirname'](_0x361992);let _0x2ad02b={'width':0x780,'height':0x438,'time':0xf,'format':_0x428742(0x143),'size':_0x9011b1,'filePath':_0x3e2e65};try{_0x2ad02b=await _0x285c0c[_0x428742(0x190)](getVideoInfo,_0x2fa6ba),_0x285c0c[_0x428742(0x149)](logDebug,_0x428742(0x13a),_0x2ad02b);}catch(_0x4b5edc){_0x285c0c['wuSZm'](logError,_0x285c0c[_0x428742(0x172)],_0x4b5edc);}const _0x22940b=new Promise((_0x1b2d62,_0x441377)=>{const _0x47a6f0=_0x428742,_0xcea6ed={'UJnAr':function(_0x1cb2ad,_0x1564c1){const _0x16b136=_0x20da;return _0x285c0c[_0x16b136(0x190)](_0x1cb2ad,_0x1564c1);},'ygdTl':function(_0x39180c,_0x2db1ff){return _0x39180c(_0x2db1ff);},'Ynhuy':function(_0x1a278b,_0xdf3e3b,_0x3d69d6){const _0x17fc78=_0x20da;return _0x285c0c[_0x17fc78(0x149)](_0x1a278b,_0xdf3e3b,_0x3d69d6);},'ZHlVH':_0x285c0c[_0x47a6f0(0x17d)]},_0x1b93ce=_0x39ad2e+_0x47a6f0(0x147),_0x243c4c=_0x5ee328['join'](_0x361992,_0x1b93ce);_0x285c0c[_0x47a6f0(0x190)](_0x3733ed,_0x3e2e65)['on'](_0x285c0c['EtrNS'],()=>{})['on'](_0x285c0c[_0x47a6f0(0x14c)],_0x508759=>{const _0x4aac42=_0x47a6f0,_0x1a001a={'QCTdm':function(_0x118e94,_0x1a5894){const _0x1bddfd=_0x20da;return _0xcea6ed[_0x1bddfd(0x145)](_0x118e94,_0x1a5894);}};_0xcea6ed[_0x4aac42(0x166)](logDebug,_0xcea6ed[_0x4aac42(0x171)],_0x508759),_0xb6095d?_0x9f2ce4[_0x4aac42(0x185)](_0xb6095d,_0x243c4c)[_0x4aac42(0x144)](()=>{const _0x5243eb=_0x4aac42;_0xcea6ed[_0x5243eb(0x14a)](_0x1b2d62,_0x243c4c);})['catch'](_0x441377):_0x9f2ce4[_0x4aac42(0x191)](_0x243c4c,defaultVideoThumb)[_0x4aac42(0x144)](()=>{const _0x3f1a6f=_0x4aac42;_0x1a001a[_0x3f1a6f(0x177)](_0x1b2d62,_0x243c4c);})['catch'](_0x441377);})[_0x47a6f0(0x156)]({'timestamps':[0x0],'filename':_0x1b93ce,'folder':_0x361992,'size':_0x2ad02b[_0x47a6f0(0x16d)]+'x'+_0x2ad02b['height']})['on'](_0x285c0c[_0x47a6f0(0x182)],()=>{_0x1b2d62(_0x243c4c);});}),_0x4db80e=new Map(),_0x514784=await _0x22940b,_0x598c53=(await _0x9f2ce4[_0x428742(0x153)](_0x514784))[_0x428742(0x17e)];_0x4db80e[_0x428742(0x164)](0x0,_0x514784);const _0x50d7ba=await calculateFileMD5(_0x514784),_0x48fcfb={'elementType':ElementType[_0x428742(0x15c)],'elementId':'','videoElement':{'fileName':_0x285c0c[_0x428742(0x183)](_0xf02c44,_0x26010f),'filePath':_0x2fa6ba,'videoMd5':_0x39ad2e,'thumbMd5':_0x50d7ba,'fileTime':_0x2ad02b[_0x428742(0x160)],'thumbPath':_0x4db80e,'thumbSize':_0x598c53,'thumbWidth':_0x2ad02b['width'],'thumbHeight':_0x2ad02b[_0x428742(0x187)],'fileSize':''+_0x9011b1}};return _0x48fcfb;}static async[_0x4f201b(0x14f)](_0x5df3c9){const _0xba906a=_0x4f201b,_0x500c34={'LuBcy':function(_0x311306,_0x124eb9){return _0x311306(_0x124eb9);},'JpJWq':'语音转换失败,\x20请检查语音文件是否正常','KpQTN':function(_0x29d88d,_0x2a123a){return _0x29d88d===_0x2a123a;},'VZXOx':_0xba906a(0x157),'pbBdS':function(_0x382828,_0x3dcaae){return _0x382828||_0x3dcaae;}},{converted:_0x2d1b71,path:_0x31af3d,duration:_0x604fc5}=await _0x500c34[_0xba906a(0x140)](encodeSilk,_0x5df3c9);if(!_0x31af3d)throw _0x500c34[_0xba906a(0x15e)];const {md5:_0x28ff74,fileName:_0x5df15e,path:_0x59288a,fileSize:_0x1de6fb}=await NTQQFileApi[_0xba906a(0x18e)](_0x31af3d,ElementType[_0xba906a(0x178)]);if(_0x500c34[_0xba906a(0x16a)](_0x1de6fb,0x0))throw _0x500c34[_0xba906a(0x16c)];return _0x2d1b71&&_0x9f2ce4[_0xba906a(0x173)](_0x31af3d)[_0xba906a(0x144)](),{'elementType':ElementType[_0xba906a(0x178)],'elementId':'','pttElement':{'fileName':_0x5df15e,'filePath':_0x59288a,'md5HexStr':_0x28ff74,'fileSize':_0x1de6fb,'duration':_0x500c34['pbBdS'](_0x604fc5,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4f201b(0x155)](_0x3e34c4){const _0x79394c=_0x4f201b,_0x35e799={'RbmFl':function(_0x1b8672,_0x36d93c){return _0x1b8672<_0x36d93c;}};return{'elementType':ElementType[_0x79394c(0x17b)],'elementId':'','faceElement':{'faceIndex':_0x3e34c4,'faceType':_0x35e799['RbmFl'](_0x3e34c4,0xde)?FaceType[_0x79394c(0x158)]:FaceType[_0x79394c(0x13d)]}};}static[_0x4f201b(0x175)](_0x55ee67){const _0x4fcbef=_0x4f201b,_0x1496fc={'ilIfc':_0x4fcbef(0x151)};return{'elementType':ElementType[_0x4fcbef(0x17b)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4fcbef(0x175)],'faceType':FaceType[_0x4fcbef(0x175)],'faceText':_0x1496fc[_0x4fcbef(0x176)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4f201b(0x16f)](_0x1b9862){const _0xb0fcc3=_0x4f201b,_0x2bf44d={'CiShy':_0xb0fcc3(0x18c)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x2bf44d[_0xb0fcc3(0x18b)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4f201b(0x141)](_0x357bbb){const _0x4c4929=_0x4f201b,_0x117e53={'HFKfd':function(_0x2a0dec,_0x554b02){return _0x2a0dec!==_0x554b02;},'hlhzv':_0x4c4929(0x146)};return _0x117e53[_0x4c4929(0x168)](typeof _0x357bbb,_0x117e53[_0x4c4929(0x15d)])&&(_0x357bbb=JSON[_0x4c4929(0x18d)](_0x357bbb)),{'elementType':ElementType[_0x4c4929(0x150)],'elementId':'','arkElement':{'bytesData':_0x357bbb,'linkInfo':null,'subElementType':null}};}static[_0x4f201b(0x142)](_0x27f8db){const _0x6b0cd=_0x4f201b;return{'elementType':ElementType[_0x6b0cd(0x162)],'elementId':'','markdownElement':{'content':_0x27f8db}};}}