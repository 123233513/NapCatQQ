const _0x113586=_0x2538;(function(_0x1ef21d,_0x58e444){const _0x140acb=_0x2538,_0x43718a=_0x1ef21d();while(!![]){try{const _0x186bed=parseInt(_0x140acb(0xed))/0x1+parseInt(_0x140acb(0xde))/0x2*(parseInt(_0x140acb(0xfa))/0x3)+parseInt(_0x140acb(0xbd))/0x4+parseInt(_0x140acb(0xca))/0x5+parseInt(_0x140acb(0xba))/0x6+-parseInt(_0x140acb(0xd7))/0x7*(-parseInt(_0x140acb(0xf0))/0x8)+-parseInt(_0x140acb(0xee))/0x9;if(_0x186bed===_0x58e444)break;else _0x43718a['push'](_0x43718a['shift']());}catch(_0x1e3c14){_0x43718a['push'](_0x43718a['shift']());}}}(_0x1d6d,0x1930d));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x7655ef}from'node:fs';function _0x2538(_0x12af52,_0x41a37e){const _0x1d6dc1=_0x1d6d();return _0x2538=function(_0x2538f8,_0x1fce52){_0x2538f8=_0x2538f8-0xb2;let _0x1533f0=_0x1d6dc1[_0x2538f8];return _0x1533f0;},_0x2538(_0x12af52,_0x41a37e);}import _0x665fc2 from'fluent-ffmpeg';function _0x1d6d(){const _0x1958f0=['nQlox','HFkLq','egSFp','dirname','toString','文件异常，大小为0','Bot\x20Test','WNWTv','36195WUFWTs','urYEC','text','VIDEO','size','mface','oNSsw','语音转换失败,\x20请检查语音文件是否正常','NNBsY','Brrli','error','_0.png','markdown','kUMxw','JThRZ','FILE','sep','then','pJSUn','height','miniapp','icGvr','xDLny','[骰子]','writeFile','获取视频封面失败，使用默认封面','sysface','pic','width','video','EnkHa','PcaTb','1105728BQMOli','uMxNz','JcFUT','44764FrjjsE','AniStickerType','uploadFile','FACE','[包剪锤]','uSaGO','fpPgi','jpg','PTT','notAt','catch','TEXT','获取视频信息失败','800195ZBobZl','QSid','MARKDOWN','set','PIC','time','xhRMc','face','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','copyFile','EusMA','REPLY','Thumb','28fvQTFO','lpsdk','dice','mhCVH','mp4','stat','ARK','14rtACHf','QDes','AniStickerId','emoji','replace','skIOi','reply','unlink','AniStickerPackId','string','YlFuK','vfFRG','sNbnO','UpEBn','screenshots','172045KnqZli','5305725KUauEC','XnhAQ','161376jCYnSn','paMAT'];_0x1d6d=function(){return _0x1958f0;};return _0x1d6d();}import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x49f245 from'./face_config.json';import*as _0x50305b from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x113586(0xfc)](_0x5e8667){const _0x571cd0=_0x113586;return{'elementType':ElementType[_0x571cd0(0xc8)],'elementId':'','textElement':{'content':_0x5e8667,'atType':AtType[_0x571cd0(0xc6)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x2b3067,_0x111b1a,_0x3ce0f8,_0x558933){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x558933,'atType':_0x3ce0f8,'atUid':_0x2b3067,'atTinyId':'','atNtUid':_0x111b1a}};}static[_0x113586(0xe4)](_0x9dd171,_0x6209c1,_0x3f1389,_0x1f62a9){const _0x54afd2=_0x113586;return{'elementType':ElementType[_0x54afd2(0xd5)],'elementId':'','replyElement':{'replayMsgSeq':_0x9dd171,'replayMsgId':_0x6209c1,'senderUin':_0x3f1389,'senderUinStr':_0x1f62a9}};}static async[_0x113586(0xb5)](_0x49194c,_0x3bc817='',_0x195fc7=0x0){const _0x407c55=_0x113586,_0x301216={'paMAT':function(_0x27cd2b,_0x479719){return _0x27cd2b===_0x479719;},'vfFRG':function(_0x5ad510,_0x249a38){return _0x5ad510(_0x249a38);}},{md5:_0xa05117,fileName:_0x1de2c4,path:_0x484b9d,fileSize:_0x47d59c}=await NTQQFileApi[_0x407c55(0xbf)](_0x49194c,ElementType[_0x407c55(0xce)],_0x195fc7);if(_0x301216[_0x407c55(0xf1)](_0x47d59c,0x0))throw _0x407c55(0xf7);const _0x3b71fd=await NTQQFileApi['getImageSize'](_0x49194c),_0x5f263c={'md5HexStr':_0xa05117,'fileSize':_0x47d59c[_0x407c55(0xf6)](),'picWidth':_0x3b71fd?.[_0x407c55(0xb6)],'picHeight':_0x3b71fd?.[_0x407c55(0x10d)],'fileName':_0x1de2c4,'sourcePath':_0x484b9d,'original':!![],'picType':_0x301216[_0x407c55(0xe9)](isGIF,_0x49194c)?PicType['gif']:PicType[_0x407c55(0xc4)],'picSubType':_0x195fc7,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3bc817};return{'elementType':ElementType[_0x407c55(0xce)],'elementId':'','picElement':_0x5f263c};}static async['file'](_0x1de1bc,_0x3c0f5b='',_0x3507db=''){const _0x2bdca1=_0x113586,_0xefa635={'fpPgi':function(_0x594dda,_0x495609){return _0x594dda===_0x495609;},'JcFUT':_0x2bdca1(0xf7)},{md5:_0x406722,fileName:_0x1f85de,path:_0x38f9fd,fileSize:_0x366467}=await NTQQFileApi['uploadFile'](_0x1de1bc,ElementType['FILE']);if(_0xefa635[_0x2bdca1(0xc3)](_0x366467,0x0))throw _0xefa635[_0x2bdca1(0xbc)];const _0x594d59={'elementType':ElementType[_0x2bdca1(0x109)],'elementId':'','fileElement':{'fileName':_0x3c0f5b||_0x1f85de,'folderId':_0x3507db,'filePath':_0x38f9fd,'fileSize':_0x366467[_0x2bdca1(0xf6)]()}};return _0x594d59;}static async[_0x113586(0xb7)](_0x8b99fc,_0x20b2f9='',_0x5203b8=''){const _0x294fa1=_0x113586,_0x461066={'EusMA':function(_0x463678,_0x265da6){return _0x463678(_0x265da6);},'WNWTv':function(_0x3fa185,_0x6d1893,_0x721714){return _0x3fa185(_0x6d1893,_0x721714);},'egSFp':function(_0x11bcc4,_0x154c5d){return _0x11bcc4(_0x154c5d);},'uMxNz':'end','xDLny':function(_0x1072c0,_0x4c69fc){return _0x1072c0+_0x4c69fc;},'YlFuK':function(_0x410ede,_0xeb0c29){return _0x410ede===_0xeb0c29;},'mhCVH':'文件异常，大小为0','IFAtm':_0x294fa1(0xdb),'xhRMc':function(_0x984d5f,_0xcd4b18){return _0x984d5f(_0xcd4b18);},'JThRZ':function(_0x5d4caf,_0x23a2eb){return _0x5d4caf||_0x23a2eb;},'XnhAQ':function(_0x624fbb,_0x358bf7){return _0x624fbb+_0x358bf7;}},{fileName:_0x1fd7c9,path:_0x4a10d6,fileSize:_0x41b606,md5:_0x453768}=await NTQQFileApi[_0x294fa1(0xbf)](_0x8b99fc,ElementType[_0x294fa1(0xfd)]);if(_0x461066[_0x294fa1(0xe8)](_0x41b606,0x0))throw _0x461066[_0x294fa1(0xda)];let _0x1cb422=_0x4a10d6[_0x294fa1(0xe2)](_0x50305b[_0x294fa1(0x10a)]+'Ori'+_0x50305b[_0x294fa1(0x10a)],_0x50305b[_0x294fa1(0x10a)]+_0x294fa1(0xd6)+_0x50305b[_0x294fa1(0x10a)]);_0x1cb422=_0x50305b[_0x294fa1(0xf5)](_0x1cb422);let _0x1acd60={'width':0x780,'height':0x438,'time':0xf,'format':_0x461066['IFAtm'],'size':_0x41b606,'filePath':_0x8b99fc};try{_0x1acd60=await _0x461066[_0x294fa1(0xf4)](getVideoInfo,_0x4a10d6);}catch(_0x256fcf){_0x461066[_0x294fa1(0xf9)](logError,_0x294fa1(0xc9),_0x256fcf);}const _0x261bb6=new Promise((_0x85e00,_0x5956c1)=>{const _0x53cb84=_0x294fa1,_0x4cac8e={'uSaGO':function(_0x5063c8,_0x3f0491){const _0x522da8=_0x2538;return _0x461066[_0x522da8(0xd4)](_0x5063c8,_0x3f0491);},'oNSsw':function(_0x29a0a0,_0x1cf195,_0x28add0){const _0x10c4fa=_0x2538;return _0x461066[_0x10c4fa(0xf9)](_0x29a0a0,_0x1cf195,_0x28add0);}},_0xf66e25=_0x453768+_0x53cb84(0x105),_0x11f422=_0x50305b['join'](_0x1cb422,_0xf66e25);_0x461066[_0x53cb84(0xf4)](_0x665fc2,_0x8b99fc)['on'](_0x461066[_0x53cb84(0xbb)],()=>{})['on'](_0x53cb84(0x104),_0x378239=>{const _0xbdd9a8=_0x53cb84;_0x4cac8e[_0xbdd9a8(0x100)](logDebug,_0xbdd9a8(0xb3),_0x378239),_0x5203b8?_0x7655ef[_0xbdd9a8(0xd3)](_0x5203b8,_0x11f422)[_0xbdd9a8(0x10b)](()=>{const _0x3156a6=_0xbdd9a8;_0x4cac8e[_0x3156a6(0xc2)](_0x85e00,_0x11f422);})[_0xbdd9a8(0xc7)](_0x5956c1):_0x7655ef[_0xbdd9a8(0xb2)](_0x11f422,defaultVideoThumb)[_0xbdd9a8(0x10b)](()=>{_0x85e00(_0x11f422);})[_0xbdd9a8(0xc7)](_0x5956c1);})[_0x53cb84(0xec)]({'timestamps':[0x0],'filename':_0xf66e25,'folder':_0x1cb422,'size':_0x461066[_0x53cb84(0x110)](_0x1acd60['width']+'x',_0x1acd60[_0x53cb84(0x10d)])})['on'](_0x461066[_0x53cb84(0xbb)],()=>{const _0x5e047b=_0x53cb84;_0x461066[_0x5e047b(0xd4)](_0x85e00,_0x11f422);});}),_0x354ec1=new Map(),_0xf9daac=await _0x261bb6,_0x1f1d36=(await _0x7655ef[_0x294fa1(0xdc)](_0xf9daac))[_0x294fa1(0xfe)];_0x354ec1[_0x294fa1(0xcd)](0x0,_0xf9daac);const _0x559db9=await _0x461066[_0x294fa1(0xd0)](calculateFileMD5,_0xf9daac),_0x236c4c={'elementType':ElementType[_0x294fa1(0xfd)],'elementId':'','videoElement':{'fileName':_0x461066[_0x294fa1(0x108)](_0x20b2f9,_0x1fd7c9),'filePath':_0x4a10d6,'videoMd5':_0x453768,'thumbMd5':_0x559db9,'fileTime':_0x1acd60[_0x294fa1(0xcf)],'thumbPath':_0x354ec1,'thumbSize':_0x1f1d36,'thumbWidth':_0x1acd60[_0x294fa1(0xb6)],'thumbHeight':_0x1acd60[_0x294fa1(0x10d)],'fileSize':_0x461066[_0x294fa1(0xef)]('',_0x41b606)}};return _0x236c4c;}static async['ptt'](_0x4f9245){const _0x5cc60c=_0x113586,_0x58b38f={'nQlox':function(_0x253fa1,_0x26f39b){return _0x253fa1(_0x26f39b);},'kUMxw':_0x5cc60c(0x101),'LpFQb':function(_0x192e17,_0x586115){return _0x192e17===_0x586115;},'Brrli':_0x5cc60c(0xf7),'skIOi':function(_0x4d8c47,_0xf232dc){return _0x4d8c47||_0xf232dc;}},{converted:_0x17d468,path:_0x52be3e,duration:_0x4bc0af}=await _0x58b38f[_0x5cc60c(0xf2)](encodeSilk,_0x4f9245);if(!_0x52be3e)throw _0x58b38f[_0x5cc60c(0x107)];const {md5:_0x52edc1,fileName:_0x203bb3,path:_0x3ae1df,fileSize:_0x45da6e}=await NTQQFileApi[_0x5cc60c(0xbf)](_0x52be3e,ElementType['PTT']);if(_0x58b38f['LpFQb'](_0x45da6e,0x0))throw _0x58b38f[_0x5cc60c(0x103)];return _0x17d468&&_0x7655ef[_0x5cc60c(0xe5)](_0x52be3e)[_0x5cc60c(0x10b)](),{'elementType':ElementType[_0x5cc60c(0xc5)],'elementId':'','pttElement':{'fileName':_0x203bb3,'filePath':_0x3ae1df,'md5HexStr':_0x52edc1,'fileSize':_0x45da6e,'duration':_0x58b38f[_0x5cc60c(0xe3)](_0x4bc0af,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x113586(0xd1)](_0x27d1ba){const _0x198ca0=_0x113586,_0x9c8a5a={'HFkLq':function(_0x2572b0,_0x30d740){return _0x2572b0(_0x30d740);}},_0x275238=_0x49f245[_0x198ca0(0xb4)],_0x4c26d8=_0x49f245[_0x198ca0(0xe1)],_0x13c0b5=_0x275238['find'](_0x58f4b7=>_0x58f4b7[_0x198ca0(0xcb)]===_0x27d1ba[_0x198ca0(0xf6)]());_0x27d1ba=_0x9c8a5a[_0x198ca0(0xf3)](parseInt,_0x27d1ba[_0x198ca0(0xf6)]());let _0x3f2e9e=0x1;return _0x27d1ba>=0xde&&(_0x3f2e9e=0x2),_0x13c0b5[_0x198ca0(0xbe)]&&(_0x3f2e9e=0x3),{'elementType':ElementType[_0x198ca0(0xc0)],'elementId':'','faceElement':{'faceIndex':_0x27d1ba,'faceType':_0x3f2e9e,'faceText':_0x13c0b5[_0x198ca0(0xdf)],'stickerId':_0x13c0b5[_0x198ca0(0xe0)],'stickerType':_0x13c0b5[_0x198ca0(0xbe)],'packId':_0x13c0b5[_0x198ca0(0xe6)],'sourceType':0x1}};}static[_0x113586(0xff)](_0x48120f,_0x314538,_0x3baf2a,_0x1785c2){const _0x574b3d=_0x113586,_0x2f8235={'PcaTb':'[商城表情]'};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x48120f,'emojiId':_0x314538,'key':_0x3baf2a,'faceName':_0x1785c2||mFaceCache['get'](_0x314538)||_0x2f8235[_0x574b3d(0xb9)]}};}static['dice'](_0x3f49e3){const _0x18c46b=_0x113586,_0x4db9ba={'EnkHa':_0x18c46b(0x111)};return{'elementType':ElementType[_0x18c46b(0xc0)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x18c46b(0xd9)],'faceType':FaceType[_0x18c46b(0xd9)],'faceText':_0x4db9ba[_0x18c46b(0xb8)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x35a68e){const _0x2ad9fc=_0x113586,_0x29689={'sNbnO':_0x2ad9fc(0xc1)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x29689[_0x2ad9fc(0xea)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x25972f){const _0x4bd4a2=_0x113586,_0x483c26={'icGvr':function(_0x2f564e,_0x33511d){return _0x2f564e!==_0x33511d;},'Majta':_0x4bd4a2(0xe7)};return _0x483c26[_0x4bd4a2(0x10f)](typeof _0x25972f,_0x483c26['Majta'])&&(_0x25972f=JSON['stringify'](_0x25972f)),{'elementType':ElementType[_0x4bd4a2(0xdd)],'elementId':'','arkElement':{'bytesData':_0x25972f,'linkInfo':null,'subElementType':null}};}static[_0x113586(0x106)](_0x360d92){const _0x4072de=_0x113586;return{'elementType':ElementType[_0x4072de(0xcc)],'elementId':'','markdownElement':{'content':_0x360d92}};}static async[_0x113586(0x10e)](){const _0x55c9cc=_0x113586,_0xee638a={'NNBsY':function(_0x1c89dc,_0x23c690){return _0x1c89dc(_0x23c690);},'UpEBn':_0x55c9cc(0xf8),'lpsdk':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','urYEC':'https://www.bilibili.com/','pJSUn':_0x55c9cc(0xd2)};let _0x421f82=await _0xee638a[_0x55c9cc(0x102)](SignMiniApp,{'prompt':_0xee638a[_0x55c9cc(0xeb)],'title':_0x55c9cc(0xf8),'preview':_0xee638a[_0x55c9cc(0xd8)],'jumpUrl':_0xee638a[_0x55c9cc(0xfb)],'tag':_0xee638a[_0x55c9cc(0xeb)],'tagIcon':_0xee638a[_0x55c9cc(0x10c)],'source':_0xee638a['UpEBn'],'sourcelogo':_0x55c9cc(0xd2)});return{'elementType':ElementType[_0x55c9cc(0xdd)],'elementId':'','arkElement':{'bytesData':_0x421f82,'linkInfo':null,'subElementType':null}};}}