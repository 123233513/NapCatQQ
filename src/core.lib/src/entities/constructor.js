const _0x3b7f0c=_0x13eb;(function(_0x150985,_0x372471){const _0x47bedf=_0x13eb,_0x5a7129=_0x150985();while(!![]){try{const _0x3eefc2=-parseInt(_0x47bedf(0x154))/0x1*(-parseInt(_0x47bedf(0x15b))/0x2)+-parseInt(_0x47bedf(0x17a))/0x3+parseInt(_0x47bedf(0x199))/0x4*(parseInt(_0x47bedf(0x171))/0x5)+parseInt(_0x47bedf(0x173))/0x6+parseInt(_0x47bedf(0x16e))/0x7*(parseInt(_0x47bedf(0x18a))/0x8)+-parseInt(_0x47bedf(0x186))/0x9*(-parseInt(_0x47bedf(0x14f))/0xa)+-parseInt(_0x47bedf(0x162))/0xb*(parseInt(_0x47bedf(0x159))/0xc);if(_0x3eefc2===_0x372471)break;else _0x5a7129['push'](_0x5a7129['shift']());}catch(_0x4e0819){_0x5a7129['push'](_0x5a7129['shift']());}}}(_0x114c,0x8b7a8));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x38468f}from'node:fs';import _0xd8c793 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x13eb(_0x152362,_0x37be38){const _0x114ca5=_0x114c();return _0x13eb=function(_0x13ebda,_0x5dd08b){_0x13ebda=_0x13ebda-0x148;let _0x1153c2=_0x114ca5[_0x13ebda];return _0x1153c2;},_0x13eb(_0x152362,_0x37be38);}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x114c(){const _0xa048c=['yYTQF','MnQus','ark','9281295yyfbrt','[骰子]','stringify','wfwlC','8NvPoyg','pic','aHFyr','end','width','hehwW','PTT','fFDNG','height','set','stat','gif','join','string','vHjRn','768FUulvG','SsNra','图片信息','mp4','获取视频封面失败，使用默认封面','replace','视频信息','ttHFb','_0.png','copyFile','[包剪锤]','video','VIDEO','jpg','text','jvYOp','vqTjC','10ryLEug','rps','tAMZa','reply','TEXT','262792HreiDB','FACE','Hiiqs','YCcsW','获取视频信息失败','84jRriZp','FILE','8YGZoQy','文件异常，大小为0','LgJKJ','Ori','语音转换失败,\x20请检查语音文件是否正常','ZAmXZ','VGFpc','5660853uNRnyI','normal2','toString','PIC','uploadFile','SxyGa','markdown','path','XUvcP','notAt','usriY','dirname','4470067OqMqDO','oWzhQ','MARKDOWN','20260kTNQKc','qbsQQ','6248556ctJgMV','pdnHP','dice','sep','ARK','then','SIXnU','1100247hGbbNg','unlink','REPLY','catch','error','file','cFuPt','face','time'];_0x114c=function(){return _0xa048c;};return _0x114c();}export class SendMsgElementConstructor{static[_0x3b7f0c(0x14c)](_0x470b9f){const _0x4a140f=_0x3b7f0c;return{'elementType':ElementType[_0x4a140f(0x153)],'elementId':'','textElement':{'content':_0x470b9f,'atType':AtType[_0x4a140f(0x16b)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x10ffea,_0x29bd85,_0x468cb6,_0xa3453){const _0xa03067=_0x3b7f0c;return{'elementType':ElementType[_0xa03067(0x153)],'elementId':'','textElement':{'content':'@'+_0xa3453,'atType':_0x468cb6,'atUid':_0x10ffea,'atTinyId':'','atNtUid':_0x29bd85}};}static[_0x3b7f0c(0x152)](_0x3563fa,_0x447b5e,_0x45a650,_0x4986e1){const _0x2778a4=_0x3b7f0c;return{'elementType':ElementType[_0x2778a4(0x17c)],'elementId':'','replyElement':{'replayMsgSeq':_0x3563fa,'replayMsgId':_0x447b5e,'senderUin':_0x45a650,'senderUinStr':_0x4986e1}};}static async[_0x3b7f0c(0x18b)](_0x1fb64e,_0x2e75ee='',_0x4d7a0b=0x0){const _0x1e3598=_0x3b7f0c,_0x580005={'Wfdsh':function(_0x4cefff,_0x31a77a){return _0x4cefff===_0x31a77a;},'tAMZa':_0x1e3598(0x15c),'ZAmXZ':function(_0xd63dfa,_0x3d1d03,_0x57a41f){return _0xd63dfa(_0x3d1d03,_0x57a41f);},'MnQus':_0x1e3598(0x19b)},{md5:_0x21296e,fileName:_0x1737ee,path:_0x1755ad,fileSize:_0x6ebfe}=await NTQQFileApi['uploadFile'](_0x1fb64e,ElementType[_0x1e3598(0x165)],_0x4d7a0b);if(_0x580005['Wfdsh'](_0x6ebfe,0x0))throw _0x580005[_0x1e3598(0x151)];const _0x1f2916=await NTQQFileApi['getImageSize'](_0x1fb64e),_0x506de7={'md5HexStr':_0x21296e,'fileSize':_0x6ebfe[_0x1e3598(0x164)](),'picWidth':_0x1f2916?.[_0x1e3598(0x18e)],'picHeight':_0x1f2916?.[_0x1e3598(0x192)],'fileName':_0x1737ee,'sourcePath':_0x1755ad,'original':!![],'picType':isGIF(_0x1fb64e)?PicType[_0x1e3598(0x195)]:PicType[_0x1e3598(0x14b)],'picSubType':_0x4d7a0b,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2e75ee};return _0x580005[_0x1e3598(0x160)](logDebug,_0x580005[_0x1e3598(0x184)],_0x506de7),{'elementType':ElementType[_0x1e3598(0x165)],'elementId':'','picElement':_0x506de7};}static async[_0x3b7f0c(0x17f)](_0x2df02d,_0x3027ab=''){const _0xfc67a4=_0x3b7f0c,_0x24737f={'KBoFH':function(_0x2ac416,_0x4c68c1){return _0x2ac416===_0x4c68c1;},'Hiiqs':_0xfc67a4(0x15c),'SsNra':function(_0x4de403,_0x35890f){return _0x4de403||_0x35890f;}},{md5:_0x4848aa,fileName:_0x4d4b80,path:_0x5b68c3,fileSize:_0x50b5a7}=await NTQQFileApi[_0xfc67a4(0x166)](_0x2df02d,ElementType['FILE']);if(_0x24737f['KBoFH'](_0x50b5a7,0x0))throw _0x24737f[_0xfc67a4(0x156)];const _0xafe858={'elementType':ElementType[_0xfc67a4(0x15a)],'elementId':'','fileElement':{'fileName':_0x24737f[_0xfc67a4(0x19a)](_0x3027ab,_0x4d4b80),'filePath':_0x5b68c3,'fileSize':_0x50b5a7['toString']()}};return _0xafe858;}static async[_0x3b7f0c(0x149)](_0x3bc7e0,_0x33fddf='',_0x2f3d12=''){const _0x1137a4=_0x3b7f0c,_0x3815b4={'kpZNg':function(_0x50bd55,_0x3ffb4e){return _0x50bd55(_0x3ffb4e);},'pdnHP':function(_0x13acee,_0x2f6cc5){return _0x13acee(_0x2f6cc5);},'ovYHf':function(_0x79df68,_0xac5cb8,_0x3c604a){return _0x79df68(_0xac5cb8,_0x3c604a);},'cFuPt':_0x1137a4(0x19d),'yYTQF':_0x1137a4(0x18d),'Txnks':_0x1137a4(0x17e),'vcSxz':function(_0x3ee3b7,_0x32910c){return _0x3ee3b7+_0x32910c;},'qbsQQ':function(_0x4feabd,_0x5ef611){return _0x4feabd+_0x5ef611;},'SxyGa':_0x1137a4(0x15c),'XUvcP':function(_0x40c950,_0x5e24e1){return _0x40c950(_0x5e24e1);},'fFDNG':_0x1137a4(0x169),'oWzhQ':_0x1137a4(0x19c),'wfwlC':function(_0x408ca1,_0x4cf2eb,_0x5572ff){return _0x408ca1(_0x4cf2eb,_0x5572ff);},'jvYOp':_0x1137a4(0x19f),'WSnRs':_0x1137a4(0x158),'Qfndo':function(_0x208566,_0x5ccd5c){return _0x208566||_0x5ccd5c;},'usriY':function(_0x2a3b89,_0x2f9e46){return _0x2a3b89+_0x2f9e46;}},{fileName:_0xc0a333,path:_0x21e391,fileSize:_0x50cb31,md5:_0x2fc696}=await NTQQFileApi[_0x1137a4(0x166)](_0x3bc7e0,ElementType[_0x1137a4(0x14a)]);if(_0x50cb31===0x0)throw _0x3815b4[_0x1137a4(0x167)];const _0x36092d=_0x3815b4[_0x1137a4(0x16a)](require,_0x3815b4[_0x1137a4(0x191)]);let _0x47a45d=_0x21e391[_0x1137a4(0x19e)](_0x36092d[_0x1137a4(0x176)]+_0x1137a4(0x15e)+_0x36092d[_0x1137a4(0x176)],_0x36092d['sep']+'Thumb'+_0x36092d['sep']);_0x47a45d=_0x36092d[_0x1137a4(0x16d)](_0x47a45d);let _0x55060f={'width':0x780,'height':0x438,'time':0xf,'format':_0x3815b4[_0x1137a4(0x16f)],'size':_0x50cb31,'filePath':_0x3bc7e0};try{_0x55060f=await _0x3815b4[_0x1137a4(0x16a)](getVideoInfo,_0x21e391),_0x3815b4[_0x1137a4(0x189)](logDebug,_0x3815b4[_0x1137a4(0x14d)],_0x55060f);}catch(_0x20bc95){logError(_0x3815b4['WSnRs'],_0x20bc95);}const _0x2777ef=new Promise((_0x1164a9,_0x57220b)=>{const _0x444927=_0x1137a4,_0x4f806f={'vqTjC':function(_0xe88a62,_0x43bc40){const _0x3a4534=_0x13eb;return _0x3815b4[_0x3a4534(0x174)](_0xe88a62,_0x43bc40);},'LgJKJ':function(_0x56dd57,_0x1d1228){return _0x56dd57(_0x1d1228);},'VGFpc':function(_0x1ef84c,_0x1a7a47,_0x467212){return _0x3815b4['ovYHf'](_0x1ef84c,_0x1a7a47,_0x467212);},'zSQzG':_0x3815b4[_0x444927(0x180)]},_0x4d87c6=_0x2fc696+_0x444927(0x1a1),_0x1b01fd=_0x36092d[_0x444927(0x196)](_0x47a45d,_0x4d87c6);_0x3815b4['kpZNg'](_0xd8c793,_0x3bc7e0)['on'](_0x3815b4[_0x444927(0x183)],()=>{})['on'](_0x3815b4['Txnks'],_0xc48625=>{const _0x128c7e=_0x444927,_0x18c1f6={'hehwW':function(_0x302b6d,_0x40f8e5){const _0x424e5e=_0x13eb;return _0x4f806f[_0x424e5e(0x15d)](_0x302b6d,_0x40f8e5);}};_0x4f806f[_0x128c7e(0x161)](logDebug,_0x4f806f['zSQzG'],_0xc48625),_0x2f3d12?_0x38468f[_0x128c7e(0x1a2)](_0x2f3d12,_0x1b01fd)[_0x128c7e(0x178)](()=>{const _0x328935=_0x128c7e;_0x4f806f[_0x328935(0x14e)](_0x1164a9,_0x1b01fd);})['catch'](_0x57220b):_0x38468f['writeFile'](_0x1b01fd,defaultVideoThumb)[_0x128c7e(0x178)](()=>{const _0x31ecbf=_0x128c7e;_0x18c1f6[_0x31ecbf(0x18f)](_0x1164a9,_0x1b01fd);})[_0x128c7e(0x17d)](_0x57220b);})['screenshots']({'timestamps':[0x0],'filename':_0x4d87c6,'folder':_0x47a45d,'size':_0x3815b4['vcSxz'](_0x3815b4[_0x444927(0x172)](_0x55060f[_0x444927(0x18e)],'x'),_0x55060f[_0x444927(0x192)])})['on'](_0x3815b4[_0x444927(0x183)],()=>{_0x3815b4['kpZNg'](_0x1164a9,_0x1b01fd);});}),_0x98b530=new Map(),_0x32a76d=await _0x2777ef,_0x57e472=(await _0x38468f[_0x1137a4(0x194)](_0x32a76d))['size'];_0x98b530[_0x1137a4(0x193)](0x0,_0x32a76d);const _0x2cded6=await calculateFileMD5(_0x32a76d),_0x3a70ea={'elementType':ElementType[_0x1137a4(0x14a)],'elementId':'','videoElement':{'fileName':_0x3815b4['Qfndo'](_0x33fddf,_0xc0a333),'filePath':_0x21e391,'videoMd5':_0x2fc696,'thumbMd5':_0x2cded6,'fileTime':_0x55060f[_0x1137a4(0x182)],'thumbPath':_0x98b530,'thumbSize':_0x57e472,'thumbWidth':_0x55060f['width'],'thumbHeight':_0x55060f['height'],'fileSize':_0x3815b4[_0x1137a4(0x16c)]('',_0x50cb31)}};return _0x3a70ea;}static async['ptt'](_0x9d9222){const _0x4527d4=_0x3b7f0c,_0x23b980={'SIXnU':function(_0x2d2fd0,_0x6ddb38){return _0x2d2fd0(_0x6ddb38);},'ttHFb':_0x4527d4(0x15f),'vHjRn':function(_0x373bed,_0x971c9a){return _0x373bed||_0x971c9a;}},{converted:_0x4c874b,path:_0x278ef3,duration:_0x8a4165}=await _0x23b980[_0x4527d4(0x179)](encodeSilk,_0x9d9222);if(!_0x278ef3)throw _0x23b980[_0x4527d4(0x1a0)];const {md5:_0x25e700,fileName:_0x7cac24,path:_0x5b0124,fileSize:_0x1eb690}=await NTQQFileApi[_0x4527d4(0x166)](_0x278ef3,ElementType[_0x4527d4(0x190)]);if(_0x1eb690===0x0)throw _0x4527d4(0x15c);return _0x4c874b&&_0x38468f[_0x4527d4(0x17b)](_0x278ef3)[_0x4527d4(0x178)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x7cac24,'filePath':_0x5b0124,'md5HexStr':_0x25e700,'fileSize':_0x1eb690,'duration':_0x23b980[_0x4527d4(0x198)](_0x8a4165,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x3b7f0c(0x181)](_0x177290){const _0x5235be=_0x3b7f0c,_0x3ac4e5={'aHFyr':function(_0x1cdabb,_0x23daa1){return _0x1cdabb<_0x23daa1;}};return{'elementType':ElementType[_0x5235be(0x155)],'elementId':'','faceElement':{'faceIndex':_0x177290,'faceType':_0x3ac4e5[_0x5235be(0x18c)](_0x177290,0xde)?FaceType['normal']:FaceType[_0x5235be(0x163)]}};}static[_0x3b7f0c(0x175)](_0x5b5e16){const _0xc3219a=_0x3b7f0c;return{'elementType':ElementType[_0xc3219a(0x155)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0xc3219a(0x175)],'faceText':_0xc3219a(0x187),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3b7f0c(0x150)](_0x10d04a){const _0x5bbb1b=_0x3b7f0c,_0x3b5565={'YCcsW':_0x5bbb1b(0x148)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x3b5565[_0x5bbb1b(0x157)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3b7f0c(0x185)](_0xb8a31a){const _0x628ab7=_0x3b7f0c;return typeof _0xb8a31a!==_0x628ab7(0x197)&&(_0xb8a31a=JSON[_0x628ab7(0x188)](_0xb8a31a)),{'elementType':ElementType[_0x628ab7(0x177)],'elementId':'','arkElement':{'bytesData':_0xb8a31a,'linkInfo':null,'subElementType':null}};}static[_0x3b7f0c(0x168)](_0xa03120){const _0xf76118=_0x3b7f0c;return{'elementType':ElementType[_0xf76118(0x170)],'elementId':'','markdownElement':{'content':_0xa03120}};}}