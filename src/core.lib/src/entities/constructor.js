const _0x3d1956=_0x1a19;(function(_0x25b58b,_0x2efa65){const _0x4d369d=_0x1a19,_0x378faf=_0x25b58b();while(!![]){try{const _0x507112=parseInt(_0x4d369d(0x148))/0x1+parseInt(_0x4d369d(0x138))/0x2*(parseInt(_0x4d369d(0x134))/0x3)+-parseInt(_0x4d369d(0x14f))/0x4*(-parseInt(_0x4d369d(0x130))/0x5)+-parseInt(_0x4d369d(0x15a))/0x6*(-parseInt(_0x4d369d(0x168))/0x7)+parseInt(_0x4d369d(0x140))/0x8*(parseInt(_0x4d369d(0x154))/0x9)+-parseInt(_0x4d369d(0x170))/0xa*(parseInt(_0x4d369d(0x18a))/0xb)+-parseInt(_0x4d369d(0x13b))/0xc;if(_0x507112===_0x2efa65)break;else _0x378faf['push'](_0x378faf['shift']());}catch(_0x22de1b){_0x378faf['push'](_0x378faf['shift']());}}}(_0x1a49,0x440f8));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x1ad53c}from'node:fs';function _0x1a19(_0x51b966,_0x29f4f9){const _0x1a49e1=_0x1a49();return _0x1a19=function(_0x1a19b3,_0x12216f){_0x1a19b3=_0x1a19b3-0x130;let _0x5c5c2b=_0x1a49e1[_0x1a19b3];return _0x5c5c2b;},_0x1a19(_0x51b966,_0x29f4f9);}import _0x50ad4e from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x1a49(){const _0x1b34b3=['AhezH','Thumb','20JWtZiZ','gbbOx','ark','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','3CpSMbd','Dwbxx','file','set','78652jbECdk','QzRvM','pOsag','6162000xDQuDJ','join','AniStickerType','SwaNL','EMaxU','24wGEQvq','图片信息','MARKDOWN','AniStickerId','get','sep','PTT','string','523798GGeKni','PIC','stat','rGJeB','dPAnE','YuXUX','ARK','40420exzcdE','getImageSize','error','miniapp','uploadFile','590166bVYKTB','ZHKvA','PiDkF','FACE','xtFbU','catch','1682028zkDoTK','screenshots','[包剪锤]','yxCjk','TEXT','文件异常，大小为0','AniStickerPackId','ArQzi','dice','height','copyFile','获取视频信息失败','KUKcI','https://www.bilibili.com/','7zQZjLh','Apyky','[商城表情]','MFACE','VIDEO','unlink','markdown','emoji','10Tqnnce','rps','width','face','视频信息','writeFile','Ori','video','toString','HaeXB','dirname','ptt','获取视频封面失败，使用默认封面','HjsEm','Bot\x20Test','yEqUq','jwizY','gif','语音转换失败,\x20请检查语音文件是否正常','then','vQzFf','TiCHJ','sysface','[骰子]','zgXhm','reply','3171608pBgRal','pic','MkkKo'];_0x1a49=function(){return _0x1b34b3;};return _0x1a49();}import _0x1e0a9f from'./face_config.json';import*as _0x5b2bb2 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x1a35c5){const _0x830a9f=_0x1a19;return{'elementType':ElementType[_0x830a9f(0x15e)],'elementId':'','textElement':{'content':_0x1a35c5,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4390cf,_0x311a98,_0x41cab4,_0x48c274){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x48c274,'atType':_0x41cab4,'atUid':_0x4390cf,'atTinyId':'','atNtUid':_0x311a98}};}static[_0x3d1956(0x189)](_0x517ac1,_0x228524,_0x472106,_0x4ff3d0){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x517ac1,'replayMsgId':_0x228524,'senderUin':_0x472106,'senderUinStr':_0x4ff3d0}};}static async[_0x3d1956(0x18b)](_0x98a45c,_0x5908af='',_0x240198=0x0){const _0x4700ef=_0x3d1956,_0x5d2297={'Qchut':_0x4700ef(0x15f),'HaeXB':function(_0x42b93c,_0x2bb113){return _0x42b93c(_0x2bb113);},'yxCjk':function(_0x16c364,_0x5196a3,_0x49e5f0){return _0x16c364(_0x5196a3,_0x49e5f0);}},{md5:_0x5cc89b,fileName:_0x1d6fc4,path:_0x57cccc,fileSize:_0x434657}=await NTQQFileApi[_0x4700ef(0x153)](_0x98a45c,ElementType[_0x4700ef(0x149)],_0x240198);if(_0x434657===0x0)throw _0x5d2297['Qchut'];const _0x1bef19=await NTQQFileApi[_0x4700ef(0x150)](_0x98a45c),_0x11308f={'md5HexStr':_0x5cc89b,'fileSize':_0x434657[_0x4700ef(0x178)](),'picWidth':_0x1bef19?.[_0x4700ef(0x172)],'picHeight':_0x1bef19?.[_0x4700ef(0x163)],'fileName':_0x1d6fc4,'sourcePath':_0x57cccc,'original':!![],'picType':_0x5d2297[_0x4700ef(0x179)](isGIF,_0x98a45c)?PicType[_0x4700ef(0x181)]:PicType['jpg'],'picSubType':_0x240198,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5908af};return _0x5d2297[_0x4700ef(0x15d)](logDebug,_0x4700ef(0x141),_0x11308f),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x11308f};}static async[_0x3d1956(0x136)](_0x432331,_0x18dbe0=''){const _0x107617=_0x3d1956,_0x580840={'SwaNL':function(_0x1a8d0d,_0x468219){return _0x1a8d0d===_0x468219;},'TiCHJ':'文件异常，大小为0','ArQzi':function(_0x319876,_0x378661){return _0x319876||_0x378661;}},{md5:_0x160cb5,fileName:_0x5f4097,path:_0x432508,fileSize:_0x5fd165}=await NTQQFileApi['uploadFile'](_0x432331,ElementType['FILE']);if(_0x580840[_0x107617(0x13e)](_0x5fd165,0x0))throw _0x580840[_0x107617(0x185)];const _0x5a26ff={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x580840[_0x107617(0x161)](_0x18dbe0,_0x5f4097),'filePath':_0x432508,'fileSize':_0x5fd165['toString']()}};return _0x5a26ff;}static async[_0x3d1956(0x177)](_0x3bd581,_0x131cb3='',_0x2a216a=''){const _0x3c7a61=_0x3d1956,_0x25a4a8={'QzRvM':function(_0x5a4220,_0x509dc0,_0x4234e5){return _0x5a4220(_0x509dc0,_0x4234e5);},'UtBak':_0x3c7a61(0x17c),'zgXhm':function(_0x2c63b9,_0x1f0047){return _0x2c63b9(_0x1f0047);},'MkkKo':'end','EMaxU':function(_0x2550c9,_0x497bec){return _0x2550c9+_0x497bec;},'khNPt':function(_0x515884,_0x34933b){return _0x515884===_0x34933b;},'AhezH':_0x3c7a61(0x174),'Dwbxx':_0x3c7a61(0x165),'YuXUX':function(_0x3d260f,_0x22fef8){return _0x3d260f(_0x22fef8);},'AYhJy':function(_0x1e4f76,_0x192ee9){return _0x1e4f76||_0x192ee9;}},{fileName:_0x334a80,path:_0x3dc9a2,fileSize:_0x3b1e79,md5:_0x2f48b3}=await NTQQFileApi[_0x3c7a61(0x153)](_0x3bd581,ElementType[_0x3c7a61(0x16c)]);if(_0x25a4a8['khNPt'](_0x3b1e79,0x0))throw _0x3c7a61(0x15f);let _0x15a899=_0x3dc9a2['replace'](_0x5b2bb2['sep']+_0x3c7a61(0x176)+_0x5b2bb2[_0x3c7a61(0x145)],_0x5b2bb2[_0x3c7a61(0x145)]+_0x3c7a61(0x18e)+_0x5b2bb2[_0x3c7a61(0x145)]);_0x15a899=_0x5b2bb2[_0x3c7a61(0x17a)](_0x15a899);let _0x2e9fc3={'width':0x780,'height':0x438,'time':0xf,'format':'mp4','size':_0x3b1e79,'filePath':_0x3bd581};try{_0x2e9fc3=await getVideoInfo(_0x3dc9a2),_0x25a4a8[_0x3c7a61(0x139)](logDebug,_0x25a4a8[_0x3c7a61(0x18d)],_0x2e9fc3);}catch(_0x2acb61){_0x25a4a8['QzRvM'](logError,_0x25a4a8[_0x3c7a61(0x135)],_0x2acb61);}const _0x4f0e62=new Promise((_0x1ecc78,_0x132c49)=>{const _0x936de2=_0x3c7a61,_0x36ff69={'ZHKvA':function(_0x57aaa9,_0x34b518){return _0x57aaa9(_0x34b518);}},_0x1999ec=_0x2f48b3+'_0.png',_0x438e64=_0x5b2bb2[_0x936de2(0x13c)](_0x15a899,_0x1999ec);_0x25a4a8[_0x936de2(0x188)](_0x50ad4e,_0x3bd581)['on'](_0x25a4a8[_0x936de2(0x18c)],()=>{})['on'](_0x936de2(0x151),_0x3c08f3=>{const _0x324295=_0x936de2,_0x5e1269={'RrDEa':function(_0x44969b,_0x2b7e65){return _0x44969b(_0x2b7e65);}};_0x25a4a8[_0x324295(0x139)](logDebug,_0x25a4a8['UtBak'],_0x3c08f3),_0x2a216a?_0x1ad53c[_0x324295(0x164)](_0x2a216a,_0x438e64)[_0x324295(0x183)](()=>{_0x5e1269['RrDEa'](_0x1ecc78,_0x438e64);})[_0x324295(0x159)](_0x132c49):_0x1ad53c[_0x324295(0x175)](_0x438e64,defaultVideoThumb)[_0x324295(0x183)](()=>{const _0x3aca3e=_0x324295;_0x36ff69[_0x3aca3e(0x155)](_0x1ecc78,_0x438e64);})[_0x324295(0x159)](_0x132c49);})[_0x936de2(0x15b)]({'timestamps':[0x0],'filename':_0x1999ec,'folder':_0x15a899,'size':_0x25a4a8[_0x936de2(0x13f)](_0x25a4a8[_0x936de2(0x13f)](_0x2e9fc3[_0x936de2(0x172)],'x'),_0x2e9fc3[_0x936de2(0x163)])})['on'](_0x25a4a8[_0x936de2(0x18c)],()=>{_0x1ecc78(_0x438e64);});}),_0x41fb0e=new Map(),_0x213455=await _0x4f0e62,_0x285fb0=(await _0x1ad53c[_0x3c7a61(0x14a)](_0x213455))['size'];_0x41fb0e[_0x3c7a61(0x137)](0x0,_0x213455);const _0x52cb08=await _0x25a4a8[_0x3c7a61(0x14d)](calculateFileMD5,_0x213455),_0x528e3d={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x25a4a8['AYhJy'](_0x131cb3,_0x334a80),'filePath':_0x3dc9a2,'videoMd5':_0x2f48b3,'thumbMd5':_0x52cb08,'fileTime':_0x2e9fc3['time'],'thumbPath':_0x41fb0e,'thumbSize':_0x285fb0,'thumbWidth':_0x2e9fc3[_0x3c7a61(0x172)],'thumbHeight':_0x2e9fc3[_0x3c7a61(0x163)],'fileSize':_0x25a4a8[_0x3c7a61(0x13f)]('',_0x3b1e79)}};return _0x528e3d;}static async[_0x3d1956(0x17b)](_0x362522){const _0x2cce00=_0x3d1956,_0x22f054={'PiDkF':function(_0x3d34dc,_0x3ef419){return _0x3d34dc(_0x3ef419);},'vQzFf':function(_0xc7feed,_0x3e7ff0){return _0xc7feed===_0x3e7ff0;},'cJeiS':_0x2cce00(0x15f),'rGJeB':function(_0x28cfc7,_0x4589fa){return _0x28cfc7||_0x4589fa;}},{converted:_0x17d6d9,path:_0x2f0495,duration:_0x190683}=await _0x22f054[_0x2cce00(0x156)](encodeSilk,_0x362522);if(!_0x2f0495)throw _0x2cce00(0x182);const {md5:_0x561c77,fileName:_0x2b6c30,path:_0xc7d84f,fileSize:_0x520da1}=await NTQQFileApi[_0x2cce00(0x153)](_0x2f0495,ElementType[_0x2cce00(0x146)]);if(_0x22f054[_0x2cce00(0x184)](_0x520da1,0x0))throw _0x22f054['cJeiS'];return _0x17d6d9&&_0x1ad53c[_0x2cce00(0x16d)](_0x2f0495)['then'](),{'elementType':ElementType[_0x2cce00(0x146)],'elementId':'','pttElement':{'fileName':_0x2b6c30,'filePath':_0xc7d84f,'md5HexStr':_0x561c77,'fileSize':_0x520da1,'duration':_0x22f054[_0x2cce00(0x14b)](_0x190683,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x3d1956(0x173)](_0x4b6004){const _0xdef949=_0x3d1956,_0x4fa47f={'gbbOx':function(_0x46dd5c,_0x1ec455){return _0x46dd5c(_0x1ec455);},'xtFbU':function(_0x1ace36,_0x5b6e57){return _0x1ace36>=_0x5b6e57;}},_0x3063dc=_0x1e0a9f[_0xdef949(0x186)],_0x3667ea=_0x1e0a9f[_0xdef949(0x16f)],_0x197d43=_0x3063dc['find'](_0x1c1894=>_0x1c1894['QSid']===_0x4b6004[_0xdef949(0x178)]());_0x4b6004=_0x4fa47f[_0xdef949(0x131)](parseInt,_0x4b6004[_0xdef949(0x178)]());let _0x5b8fa2=0x1;return _0x4fa47f[_0xdef949(0x158)](_0x4b6004,0xde)&&(_0x5b8fa2=0x2),_0x197d43[_0xdef949(0x13d)]&&(_0x5b8fa2=0x3),{'elementType':ElementType[_0xdef949(0x157)],'elementId':'','faceElement':{'faceIndex':_0x4b6004,'faceType':_0x5b8fa2,'faceText':_0x197d43['QDes'],'stickerId':_0x197d43[_0xdef949(0x143)],'stickerType':_0x197d43[_0xdef949(0x13d)],'packId':_0x197d43[_0xdef949(0x160)],'sourceType':0x1}};}static['mface'](_0x19d61e,_0xb28209,_0xc4a14c,_0x13c3aa){const _0x4158fd=_0x3d1956,_0x54afcb={'Apyky':_0x4158fd(0x16a)};return{'elementType':ElementType[_0x4158fd(0x16b)],'marketFaceElement':{'emojiPackageId':_0x19d61e,'emojiId':_0xb28209,'key':_0xc4a14c,'faceName':_0x13c3aa||mFaceCache[_0x4158fd(0x144)](_0xb28209)||_0x54afcb[_0x4158fd(0x169)]}};}static[_0x3d1956(0x162)](_0x14d819){const _0x447383=_0x3d1956;return{'elementType':ElementType[_0x447383(0x157)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x447383(0x162)],'faceType':FaceType[_0x447383(0x162)],'faceText':_0x447383(0x187),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3d1956(0x171)](_0x3371d9){const _0x5c1937=_0x3d1956,_0x550a1d={'pOsag':_0x5c1937(0x15c)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x550a1d[_0x5c1937(0x13a)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3d1956(0x132)](_0x2d4261){const _0x52db3f=_0x3d1956,_0x53566a={'HjsEm':_0x52db3f(0x147)};return typeof _0x2d4261!==_0x53566a[_0x52db3f(0x17d)]&&(_0x2d4261=JSON['stringify'](_0x2d4261)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x2d4261,'linkInfo':null,'subElementType':null}};}static[_0x3d1956(0x16e)](_0x149698){const _0x12e96d=_0x3d1956;return{'elementType':ElementType[_0x12e96d(0x142)],'elementId':'','markdownElement':{'content':_0x149698}};}static async[_0x3d1956(0x152)](){const _0x694dda=_0x3d1956,_0x467e10={'yEqUq':_0x694dda(0x17e),'jwizY':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','KUKcI':_0x694dda(0x167),'dPAnE':_0x694dda(0x133)};let _0x207470=await SignMiniApp({'prompt':_0x467e10[_0x694dda(0x17f)],'title':_0x467e10['yEqUq'],'preview':_0x467e10[_0x694dda(0x180)],'jumpUrl':_0x467e10[_0x694dda(0x166)],'tag':_0x467e10['yEqUq'],'tagIcon':_0x467e10[_0x694dda(0x14c)],'source':_0x467e10[_0x694dda(0x17f)],'sourcelogo':_0x694dda(0x133)});return{'elementType':ElementType[_0x694dda(0x14e)],'elementId':'','arkElement':{'bytesData':_0x207470,'linkInfo':null,'subElementType':null}};}}