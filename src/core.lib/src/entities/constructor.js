const _0x467d34=_0x5759;(function(_0x3318d5,_0x5eb8f6){const _0x58cccf=_0x5759,_0x2afbbb=_0x3318d5();while(!![]){try{const _0x3fd3fd=parseInt(_0x58cccf(0x1e3))/0x1*(-parseInt(_0x58cccf(0x1ed))/0x2)+parseInt(_0x58cccf(0x1f0))/0x3+-parseInt(_0x58cccf(0x1ca))/0x4+-parseInt(_0x58cccf(0x1af))/0x5*(-parseInt(_0x58cccf(0x1ff))/0x6)+-parseInt(_0x58cccf(0x1ac))/0x7+-parseInt(_0x58cccf(0x1de))/0x8*(-parseInt(_0x58cccf(0x1b8))/0x9)+-parseInt(_0x58cccf(0x1f6))/0xa*(parseInt(_0x58cccf(0x1cb))/0xb);if(_0x3fd3fd===_0x5eb8f6)break;else _0x2afbbb['push'](_0x2afbbb['shift']());}catch(_0x4fa364){_0x2afbbb['push'](_0x2afbbb['shift']());}}}(_0x4add,0x4c6f6));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x59b8c2}from'node:fs';import _0x19007e from'fluent-ffmpeg';function _0x4add(){const _0x4a05a3=['LWzRh','Thumb','miniapp','9izEGiU','text','REPLY','[包剪锤]','获取视频信息失败','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','pic','AniStickerPackId','UfOqD','markdown','QnIet','copyFile','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','YwsvS','then','stat','RPS','time','860680leoSja','1694LHZmLv','writeFile','kcioD','GAGTM','stringify','PTT','语音转换失败,\x20请检查语音文件是否正常','set','rps','ibCPH','IYoVE','uploadFile','mIeVS','kMliu','PIC','size','AniStickerId','AniStickerType','TEXT','2417848ZpcgUK','QSid','face','CXKgQ','https://www.bilibili.com/','52859wABxZs','MARKDOWN','find','ARK','FILE','dirname','get','nnPnd','end','FpsIc','2uWtQKj','ark','文件异常，大小为0','435564CpOZlB','IGDMg','mSiqy','join','Ori','[商城表情]','9710JmuWUQ','catch','notAt','reply','getImageSize','EEpeC','dice','TzGro','width','318ZoSnhN','mface','pIzQe','error','sep','FACE','qaEyh','height','NIZOp','获取视频封面失败，使用默认封面','emoji','36428DttPzG','unlink','mp4','27210XCUSsj','replace','ZuiTI','Bot\x20Test','UBAGa','toString'];_0x4add=function(){return _0x4a05a3;};return _0x4add();}import{NTQQFileApi}from'@/core/apis/file';function _0x5759(_0x1a6c43,_0x338724){const _0x4add5f=_0x4add();return _0x5759=function(_0x575976,_0x5eea59){_0x575976=_0x575976-0x1a6;let _0x2ad81c=_0x4add5f[_0x575976];return _0x2ad81c;},_0x5759(_0x1a6c43,_0x338724);}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x466d81 from'./face_config.json';import*as _0x22c863 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x467d34(0x1b9)](_0xfa467a){const _0x1632a1=_0x467d34;return{'elementType':ElementType[_0x1632a1(0x1dd)],'elementId':'','textElement':{'content':_0xfa467a,'atType':AtType[_0x1632a1(0x1f8)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4cbfa3,_0x221199,_0xb6280e,_0x1622f9){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x1622f9,'atType':_0xb6280e,'atUid':_0x4cbfa3,'atTinyId':'','atNtUid':_0x221199}};}static[_0x467d34(0x1f9)](_0x528b5c,_0x53dea1,_0x110eff,_0x266d94){const _0x125699=_0x467d34;return{'elementType':ElementType[_0x125699(0x1ba)],'elementId':'','replyElement':{'replayMsgSeq':_0x528b5c,'replayMsgId':_0x53dea1,'senderUin':_0x110eff,'senderUinStr':_0x266d94}};}static async[_0x467d34(0x1be)](_0x19f320,_0x4b6911='',_0x4a09e6=0x0){const _0x5f2ff2=_0x467d34,_0x5e572d={'IYoVE':function(_0x1b0edd,_0x41ba2f){return _0x1b0edd===_0x41ba2f;},'QnIet':_0x5f2ff2(0x1ef),'IGDMg':function(_0x4d9af0,_0x63bdbe){return _0x4d9af0(_0x63bdbe);}},{md5:_0x4c2a68,fileName:_0x31ff0c,path:_0x470eba,fileSize:_0xac6c87}=await NTQQFileApi[_0x5f2ff2(0x1d6)](_0x19f320,ElementType[_0x5f2ff2(0x1d9)],_0x4a09e6);if(_0x5e572d[_0x5f2ff2(0x1d5)](_0xac6c87,0x0))throw _0x5e572d[_0x5f2ff2(0x1c2)];const _0x3fa3be=await NTQQFileApi[_0x5f2ff2(0x1fa)](_0x19f320),_0x9cf123={'md5HexStr':_0x4c2a68,'fileSize':_0xac6c87[_0x5f2ff2(0x1b4)](),'picWidth':_0x3fa3be?.['width'],'picHeight':_0x3fa3be?.[_0x5f2ff2(0x1a8)],'fileName':_0x31ff0c,'sourcePath':_0x470eba,'original':!![],'picType':_0x5e572d[_0x5f2ff2(0x1f1)](isGIF,_0x19f320)?PicType['gif']:PicType['jpg'],'picSubType':_0x4a09e6,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x4b6911};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x9cf123};}static async['file'](_0x233980,_0x2f0e73=''){const _0x46944c=_0x467d34,_0x78a1a6={'mIeVS':function(_0x25d228,_0x48a887){return _0x25d228===_0x48a887;},'ibCPH':_0x46944c(0x1ef)},{md5:_0x5c90ff,fileName:_0x1aea95,path:_0x3c8096,fileSize:_0x32d2be}=await NTQQFileApi['uploadFile'](_0x233980,ElementType[_0x46944c(0x1e7)]);if(_0x78a1a6[_0x46944c(0x1d7)](_0x32d2be,0x0))throw _0x78a1a6[_0x46944c(0x1d4)];const _0x3c5f05={'elementType':ElementType[_0x46944c(0x1e7)],'elementId':'','fileElement':{'fileName':_0x2f0e73||_0x1aea95,'filePath':_0x3c8096,'fileSize':_0x32d2be[_0x46944c(0x1b4)]()}};return _0x3c5f05;}static async['video'](_0x3bbcfb,_0x1b621d='',_0x2873ae=''){const _0x516bc2=_0x467d34,_0x203e21={'qaEyh':function(_0x59322e,_0x429824){return _0x59322e(_0x429824);},'JAlDn':_0x516bc2(0x1aa),'nnPnd':_0x516bc2(0x1eb),'CXKgQ':_0x516bc2(0x202),'kcioD':function(_0x4f0455,_0x1e9c1f){return _0x4f0455+_0x1e9c1f;},'ODpcE':_0x516bc2(0x1ef),'mSiqy':function(_0x3e4557,_0x56d6c8,_0x3b6232){return _0x3e4557(_0x56d6c8,_0x3b6232);},'SJXWD':_0x516bc2(0x1bc),'ChblM':function(_0x40f93d,_0x4366ba){return _0x40f93d(_0x4366ba);},'GAGTM':function(_0x570ebb,_0x6ed212){return _0x570ebb||_0x6ed212;}},{fileName:_0x278465,path:_0x3e4abd,fileSize:_0x196ad8,md5:_0x49a04a}=await NTQQFileApi[_0x516bc2(0x1d6)](_0x3bbcfb,ElementType['VIDEO']);if(_0x196ad8===0x0)throw _0x203e21['ODpcE'];let _0x4099ac=_0x3e4abd[_0x516bc2(0x1b0)](_0x22c863[_0x516bc2(0x203)]+_0x516bc2(0x1f4)+_0x22c863[_0x516bc2(0x203)],_0x22c863['sep']+_0x516bc2(0x1b6)+_0x22c863[_0x516bc2(0x203)]);_0x4099ac=_0x22c863[_0x516bc2(0x1e8)](_0x4099ac);let _0x3dbb20={'width':0x780,'height':0x438,'time':0xf,'format':_0x516bc2(0x1ae),'size':_0x196ad8,'filePath':_0x3bbcfb};try{_0x3dbb20=await getVideoInfo(_0x3e4abd);}catch(_0x5a0d3d){_0x203e21[_0x516bc2(0x1f2)](logError,_0x203e21['SJXWD'],_0x5a0d3d);}const _0x4017e9=new Promise((_0x76877d,_0x452eda)=>{const _0x50b22c=_0x516bc2,_0x31f8ad={'UBAGa':function(_0x48f7bd,_0x68533a){return _0x203e21['qaEyh'](_0x48f7bd,_0x68533a);}},_0x7b2233=_0x49a04a+'_0.png',_0x354420=_0x22c863[_0x50b22c(0x1f3)](_0x4099ac,_0x7b2233);_0x19007e(_0x3bbcfb)['on'](_0x203e21[_0x50b22c(0x1ea)],()=>{})['on'](_0x203e21[_0x50b22c(0x1e1)],_0x33a687=>{const _0x10b8d9=_0x50b22c,_0x267055={'NIZOp':function(_0x3ec028,_0x376028){const _0x5d4339=_0x5759;return _0x203e21[_0x5d4339(0x1a7)](_0x3ec028,_0x376028);},'kMliu':function(_0x198f2e,_0x395420){const _0x45d106=_0x5759;return _0x203e21[_0x45d106(0x1a7)](_0x198f2e,_0x395420);}};logDebug(_0x203e21['JAlDn'],_0x33a687),_0x2873ae?_0x59b8c2[_0x10b8d9(0x1c3)](_0x2873ae,_0x354420)[_0x10b8d9(0x1c6)](()=>{const _0x49f3a5=_0x10b8d9;_0x267055[_0x49f3a5(0x1a9)](_0x76877d,_0x354420);})[_0x10b8d9(0x1f7)](_0x452eda):_0x59b8c2[_0x10b8d9(0x1cc)](_0x354420,defaultVideoThumb)['then'](()=>{const _0x1db4a2=_0x10b8d9;_0x267055[_0x1db4a2(0x1d8)](_0x76877d,_0x354420);})['catch'](_0x452eda);})['screenshots']({'timestamps':[0x0],'filename':_0x7b2233,'folder':_0x4099ac,'size':_0x203e21[_0x50b22c(0x1cd)](_0x3dbb20[_0x50b22c(0x1fe)]+'x',_0x3dbb20[_0x50b22c(0x1a8)])})['on']('end',()=>{const _0x39ecdc=_0x50b22c;_0x31f8ad[_0x39ecdc(0x1b3)](_0x76877d,_0x354420);});}),_0x544e66=new Map(),_0x13f410=await _0x4017e9,_0x2c4cc8=(await _0x59b8c2[_0x516bc2(0x1c7)](_0x13f410))[_0x516bc2(0x1da)];_0x544e66[_0x516bc2(0x1d2)](0x0,_0x13f410);const _0x5db228=await _0x203e21['ChblM'](calculateFileMD5,_0x13f410),_0x1d81c3={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x203e21[_0x516bc2(0x1ce)](_0x1b621d,_0x278465),'filePath':_0x3e4abd,'videoMd5':_0x49a04a,'thumbMd5':_0x5db228,'fileTime':_0x3dbb20[_0x516bc2(0x1c9)],'thumbPath':_0x544e66,'thumbSize':_0x2c4cc8,'thumbWidth':_0x3dbb20[_0x516bc2(0x1fe)],'thumbHeight':_0x3dbb20['height'],'fileSize':''+_0x196ad8}};return _0x1d81c3;}static async['ptt'](_0x344429){const _0x42fa0e=_0x467d34,_0xa6c2ff={'AHlKx':function(_0x168c3c,_0x59d155){return _0x168c3c===_0x59d155;},'EEpeC':_0x42fa0e(0x1ef),'LWzRh':function(_0x110213,_0x519b36){return _0x110213||_0x519b36;}},{converted:_0xd8c923,path:_0x23fe9f,duration:_0x420685}=await encodeSilk(_0x344429);if(!_0x23fe9f)throw _0x42fa0e(0x1d1);const {md5:_0x163cc9,fileName:_0x8b2f4f,path:_0x19b3d9,fileSize:_0x208b72}=await NTQQFileApi[_0x42fa0e(0x1d6)](_0x23fe9f,ElementType[_0x42fa0e(0x1d0)]);if(_0xa6c2ff['AHlKx'](_0x208b72,0x0))throw _0xa6c2ff[_0x42fa0e(0x1fb)];return _0xd8c923&&_0x59b8c2[_0x42fa0e(0x1ad)](_0x23fe9f)[_0x42fa0e(0x1c6)](),{'elementType':ElementType[_0x42fa0e(0x1d0)],'elementId':'','pttElement':{'fileName':_0x8b2f4f,'filePath':_0x19b3d9,'md5HexStr':_0x163cc9,'fileSize':_0x208b72,'duration':_0xa6c2ff[_0x42fa0e(0x1b5)](_0x420685,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x467d34(0x1e0)](_0x4d2c97){const _0x3304d0=_0x467d34,_0x278f76={'Qrtgr':function(_0xeb5947,_0x5851c8){return _0xeb5947(_0x5851c8);},'FpsIc':function(_0x5286d8,_0x394485){return _0x5286d8>=_0x394485;}},_0x1708ab=_0x466d81['sysface'],_0x5855d4=_0x466d81[_0x3304d0(0x1ab)],_0x53f637=_0x1708ab[_0x3304d0(0x1e5)](_0x27eef9=>_0x27eef9[_0x3304d0(0x1df)]===_0x4d2c97[_0x3304d0(0x1b4)]());_0x4d2c97=_0x278f76['Qrtgr'](parseInt,_0x4d2c97[_0x3304d0(0x1b4)]());let _0xf79596=0x1;return _0x278f76[_0x3304d0(0x1ec)](_0x4d2c97,0xde)&&(_0xf79596=0x2),_0x53f637['AniStickerType']&&(_0xf79596=0x3),{'elementType':ElementType[_0x3304d0(0x1a6)],'elementId':'','faceElement':{'faceIndex':_0x4d2c97,'faceType':_0xf79596,'faceText':_0x53f637['QDes'],'stickerId':_0x53f637[_0x3304d0(0x1db)],'stickerType':_0x53f637[_0x3304d0(0x1dc)],'packId':_0x53f637[_0x3304d0(0x1bf)],'sourceType':0x1}};}static[_0x467d34(0x200)](_0x43689d,_0x4137ef,_0x17661a,_0x573736){const _0xebd5e8=_0x467d34;return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x43689d,'emojiId':_0x4137ef,'key':_0x17661a,'faceName':_0x573736||mFaceCache[_0xebd5e8(0x1e9)](_0x4137ef)||_0xebd5e8(0x1f5)}};}static[_0x467d34(0x1fc)](_0x19d306){const _0xdbbdb=_0x467d34,_0x405c1b={'TzGro':'[骰子]'};return{'elementType':ElementType[_0xdbbdb(0x1a6)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':_0x405c1b[_0xdbbdb(0x1fd)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x467d34(0x1d3)](_0x172742){const _0x4e913c=_0x467d34,_0x2c2aee={'ZuiTI':_0x4e913c(0x1bb)};return{'elementType':ElementType[_0x4e913c(0x1a6)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4e913c(0x1c8)],'faceText':_0x2c2aee[_0x4e913c(0x1b1)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x467d34(0x1ee)](_0x2df5bc){const _0x13bf65=_0x467d34,_0x57aa86={'jiDAF':'string'};return typeof _0x2df5bc!==_0x57aa86['jiDAF']&&(_0x2df5bc=JSON[_0x13bf65(0x1cf)](_0x2df5bc)),{'elementType':ElementType[_0x13bf65(0x1e6)],'elementId':'','arkElement':{'bytesData':_0x2df5bc,'linkInfo':null,'subElementType':null}};}static[_0x467d34(0x1c1)](_0x527134){const _0x2da518=_0x467d34;return{'elementType':ElementType[_0x2da518(0x1e4)],'elementId':'','markdownElement':{'content':_0x527134}};}static async[_0x467d34(0x1b7)](){const _0x23ad5c=_0x467d34,_0x31c46b={'pIzQe':_0x23ad5c(0x1b2),'UfOqD':_0x23ad5c(0x1bd),'YwsvS':_0x23ad5c(0x1c4)};let _0x12c57a=await SignMiniApp({'prompt':_0x31c46b[_0x23ad5c(0x201)],'title':_0x31c46b['pIzQe'],'preview':_0x31c46b[_0x23ad5c(0x1c0)],'jumpUrl':_0x23ad5c(0x1e2),'tag':_0x31c46b[_0x23ad5c(0x201)],'tagIcon':_0x23ad5c(0x1c4),'source':_0x23ad5c(0x1b2),'sourcelogo':_0x31c46b[_0x23ad5c(0x1c5)]});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x12c57a,'linkInfo':null,'subElementType':null}};}}