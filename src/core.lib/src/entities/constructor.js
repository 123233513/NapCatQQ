const _0x2fcd48=_0x5c47;(function(_0x2edb19,_0x45dbcc){const _0x49fb83=_0x5c47,_0x4601db=_0x2edb19();while(!![]){try{const _0x155078=parseInt(_0x49fb83(0x12e))/0x1+-parseInt(_0x49fb83(0x164))/0x2+parseInt(_0x49fb83(0x12f))/0x3*(-parseInt(_0x49fb83(0x13d))/0x4)+parseInt(_0x49fb83(0x15a))/0x5*(-parseInt(_0x49fb83(0x13e))/0x6)+parseInt(_0x49fb83(0x132))/0x7*(-parseInt(_0x49fb83(0x13c))/0x8)+-parseInt(_0x49fb83(0x157))/0x9*(-parseInt(_0x49fb83(0x140))/0xa)+parseInt(_0x49fb83(0x139))/0xb;if(_0x155078===_0x45dbcc)break;else _0x4601db['push'](_0x4601db['shift']());}catch(_0x4f7210){_0x4601db['push'](_0x4601db['shift']());}}}(_0x4144,0xc77fc));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x4e2587}from'node:fs';import _0x2e48e3 from'fluent-ffmpeg';function _0x4144(){const _0x5eb05=['581290YxtOjK','sep','mp4','ARK','dice','DBUAE','AudDo','MFACE','replace','join','视频信息','catch','XWEuC','uoAoe','MARKDOWN','get','FILE','mface','notAt','bdaqd','PIC','video','QSid','copyFile','RPS','pic','REPLY','YeINh','uploadFile','Ori','zyfSC','height','918940JyEWAA','737589WghsGu','AniStickerType','XovgX','3851554YtkcQt','sysface','Thumb','writeFile','YZSwc','PTT','oUFXV','13814735zdiQdV','语音转换失败,\x20请检查语音文件是否正常','ZGjrq','16yGFKaU','4lwUEUT','93354WCjQeg','AniStickerPackId','80ZyJgph','FACE','time','TEXT','wljjy','unlink','bgYLg','emoji','文件异常，大小为0','VIDEO','getImageSize','ptt','HicER','OdGPt','exhrj','SxrTu','AniStickerId','gHwbp','error','kPpHF','gif','eFuqI','width','506727uqDYQE','set','then','55obVcIT','reply','text','screenshots','[包剪锤]','end','stringify','[骰子]','toString','获取视频信息失败'];_0x4144=function(){return _0x5eb05;};return _0x4144();}import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x3a956f from'./face_config.json';export const mFaceCache=new Map();function _0x5c47(_0x4d6132,_0x4d1226){const _0x4144d8=_0x4144();return _0x5c47=function(_0x5c478f,_0x22e704){_0x5c478f=_0x5c478f-0x118;let _0x14a089=_0x4144d8[_0x5c478f];return _0x14a089;},_0x5c47(_0x4d6132,_0x4d1226);}export class SendMsgElementConstructor{static[_0x2fcd48(0x15c)](_0x48c892){const _0x35a68b=_0x2fcd48;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x48c892,'atType':AtType[_0x35a68b(0x120)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x46ff2a,_0x4e7384,_0x358f35,_0x57acde){const _0x179c51=_0x2fcd48;return{'elementType':ElementType[_0x179c51(0x143)],'elementId':'','textElement':{'content':'@'+_0x57acde,'atType':_0x358f35,'atUid':_0x46ff2a,'atTinyId':'','atNtUid':_0x4e7384}};}static[_0x2fcd48(0x15b)](_0x42254b,_0x310cec,_0x3ed2cb,_0x43eb6c){const _0x57d0fd=_0x2fcd48;return{'elementType':ElementType[_0x57d0fd(0x128)],'elementId':'','replyElement':{'replayMsgSeq':_0x42254b,'replayMsgId':_0x310cec,'senderUin':_0x3ed2cb,'senderUinStr':_0x43eb6c}};}static async[_0x2fcd48(0x127)](_0x30118b,_0x385c8a='',_0x195eef=0x0){const _0x4ff030=_0x2fcd48,_0x28d14d={'ldOWH':function(_0x1c9a9e,_0x598485){return _0x1c9a9e===_0x598485;},'ULqrf':_0x4ff030(0x148),'tKZhC':function(_0xe9c1ee,_0x4f8a3a){return _0xe9c1ee(_0x4f8a3a);}},{md5:_0x219710,fileName:_0x359d29,path:_0x3d32a5,fileSize:_0x58b092}=await NTQQFileApi[_0x4ff030(0x12a)](_0x30118b,ElementType[_0x4ff030(0x122)],_0x195eef);if(_0x28d14d['ldOWH'](_0x58b092,0x0))throw _0x28d14d['ULqrf'];const _0x19f270=await NTQQFileApi[_0x4ff030(0x14a)](_0x30118b),_0x599c18={'md5HexStr':_0x219710,'fileSize':_0x58b092['toString'](),'picWidth':_0x19f270?.[_0x4ff030(0x156)],'picHeight':_0x19f270?.[_0x4ff030(0x12d)],'fileName':_0x359d29,'sourcePath':_0x3d32a5,'original':!![],'picType':_0x28d14d['tKZhC'](isGIF,_0x30118b)?PicType[_0x4ff030(0x154)]:PicType['jpg'],'picSubType':_0x195eef,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x385c8a};return logDebug('图片信息',_0x599c18),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x599c18};}static async['file'](_0x1fdb3c,_0x5a3bad=''){const _0xcbee4d=_0x2fcd48,_0x5b1609={'tDPRQ':_0xcbee4d(0x148),'uoAoe':function(_0x177db5,_0x826f7e){return _0x177db5||_0x826f7e;}},{md5:_0x3ecf04,fileName:_0xdcb245,path:_0x1a63cb,fileSize:_0x32c38a}=await NTQQFileApi['uploadFile'](_0x1fdb3c,ElementType[_0xcbee4d(0x11e)]);if(_0x32c38a===0x0)throw _0x5b1609['tDPRQ'];const _0x39d757={'elementType':ElementType[_0xcbee4d(0x11e)],'elementId':'','fileElement':{'fileName':_0x5b1609[_0xcbee4d(0x11b)](_0x5a3bad,_0xdcb245),'filePath':_0x1a63cb,'fileSize':_0x32c38a[_0xcbee4d(0x162)]()}};return _0x39d757;}static async[_0x2fcd48(0x123)](_0x49ffb6,_0x21a208='',_0x5a9034=''){const _0x2edf3c=_0x2fcd48,_0x1bb5a0={'wljjy':function(_0x1387b,_0x502147){return _0x1387b(_0x502147);},'XovgX':_0x2edf3c(0x15f),'bgYLg':function(_0xfbde6f,_0x32ff5d){return _0xfbde6f+_0x32ff5d;},'gHwbp':function(_0x15b476,_0x216cd4){return _0x15b476+_0x216cd4;},'kPpHF':function(_0x2d9b21,_0x57f774){return _0x2d9b21===_0x57f774;},'YZSwc':_0x2edf3c(0x148),'xRclV':'path','SxrTu':function(_0x5b58ab,_0x45ec15,_0x4aed7a){return _0x5b58ab(_0x45ec15,_0x4aed7a);},'TYGiU':_0x2edf3c(0x118),'YeINh':function(_0x43f070,_0x505952,_0x3c76b3){return _0x43f070(_0x505952,_0x3c76b3);},'oUFXV':_0x2edf3c(0x163)},{fileName:_0x27711b,path:_0x407932,fileSize:_0x34f1ea,md5:_0x3151d2}=await NTQQFileApi[_0x2edf3c(0x12a)](_0x49ffb6,ElementType[_0x2edf3c(0x149)]);if(_0x1bb5a0[_0x2edf3c(0x153)](_0x34f1ea,0x0))throw _0x1bb5a0[_0x2edf3c(0x136)];const _0x14b1c7=_0x1bb5a0[_0x2edf3c(0x144)](require,_0x1bb5a0['xRclV']);let _0x2c8b91=_0x407932[_0x2edf3c(0x16c)](_0x14b1c7['sep']+_0x2edf3c(0x12b)+_0x14b1c7[_0x2edf3c(0x165)],_0x14b1c7['sep']+_0x2edf3c(0x134)+_0x14b1c7[_0x2edf3c(0x165)]);_0x2c8b91=_0x14b1c7['dirname'](_0x2c8b91);let _0x46ea3d={'width':0x780,'height':0x438,'time':0xf,'format':_0x2edf3c(0x166),'size':_0x34f1ea,'filePath':_0x49ffb6};try{_0x46ea3d=await _0x1bb5a0[_0x2edf3c(0x144)](getVideoInfo,_0x407932),_0x1bb5a0[_0x2edf3c(0x14f)](logDebug,_0x1bb5a0['TYGiU'],_0x46ea3d);}catch(_0x3b2190){_0x1bb5a0[_0x2edf3c(0x129)](logError,_0x1bb5a0[_0x2edf3c(0x138)],_0x3b2190);}const _0x27e0ef=new Promise((_0x6ae0df,_0x154020)=>{const _0x44b9de=_0x2edf3c,_0x5d6632={'bdaqd':function(_0x2abbe9,_0x1746cb){const _0x227483=_0x5c47;return _0x1bb5a0[_0x227483(0x144)](_0x2abbe9,_0x1746cb);}},_0x39c507=_0x3151d2+'_0.png',_0x562a76=_0x14b1c7[_0x44b9de(0x16d)](_0x2c8b91,_0x39c507);_0x1bb5a0[_0x44b9de(0x144)](_0x2e48e3,_0x49ffb6)['on'](_0x1bb5a0[_0x44b9de(0x131)],()=>{})['on'](_0x44b9de(0x152),_0x5286a0=>{const _0x58df2e=_0x44b9de;logDebug('获取视频封面失败，使用默认封面',_0x5286a0),_0x5a9034?_0x4e2587[_0x58df2e(0x125)](_0x5a9034,_0x562a76)[_0x58df2e(0x159)](()=>{const _0xb5e2f2=_0x58df2e;_0x5d6632[_0xb5e2f2(0x121)](_0x6ae0df,_0x562a76);})['catch'](_0x154020):_0x4e2587[_0x58df2e(0x135)](_0x562a76,defaultVideoThumb)[_0x58df2e(0x159)](()=>{_0x6ae0df(_0x562a76);})[_0x58df2e(0x119)](_0x154020);})[_0x44b9de(0x15d)]({'timestamps':[0x0],'filename':_0x39c507,'folder':_0x2c8b91,'size':_0x1bb5a0[_0x44b9de(0x146)](_0x1bb5a0[_0x44b9de(0x151)](_0x46ea3d[_0x44b9de(0x156)],'x'),_0x46ea3d['height'])})['on'](_0x1bb5a0['XovgX'],()=>{_0x6ae0df(_0x562a76);});}),_0x9bb283=new Map(),_0x44e3ae=await _0x27e0ef,_0x326425=(await _0x4e2587['stat'](_0x44e3ae))['size'];_0x9bb283[_0x2edf3c(0x158)](0x0,_0x44e3ae);const _0x378313=await calculateFileMD5(_0x44e3ae),_0x27fd4f={'elementType':ElementType[_0x2edf3c(0x149)],'elementId':'','videoElement':{'fileName':_0x21a208||_0x27711b,'filePath':_0x407932,'videoMd5':_0x3151d2,'thumbMd5':_0x378313,'fileTime':_0x46ea3d[_0x2edf3c(0x142)],'thumbPath':_0x9bb283,'thumbSize':_0x326425,'thumbWidth':_0x46ea3d[_0x2edf3c(0x156)],'thumbHeight':_0x46ea3d[_0x2edf3c(0x12d)],'fileSize':''+_0x34f1ea}};return _0x27fd4f;}static async[_0x2fcd48(0x14b)](_0x1df016){const _0x21dd97=_0x2fcd48,_0x347ea4={'OdGPt':function(_0x36b521,_0x354141){return _0x36b521(_0x354141);},'zyfSC':_0x21dd97(0x13a),'dmMyT':_0x21dd97(0x148),'eFuqI':function(_0xc91078,_0x5dd5e5){return _0xc91078||_0x5dd5e5;}},{converted:_0x3e87dd,path:_0x23269d,duration:_0x3fa068}=await _0x347ea4[_0x21dd97(0x14d)](encodeSilk,_0x1df016);if(!_0x23269d)throw _0x347ea4[_0x21dd97(0x12c)];const {md5:_0x2abf81,fileName:_0x39a823,path:_0x43d29b,fileSize:_0x255445}=await NTQQFileApi[_0x21dd97(0x12a)](_0x23269d,ElementType[_0x21dd97(0x137)]);if(_0x255445===0x0)throw _0x347ea4['dmMyT'];return _0x3e87dd&&_0x4e2587[_0x21dd97(0x145)](_0x23269d)[_0x21dd97(0x159)](),{'elementType':ElementType[_0x21dd97(0x137)],'elementId':'','pttElement':{'fileName':_0x39a823,'filePath':_0x43d29b,'md5HexStr':_0x2abf81,'fileSize':_0x255445,'duration':_0x347ea4[_0x21dd97(0x155)](_0x3fa068,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x3f62b5){const _0x547d87=_0x2fcd48,_0x2393ef={'exhrj':function(_0x5eb6d6,_0x50b2d0){return _0x5eb6d6(_0x50b2d0);},'HicER':function(_0x22b6b8,_0x7e9d2){return _0x22b6b8>=_0x7e9d2;}},_0x5906f9=_0x3a956f[_0x547d87(0x133)],_0x2d2030=_0x3a956f[_0x547d87(0x147)],_0x337b02=_0x5906f9['find'](_0x5a8cac=>_0x5a8cac[_0x547d87(0x124)]===_0x3f62b5['toString']());_0x3f62b5=_0x2393ef[_0x547d87(0x14e)](parseInt,_0x3f62b5[_0x547d87(0x162)]());let _0x1b330f=0x1;return _0x2393ef[_0x547d87(0x14c)](_0x3f62b5,0xde)&&(_0x1b330f=0x2),_0x337b02[_0x547d87(0x130)]&&(_0x1b330f=0x3),{'elementType':ElementType[_0x547d87(0x141)],'elementId':'','faceElement':{'faceIndex':_0x3f62b5,'faceType':_0x1b330f,'faceText':_0x337b02['QDes'],'stickerId':_0x337b02[_0x547d87(0x150)],'stickerType':_0x337b02[_0x547d87(0x130)],'packId':_0x337b02[_0x547d87(0x13f)],'sourceType':0x1}};}static[_0x2fcd48(0x11f)](_0x1eb3a5,_0x96c83e,_0x3a90ff,_0xf67156){const _0x2ac292=_0x2fcd48,_0x44b9d9={'WsMGW':'[商城表情]'};return{'elementType':ElementType[_0x2ac292(0x16b)],'marketFaceElement':{'emojiPackageId':_0x1eb3a5,'emojiId':_0x96c83e,'key':_0x3a90ff,'faceName':_0xf67156||mFaceCache[_0x2ac292(0x11d)](_0x96c83e)||_0x44b9d9['WsMGW']}};}static[_0x2fcd48(0x168)](_0x1c87d6){const _0x387d90=_0x2fcd48,_0x1c4c4d={'DBUAE':_0x387d90(0x161)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x387d90(0x168)],'faceType':FaceType[_0x387d90(0x168)],'faceText':_0x1c4c4d[_0x387d90(0x169)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x141441){const _0x2436c3=_0x2fcd48,_0x382a76={'ZGjrq':_0x2436c3(0x15e)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x2436c3(0x126)],'faceText':_0x382a76[_0x2436c3(0x13b)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x42f08b){const _0x2669e0=_0x2fcd48,_0x3ea6b6={'AudDo':function(_0x2fc12d,_0x165f92){return _0x2fc12d!==_0x165f92;},'XWEuC':'string'};return _0x3ea6b6[_0x2669e0(0x16a)](typeof _0x42f08b,_0x3ea6b6[_0x2669e0(0x11a)])&&(_0x42f08b=JSON[_0x2669e0(0x160)](_0x42f08b)),{'elementType':ElementType[_0x2669e0(0x167)],'elementId':'','arkElement':{'bytesData':_0x42f08b,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x4e1b3c){const _0x188690=_0x2fcd48;return{'elementType':ElementType[_0x188690(0x11c)],'elementId':'','markdownElement':{'content':_0x4e1b3c}};}}