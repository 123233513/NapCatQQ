const _0x1fabe6=_0x35f5;(function(_0x32053a,_0x517db1){const _0x5d6f5d=_0x35f5,_0x40fa87=_0x32053a();while(!![]){try{const _0x349489=parseInt(_0x5d6f5d(0x195))/0x1*(parseInt(_0x5d6f5d(0x1d6))/0x2)+parseInt(_0x5d6f5d(0x1c5))/0x3*(-parseInt(_0x5d6f5d(0x1c1))/0x4)+-parseInt(_0x5d6f5d(0x1b4))/0x5*(-parseInt(_0x5d6f5d(0x1a9))/0x6)+parseInt(_0x5d6f5d(0x196))/0x7+parseInt(_0x5d6f5d(0x1be))/0x8*(parseInt(_0x5d6f5d(0x1b8))/0x9)+-parseInt(_0x5d6f5d(0x1d1))/0xa*(-parseInt(_0x5d6f5d(0x1bf))/0xb)+-parseInt(_0x5d6f5d(0x1af))/0xc;if(_0x349489===_0x517db1)break;else _0x40fa87['push'](_0x40fa87['shift']());}catch(_0x1aeeae){_0x40fa87['push'](_0x40fa87['shift']());}}}(_0x34c9,0x48756));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x29f5b6}from'node:fs';import _0x3cfdba from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x34c9(){const _0xddb80a=['time','ptt','text','stringify','then','TEXT','hGEPx','图片信息','[商城表情]','width','2860GQAquN','apLgX','tfJJH','VIDEO','BENIx','10202bvVTmc','gpvgK','screenshots','file','face','getImageSize','文件异常，大小为0','UNNwp','uploadFile','ARK','fIyLr','FILE','markdown','OGfGM','[骰子]','jpg','视频信息','BVRBt','vQPMh','OVMdu','notAt','JIIXp','sep','normal2','replace','khNoD','stat','copyFile','reply','JUJdp','获取视频封面失败，使用默认封面','99peOYGE','1566187LmcAdb','FACE','pic','获取视频信息失败','GuTrh','HAsId','DixGx','bkenR','video','PIC','NRZSG','AccSt','toString','height','VYqmO','set','jvoxc','MFACE','LYsKK','66VXfXQP','ark','writeFile','QpviW','unlink','PTT','8460372iBIIjG','join','hvfUw','YLjtp','catch','85630XqgPae','sWXYR','hNwRO','mJyBx','4891311yIoQqI','dice','mp4','[包剪锤]','Ori','get','8FZnhQE','4763Ylhflb','dirname','4184wdACJb','adXbH','_0.png','size','1671FFpKsY','mface'];_0x34c9=function(){return _0xddb80a;};return _0x34c9();}import{calculateFileMD5,isGIF}from'@/common/utils/file';function _0x35f5(_0x3d83fb,_0x820662){const _0x34c90d=_0x34c9();return _0x35f5=function(_0x35f5bf,_0x5ff45c){_0x35f5bf=_0x35f5bf-0x179;let _0x1022bc=_0x34c90d[_0x35f5bf];return _0x1022bc;},_0x35f5(_0x3d83fb,_0x820662);}import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x1fabe6(0x1c9)](_0x204441){const _0x1b4098=_0x1fabe6;return{'elementType':ElementType[_0x1b4098(0x1cc)],'elementId':'','textElement':{'content':_0x204441,'atType':AtType[_0x1b4098(0x18a)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x7e0988,_0x54edf7,_0x321d80,_0x4ae03b){const _0x256a54=_0x1fabe6;return{'elementType':ElementType[_0x256a54(0x1cc)],'elementId':'','textElement':{'content':'@'+_0x4ae03b,'atType':_0x321d80,'atUid':_0x7e0988,'atTinyId':'','atNtUid':_0x54edf7}};}static[_0x1fabe6(0x192)](_0x12f264,_0x3dd9a3,_0x11cf49,_0x2f64c7){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x12f264,'replayMsgId':_0x3dd9a3,'senderUin':_0x11cf49,'senderUinStr':_0x2f64c7}};}static async[_0x1fabe6(0x198)](_0x106b10,_0x31f538='',_0x29f0b4=0x0){const _0x2b0dc2=_0x1fabe6,_0x588c6b={'DixGx':function(_0x445d70,_0x109ac2){return _0x445d70===_0x109ac2;},'HAsId':_0x2b0dc2(0x17c),'JUJdp':function(_0x278bde,_0x3d26db){return _0x278bde(_0x3d26db);},'LYsKK':function(_0x4e9cc8,_0x1a78b2,_0x80944d){return _0x4e9cc8(_0x1a78b2,_0x80944d);},'GuTrh':_0x2b0dc2(0x1ce)},{md5:_0x20e89e,fileName:_0xc2cbe8,path:_0x37c429,fileSize:_0x443af5}=await NTQQFileApi[_0x2b0dc2(0x17e)](_0x106b10,ElementType[_0x2b0dc2(0x19f)],_0x29f0b4);if(_0x588c6b[_0x2b0dc2(0x19c)](_0x443af5,0x0))throw _0x588c6b[_0x2b0dc2(0x19b)];const _0x5c00ce=await NTQQFileApi[_0x2b0dc2(0x17b)](_0x106b10),_0xedb25={'md5HexStr':_0x20e89e,'fileSize':_0x443af5[_0x2b0dc2(0x1a2)](),'picWidth':_0x5c00ce?.[_0x2b0dc2(0x1d0)],'picHeight':_0x5c00ce?.['height'],'fileName':_0xc2cbe8,'sourcePath':_0x37c429,'original':!![],'picType':_0x588c6b[_0x2b0dc2(0x193)](isGIF,_0x106b10)?PicType['gif']:PicType[_0x2b0dc2(0x185)],'picSubType':_0x29f0b4,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x31f538};return _0x588c6b[_0x2b0dc2(0x1a8)](logDebug,_0x588c6b[_0x2b0dc2(0x19a)],_0xedb25),{'elementType':ElementType[_0x2b0dc2(0x19f)],'elementId':'','picElement':_0xedb25};}static async[_0x1fabe6(0x179)](_0xe456b,_0xe5243c=''){const _0x57004e=_0x1fabe6,_0x102982={'NRZSG':function(_0x4a206f,_0x146646){return _0x4a206f===_0x146646;},'elGOp':_0x57004e(0x17c),'OGfGM':function(_0x5b9b66,_0x15fc32){return _0x5b9b66||_0x15fc32;}},{md5:_0x2f3633,fileName:_0x2bc876,path:_0x77d411,fileSize:_0x16033b}=await NTQQFileApi[_0x57004e(0x17e)](_0xe456b,ElementType[_0x57004e(0x181)]);if(_0x102982[_0x57004e(0x1a0)](_0x16033b,0x0))throw _0x102982['elGOp'];const _0xb33bf9={'elementType':ElementType[_0x57004e(0x181)],'elementId':'','fileElement':{'fileName':_0x102982[_0x57004e(0x183)](_0xe5243c,_0x2bc876),'filePath':_0x77d411,'fileSize':_0x16033b[_0x57004e(0x1a2)]()}};return _0xb33bf9;}static async[_0x1fabe6(0x19e)](_0xb1f487,_0x112433='',_0x5935a0=''){const _0x42cffe=_0x1fabe6,_0xaa64c5={'UUSdL':function(_0x4b0e53,_0xc0720f){return _0x4b0e53(_0xc0720f);},'gpvgK':function(_0x5da179,_0x566553){return _0x5da179(_0x566553);},'adXbH':_0x42cffe(0x194),'zhQMo':function(_0x1a9e67,_0x4cb814){return _0x1a9e67(_0x4cb814);},'AccSt':'end','YLjtp':function(_0x2c761a,_0x7db209){return _0x2c761a+_0x7db209;},'GZpQm':function(_0x26f5b0,_0x2b248d){return _0x26f5b0+_0x2b248d;},'mJyBx':function(_0x3d623e,_0x5c59b9){return _0x3d623e===_0x5c59b9;},'hGEPx':'文件异常，大小为0','BVRBt':'path','hNwRO':_0x42cffe(0x1ba),'bkenR':function(_0x5f1458,_0x2503e0,_0x3f7b90){return _0x5f1458(_0x2503e0,_0x3f7b90);},'khNoD':_0x42cffe(0x186),'JIIXp':_0x42cffe(0x199),'UNNwp':function(_0x431db2,_0xef8f90){return _0x431db2(_0xef8f90);},'VYqmO':function(_0x373069,_0x4b82a7){return _0x373069||_0x4b82a7;},'jvoxc':function(_0x3fd0a2,_0xd2c29a){return _0x3fd0a2+_0xd2c29a;}},{fileName:_0x1b6468,path:_0x1a6cd2,fileSize:_0x201d75,md5:_0x273d9c}=await NTQQFileApi['uploadFile'](_0xb1f487,ElementType[_0x42cffe(0x1d4)]);if(_0xaa64c5[_0x42cffe(0x1b7)](_0x201d75,0x0))throw _0xaa64c5[_0x42cffe(0x1cd)];const _0x172db7=require(_0xaa64c5[_0x42cffe(0x187)]);let _0x2fe145=_0x1a6cd2[_0x42cffe(0x18e)](_0x172db7[_0x42cffe(0x18c)]+_0x42cffe(0x1bc)+_0x172db7[_0x42cffe(0x18c)],_0x172db7[_0x42cffe(0x18c)]+'Thumb'+_0x172db7[_0x42cffe(0x18c)]);_0x2fe145=_0x172db7[_0x42cffe(0x1c0)](_0x2fe145);let _0x3c65dc={'width':0x780,'height':0x438,'time':0xf,'format':_0xaa64c5[_0x42cffe(0x1b6)],'size':_0x201d75,'filePath':_0xb1f487};try{_0x3c65dc=await _0xaa64c5[_0x42cffe(0x1d7)](getVideoInfo,_0x1a6cd2),_0xaa64c5[_0x42cffe(0x19d)](logDebug,_0xaa64c5[_0x42cffe(0x18f)],_0x3c65dc);}catch(_0x57ccec){_0xaa64c5[_0x42cffe(0x19d)](logError,_0xaa64c5[_0x42cffe(0x18b)],_0x57ccec);}const _0x1a47d4=new Promise((_0x4efde4,_0x53800a)=>{const _0x2d4ea6=_0x42cffe,_0x2b261e={'apLgX':function(_0x5f3ae2,_0x97a443){return _0xaa64c5['UUSdL'](_0x5f3ae2,_0x97a443);},'fIyLr':function(_0x595477,_0x33da85){const _0x3abb68=_0x35f5;return _0xaa64c5[_0x3abb68(0x1d7)](_0x595477,_0x33da85);},'vQPMh':_0xaa64c5[_0x2d4ea6(0x1c2)]},_0x5f33b3=_0x273d9c+_0x2d4ea6(0x1c3),_0x2ac585=_0x172db7[_0x2d4ea6(0x1b0)](_0x2fe145,_0x5f33b3);_0xaa64c5['zhQMo'](_0x3cfdba,_0xb1f487)['on'](_0xaa64c5[_0x2d4ea6(0x1a1)],()=>{})['on']('error',_0x130d11=>{const _0xc2f44=_0x2d4ea6,_0x5116e5={'QpviW':function(_0x302ba7,_0xdf465d){const _0x5a2b33=_0x35f5;return _0x2b261e[_0x5a2b33(0x180)](_0x302ba7,_0xdf465d);}};logDebug(_0x2b261e[_0xc2f44(0x188)],_0x130d11),_0x5935a0?_0x29f5b6[_0xc2f44(0x191)](_0x5935a0,_0x2ac585)[_0xc2f44(0x1cb)](()=>{const _0x122c4d=_0xc2f44;_0x5116e5[_0x122c4d(0x1ac)](_0x4efde4,_0x2ac585);})[_0xc2f44(0x1b3)](_0x53800a):_0x29f5b6[_0xc2f44(0x1ab)](_0x2ac585,defaultVideoThumb)[_0xc2f44(0x1cb)](()=>{const _0x1484e5=_0xc2f44;_0x2b261e[_0x1484e5(0x1d2)](_0x4efde4,_0x2ac585);})['catch'](_0x53800a);})[_0x2d4ea6(0x1d8)]({'timestamps':[0x0],'filename':_0x5f33b3,'folder':_0x2fe145,'size':_0xaa64c5[_0x2d4ea6(0x1b2)](_0xaa64c5['GZpQm'](_0x3c65dc[_0x2d4ea6(0x1d0)],'x'),_0x3c65dc['height'])})['on'](_0xaa64c5[_0x2d4ea6(0x1a1)],()=>{_0xaa64c5['UUSdL'](_0x4efde4,_0x2ac585);});}),_0x17b815=new Map(),_0x34ac18=await _0x1a47d4,_0x16b6c2=(await _0x29f5b6[_0x42cffe(0x190)](_0x34ac18))[_0x42cffe(0x1c4)];_0x17b815[_0x42cffe(0x1a5)](0x0,_0x34ac18);const _0x464c70=await _0xaa64c5[_0x42cffe(0x17d)](calculateFileMD5,_0x34ac18),_0x18657d={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0xaa64c5[_0x42cffe(0x1a4)](_0x112433,_0x1b6468),'filePath':_0x1a6cd2,'videoMd5':_0x273d9c,'thumbMd5':_0x464c70,'fileTime':_0x3c65dc[_0x42cffe(0x1c7)],'thumbPath':_0x17b815,'thumbSize':_0x16b6c2,'thumbWidth':_0x3c65dc[_0x42cffe(0x1d0)],'thumbHeight':_0x3c65dc[_0x42cffe(0x1a3)],'fileSize':_0xaa64c5[_0x42cffe(0x1a6)]('',_0x201d75)}};return _0x18657d;}static async[_0x1fabe6(0x1c8)](_0x167592){const _0x35250b=_0x1fabe6,_0x40324d={'hvfUw':'语音转换失败,\x20请检查语音文件是否正常','BENIx':function(_0x2ab84a,_0x3286d4){return _0x2ab84a===_0x3286d4;},'sbcKu':_0x35250b(0x17c)},{converted:_0x5140d1,path:_0x51bd88,duration:_0x6a596}=await encodeSilk(_0x167592);if(!_0x51bd88)throw _0x40324d[_0x35250b(0x1b1)];const {md5:_0x62d36e,fileName:_0x564cf2,path:_0x58de83,fileSize:_0x42ae13}=await NTQQFileApi[_0x35250b(0x17e)](_0x51bd88,ElementType[_0x35250b(0x1ae)]);if(_0x40324d[_0x35250b(0x1d5)](_0x42ae13,0x0))throw _0x40324d['sbcKu'];return _0x5140d1&&_0x29f5b6[_0x35250b(0x1ad)](_0x51bd88)[_0x35250b(0x1cb)](),{'elementType':ElementType[_0x35250b(0x1ae)],'elementId':'','pttElement':{'fileName':_0x564cf2,'filePath':_0x58de83,'md5HexStr':_0x62d36e,'fileSize':_0x42ae13,'duration':_0x6a596||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x1fabe6(0x17a)](_0x52cd64){const _0x19013b=_0x1fabe6,_0x31a492={'OVMdu':function(_0x544414,_0x3f3351){return _0x544414<_0x3f3351;}};return{'elementType':ElementType[_0x19013b(0x197)],'elementId':'','faceElement':{'faceIndex':_0x52cd64,'faceType':_0x31a492[_0x19013b(0x189)](_0x52cd64,0xde)?FaceType['normal']:FaceType[_0x19013b(0x18d)]}};}static[_0x1fabe6(0x1c6)](_0x164d5b,_0x5bfbc5,_0x5d88fe,_0x53bd1f){const _0x181345=_0x1fabe6;return{'elementType':ElementType[_0x181345(0x1a7)],'marketFaceElement':{'emojiPackageId':_0x164d5b,'emojiId':_0x5bfbc5,'key':_0x5d88fe,'faceName':_0x53bd1f||mFaceCache[_0x181345(0x1bd)](_0x5bfbc5)||_0x181345(0x1cf)}};}static[_0x1fabe6(0x1b9)](_0x5c2468){const _0x21b086=_0x1fabe6,_0x1980de={'sWXYR':_0x21b086(0x184)};return{'elementType':ElementType[_0x21b086(0x197)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x21b086(0x1b9)],'faceText':_0x1980de[_0x21b086(0x1b5)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x1af69c){const _0x1fae83=_0x1fabe6,_0x307ca6={'tfJJH':_0x1fae83(0x1bb)};return{'elementType':ElementType[_0x1fae83(0x197)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x307ca6[_0x1fae83(0x1d3)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x1fabe6(0x1aa)](_0x3d4e47){const _0x16cb58=_0x1fabe6,_0x53b86b={'ErXTX':function(_0xb03bae,_0x347bcf){return _0xb03bae!==_0x347bcf;}};return _0x53b86b['ErXTX'](typeof _0x3d4e47,'string')&&(_0x3d4e47=JSON[_0x16cb58(0x1ca)](_0x3d4e47)),{'elementType':ElementType[_0x16cb58(0x17f)],'elementId':'','arkElement':{'bytesData':_0x3d4e47,'linkInfo':null,'subElementType':null}};}static[_0x1fabe6(0x182)](_0x45e8aa){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x45e8aa}};}}