const _0x3d354e=_0x2165;(function(_0x5eda51,_0x106abf){const _0x334169=_0x2165,_0x3e6443=_0x5eda51();while(!![]){try{const _0x3db82a=parseInt(_0x334169(0x1ea))/0x1*(-parseInt(_0x334169(0x1f2))/0x2)+parseInt(_0x334169(0x214))/0x3*(parseInt(_0x334169(0x1e1))/0x4)+parseInt(_0x334169(0x215))/0x5+-parseInt(_0x334169(0x1f5))/0x6*(parseInt(_0x334169(0x220))/0x7)+-parseInt(_0x334169(0x1de))/0x8*(-parseInt(_0x334169(0x200))/0x9)+-parseInt(_0x334169(0x224))/0xa*(-parseInt(_0x334169(0x1fa))/0xb)+-parseInt(_0x334169(0x1eb))/0xc;if(_0x3db82a===_0x106abf)break;else _0x3e6443['push'](_0x3e6443['shift']());}catch(_0x39f280){_0x3e6443['push'](_0x3e6443['shift']());}}}(_0x5122,0x32d39));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x12f345}from'node:fs';import _0x5b791f from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';function _0x5122(){const _0x4b85fa=['height','zpjzt','语音转换失败,\x20请检查语音文件是否正常','end','DMLxW','2178378riLemX','dice','size','rps','FILE','text','tXGtj','width','normal','PIC','EqBra','face','dirname','then','error','MARKDOWN','AoiAB','path','gif','ARK','1136166jtOmcG','2033615hyetiF','catch','replace','writeFile','FACE','normal2','[骰子]','iJbKY','ifDgq','jpg','RPS','77aulhex','图片信息','Ori','string','130vRtjpe','join','markdown','screenshots','MyCoL','wNdUz','sep','_0.png','视频信息','REPLY','ptt','unlink','eSgRy','获取视频信息失败','video','shiiI','8YXJqqo','XpQct','UZYVB','4taUdLY','zDJTP','bGlnQ','Qwmng','ark','file','PTT','文件异常，大小为0','QaCzM','1124PJwWPh','3061764EPYmvV','abzJP','uploadFile','vtQWv','FsMLU','ZGpsa','reply','618WsMSnh','fEEmH','QubIl','189426CDJrrn','PdKwZ','copyFile','VIDEO','pic','110374XECklW'];_0x5122=function(){return _0x4b85fa;};return _0x5122();}import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x2165(_0x5d48fd,_0x2a258a){const _0x512296=_0x5122();return _0x2165=function(_0x2165b0,_0x2920a1){_0x2165b0=_0x2165b0-0x1d4;let _0x355479=_0x512296[_0x2165b0];return _0x355479;},_0x2165(_0x5d48fd,_0x2a258a);}export class SendMsgElementConstructor{static[_0x3d354e(0x205)](_0x595786){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x595786,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x489b4f,_0x3e2caf,_0x439b18,_0x25fd78){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x25fd78,'atType':_0x439b18,'atUid':_0x489b4f,'atTinyId':'','atNtUid':_0x3e2caf}};}static[_0x3d354e(0x1f1)](_0x34d7ba,_0x5c1a86,_0x5a008d,_0x235d42){const _0x43655f=_0x3d354e;return{'elementType':ElementType[_0x43655f(0x1d7)],'elementId':'','replyElement':{'replayMsgSeq':_0x34d7ba,'replayMsgId':_0x5c1a86,'senderUin':_0x5a008d,'senderUinStr':_0x235d42}};}static async[_0x3d354e(0x1f9)](_0x3944a6,_0x11fd33='',_0x407bb2=0x0){const _0xb66668=_0x3d354e,_0x1856d3={'zDJTP':function(_0x22cd62,_0x387fc6){return _0x22cd62===_0x387fc6;},'euQxP':'文件异常，大小为0','tXGtj':function(_0x48d948,_0x27c1f3){return _0x48d948(_0x27c1f3);}},{md5:_0x262b52,fileName:_0x2efb16,path:_0x4fbd93,fileSize:_0x2a9974}=await NTQQFileApi[_0xb66668(0x1ed)](_0x3944a6,ElementType['PIC'],_0x407bb2);if(_0x1856d3[_0xb66668(0x1e2)](_0x2a9974,0x0))throw _0x1856d3['euQxP'];const _0x1bba97=await NTQQFileApi['getImageSize'](_0x3944a6),_0x2d810e={'md5HexStr':_0x262b52,'fileSize':_0x2a9974['toString'](),'picWidth':_0x1bba97?.[_0xb66668(0x207)],'picHeight':_0x1bba97?.[_0xb66668(0x1fb)],'fileName':_0x2efb16,'sourcePath':_0x4fbd93,'original':!![],'picType':_0x1856d3[_0xb66668(0x206)](isGIF,_0x3944a6)?PicType[_0xb66668(0x212)]:PicType[_0xb66668(0x21e)],'picSubType':_0x407bb2,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x11fd33};return logDebug(_0xb66668(0x221),_0x2d810e),{'elementType':ElementType[_0xb66668(0x209)],'elementId':'','picElement':_0x2d810e};}static async[_0x3d354e(0x1e6)](_0x5c4ed3,_0x17ba40=''){const _0x117498=_0x3d354e,_0x35a4c2={'QubIl':function(_0x1ca604,_0x4c17df){return _0x1ca604===_0x4c17df;},'eSgRy':_0x117498(0x1e8),'AoiAB':function(_0x23f56b,_0x8d127e){return _0x23f56b||_0x8d127e;}},{md5:_0x33d50b,fileName:_0x486006,path:_0xf45b88,fileSize:_0x41699b}=await NTQQFileApi['uploadFile'](_0x5c4ed3,ElementType[_0x117498(0x204)]);if(_0x35a4c2[_0x117498(0x1f4)](_0x41699b,0x0))throw _0x35a4c2[_0x117498(0x1da)];const _0x34b069={'elementType':ElementType[_0x117498(0x204)],'elementId':'','fileElement':{'fileName':_0x35a4c2[_0x117498(0x210)](_0x17ba40,_0x486006),'filePath':_0xf45b88,'fileSize':_0x41699b['toString']()}};return _0x34b069;}static async[_0x3d354e(0x1dc)](_0x4b522b,_0x132943='',_0xab8212=''){const _0x3551b7=_0x3d354e,_0x1b06eb={'zpjzt':function(_0x1b1e2e,_0x104c7f,_0x1d6c8a){return _0x1b1e2e(_0x104c7f,_0x1d6c8a);},'EqBra':'获取视频封面失败，使用默认封面','ZGpsa':_0x3551b7(0x20e),'QaCzM':function(_0x117373,_0x545eb2){return _0x117373+_0x545eb2;},'PdKwZ':_0x3551b7(0x1e8),'DMLxW':function(_0x5e11bc,_0x2a51f8){return _0x5e11bc(_0x2a51f8);},'fEEmH':'mp4','iJbKY':_0x3551b7(0x1d6),'UZYVB':function(_0x5ab2d9,_0x7594e5){return _0x5ab2d9||_0x7594e5;}},{fileName:_0x118ed5,path:_0x264ba4,fileSize:_0xc4a50f,md5:_0x14be1f}=await NTQQFileApi[_0x3551b7(0x1ed)](_0x4b522b,ElementType[_0x3551b7(0x1f8)]);if(_0xc4a50f===0x0)throw _0x1b06eb[_0x3551b7(0x1f6)];const _0x137af6=_0x1b06eb[_0x3551b7(0x1ff)](require,_0x3551b7(0x211));let _0x3542fe=_0x264ba4[_0x3551b7(0x217)](_0x137af6[_0x3551b7(0x1d4)]+_0x3551b7(0x222)+_0x137af6[_0x3551b7(0x1d4)],_0x137af6[_0x3551b7(0x1d4)]+'Thumb'+_0x137af6[_0x3551b7(0x1d4)]);_0x3542fe=_0x137af6[_0x3551b7(0x20c)](_0x3542fe);let _0x2d4634={'width':0x780,'height':0x438,'time':0xf,'format':_0x1b06eb[_0x3551b7(0x1f3)],'size':_0xc4a50f,'filePath':_0x4b522b};try{_0x2d4634=await getVideoInfo(_0x264ba4),logDebug(_0x1b06eb[_0x3551b7(0x21c)],_0x2d4634);}catch(_0x37c994){_0x1b06eb[_0x3551b7(0x1fc)](logError,_0x3551b7(0x1db),_0x37c994);}const _0x492806=new Promise((_0x251cb2,_0x8baa94)=>{const _0x501150=_0x3551b7,_0x158a9a={'vtQWv':function(_0xf4f9ef,_0x21e88e){return _0xf4f9ef(_0x21e88e);},'wNdUz':function(_0x4470d1,_0x4a7f24,_0x107a6a){const _0x1aa4ca=_0x2165;return _0x1b06eb[_0x1aa4ca(0x1fc)](_0x4470d1,_0x4a7f24,_0x107a6a);},'MyCoL':_0x1b06eb[_0x501150(0x20a)],'abzJP':function(_0x40b428,_0x48805f){return _0x40b428(_0x48805f);}},_0x1d9344=_0x14be1f+_0x501150(0x1d5),_0x3202dc=_0x137af6[_0x501150(0x225)](_0x3542fe,_0x1d9344);_0x5b791f(_0x4b522b)['on']('end',()=>{})['on'](_0x1b06eb[_0x501150(0x1f0)],_0x58f2b4=>{const _0x4a16b1=_0x501150;_0x158a9a[_0x4a16b1(0x229)](logDebug,_0x158a9a[_0x4a16b1(0x228)],_0x58f2b4),_0xab8212?_0x12f345[_0x4a16b1(0x1f7)](_0xab8212,_0x3202dc)[_0x4a16b1(0x20d)](()=>{const _0x5eb10a=_0x4a16b1;_0x158a9a[_0x5eb10a(0x1ee)](_0x251cb2,_0x3202dc);})[_0x4a16b1(0x216)](_0x8baa94):_0x12f345[_0x4a16b1(0x218)](_0x3202dc,defaultVideoThumb)[_0x4a16b1(0x20d)](()=>{_0x251cb2(_0x3202dc);})[_0x4a16b1(0x216)](_0x8baa94);})[_0x501150(0x227)]({'timestamps':[0x0],'filename':_0x1d9344,'folder':_0x3542fe,'size':_0x1b06eb[_0x501150(0x1e9)](_0x1b06eb['QaCzM'](_0x2d4634[_0x501150(0x207)],'x'),_0x2d4634['height'])})['on'](_0x501150(0x1fe),()=>{const _0x24b12b=_0x501150;_0x158a9a[_0x24b12b(0x1ec)](_0x251cb2,_0x3202dc);});}),_0x124310=new Map(),_0x5dce30=await _0x492806,_0x2d12c8=(await _0x12f345['stat'](_0x5dce30))[_0x3551b7(0x202)];_0x124310['set'](0x0,_0x5dce30);const _0x1ccf83=await _0x1b06eb[_0x3551b7(0x1ff)](calculateFileMD5,_0x5dce30),_0x573e0b={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x1b06eb[_0x3551b7(0x1e0)](_0x132943,_0x118ed5),'filePath':_0x264ba4,'videoMd5':_0x14be1f,'thumbMd5':_0x1ccf83,'fileTime':_0x2d4634['time'],'thumbPath':_0x124310,'thumbSize':_0x2d12c8,'thumbWidth':_0x2d4634[_0x3551b7(0x207)],'thumbHeight':_0x2d4634[_0x3551b7(0x1fb)],'fileSize':_0x1b06eb['QaCzM']('',_0xc4a50f)}};return _0x573e0b;}static async[_0x3d354e(0x1d8)](_0x263407){const _0x498842=_0x3d354e,_0x55d231={'ifDgq':function(_0x412060,_0x2cda81){return _0x412060(_0x2cda81);},'XpQct':_0x498842(0x1e8),'FsMLU':function(_0x390a6d,_0x192a9e){return _0x390a6d||_0x192a9e;}},{converted:_0x412709,path:_0x58cf16,duration:_0x3af15d}=await _0x55d231[_0x498842(0x21d)](encodeSilk,_0x263407);if(!_0x58cf16)throw _0x498842(0x1fd);const {md5:_0x20474d,fileName:_0x40af0b,path:_0x4b4f71,fileSize:_0x6fc1bb}=await NTQQFileApi[_0x498842(0x1ed)](_0x58cf16,ElementType['PTT']);if(_0x6fc1bb===0x0)throw _0x55d231[_0x498842(0x1df)];return _0x412709&&_0x12f345[_0x498842(0x1d9)](_0x58cf16)[_0x498842(0x20d)](),{'elementType':ElementType[_0x498842(0x1e7)],'elementId':'','pttElement':{'fileName':_0x40af0b,'filePath':_0x4b4f71,'md5HexStr':_0x20474d,'fileSize':_0x6fc1bb,'duration':_0x55d231[_0x498842(0x1ef)](_0x3af15d,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x3d354e(0x20b)](_0x54106b){const _0x56d526=_0x3d354e,_0x185acd={'shiiI':function(_0x2cfe3f,_0x60f440){return _0x2cfe3f<_0x60f440;}};return{'elementType':ElementType[_0x56d526(0x219)],'elementId':'','faceElement':{'faceIndex':_0x54106b,'faceType':_0x185acd[_0x56d526(0x1dd)](_0x54106b,0xde)?FaceType[_0x56d526(0x208)]:FaceType[_0x56d526(0x21a)]}};}static[_0x3d354e(0x201)](_0xd66d31){const _0x39e291=_0x3d354e,_0x44bb87={'xjBtM':_0x39e291(0x21b)};return{'elementType':ElementType[_0x39e291(0x219)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x39e291(0x201)],'faceType':FaceType[_0x39e291(0x201)],'faceText':_0x44bb87['xjBtM'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3d354e(0x203)](_0x5afd80){const _0x569ef1=_0x3d354e,_0x3145a9={'Qwmng':'[包剪锤]'};return{'elementType':ElementType[_0x569ef1(0x219)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x569ef1(0x21f)],'faceText':_0x3145a9[_0x569ef1(0x1e4)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x3d354e(0x1e5)](_0x5bdfb5){const _0x2cb31c=_0x3d354e,_0x1dc517={'bGlnQ':function(_0x592517,_0x13bfad){return _0x592517!==_0x13bfad;},'PhcnU':_0x2cb31c(0x223)};return _0x1dc517[_0x2cb31c(0x1e3)](typeof _0x5bdfb5,_0x1dc517['PhcnU'])&&(_0x5bdfb5=JSON['stringify'](_0x5bdfb5)),{'elementType':ElementType[_0x2cb31c(0x213)],'elementId':'','arkElement':{'bytesData':_0x5bdfb5,'linkInfo':null,'subElementType':null}};}static[_0x3d354e(0x226)](_0x17ef64){const _0x231d96=_0x3d354e;return{'elementType':ElementType[_0x231d96(0x20f)],'elementId':'','markdownElement':{'content':_0x17ef64}};}}