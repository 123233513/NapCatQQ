const _0x16789c=_0x3ce3;(function(_0x5a9347,_0x5c44d5){const _0x5c4732=_0x3ce3,_0x120ea7=_0x5a9347();while(!![]){try{const _0x32f320=parseInt(_0x5c4732(0x207))/0x1*(-parseInt(_0x5c4732(0x1bd))/0x2)+parseInt(_0x5c4732(0x1e2))/0x3*(parseInt(_0x5c4732(0x205))/0x4)+-parseInt(_0x5c4732(0x1e7))/0x5*(-parseInt(_0x5c4732(0x1d8))/0x6)+parseInt(_0x5c4732(0x1c7))/0x7*(-parseInt(_0x5c4732(0x200))/0x8)+-parseInt(_0x5c4732(0x1af))/0x9*(parseInt(_0x5c4732(0x1d2))/0xa)+parseInt(_0x5c4732(0x1b4))/0xb+parseInt(_0x5c4732(0x1e4))/0xc*(parseInt(_0x5c4732(0x1ab))/0xd);if(_0x32f320===_0x5c44d5)break;else _0x120ea7['push'](_0x120ea7['shift']());}catch(_0x21de87){_0x120ea7['push'](_0x120ea7['shift']());}}}(_0x47e7,0x52d4f));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x5c0afb}from'node:fs';import _0x1857b4 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';function _0x47e7(){const _0x722dee=['PTT','YnZHc','AniStickerType','ark','vumaS','set','dirname','402zTTXuF','uiJWh','HtaZX','sep','PIC','_0.png','文件异常，大小为0','string','mface','[商城表情]','12439aBdBGG','time','height','uequT','abbou','stringify','语音转换失败,\x20请检查语音文件是否正常','BLJVA','get','FACE','OTnfh','1810xZgquy','replace','width','MFACE','IYcbi','copyFile','307086DpOvhM','nKfCv','NTKKE','Thumb','rps','Ousmq','sPCKQ','ARK','uploadFile','[包剪锤]','8160WacbhZ','reply','916536BLxBGe','TEXT','find','5URovVH','unlink','file','MARKDOWN','gif','获取视频信息失败','lKgiX','ptt','Ori','toString','text','pSeCe','clHqu','catch','mp4','oMPwq','mxHIi','stat','PVvoD','fiwtB','dice','miniapp','JSGuq','bSXVP','AniStickerPackId','1912BJqFhA','screenshots','join','获取视频封面失败，使用默认封面','markdown','996mwxXjk','face','2433BreUOy','https://www.bilibili.com/','error','vWCes','xHuUZ','getImageSize','26rxPAxc','pic','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','then','4635ZqFLMl','smOwt','[骰子]','AniStickerId','VIDEO','5115143QMhFDd','FILE'];_0x47e7=function(){return _0x722dee;};return _0x47e7();}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x35bc2e from'./face_config.json';function _0x3ce3(_0x3fb05b,_0x3c1933){const _0x47e77f=_0x47e7();return _0x3ce3=function(_0x3ce3d4,_0x313f5a){_0x3ce3d4=_0x3ce3d4-0x1a7;let _0x3da97b=_0x47e77f[_0x3ce3d4];return _0x3da97b;},_0x3ce3(_0x3fb05b,_0x3c1933);}import*as _0x4019f6 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x16789c(0x1f1)](_0x2f4626){const _0x49fad8=_0x16789c;return{'elementType':ElementType[_0x49fad8(0x1e5)],'elementId':'','textElement':{'content':_0x2f4626,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x224729,_0x4d6c55,_0x36fc16,_0x1b799d){const _0x2a3e54=_0x16789c;return{'elementType':ElementType[_0x2a3e54(0x1e5)],'elementId':'','textElement':{'content':'@'+_0x1b799d,'atType':_0x36fc16,'atUid':_0x224729,'atTinyId':'','atNtUid':_0x4d6c55}};}static[_0x16789c(0x1e3)](_0x319384,_0x4c2a02,_0x211278,_0x239b25){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x319384,'replayMsgId':_0x4c2a02,'senderUin':_0x211278,'senderUinStr':_0x239b25}};}static async[_0x16789c(0x1ac)](_0x35da0c,_0x450807='',_0x43712c=0x0){const _0x186e15=_0x16789c,_0xb81980={'mxHIi':_0x186e15(0x1c3),'PVvoD':function(_0x26bfbb,_0x238ba5){return _0x26bfbb(_0x238ba5);}},{md5:_0x225691,fileName:_0x132c0e,path:_0x1ced75,fileSize:_0x1f2282}=await NTQQFileApi[_0x186e15(0x1e0)](_0x35da0c,ElementType[_0x186e15(0x1c1)],_0x43712c);if(_0x1f2282===0x0)throw _0xb81980[_0x186e15(0x1f7)];const _0x1c48f4=await NTQQFileApi[_0x186e15(0x1aa)](_0x35da0c),_0x1dd04d={'md5HexStr':_0x225691,'fileSize':_0x1f2282[_0x186e15(0x1f0)](),'picWidth':_0x1c48f4?.['width'],'picHeight':_0x1c48f4?.['height'],'fileName':_0x132c0e,'sourcePath':_0x1ced75,'original':!![],'picType':_0xb81980[_0x186e15(0x1f9)](isGIF,_0x35da0c)?PicType[_0x186e15(0x1eb)]:PicType['jpg'],'picSubType':_0x43712c,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x450807};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x1dd04d};}static async[_0x16789c(0x1e9)](_0x559650,_0x28da7b='',_0x2100ec=''){const _0xf4ff03=_0x16789c,_0x106489={'abbou':function(_0x5b270b,_0x31a88e){return _0x5b270b===_0x31a88e;}},{md5:_0x29f48e,fileName:_0x4b1b6a,path:_0x1941bb,fileSize:_0x2d026f}=await NTQQFileApi[_0xf4ff03(0x1e0)](_0x559650,ElementType['FILE']);if(_0x106489[_0xf4ff03(0x1cb)](_0x2d026f,0x0))throw _0xf4ff03(0x1c3);const _0x2194d3={'elementType':ElementType[_0xf4ff03(0x1b5)],'elementId':'','fileElement':{'fileName':_0x28da7b||_0x4b1b6a,'folderId':_0x2100ec,'filePath':_0x1941bb,'fileSize':_0x2d026f['toString']()}};return _0x2194d3;}static async['video'](_0x136d42,_0x192574='',_0x45b622=''){const _0x1de401=_0x16789c,_0x20d4b8={'vumaS':function(_0x1e92a9,_0x1e916e,_0x3259bf){return _0x1e92a9(_0x1e916e,_0x3259bf);},'oMPwq':_0x1de401(0x203),'pSeCe':function(_0x23f8e5,_0x2fcb01){return _0x23f8e5(_0x2fcb01);},'xHuUZ':function(_0x2c83cb,_0x5ca8be){return _0x2c83cb(_0x5ca8be);},'bSXVP':'end','YnZHc':_0x1de401(0x1a7),'vWCes':function(_0x88eed0,_0x3ae942){return _0x88eed0+_0x3ae942;},'NOwkD':function(_0x549826,_0x54c118){return _0x549826===_0x54c118;},'uequT':_0x1de401(0x1c3),'nKfCv':_0x1de401(0x1f5),'lKgiX':function(_0x41781e,_0x569402,_0x5dc001){return _0x41781e(_0x569402,_0x5dc001);},'tVvKM':_0x1de401(0x1ec),'oQkdJ':function(_0x4e0bac,_0xe248fb){return _0x4e0bac||_0xe248fb;}},{fileName:_0x1416fc,path:_0x5313be,fileSize:_0x521f52,md5:_0x5ada8f}=await NTQQFileApi[_0x1de401(0x1e0)](_0x136d42,ElementType[_0x1de401(0x1b3)]);if(_0x20d4b8['NOwkD'](_0x521f52,0x0))throw _0x20d4b8[_0x1de401(0x1ca)];let _0x55c4ce=_0x5313be[_0x1de401(0x1d3)](_0x4019f6['sep']+_0x1de401(0x1ef)+_0x4019f6[_0x1de401(0x1c0)],_0x4019f6[_0x1de401(0x1c0)]+_0x1de401(0x1db)+_0x4019f6['sep']);_0x55c4ce=_0x4019f6[_0x1de401(0x1bc)](_0x55c4ce);let _0x42d114={'width':0x780,'height':0x438,'time':0xf,'format':_0x20d4b8[_0x1de401(0x1d9)],'size':_0x521f52,'filePath':_0x136d42};try{_0x42d114=await getVideoInfo(_0x5313be);}catch(_0x223f0c){_0x20d4b8[_0x1de401(0x1ed)](logError,_0x20d4b8['tVvKM'],_0x223f0c);}const _0x58bb12=new Promise((_0x1c70e5,_0x5a8a8f)=>{const _0x4ac28e=_0x1de401,_0x599766={'OTnfh':function(_0x1d6eef,_0x42c554){const _0x9327fa=_0x3ce3;return _0x20d4b8[_0x9327fa(0x1f2)](_0x1d6eef,_0x42c554);}},_0x3e4aa6=_0x5ada8f+_0x4ac28e(0x1c2),_0x55a864=_0x4019f6[_0x4ac28e(0x202)](_0x55c4ce,_0x3e4aa6);_0x20d4b8[_0x4ac28e(0x1a9)](_0x1857b4,_0x136d42)['on'](_0x20d4b8[_0x4ac28e(0x1fe)],()=>{})['on'](_0x20d4b8[_0x4ac28e(0x1b7)],_0xcacad9=>{const _0x4bde1d=_0x4ac28e;_0x20d4b8[_0x4bde1d(0x1ba)](logDebug,_0x20d4b8[_0x4bde1d(0x1f6)],_0xcacad9),_0x45b622?_0x5c0afb[_0x4bde1d(0x1d7)](_0x45b622,_0x55a864)[_0x4bde1d(0x1ae)](()=>{_0x1c70e5(_0x55a864);})['catch'](_0x5a8a8f):_0x5c0afb['writeFile'](_0x55a864,defaultVideoThumb)['then'](()=>{const _0x5e88ae=_0x4bde1d;_0x599766[_0x5e88ae(0x1d1)](_0x1c70e5,_0x55a864);})[_0x4bde1d(0x1f4)](_0x5a8a8f);})[_0x4ac28e(0x201)]({'timestamps':[0x0],'filename':_0x3e4aa6,'folder':_0x55c4ce,'size':_0x20d4b8['vWCes'](_0x20d4b8[_0x4ac28e(0x1a8)](_0x42d114[_0x4ac28e(0x1d4)],'x'),_0x42d114[_0x4ac28e(0x1c9)])})['on'](_0x20d4b8[_0x4ac28e(0x1fe)],()=>{_0x1c70e5(_0x55a864);});}),_0xf459e3=new Map(),_0x49f1bb=await _0x58bb12,_0x1174fa=(await _0x5c0afb[_0x1de401(0x1f8)](_0x49f1bb))['size'];_0xf459e3[_0x1de401(0x1bb)](0x0,_0x49f1bb);const _0x5264c6=await _0x20d4b8[_0x1de401(0x1f2)](calculateFileMD5,_0x49f1bb),_0x42cad8={'elementType':ElementType[_0x1de401(0x1b3)],'elementId':'','videoElement':{'fileName':_0x20d4b8['oQkdJ'](_0x192574,_0x1416fc),'filePath':_0x5313be,'videoMd5':_0x5ada8f,'thumbMd5':_0x5264c6,'fileTime':_0x42d114[_0x1de401(0x1c8)],'thumbPath':_0xf459e3,'thumbSize':_0x1174fa,'thumbWidth':_0x42d114[_0x1de401(0x1d4)],'thumbHeight':_0x42d114['height'],'fileSize':_0x20d4b8['vWCes']('',_0x521f52)}};return _0x42cad8;}static async[_0x16789c(0x1ee)](_0x238ca6){const _0x128733=_0x16789c,_0x44e9ed={'BLJVA':function(_0x3f7d7c,_0x10ad10){return _0x3f7d7c(_0x10ad10);},'JSGuq':_0x128733(0x1cd),'bezRg':_0x128733(0x1c3),'aoPsH':function(_0x3c5327,_0x2cd618){return _0x3c5327||_0x2cd618;}},{converted:_0x1cae30,path:_0x69c1e4,duration:_0x909bb1}=await _0x44e9ed[_0x128733(0x1ce)](encodeSilk,_0x238ca6);if(!_0x69c1e4)throw _0x44e9ed[_0x128733(0x1fd)];const {md5:_0x1aa186,fileName:_0x4df358,path:_0x5e91d3,fileSize:_0x5e6be5}=await NTQQFileApi['uploadFile'](_0x69c1e4,ElementType['PTT']);if(_0x5e6be5===0x0)throw _0x44e9ed['bezRg'];return _0x1cae30&&_0x5c0afb[_0x128733(0x1e8)](_0x69c1e4)['then'](),{'elementType':ElementType[_0x128733(0x1b6)],'elementId':'','pttElement':{'fileName':_0x4df358,'filePath':_0x5e91d3,'md5HexStr':_0x1aa186,'fileSize':_0x5e6be5,'duration':_0x44e9ed['aoPsH'](_0x909bb1,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x16789c(0x206)](_0x3929ea){const _0x1efb18=_0x16789c,_0x53d201={'sPCKQ':function(_0x49c7d7,_0x2f35a0){return _0x49c7d7(_0x2f35a0);},'VwMcK':function(_0x85030,_0x3e73a6){return _0x85030>=_0x3e73a6;}},_0x52b2b4=_0x35bc2e['sysface'],_0x5c2401=_0x35bc2e['emoji'],_0x2d3758=_0x52b2b4[_0x1efb18(0x1e6)](_0x18351f=>_0x18351f['QSid']===_0x3929ea[_0x1efb18(0x1f0)]());_0x3929ea=_0x53d201[_0x1efb18(0x1de)](parseInt,_0x3929ea[_0x1efb18(0x1f0)]());let _0x2489f5=0x1;return _0x53d201['VwMcK'](_0x3929ea,0xde)&&(_0x2489f5=0x2),_0x2d3758[_0x1efb18(0x1b8)]&&(_0x2489f5=0x3),{'elementType':ElementType[_0x1efb18(0x1d0)],'elementId':'','faceElement':{'faceIndex':_0x3929ea,'faceType':_0x2489f5,'faceText':_0x2d3758['QDes'],'stickerId':_0x2d3758[_0x1efb18(0x1b2)],'stickerType':_0x2d3758['AniStickerType'],'packId':_0x2d3758[_0x1efb18(0x1ff)],'sourceType':0x1}};}static[_0x16789c(0x1c5)](_0x32a7f5,_0x5b0633,_0xeff488,_0x4313d1){const _0x23f046=_0x16789c,_0x4fdc0f={'fiwtB':_0x23f046(0x1c6)};return{'elementType':ElementType[_0x23f046(0x1d5)],'marketFaceElement':{'emojiPackageId':_0x32a7f5,'emojiId':_0x5b0633,'key':_0xeff488,'faceName':_0x4313d1||mFaceCache[_0x23f046(0x1cf)](_0x5b0633)||_0x4fdc0f[_0x23f046(0x1fa)]}};}static[_0x16789c(0x1fb)](_0x5eb73c){const _0x2fbb48=_0x16789c,_0x1cd14e={'HtaZX':_0x2fbb48(0x1b1)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x2fbb48(0x1fb)],'faceType':FaceType[_0x2fbb48(0x1fb)],'faceText':_0x1cd14e[_0x2fbb48(0x1bf)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x16789c(0x1dc)](_0x31f781){const _0x168c53=_0x16789c,_0x32f4e9={'IYcbi':_0x168c53(0x1e1)};return{'elementType':ElementType[_0x168c53(0x1d0)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x32f4e9[_0x168c53(0x1d6)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x16789c(0x1b9)](_0x376b6e){const _0x3cb8d9=_0x16789c,_0x2096b6={'clHqu':function(_0xfd9dda,_0x423840){return _0xfd9dda!==_0x423840;},'Ousmq':_0x3cb8d9(0x1c4)};return _0x2096b6[_0x3cb8d9(0x1f3)](typeof _0x376b6e,_0x2096b6[_0x3cb8d9(0x1dd)])&&(_0x376b6e=JSON[_0x3cb8d9(0x1cc)](_0x376b6e)),{'elementType':ElementType[_0x3cb8d9(0x1df)],'elementId':'','arkElement':{'bytesData':_0x376b6e,'linkInfo':null,'subElementType':null}};}static[_0x16789c(0x204)](_0x4db0a4){const _0x1dc897=_0x16789c;return{'elementType':ElementType[_0x1dc897(0x1ea)],'elementId':'','markdownElement':{'content':_0x4db0a4}};}static async[_0x16789c(0x1fc)](){const _0x306a03=_0x16789c,_0xf9375e={'NTKKE':function(_0x59a005,_0x11af19){return _0x59a005(_0x11af19);},'smOwt':'Bot\x20Test','dsZYT':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','uiJWh':_0x306a03(0x1ad)};let _0xfb1ee5=await _0xf9375e[_0x306a03(0x1da)](SignMiniApp,{'prompt':_0xf9375e[_0x306a03(0x1b0)],'title':_0xf9375e['smOwt'],'preview':_0xf9375e['dsZYT'],'jumpUrl':_0x306a03(0x208),'tag':_0xf9375e[_0x306a03(0x1b0)],'tagIcon':_0xf9375e[_0x306a03(0x1be)],'source':_0xf9375e[_0x306a03(0x1b0)],'sourcelogo':_0x306a03(0x1ad)});return{'elementType':ElementType[_0x306a03(0x1df)],'elementId':'','arkElement':{'bytesData':_0xfb1ee5,'linkInfo':null,'subElementType':null}};}}