const _0x7fe54c=_0x3bdd;(function(_0x4e26f8,_0x5e81ef){const _0x1b92ad=_0x3bdd,_0x511ba9=_0x4e26f8();while(!![]){try{const _0x45fdfb=-parseInt(_0x1b92ad(0x129))/0x1+parseInt(_0x1b92ad(0x150))/0x2+parseInt(_0x1b92ad(0x13b))/0x3+parseInt(_0x1b92ad(0x123))/0x4*(parseInt(_0x1b92ad(0x15b))/0x5)+-parseInt(_0x1b92ad(0x143))/0x6*(-parseInt(_0x1b92ad(0x16f))/0x7)+parseInt(_0x1b92ad(0x112))/0x8+-parseInt(_0x1b92ad(0x124))/0x9;if(_0x45fdfb===_0x5e81ef)break;else _0x511ba9['push'](_0x511ba9['shift']());}catch(_0x5440ad){_0x511ba9['push'](_0x511ba9['shift']());}}}(_0x2820,0x98496));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x5d59cd}from'node:fs';import _0x311865 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x2820(){const _0x3fe2e1=['https://www.bilibili.com/','catch','zBDoq','screenshots','height','aeItS','stringify','2754864qsWDQv','LlXxG','AniStickerType','ptt','writeFile','emFsC','dice','uaDOZ','markdown','error','getImageSize','join','replace','face','ark','视频信息','sysface','433084mdbHng','19986606ngsaSH','BGvwS','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','sep','[商城表情]','160500CiJGyF','unlink','get','itioF','TEXT','lTAaw','AniStickerPackId','VIDEO','emoji','PTT','text','mp4','图片信息','MFACE','set','RibEF','QeJhL','WdJHn','1934247qtshzf','语音转换失败,\x20请检查语音文件是否正常','GXeCZ','Krnip','QDes','REPLY','RPS','NODuN','79470vjtByp','bkxSr','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','[骰子]','LmyCd','haJqk','stat','miniapp','MARKDOWN','width','find','brdjw','uploadFile','1411414LibjMK','ARK','reply','PIC','dirname','mvVyW','AniStickerId','FILE','FACE','获取视频信息失败','jUOez','55AQHWGu','zipNU','文件异常，大小为0','Bot\x20Test','video','获取视频封面失败，使用默认封面','string','toString','lvePc','dzzRH','pPlSV','mface','mtTda','BqagP','end','lNQJs','then','Ori','QSid','ylllf','63alwzwH'];_0x2820=function(){return _0x3fe2e1;};return _0x2820();}import{encodeSilk}from'@/common/utils/audio';import _0x1b03eb from'./face_config.json';import*as _0x21c2a5 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();function _0x3bdd(_0x1c464a,_0x321391){const _0x2820c2=_0x2820();return _0x3bdd=function(_0x3bddbf,_0x4d486a){_0x3bddbf=_0x3bddbf-0x10f;let _0x5f16f8=_0x2820c2[_0x3bddbf];return _0x5f16f8;},_0x3bdd(_0x1c464a,_0x321391);}export class SendMsgElementConstructor{static[_0x7fe54c(0x133)](_0x6c2c4d){const _0x5d34ec=_0x7fe54c;return{'elementType':ElementType[_0x5d34ec(0x12d)],'elementId':'','textElement':{'content':_0x6c2c4d,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0xd075d2,_0x51f87b,_0x331d2b,_0x2ffb26){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x2ffb26,'atType':_0x331d2b,'atUid':_0xd075d2,'atTinyId':'','atNtUid':_0x51f87b}};}static[_0x7fe54c(0x152)](_0x31bebf,_0x92854f,_0x1562bc,_0x2e49b3){const _0x2ce197=_0x7fe54c;return{'elementType':ElementType[_0x2ce197(0x140)],'elementId':'','replyElement':{'replayMsgSeq':_0x31bebf,'replayMsgId':_0x92854f,'senderUin':_0x1562bc,'senderUinStr':_0x2e49b3}};}static async['pic'](_0x3b06f2,_0x34f839='',_0x3a7300=0x0){const _0x5b8945=_0x7fe54c,_0x369e8f={'KLoeW':function(_0x55ba7d,_0x74ccfc){return _0x55ba7d(_0x74ccfc);},'emFsC':function(_0xe373da,_0x3f7c55,_0x3a8941){return _0xe373da(_0x3f7c55,_0x3a8941);},'jUOez':_0x5b8945(0x135)},{md5:_0x160ddd,fileName:_0xaf078f,path:_0x596f2e,fileSize:_0x28693a}=await NTQQFileApi[_0x5b8945(0x14f)](_0x3b06f2,ElementType[_0x5b8945(0x153)],_0x3a7300);if(_0x28693a===0x0)throw'文件异常，大小为0';const _0x19214f=await NTQQFileApi[_0x5b8945(0x11c)](_0x3b06f2),_0x31c3c7={'md5HexStr':_0x160ddd,'fileSize':_0x28693a[_0x5b8945(0x162)](),'picWidth':_0x19214f?.[_0x5b8945(0x14c)],'picHeight':_0x19214f?.[_0x5b8945(0x10f)],'fileName':_0xaf078f,'sourcePath':_0x596f2e,'original':!![],'picType':_0x369e8f['KLoeW'](isGIF,_0x3b06f2)?PicType['gif']:PicType['jpg'],'picSubType':_0x3a7300,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x34f839};return _0x369e8f[_0x5b8945(0x117)](logDebug,_0x369e8f[_0x5b8945(0x15a)],_0x31c3c7),{'elementType':ElementType[_0x5b8945(0x153)],'elementId':'','picElement':_0x31c3c7};}static async['file'](_0x4d6143,_0x2a3314=''){const _0x8b1d68=_0x7fe54c,_0x29cde9={'dzzRH':function(_0xba2519,_0x1ea60){return _0xba2519===_0x1ea60;},'haJqk':_0x8b1d68(0x15d),'zBDoq':function(_0x12d407,_0x3d7f85){return _0x12d407||_0x3d7f85;}},{md5:_0x270f5d,fileName:_0x369c04,path:_0x1d97ff,fileSize:_0x47d398}=await NTQQFileApi[_0x8b1d68(0x14f)](_0x4d6143,ElementType[_0x8b1d68(0x157)]);if(_0x29cde9[_0x8b1d68(0x164)](_0x47d398,0x0))throw _0x29cde9[_0x8b1d68(0x148)];const _0x4bf1c9={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x29cde9[_0x8b1d68(0x172)](_0x2a3314,_0x369c04),'filePath':_0x1d97ff,'fileSize':_0x47d398['toString']()}};return _0x4bf1c9;}static async[_0x7fe54c(0x15f)](_0x1e265d,_0x1d67af='',_0x37cdd2=''){const _0x503744=_0x7fe54c,_0x8d42ea={'LmyCd':function(_0x3f823e,_0x6afc03){return _0x3f823e(_0x6afc03);},'brdjw':function(_0x1919b3,_0x5022a4,_0x32ac9e){return _0x1919b3(_0x5022a4,_0x32ac9e);},'BGvwS':_0x503744(0x160),'yLEuI':_0x503744(0x169),'Krnip':_0x503744(0x11b),'RibEF':function(_0xf62319,_0xc1e26f){return _0xf62319+_0xc1e26f;},'FtUre':function(_0xcf557f,_0x4c9260){return _0xcf557f===_0x4c9260;},'kHJJP':_0x503744(0x15d),'lNQJs':_0x503744(0x134),'lvePc':_0x503744(0x121),'LlXxG':function(_0xc3478a,_0x4b4841,_0x3a7de4){return _0xc3478a(_0x4b4841,_0x3a7de4);},'WdJHn':_0x503744(0x159),'lcikU':function(_0x5ba459,_0x4bcb4f){return _0x5ba459||_0x4bcb4f;}},{fileName:_0x3ea114,path:_0x4cec55,fileSize:_0x4b47b5,md5:_0x15826a}=await NTQQFileApi[_0x503744(0x14f)](_0x1e265d,ElementType[_0x503744(0x130)]);if(_0x8d42ea['FtUre'](_0x4b47b5,0x0))throw _0x8d42ea['kHJJP'];let _0x25e30a=_0x4cec55[_0x503744(0x11e)](_0x21c2a5[_0x503744(0x127)]+_0x503744(0x16c)+_0x21c2a5[_0x503744(0x127)],_0x21c2a5['sep']+'Thumb'+_0x21c2a5[_0x503744(0x127)]);_0x25e30a=_0x21c2a5[_0x503744(0x154)](_0x25e30a);let _0x4fafe0={'width':0x780,'height':0x438,'time':0xf,'format':_0x8d42ea[_0x503744(0x16a)],'size':_0x4b47b5,'filePath':_0x1e265d};try{_0x4fafe0=await _0x8d42ea[_0x503744(0x147)](getVideoInfo,_0x4cec55),_0x8d42ea[_0x503744(0x14e)](logDebug,_0x8d42ea[_0x503744(0x163)],_0x4fafe0);}catch(_0x29edd1){_0x8d42ea[_0x503744(0x113)](logError,_0x8d42ea[_0x503744(0x13a)],_0x29edd1);}const _0x20d818=new Promise((_0x2ae6cd,_0x4d84a4)=>{const _0x74a0c3=_0x503744,_0x6b4caa={'lTAaw':function(_0x2673c7,_0x368df8){return _0x8d42ea['LmyCd'](_0x2673c7,_0x368df8);},'bkxSr':function(_0x518252,_0x59f9f4,_0x5a13fc){const _0x3a426e=_0x3bdd;return _0x8d42ea[_0x3a426e(0x14e)](_0x518252,_0x59f9f4,_0x5a13fc);},'zrBRD':_0x8d42ea[_0x74a0c3(0x125)]},_0x4e12b1=_0x15826a+'_0.png',_0x2f73d1=_0x21c2a5[_0x74a0c3(0x11d)](_0x25e30a,_0x4e12b1);_0x8d42ea[_0x74a0c3(0x147)](_0x311865,_0x1e265d)['on'](_0x8d42ea['yLEuI'],()=>{})['on'](_0x8d42ea[_0x74a0c3(0x13e)],_0x227fd2=>{const _0x3685bc=_0x74a0c3,_0x3fef6b={'zipNU':function(_0x34fc7e,_0x3b46a9){const _0xd694de=_0x3bdd;return _0x6b4caa[_0xd694de(0x12e)](_0x34fc7e,_0x3b46a9);}};_0x6b4caa[_0x3685bc(0x144)](logDebug,_0x6b4caa['zrBRD'],_0x227fd2),_0x37cdd2?_0x5d59cd['copyFile'](_0x37cdd2,_0x2f73d1)[_0x3685bc(0x16b)](()=>{_0x2ae6cd(_0x2f73d1);})['catch'](_0x4d84a4):_0x5d59cd[_0x3685bc(0x116)](_0x2f73d1,defaultVideoThumb)[_0x3685bc(0x16b)](()=>{const _0x469a6e=_0x3685bc;_0x3fef6b[_0x469a6e(0x15c)](_0x2ae6cd,_0x2f73d1);})[_0x3685bc(0x171)](_0x4d84a4);})[_0x74a0c3(0x173)]({'timestamps':[0x0],'filename':_0x4e12b1,'folder':_0x25e30a,'size':_0x8d42ea['RibEF'](_0x8d42ea[_0x74a0c3(0x138)](_0x4fafe0[_0x74a0c3(0x14c)],'x'),_0x4fafe0[_0x74a0c3(0x10f)])})['on'](_0x74a0c3(0x169),()=>{const _0x40fa0c=_0x74a0c3;_0x8d42ea[_0x40fa0c(0x147)](_0x2ae6cd,_0x2f73d1);});}),_0x408730=new Map(),_0x2fa041=await _0x20d818,_0x33bd98=(await _0x5d59cd[_0x503744(0x149)](_0x2fa041))['size'];_0x408730[_0x503744(0x137)](0x0,_0x2fa041);const _0x5374f5=await calculateFileMD5(_0x2fa041),_0x28a4c1={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x8d42ea['lcikU'](_0x1d67af,_0x3ea114),'filePath':_0x4cec55,'videoMd5':_0x15826a,'thumbMd5':_0x5374f5,'fileTime':_0x4fafe0['time'],'thumbPath':_0x408730,'thumbSize':_0x33bd98,'thumbWidth':_0x4fafe0[_0x503744(0x14c)],'thumbHeight':_0x4fafe0[_0x503744(0x10f)],'fileSize':''+_0x4b47b5}};return _0x28a4c1;}static async[_0x7fe54c(0x115)](_0x351bdb){const _0x366db1=_0x7fe54c,_0x5f518a={'uaDOZ':function(_0x25c8fb,_0x5ee752){return _0x25c8fb(_0x5ee752);},'BqagP':_0x366db1(0x13c),'YAkMw':function(_0x25f543,_0x5a7be0){return _0x25f543===_0x5a7be0;},'mvVyW':_0x366db1(0x15d),'mtTda':function(_0x259984,_0x56c4ca){return _0x259984||_0x56c4ca;}},{converted:_0x4fe5e1,path:_0x2ac67d,duration:_0x1aec8d}=await _0x5f518a[_0x366db1(0x119)](encodeSilk,_0x351bdb);if(!_0x2ac67d)throw _0x5f518a[_0x366db1(0x168)];const {md5:_0x5ccd28,fileName:_0x41abba,path:_0x51a7db,fileSize:_0x5d2d05}=await NTQQFileApi[_0x366db1(0x14f)](_0x2ac67d,ElementType[_0x366db1(0x132)]);if(_0x5f518a['YAkMw'](_0x5d2d05,0x0))throw _0x5f518a[_0x366db1(0x155)];return _0x4fe5e1&&_0x5d59cd[_0x366db1(0x12a)](_0x2ac67d)['then'](),{'elementType':ElementType[_0x366db1(0x132)],'elementId':'','pttElement':{'fileName':_0x41abba,'filePath':_0x51a7db,'md5HexStr':_0x5ccd28,'fileSize':_0x5d2d05,'duration':_0x5f518a[_0x366db1(0x167)](_0x1aec8d,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x7fe54c(0x11f)](_0x29a067){const _0x571476=_0x7fe54c,_0x4f98eb={'aeItS':function(_0x2b5951,_0x2fed5c){return _0x2b5951(_0x2fed5c);},'itioF':function(_0x184c96,_0xf9c368){return _0x184c96>=_0xf9c368;}},_0x3e00ca=_0x1b03eb[_0x571476(0x122)],_0x45043b=_0x1b03eb[_0x571476(0x131)],_0x355fca=_0x3e00ca[_0x571476(0x14d)](_0x106ea9=>_0x106ea9[_0x571476(0x16d)]===_0x29a067[_0x571476(0x162)]());_0x29a067=_0x4f98eb[_0x571476(0x110)](parseInt,_0x29a067[_0x571476(0x162)]());let _0xe7cccb=0x1;return _0x4f98eb[_0x571476(0x12c)](_0x29a067,0xde)&&(_0xe7cccb=0x2),_0x355fca[_0x571476(0x114)]&&(_0xe7cccb=0x3),{'elementType':ElementType[_0x571476(0x158)],'elementId':'','faceElement':{'faceIndex':_0x29a067,'faceType':_0xe7cccb,'faceText':_0x355fca[_0x571476(0x13f)],'stickerId':_0x355fca[_0x571476(0x156)],'stickerType':_0x355fca[_0x571476(0x114)],'packId':_0x355fca[_0x571476(0x12f)],'sourceType':0x1}};}static[_0x7fe54c(0x166)](_0x3c2625,_0x1c76bd,_0x404275,_0x19b5dd){const _0x19789b=_0x7fe54c,_0x510b05={'ylllf':_0x19789b(0x128)};return{'elementType':ElementType[_0x19789b(0x136)],'marketFaceElement':{'emojiPackageId':_0x3c2625,'emojiId':_0x1c76bd,'key':_0x404275,'faceName':_0x19b5dd||mFaceCache[_0x19789b(0x12b)](_0x1c76bd)||_0x510b05[_0x19789b(0x16e)]}};}static[_0x7fe54c(0x118)](_0x89dcc){const _0x208d83=_0x7fe54c,_0x4b956b={'PONuy':_0x208d83(0x146)};return{'elementType':ElementType[_0x208d83(0x158)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x208d83(0x118)],'faceType':FaceType[_0x208d83(0x118)],'faceText':_0x4b956b['PONuy'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x15017a){const _0x79c54f=_0x7fe54c;return{'elementType':ElementType[_0x79c54f(0x158)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x79c54f(0x141)],'faceText':'[包剪锤]','faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x7fe54c(0x120)](_0x289c81){const _0xcb1680=_0x7fe54c,_0x3b152b={'YhBBo':function(_0x5d9a02,_0x2a0180){return _0x5d9a02!==_0x2a0180;},'xWOyc':_0xcb1680(0x161)};return _0x3b152b['YhBBo'](typeof _0x289c81,_0x3b152b['xWOyc'])&&(_0x289c81=JSON[_0xcb1680(0x111)](_0x289c81)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x289c81,'linkInfo':null,'subElementType':null}};}static[_0x7fe54c(0x11a)](_0x1440f0){const _0x30db95=_0x7fe54c;return{'elementType':ElementType[_0x30db95(0x14b)],'elementId':'','markdownElement':{'content':_0x1440f0}};}static async[_0x7fe54c(0x14a)](){const _0x588539=_0x7fe54c,_0x2cbb63={'QeJhL':_0x588539(0x15e),'GXeCZ':_0x588539(0x126),'NODuN':_0x588539(0x170),'pPlSV':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0x5c19f9=await SignMiniApp({'prompt':_0x2cbb63[_0x588539(0x139)],'title':_0x2cbb63[_0x588539(0x139)],'preview':_0x2cbb63[_0x588539(0x13d)],'jumpUrl':_0x2cbb63[_0x588539(0x142)],'tag':_0x588539(0x15e),'tagIcon':_0x588539(0x145),'source':_0x2cbb63[_0x588539(0x139)],'sourcelogo':_0x2cbb63[_0x588539(0x165)]});return{'elementType':ElementType[_0x588539(0x151)],'elementId':'','arkElement':{'bytesData':_0x5c19f9,'linkInfo':null,'subElementType':null}};}}