const _0x2871fc=_0x12b5;(function(_0x34a863,_0x335285){const _0x4dcd58=_0x12b5,_0x242aec=_0x34a863();while(!![]){try{const _0x4fb67e=-parseInt(_0x4dcd58(0x16d))/0x1*(-parseInt(_0x4dcd58(0x155))/0x2)+-parseInt(_0x4dcd58(0x13d))/0x3*(-parseInt(_0x4dcd58(0x181))/0x4)+-parseInt(_0x4dcd58(0x144))/0x5+-parseInt(_0x4dcd58(0x141))/0x6*(parseInt(_0x4dcd58(0x194))/0x7)+parseInt(_0x4dcd58(0x17b))/0x8+-parseInt(_0x4dcd58(0x157))/0x9*(-parseInt(_0x4dcd58(0x169))/0xa)+-parseInt(_0x4dcd58(0x17f))/0xb;if(_0x4fb67e===_0x335285)break;else _0x242aec['push'](_0x242aec['shift']());}catch(_0x2ccc77){_0x242aec['push'](_0x242aec['shift']());}}}(_0x4d59,0x7a7f6));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x1214bd}from'node:fs';function _0x12b5(_0x59a0df,_0x57c345){const _0x4d5970=_0x4d59();return _0x12b5=function(_0x12b509,_0x4bc1cf){_0x12b509=_0x12b509-0x13d;let _0x38463e=_0x4d5970[_0x12b509];return _0x38463e;},_0x12b5(_0x59a0df,_0x57c345);}import _0x4a970b from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x4d59(){const _0x46828c=['getImageSize','视频信息','PTT','copyFile','RmUjs','dice','jiIBU','FlTiB','width','catch','kOGoQ','获取视频信息失败','sZEDE','2QsMRTH','then','7290cirIln','AniStickerId','EfThg','AniStickerType','FACE','jajKg','文件异常，大小为0','TUbBf','height','ptt','_0.png','replace','ark','FFFQJ','JKRvb','EvTJS','mp4','toString','10810RRLStk','emoji','QHKSS','EzqGc','857309TrSCGE','pwsXw','stringify','vamdH','Thumb','jpg','DiTzT','notAt','gFZhq','hLaGE','AniStickerPackId','RPS','MARKDOWN','unlink','1750544kvoVbX','Ori','ARK','Zabfk','7992248xcgdgY','sep','4HllpQe','wMBUn','face','mface','PIC','FILE','markdown','REPLY','text','writeFile','kEgxv','baAeZ','HzXyP','video','uploadFile','TEXT','pVIvv','ElWzg','获取视频封面失败，使用默认封面','5660326sCiQYi','DeSZT','QAXhi','get','1250157wFwCIA','stat','join','QDes','6bcvSHo','MFACE','screenshots','1657600pCedvb','图片信息','zvwSb','[骰子]'];_0x4d59=function(){return _0x46828c;};return _0x4d59();}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x3d033a from'./face_config.json';import*as _0x146c60 from'node:path';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x2871fc(0x189)](_0x568766){const _0x1089e7=_0x2871fc;return{'elementType':ElementType[_0x1089e7(0x190)],'elementId':'','textElement':{'content':_0x568766,'atType':AtType[_0x1089e7(0x174)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x567473,_0x7f3c2d,_0x2af050,_0x5047d6){const _0x7cc4fb=_0x2871fc;return{'elementType':ElementType[_0x7cc4fb(0x190)],'elementId':'','textElement':{'content':'@'+_0x5047d6,'atType':_0x2af050,'atUid':_0x567473,'atTinyId':'','atNtUid':_0x7f3c2d}};}static['reply'](_0x1e64bf,_0x1b3ac6,_0x255c37,_0x3f24f2){const _0x160c9c=_0x2871fc;return{'elementType':ElementType[_0x160c9c(0x188)],'elementId':'','replyElement':{'replayMsgSeq':_0x1e64bf,'replayMsgId':_0x1b3ac6,'senderUin':_0x255c37,'senderUinStr':_0x3f24f2}};}static async['pic'](_0x4e648b,_0x5df1a9='',_0x58d510=0x0){const _0x1034e5=_0x2871fc,_0xdb4b8b={'RJkIN':function(_0x4a24a4,_0x270e33){return _0x4a24a4===_0x270e33;},'jajKg':_0x1034e5(0x15d),'Zabfk':function(_0xd71c,_0x76c10e){return _0xd71c(_0x76c10e);},'kEgxv':function(_0x1379ed,_0x34ae80,_0x5919d3){return _0x1379ed(_0x34ae80,_0x5919d3);},'hLaGE':_0x1034e5(0x145)},{md5:_0x37a330,fileName:_0xbe55b6,path:_0x3ef86f,fileSize:_0x22de4b}=await NTQQFileApi[_0x1034e5(0x18f)](_0x4e648b,ElementType[_0x1034e5(0x185)],_0x58d510);if(_0xdb4b8b['RJkIN'](_0x22de4b,0x0))throw _0xdb4b8b[_0x1034e5(0x15c)];const _0x426b6a=await NTQQFileApi[_0x1034e5(0x148)](_0x4e648b),_0x42f722={'md5HexStr':_0x37a330,'fileSize':_0x22de4b[_0x1034e5(0x168)](),'picWidth':_0x426b6a?.[_0x1034e5(0x150)],'picHeight':_0x426b6a?.[_0x1034e5(0x15f)],'fileName':_0xbe55b6,'sourcePath':_0x3ef86f,'original':!![],'picType':_0xdb4b8b[_0x1034e5(0x17e)](isGIF,_0x4e648b)?PicType['gif']:PicType[_0x1034e5(0x172)],'picSubType':_0x58d510,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5df1a9};return _0xdb4b8b[_0x1034e5(0x18b)](logDebug,_0xdb4b8b[_0x1034e5(0x176)],_0x42f722),{'elementType':ElementType[_0x1034e5(0x185)],'elementId':'','picElement':_0x42f722};}static async['file'](_0x1a1ccd,_0x479947=''){const _0x52c526=_0x2871fc,_0x28dcde={'EfThg':function(_0x14114b,_0x31bd52){return _0x14114b===_0x31bd52;},'baAeZ':function(_0x40bc98,_0x4afe9b){return _0x40bc98||_0x4afe9b;}},{md5:_0x48b594,fileName:_0xd2317d,path:_0x1a2ee4,fileSize:_0x45f274}=await NTQQFileApi['uploadFile'](_0x1a1ccd,ElementType[_0x52c526(0x186)]);if(_0x28dcde[_0x52c526(0x159)](_0x45f274,0x0))throw _0x52c526(0x15d);const _0x50de57={'elementType':ElementType[_0x52c526(0x186)],'elementId':'','fileElement':{'fileName':_0x28dcde[_0x52c526(0x18c)](_0x479947,_0xd2317d),'filePath':_0x1a2ee4,'fileSize':_0x45f274[_0x52c526(0x168)]()}};return _0x50de57;}static async[_0x2871fc(0x18e)](_0x4822f3,_0x421b27='',_0x2038db=''){const _0x46bf97=_0x2871fc,_0x3b6128={'jTybx':function(_0x1c905c,_0x11c122){return _0x1c905c(_0x11c122);},'QHKSS':function(_0x3654ec,_0x22dfd8,_0x5d531f){return _0x3654ec(_0x22dfd8,_0x5d531f);},'DeSZT':_0x46bf97(0x193),'HzXyP':function(_0x3201a0,_0x1c1d29){return _0x3201a0(_0x1c1d29);},'RmUjs':'end','FFFQJ':'error','jiIBU':function(_0x1c8125,_0x1929bc){return _0x1c8125+_0x1929bc;},'EvTJS':function(_0x250da4,_0x212fd0){return _0x250da4===_0x212fd0;},'sZEDE':_0x46bf97(0x15d),'vamdH':function(_0x1bb1bb,_0x4f875f){return _0x1bb1bb(_0x4f875f);},'ElWzg':_0x46bf97(0x149),'kOGoQ':function(_0x4c4a13,_0x5a4633,_0x27d20f){return _0x4c4a13(_0x5a4633,_0x27d20f);},'JKRvb':_0x46bf97(0x153),'pVIvv':function(_0x4d9db6,_0x2b0f40){return _0x4d9db6||_0x2b0f40;},'SYDEP':function(_0x349873,_0x33b4cf){return _0x349873+_0x33b4cf;}},{fileName:_0x17e5a7,path:_0x3060ba,fileSize:_0x480868,md5:_0x25be96}=await NTQQFileApi[_0x46bf97(0x18f)](_0x4822f3,ElementType['VIDEO']);if(_0x3b6128[_0x46bf97(0x166)](_0x480868,0x0))throw _0x3b6128[_0x46bf97(0x154)];let _0x5dde1b=_0x3060ba[_0x46bf97(0x162)](_0x146c60['sep']+_0x46bf97(0x17c)+_0x146c60[_0x46bf97(0x180)],_0x146c60[_0x46bf97(0x180)]+_0x46bf97(0x171)+_0x146c60['sep']);_0x5dde1b=_0x146c60['dirname'](_0x5dde1b);let _0x1d5e0c={'width':0x780,'height':0x438,'time':0xf,'format':_0x46bf97(0x167),'size':_0x480868,'filePath':_0x4822f3};try{_0x1d5e0c=await _0x3b6128[_0x46bf97(0x170)](getVideoInfo,_0x3060ba),_0x3b6128[_0x46bf97(0x16b)](logDebug,_0x3b6128[_0x46bf97(0x192)],_0x1d5e0c);}catch(_0x346e33){_0x3b6128[_0x46bf97(0x152)](logError,_0x3b6128[_0x46bf97(0x165)],_0x346e33);}const _0x3eb4cd=new Promise((_0x1b0f8e,_0x21d4fb)=>{const _0x2e27cc=_0x46bf97,_0x484af2={'gFZhq':function(_0x180901,_0x294188){return _0x3b6128['jTybx'](_0x180901,_0x294188);},'wMBUn':function(_0x40e92a,_0x582b51,_0x3234d8){const _0x44ca8c=_0x12b5;return _0x3b6128[_0x44ca8c(0x16b)](_0x40e92a,_0x582b51,_0x3234d8);},'FlTiB':_0x3b6128[_0x2e27cc(0x195)]},_0x4531f2=_0x25be96+_0x2e27cc(0x161),_0xf15ad=_0x146c60[_0x2e27cc(0x13f)](_0x5dde1b,_0x4531f2);_0x3b6128[_0x2e27cc(0x18d)](_0x4a970b,_0x4822f3)['on'](_0x3b6128['RmUjs'],()=>{})['on'](_0x3b6128[_0x2e27cc(0x164)],_0x390bbf=>{const _0x1012ee=_0x2e27cc,_0x5b0c20={'QAXhi':function(_0x5010e9,_0x438f87){const _0x116c74=_0x12b5;return _0x484af2[_0x116c74(0x175)](_0x5010e9,_0x438f87);}};_0x484af2[_0x1012ee(0x182)](logDebug,_0x484af2[_0x1012ee(0x14f)],_0x390bbf),_0x2038db?_0x1214bd[_0x1012ee(0x14b)](_0x2038db,_0xf15ad)['then'](()=>{const _0x4632e3=_0x1012ee;_0x5b0c20[_0x4632e3(0x196)](_0x1b0f8e,_0xf15ad);})['catch'](_0x21d4fb):_0x1214bd[_0x1012ee(0x18a)](_0xf15ad,defaultVideoThumb)[_0x1012ee(0x156)](()=>{_0x1b0f8e(_0xf15ad);})[_0x1012ee(0x151)](_0x21d4fb);})[_0x2e27cc(0x143)]({'timestamps':[0x0],'filename':_0x4531f2,'folder':_0x5dde1b,'size':_0x3b6128[_0x2e27cc(0x14e)](_0x3b6128['jiIBU'](_0x1d5e0c[_0x2e27cc(0x150)],'x'),_0x1d5e0c[_0x2e27cc(0x15f)])})['on'](_0x3b6128[_0x2e27cc(0x14c)],()=>{_0x484af2['gFZhq'](_0x1b0f8e,_0xf15ad);});}),_0x1f059a=new Map(),_0x2f67a4=await _0x3eb4cd,_0x3d80ee=(await _0x1214bd[_0x46bf97(0x13e)](_0x2f67a4))['size'];_0x1f059a['set'](0x0,_0x2f67a4);const _0x13bf1d=await _0x3b6128[_0x46bf97(0x18d)](calculateFileMD5,_0x2f67a4),_0x25ba37={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x3b6128[_0x46bf97(0x191)](_0x421b27,_0x17e5a7),'filePath':_0x3060ba,'videoMd5':_0x25be96,'thumbMd5':_0x13bf1d,'fileTime':_0x1d5e0c['time'],'thumbPath':_0x1f059a,'thumbSize':_0x3d80ee,'thumbWidth':_0x1d5e0c[_0x46bf97(0x150)],'thumbHeight':_0x1d5e0c[_0x46bf97(0x15f)],'fileSize':_0x3b6128['SYDEP']('',_0x480868)}};return _0x25ba37;}static async[_0x2871fc(0x160)](_0x404669){const _0x5f3f66=_0x2871fc,_0x5b78de={'pwsXw':function(_0x5a2bbc,_0x2c189d){return _0x5a2bbc===_0x2c189d;},'zcNar':_0x5f3f66(0x15d)},{converted:_0x2101e5,path:_0x57f0a5,duration:_0xa9c6bf}=await encodeSilk(_0x404669);if(!_0x57f0a5)throw'语音转换失败,\x20请检查语音文件是否正常';const {md5:_0x28272b,fileName:_0x2ef68f,path:_0xc23177,fileSize:_0x14c566}=await NTQQFileApi[_0x5f3f66(0x18f)](_0x57f0a5,ElementType[_0x5f3f66(0x14a)]);if(_0x5b78de[_0x5f3f66(0x16e)](_0x14c566,0x0))throw _0x5b78de['zcNar'];return _0x2101e5&&_0x1214bd[_0x5f3f66(0x17a)](_0x57f0a5)['then'](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x2ef68f,'filePath':_0xc23177,'md5HexStr':_0x28272b,'fileSize':_0x14c566,'duration':_0xa9c6bf||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x2871fc(0x183)](_0xfa64d){const _0x5cc453=_0x2871fc,_0xb4053c={'EzqGc':function(_0x2383ce,_0x18126d){return _0x2383ce(_0x18126d);},'TUbBf':function(_0x14548b,_0x11266f){return _0x14548b>=_0x11266f;}},_0xe80a6a=_0x3d033a['sysface'],_0x5db46c=_0x3d033a[_0x5cc453(0x16a)],_0x4e6d75=_0xe80a6a['find'](_0xac928f=>_0xac928f['QSid']===_0xfa64d[_0x5cc453(0x168)]());_0xfa64d=_0xb4053c[_0x5cc453(0x16c)](parseInt,_0xfa64d['toString']());let _0x19a01b=0x1;return _0xb4053c[_0x5cc453(0x15e)](_0xfa64d,0xde)&&(_0x19a01b=0x2),_0x4e6d75[_0x5cc453(0x15a)]&&(_0x19a01b=0x3),{'elementType':ElementType[_0x5cc453(0x15b)],'elementId':'','faceElement':{'faceIndex':_0xfa64d,'faceType':_0x19a01b,'faceText':_0x4e6d75[_0x5cc453(0x140)],'stickerId':_0x4e6d75[_0x5cc453(0x158)],'stickerType':_0x4e6d75[_0x5cc453(0x15a)],'packId':_0x4e6d75[_0x5cc453(0x177)],'sourceType':0x1}};}static[_0x2871fc(0x184)](_0x1b3ceb,_0x9f1338,_0x4d1fd1,_0x1b8ade){const _0x450b7a=_0x2871fc,_0x3da722={'zvwSb':'[商城表情]'};return{'elementType':ElementType[_0x450b7a(0x142)],'marketFaceElement':{'emojiPackageId':_0x1b3ceb,'emojiId':_0x9f1338,'key':_0x4d1fd1,'faceName':_0x1b8ade||mFaceCache[_0x450b7a(0x197)](_0x9f1338)||_0x3da722[_0x450b7a(0x146)]}};}static[_0x2871fc(0x14d)](_0x510c8d){const _0x3c61e1=_0x2871fc,_0x2f7bf8={'DiTzT':_0x3c61e1(0x147)};return{'elementType':ElementType[_0x3c61e1(0x15b)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':_0x2f7bf8[_0x3c61e1(0x173)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x5662da){const _0x5780c9=_0x2871fc;return{'elementType':ElementType[_0x5780c9(0x15b)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x5780c9(0x178)],'faceText':'[包剪锤]','faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2871fc(0x163)](_0x42bb9d){const _0x4d68a1=_0x2871fc;return typeof _0x42bb9d!=='string'&&(_0x42bb9d=JSON[_0x4d68a1(0x16f)](_0x42bb9d)),{'elementType':ElementType[_0x4d68a1(0x17d)],'elementId':'','arkElement':{'bytesData':_0x42bb9d,'linkInfo':null,'subElementType':null}};}static[_0x2871fc(0x187)](_0x436724){const _0x308b34=_0x2871fc;return{'elementType':ElementType[_0x308b34(0x179)],'elementId':'','markdownElement':{'content':_0x436724}};}}