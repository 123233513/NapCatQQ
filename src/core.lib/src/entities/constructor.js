const _0x5d3a0d=_0x5b1c;(function(_0x10e587,_0x4b4035){const _0x29b6bf=_0x5b1c,_0x4ae254=_0x10e587();while(!![]){try{const _0x265de9=parseInt(_0x29b6bf(0x169))/0x1*(parseInt(_0x29b6bf(0x150))/0x2)+parseInt(_0x29b6bf(0x14b))/0x3*(-parseInt(_0x29b6bf(0x167))/0x4)+parseInt(_0x29b6bf(0x17b))/0x5+-parseInt(_0x29b6bf(0x12a))/0x6*(-parseInt(_0x29b6bf(0x131))/0x7)+parseInt(_0x29b6bf(0x14c))/0x8*(-parseInt(_0x29b6bf(0x165))/0x9)+-parseInt(_0x29b6bf(0x128))/0xa*(parseInt(_0x29b6bf(0x149))/0xb)+parseInt(_0x29b6bf(0x16a))/0xc*(parseInt(_0x29b6bf(0x133))/0xd);if(_0x265de9===_0x4b4035)break;else _0x4ae254['push'](_0x4ae254['shift']());}catch(_0x18a733){_0x4ae254['push'](_0x4ae254['shift']());}}}(_0x243f,0x56633));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x3260ec}from'node:fs';import _0x3c43b0 from'fluent-ffmpeg';function _0x5b1c(_0x247e40,_0x2a2287){const _0x243f9c=_0x243f();return _0x5b1c=function(_0x5b1c77,_0x525d15){_0x5b1c77=_0x5b1c77-0x127;let _0x220ae0=_0x243f9c[_0x5b1c77];return _0x220ae0;},_0x5b1c(_0x247e40,_0x2a2287);}function _0x243f(){const _0x1c305c=['ndFYe','9vosblp','1957744UfXBdQ','join','face','getImageSize','69594TqVWZz','[商城表情]','PTT','writeFile','Ori','TEXT','[骰子]','ptt','BqhHj','AniStickerType','sysface','size','MFACE','uoCKf','LbEba','RPS','width','https://www.bilibili.com/','markdown','copyFile','rps','9mYvIhj','ark','793532XFYZla','PIC','8ohIgSx','96OZrGcs','then','HlSQE','video','oiGDS','QghPE','file','Bot\x20Test','emoji','PmSAz','文件异常，大小为0','FILE','FACE','dice','VIDEO','string','FEHzs','2038080ylzhsR','ZYfBe','jpg','JjfHY','error','toString','270dwespB','screenshots','70806UMtRJu','ySbiY','YmHfp','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','reply','qRRaf','Iqgcw','364hJnBLY','TuLpr','734929fYeHEe','AniStickerId','AniStickerPackId','uploadFile','sep','mp4','_0.png','VgfUe','height','MARKDOWN','Thumb','catch','QDes','replace','bopim','IPhnm','cZKJY','QSid','rHwgu','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','[包剪锤]','xdTvg','227414sneklH'];_0x243f=function(){return _0x1c305c;};return _0x243f();}import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0xfd1802 from'./face_config.json';import*as _0x11c051 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x5e83bc){const _0x1cdaf2=_0x5b1c;return{'elementType':ElementType[_0x1cdaf2(0x155)],'elementId':'','textElement':{'content':_0x5e83bc,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x30c4e5,_0x5930f4,_0x3f8b25,_0x1d8ae0){const _0x2541e0=_0x5b1c;return{'elementType':ElementType[_0x2541e0(0x155)],'elementId':'','textElement':{'content':'@'+_0x1d8ae0,'atType':_0x3f8b25,'atUid':_0x30c4e5,'atTinyId':'','atNtUid':_0x5930f4}};}static[_0x5d3a0d(0x12e)](_0x37825e,_0x2e1c6e,_0x31e907,_0x57daea){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x37825e,'replayMsgId':_0x2e1c6e,'senderUin':_0x31e907,'senderUinStr':_0x57daea}};}static async['pic'](_0x2218e5,_0x50e9ed='',_0x516c00=0x0){const _0xc785ae=_0x5d3a0d,_0x24b236={'LbEba':function(_0x5deab0,_0x3f7e8e){return _0x5deab0===_0x3f7e8e;},'YmHfp':_0xc785ae(0x174),'qRRaf':function(_0x11ea67,_0x44a4dc){return _0x11ea67(_0x44a4dc);}},{md5:_0x440b18,fileName:_0x1a223a,path:_0x5c42c7,fileSize:_0x3e00f9}=await NTQQFileApi[_0xc785ae(0x136)](_0x2218e5,ElementType[_0xc785ae(0x168)],_0x516c00);if(_0x24b236[_0xc785ae(0x15e)](_0x3e00f9,0x0))throw _0x24b236[_0xc785ae(0x12c)];const _0x21a220=await NTQQFileApi[_0xc785ae(0x14f)](_0x2218e5),_0x37dc6d={'md5HexStr':_0x440b18,'fileSize':_0x3e00f9['toString'](),'picWidth':_0x21a220?.[_0xc785ae(0x160)],'picHeight':_0x21a220?.['height'],'fileName':_0x1a223a,'sourcePath':_0x5c42c7,'original':!![],'picType':_0x24b236[_0xc785ae(0x12f)](isGIF,_0x2218e5)?PicType['gif']:PicType[_0xc785ae(0x17d)],'picSubType':_0x516c00,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x50e9ed};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x37dc6d};}static async[_0x5d3a0d(0x170)](_0x40d761,_0x6efa6='',_0x16fad5=''){const _0x2bfc34=_0x5d3a0d,_0x48390f={'diIrO':function(_0x17335a,_0xfc7b0e){return _0x17335a===_0xfc7b0e;},'rHwgu':_0x2bfc34(0x174),'ySbiY':function(_0x7e5c8d,_0x442d90){return _0x7e5c8d||_0x442d90;}},{md5:_0xb1c7e0,fileName:_0x20e5d8,path:_0x1869ae,fileSize:_0x518a0b}=await NTQQFileApi[_0x2bfc34(0x136)](_0x40d761,ElementType[_0x2bfc34(0x175)]);if(_0x48390f['diIrO'](_0x518a0b,0x0))throw _0x48390f[_0x2bfc34(0x145)];const _0x2dfc06={'elementType':ElementType[_0x2bfc34(0x175)],'elementId':'','fileElement':{'fileName':_0x48390f[_0x2bfc34(0x12b)](_0x6efa6,_0x20e5d8),'folderId':_0x16fad5,'filePath':_0x1869ae,'fileSize':_0x518a0b[_0x2bfc34(0x127)]()}};return _0x2dfc06;}static async[_0x5d3a0d(0x16d)](_0x155ae3,_0x438c28='',_0x573a35=''){const _0x233523=_0x5d3a0d,_0x3a28fb={'TuLpr':function(_0x773b22,_0x379675){return _0x773b22(_0x379675);},'Iqgcw':function(_0x4f876c,_0x119025){return _0x4f876c+_0x119025;},'BqhHj':function(_0x3991ed,_0x205088){return _0x3991ed+_0x205088;},'FEHzs':function(_0x6cdad7,_0x49210d){return _0x6cdad7(_0x49210d);},'QghPE':function(_0x14165e,_0x3caffa,_0x33903f){return _0x14165e(_0x3caffa,_0x33903f);},'xdTvg':function(_0x1baee2,_0x34eee3){return _0x1baee2(_0x34eee3);}},{fileName:_0x1e3bce,path:_0x2ec9e0,fileSize:_0x407f25,md5:_0x204c98}=await NTQQFileApi[_0x233523(0x136)](_0x155ae3,ElementType[_0x233523(0x178)]);if(_0x407f25===0x0)throw _0x233523(0x174);let _0x4f53d5=_0x2ec9e0[_0x233523(0x140)](_0x11c051[_0x233523(0x137)]+_0x233523(0x154)+_0x11c051[_0x233523(0x137)],_0x11c051['sep']+_0x233523(0x13d)+_0x11c051[_0x233523(0x137)]);_0x4f53d5=_0x11c051['dirname'](_0x4f53d5);let _0x508325={'width':0x780,'height':0x438,'time':0xf,'format':_0x233523(0x138),'size':_0x407f25,'filePath':_0x155ae3};try{_0x508325=await _0x3a28fb[_0x233523(0x17a)](getVideoInfo,_0x2ec9e0);}catch(_0x598efb){_0x3a28fb[_0x233523(0x16f)](logError,'获取视频信息失败',_0x598efb);}const _0x1f181f=new Promise((_0x42683e,_0x50076d)=>{const _0x3e174a=_0x233523,_0x2d9963={'PmSAz':function(_0x10443b,_0x1ba0bd){return _0x10443b(_0x1ba0bd);}},_0xf3ec09=_0x204c98+_0x3e174a(0x139),_0x37f628=_0x11c051[_0x3e174a(0x14d)](_0x4f53d5,_0xf3ec09);_0x3a28fb[_0x3e174a(0x132)](_0x3c43b0,_0x155ae3)['on']('end',()=>{})['on'](_0x3e174a(0x17f),_0x552aeb=>{const _0x5f53ed=_0x3e174a,_0xb8c70f={'rPUNj':function(_0x4a4bcc,_0x355a64){const _0x3b6288=_0x5b1c;return _0x3a28fb[_0x3b6288(0x132)](_0x4a4bcc,_0x355a64);},'IPhnm':function(_0x476fd7,_0x2d72bc){const _0x409f73=_0x5b1c;return _0x3a28fb[_0x409f73(0x132)](_0x476fd7,_0x2d72bc);}};logDebug('获取视频封面失败，使用默认封面',_0x552aeb),_0x573a35?_0x3260ec[_0x5f53ed(0x163)](_0x573a35,_0x37f628)[_0x5f53ed(0x16b)](()=>{_0xb8c70f['rPUNj'](_0x42683e,_0x37f628);})[_0x5f53ed(0x13e)](_0x50076d):_0x3260ec[_0x5f53ed(0x153)](_0x37f628,defaultVideoThumb)['then'](()=>{const _0xaff46c=_0x5f53ed;_0xb8c70f[_0xaff46c(0x142)](_0x42683e,_0x37f628);})['catch'](_0x50076d);})[_0x3e174a(0x129)]({'timestamps':[0x0],'filename':_0xf3ec09,'folder':_0x4f53d5,'size':_0x3a28fb[_0x3e174a(0x130)](_0x3a28fb[_0x3e174a(0x158)](_0x508325[_0x3e174a(0x160)],'x'),_0x508325[_0x3e174a(0x13b)])})['on']('end',()=>{const _0x1a2cd6=_0x3e174a;_0x2d9963[_0x1a2cd6(0x173)](_0x42683e,_0x37f628);});}),_0x23ace2=new Map(),_0x31d1d8=await _0x1f181f,_0xbc1d65=(await _0x3260ec['stat'](_0x31d1d8))[_0x233523(0x15b)];_0x23ace2['set'](0x0,_0x31d1d8);const _0x54ea44=await _0x3a28fb[_0x233523(0x148)](calculateFileMD5,_0x31d1d8),_0x193ffb={'elementType':ElementType[_0x233523(0x178)],'elementId':'','videoElement':{'fileName':_0x438c28||_0x1e3bce,'filePath':_0x2ec9e0,'videoMd5':_0x204c98,'thumbMd5':_0x54ea44,'fileTime':_0x508325['time'],'thumbPath':_0x23ace2,'thumbSize':_0xbc1d65,'thumbWidth':_0x508325[_0x233523(0x160)],'thumbHeight':_0x508325[_0x233523(0x13b)],'fileSize':_0x3a28fb[_0x233523(0x158)]('',_0x407f25)}};return _0x193ffb;}static async[_0x5d3a0d(0x157)](_0x3598c9){const _0x2b833a=_0x5d3a0d,_0xa8284={'bopim':function(_0x28d04a,_0x21afdb){return _0x28d04a(_0x21afdb);},'HlSQE':'语音转换失败,\x20请检查语音文件是否正常','cZKJY':function(_0x369ffb,_0xc8ef76){return _0x369ffb===_0xc8ef76;}},{converted:_0x342809,path:_0x30aecd,duration:_0x3ae9bd}=await _0xa8284[_0x2b833a(0x141)](encodeSilk,_0x3598c9);if(!_0x30aecd)throw _0xa8284[_0x2b833a(0x16c)];const {md5:_0x2d6b54,fileName:_0x4ae5c0,path:_0xbcfb01,fileSize:_0x31ec4a}=await NTQQFileApi[_0x2b833a(0x136)](_0x30aecd,ElementType[_0x2b833a(0x152)]);if(_0xa8284[_0x2b833a(0x143)](_0x31ec4a,0x0))throw _0x2b833a(0x174);return _0x342809&&_0x3260ec['unlink'](_0x30aecd)[_0x2b833a(0x16b)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x4ae5c0,'filePath':_0xbcfb01,'md5HexStr':_0x2d6b54,'fileSize':_0x31ec4a,'duration':_0x3ae9bd||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x5d3a0d(0x14e)](_0x237048){const _0x543f18=_0x5d3a0d,_0x594d4b={'JjfHY':function(_0x2052c2,_0x60043a){return _0x2052c2>=_0x60043a;}},_0x3c7b46=_0xfd1802[_0x543f18(0x15a)],_0x2b34b2=_0xfd1802[_0x543f18(0x172)],_0x3afe91=_0x3c7b46['find'](_0x852085=>_0x852085[_0x543f18(0x144)]===_0x237048[_0x543f18(0x127)]());_0x237048=parseInt(_0x237048[_0x543f18(0x127)]());let _0x5df589=0x1;return _0x594d4b[_0x543f18(0x17e)](_0x237048,0xde)&&(_0x5df589=0x2),_0x3afe91[_0x543f18(0x159)]&&(_0x5df589=0x3),{'elementType':ElementType[_0x543f18(0x176)],'elementId':'','faceElement':{'faceIndex':_0x237048,'faceType':_0x5df589,'faceText':_0x3afe91[_0x543f18(0x13f)],'stickerId':_0x3afe91[_0x543f18(0x134)],'stickerType':_0x3afe91[_0x543f18(0x159)],'packId':_0x3afe91[_0x543f18(0x135)],'sourceType':0x1}};}static['mface'](_0x19446f,_0x594d47,_0x573c12,_0x2b01a5){const _0x1d4bc6=_0x5d3a0d;return{'elementType':ElementType[_0x1d4bc6(0x15c)],'marketFaceElement':{'emojiPackageId':_0x19446f,'emojiId':_0x594d47,'key':_0x573c12,'faceName':_0x2b01a5||mFaceCache['get'](_0x594d47)||_0x1d4bc6(0x151)}};}static[_0x5d3a0d(0x177)](_0x1b8725){const _0x2c0ff7=_0x5d3a0d,_0x12ad63={'MKBIC':_0x2c0ff7(0x156)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x2c0ff7(0x177)],'faceType':FaceType[_0x2c0ff7(0x177)],'faceText':_0x12ad63['MKBIC'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5d3a0d(0x164)](_0x4b951d){const _0x68b34d=_0x5d3a0d,_0x133ee1={'iiRNW':_0x68b34d(0x147)};return{'elementType':ElementType[_0x68b34d(0x176)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x68b34d(0x15f)],'faceText':_0x133ee1['iiRNW'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5d3a0d(0x166)](_0x11e3e1){const _0x440ac5=_0x5d3a0d,_0x14daad={'ndFYe':function(_0x17e5d7,_0x4473ee){return _0x17e5d7!==_0x4473ee;}};return _0x14daad[_0x440ac5(0x14a)](typeof _0x11e3e1,_0x440ac5(0x179))&&(_0x11e3e1=JSON['stringify'](_0x11e3e1)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x11e3e1,'linkInfo':null,'subElementType':null}};}static[_0x5d3a0d(0x162)](_0xeb064e){const _0x4dccd8=_0x5d3a0d;return{'elementType':ElementType[_0x4dccd8(0x13c)],'elementId':'','markdownElement':{'content':_0xeb064e}};}static async['miniapp'](){const _0x2b37e8=_0x5d3a0d,_0x116f04={'uoCKf':function(_0x4c0827,_0x307cdf){return _0x4c0827(_0x307cdf);},'oiGDS':_0x2b37e8(0x171),'KcCRt':_0x2b37e8(0x12d),'ZYfBe':_0x2b37e8(0x161),'VgfUe':_0x2b37e8(0x146)};let _0x149a7b=await _0x116f04[_0x2b37e8(0x15d)](SignMiniApp,{'prompt':_0x116f04['oiGDS'],'title':_0x116f04[_0x2b37e8(0x16e)],'preview':_0x116f04['KcCRt'],'jumpUrl':_0x116f04[_0x2b37e8(0x17c)],'tag':_0x116f04[_0x2b37e8(0x16e)],'tagIcon':_0x116f04[_0x2b37e8(0x13a)],'source':_0x2b37e8(0x171),'sourcelogo':_0x116f04[_0x2b37e8(0x13a)]});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x149a7b,'linkInfo':null,'subElementType':null}};}}