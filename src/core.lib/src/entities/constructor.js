const _0x25c5f6=_0x37aa;(function(_0x424971,_0x556253){const _0x2b1927=_0x37aa,_0xca0457=_0x424971();while(!![]){try{const _0x580859=parseInt(_0x2b1927(0x106))/0x1*(-parseInt(_0x2b1927(0x116))/0x2)+parseInt(_0x2b1927(0x11a))/0x3*(-parseInt(_0x2b1927(0x128))/0x4)+-parseInt(_0x2b1927(0x130))/0x5+parseInt(_0x2b1927(0x117))/0x6*(parseInt(_0x2b1927(0xec))/0x7)+-parseInt(_0x2b1927(0x127))/0x8+-parseInt(_0x2b1927(0xf3))/0x9+parseInt(_0x2b1927(0x10f))/0xa;if(_0x580859===_0x556253)break;else _0xca0457['push'](_0xca0457['shift']());}catch(_0x256037){_0xca0457['push'](_0xca0457['shift']());}}}(_0x1456,0x42a47));function _0x37aa(_0xcfd77e,_0x1e2a3f){const _0x1456ca=_0x1456();return _0x37aa=function(_0x37aabe,_0x591cee){_0x37aabe=_0x37aabe-0xe4;let _0x263a77=_0x1456ca[_0x37aabe];return _0x263a77;},_0x37aa(_0xcfd77e,_0x1e2a3f);}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';function _0x1456(){const _0x361a2a=['Ori','PIC','writeFile','_0.png','获取视频信息失败','fudZV','EXYbO','文件异常，大小为0','rps','2463909nHvuZJ','获取视频封面失败，使用默认封面','wnDKy','tUEHL','[骰子]','VIDEO','kjDZd','3599451bZRxwz','jpg','语音转换失败,\x20请检查语音文件是否正常','join','JhuEQ','catch','pic','time','width','图片信息','bBMwk','视频信息','TEXT','PTT','copyFile','face','REPLY','ARK','error','4253FDzjdR','height','path','replace','normal2','Pdlhj','TtyfL','string','CupUX','13317670wWxzJz','stat','ptt','lNIcp','then','text','notAt','86PzLAgX','6tdQwhQ','toString','rcECF','23577MygSFo','stringify','wStsr','gif','rpmMe','dice','NdmZJ','GBlKX','MPpzF','ATXfM','sep','uploadFile','PbOEB','2469640iGhPeV','236ynxKQq','EgpJo','video','markdown','FACE','file','FILE','screenshots','277915TsxprI'];_0x1456=function(){return _0x361a2a;};return _0x1456();}import{promises as _0x328b52}from'node:fs';import _0x11d823 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static[_0x25c5f6(0x114)](_0x2db0d4){const _0x2cc049=_0x25c5f6;return{'elementType':ElementType[_0x2cc049(0xff)],'elementId':'','textElement':{'content':_0x2db0d4,'atType':AtType[_0x2cc049(0x115)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x2bc77d,_0x8e1d26,_0x53afe6,_0xcc1a){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0xcc1a,'atType':_0x53afe6,'atUid':_0x2bc77d,'atTinyId':'','atNtUid':_0x8e1d26}};}static['reply'](_0x44decd,_0x53dec3,_0x9b8703,_0x52af17){const _0x49a01d=_0x25c5f6;return{'elementType':ElementType[_0x49a01d(0x103)],'elementId':'','replyElement':{'replayMsgSeq':_0x44decd,'replayMsgId':_0x53dec3,'senderUin':_0x9b8703,'senderUinStr':_0x52af17}};}static async[_0x25c5f6(0xf9)](_0x2d3162,_0x1ca1b9='',_0x4f0287=0x0){const _0x21ae54=_0x25c5f6,_0x191ff5={'wStsr':function(_0x1f99cd,_0x57ab8a){return _0x1f99cd===_0x57ab8a;},'EXYbO':'文件异常，大小为0','qqoZC':function(_0x5143d5,_0x2b9b8c){return _0x5143d5(_0x2b9b8c);},'ZbWUB':function(_0x445231,_0xa3fd79,_0x15951e){return _0x445231(_0xa3fd79,_0x15951e);},'rcECF':_0x21ae54(0xfc)},{md5:_0x386f68,fileName:_0x1059d9,path:_0x4d10f4,fileSize:_0x3e5183}=await NTQQFileApi['uploadFile'](_0x2d3162,ElementType['PIC'],_0x4f0287);if(_0x191ff5[_0x21ae54(0x11c)](_0x3e5183,0x0))throw _0x191ff5[_0x21ae54(0xe9)];const _0x58d635=await NTQQFileApi['getImageSize'](_0x2d3162),_0xece665={'md5HexStr':_0x386f68,'fileSize':_0x3e5183[_0x21ae54(0x118)](),'picWidth':_0x58d635?.[_0x21ae54(0xfb)],'picHeight':_0x58d635?.[_0x21ae54(0x107)],'fileName':_0x1059d9,'sourcePath':_0x4d10f4,'original':!![],'picType':_0x191ff5['qqoZC'](isGIF,_0x2d3162)?PicType[_0x21ae54(0x11d)]:PicType[_0x21ae54(0xf4)],'picSubType':_0x4f0287,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x1ca1b9};return _0x191ff5['ZbWUB'](logDebug,_0x191ff5[_0x21ae54(0x119)],_0xece665),{'elementType':ElementType[_0x21ae54(0xe4)],'elementId':'','picElement':_0xece665};}static async[_0x25c5f6(0x12d)](_0x16ab63,_0xbcdc0d=''){const _0x48d2c6=_0x25c5f6,_0x57d88e={'JhuEQ':function(_0x119e26,_0x388e8b){return _0x119e26===_0x388e8b;},'fudZV':'文件异常，大小为0'},{md5:_0x31d39e,fileName:_0x293e50,path:_0x121117,fileSize:_0x5ec543}=await NTQQFileApi[_0x48d2c6(0x125)](_0x16ab63,ElementType[_0x48d2c6(0x12e)]);if(_0x57d88e[_0x48d2c6(0xf7)](_0x5ec543,0x0))throw _0x57d88e[_0x48d2c6(0xe8)];const _0x1cbf5d={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0xbcdc0d||_0x293e50,'filePath':_0x121117,'fileSize':_0x5ec543[_0x48d2c6(0x118)]()}};return _0x1cbf5d;}static async[_0x25c5f6(0x12a)](_0x23457b,_0x62ca57='',_0x286741=''){const _0x186930=_0x25c5f6,_0x89a16={'lNIcp':function(_0x4ca27c,_0x79c334,_0x590d8e){return _0x4ca27c(_0x79c334,_0x590d8e);},'GBlKX':_0x186930(0xed),'EgpJo':function(_0x22c3b9,_0x462753){return _0x22c3b9(_0x462753);},'rpmMe':'end','bDtID':_0x186930(0x105),'ATXfM':function(_0x250e74,_0x27073c){return _0x250e74+_0x27073c;},'xlCLr':'文件异常，大小为0','Pdlhj':function(_0x5cebba,_0x3f68ea){return _0x5cebba(_0x3f68ea);},'CupUX':'mp4','MPpzF':function(_0x15986d,_0x21a405){return _0x15986d(_0x21a405);},'RwGlP':_0x186930(0xfe),'PbOEB':function(_0x43fe91,_0x285ef4){return _0x43fe91||_0x285ef4;}},{fileName:_0x56d37a,path:_0x456740,fileSize:_0x20c6c1,md5:_0x3a1fe7}=await NTQQFileApi[_0x186930(0x125)](_0x23457b,ElementType[_0x186930(0xf1)]);if(_0x20c6c1===0x0)throw _0x89a16['xlCLr'];const _0x10643c=_0x89a16['Pdlhj'](require,_0x186930(0x108));let _0x1995dc=_0x456740[_0x186930(0x109)](_0x10643c[_0x186930(0x124)]+_0x186930(0x131)+_0x10643c[_0x186930(0x124)],_0x10643c[_0x186930(0x124)]+'Thumb'+_0x10643c[_0x186930(0x124)]);_0x1995dc=_0x10643c['dirname'](_0x1995dc);let _0x1cfda0={'width':0x780,'height':0x438,'time':0xf,'format':_0x89a16[_0x186930(0x10e)],'size':_0x20c6c1,'filePath':_0x23457b};try{_0x1cfda0=await _0x89a16[_0x186930(0x122)](getVideoInfo,_0x456740),logDebug(_0x89a16['RwGlP'],_0x1cfda0);}catch(_0x48fc1f){_0x89a16[_0x186930(0x112)](logError,_0x186930(0xe7),_0x48fc1f);}const _0x22aac9=new Promise((_0x4864b2,_0x1215d3)=>{const _0x2e1f84=_0x186930,_0x943d20={'TtyfL':function(_0x4f633f,_0x4df742){const _0x1d7599=_0x37aa;return _0x89a16[_0x1d7599(0x129)](_0x4f633f,_0x4df742);},'rvjzu':function(_0x35e765,_0x5f00b0){return _0x35e765(_0x5f00b0);}},_0x457f4a=_0x3a1fe7+_0x2e1f84(0xe6),_0x137137=_0x10643c[_0x2e1f84(0xf6)](_0x1995dc,_0x457f4a);_0x89a16[_0x2e1f84(0x129)](_0x11d823,_0x23457b)['on'](_0x89a16[_0x2e1f84(0x11e)],()=>{})['on'](_0x89a16['bDtID'],_0x481ba6=>{const _0x1820c0=_0x2e1f84,_0x5bee20={'bEXWU':function(_0x3c0787,_0xd03d1a){return _0x3c0787(_0xd03d1a);}};_0x89a16[_0x1820c0(0x112)](logDebug,_0x89a16[_0x1820c0(0x121)],_0x481ba6),_0x286741?_0x328b52[_0x1820c0(0x101)](_0x286741,_0x137137)[_0x1820c0(0x113)](()=>{const _0x4539b7=_0x1820c0;_0x943d20[_0x4539b7(0x10c)](_0x4864b2,_0x137137);})[_0x1820c0(0xf8)](_0x1215d3):_0x328b52[_0x1820c0(0xe5)](_0x137137,defaultVideoThumb)[_0x1820c0(0x113)](()=>{_0x5bee20['bEXWU'](_0x4864b2,_0x137137);})[_0x1820c0(0xf8)](_0x1215d3);})[_0x2e1f84(0x12f)]({'timestamps':[0x0],'filename':_0x457f4a,'folder':_0x1995dc,'size':_0x89a16[_0x2e1f84(0x123)](_0x89a16[_0x2e1f84(0x123)](_0x1cfda0[_0x2e1f84(0xfb)],'x'),_0x1cfda0['height'])})['on'](_0x89a16['rpmMe'],()=>{_0x943d20['rvjzu'](_0x4864b2,_0x137137);});}),_0x374898=new Map(),_0x17c259=await _0x22aac9,_0x166452=(await _0x328b52[_0x186930(0x110)](_0x17c259))['size'];_0x374898['set'](0x0,_0x17c259);const _0x447434=await _0x89a16[_0x186930(0x10b)](calculateFileMD5,_0x17c259),_0xbc1f={'elementType':ElementType[_0x186930(0xf1)],'elementId':'','videoElement':{'fileName':_0x89a16[_0x186930(0x126)](_0x62ca57,_0x56d37a),'filePath':_0x456740,'videoMd5':_0x3a1fe7,'thumbMd5':_0x447434,'fileTime':_0x1cfda0[_0x186930(0xfa)],'thumbPath':_0x374898,'thumbSize':_0x166452,'thumbWidth':_0x1cfda0['width'],'thumbHeight':_0x1cfda0[_0x186930(0x107)],'fileSize':''+_0x20c6c1}};return _0xbc1f;}static async[_0x25c5f6(0x111)](_0xc5348){const _0x5a331f=_0x25c5f6,_0x218e49={'wnDKy':_0x5a331f(0xf5),'kjDZd':function(_0x31b26f,_0x457edb){return _0x31b26f===_0x457edb;},'dHPGi':_0x5a331f(0xea)},{converted:_0x561599,path:_0x2636c5,duration:_0x2bd8c5}=await encodeSilk(_0xc5348);if(!_0x2636c5)throw _0x218e49[_0x5a331f(0xee)];const {md5:_0x5e5302,fileName:_0x3b9a0a,path:_0x5b91b3,fileSize:_0x195316}=await NTQQFileApi[_0x5a331f(0x125)](_0x2636c5,ElementType[_0x5a331f(0x100)]);if(_0x218e49[_0x5a331f(0xf2)](_0x195316,0x0))throw _0x218e49['dHPGi'];return _0x561599&&_0x328b52['unlink'](_0x2636c5)['then'](),{'elementType':ElementType[_0x5a331f(0x100)],'elementId':'','pttElement':{'fileName':_0x3b9a0a,'filePath':_0x5b91b3,'md5HexStr':_0x5e5302,'fileSize':_0x195316,'duration':_0x2bd8c5||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x25c5f6(0x102)](_0x459b27){const _0x4cda68=_0x25c5f6,_0x394cc7={'bBMwk':function(_0x4792de,_0x31cfdc){return _0x4792de<_0x31cfdc;}};return{'elementType':ElementType[_0x4cda68(0x12c)],'elementId':'','faceElement':{'faceIndex':_0x459b27,'faceType':_0x394cc7[_0x4cda68(0xfd)](_0x459b27,0xde)?FaceType['normal']:FaceType[_0x4cda68(0x10a)]}};}static[_0x25c5f6(0x11f)](_0x16d36f){const _0x464bb9=_0x25c5f6,_0x193219={'LngaV':_0x464bb9(0xf0)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x464bb9(0x11f)],'faceText':_0x193219['LngaV'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x25c5f6(0xeb)](_0x3b3edc){const _0x4f0c75=_0x25c5f6,_0x2afbf8={'tUEHL':'[包剪锤]'};return{'elementType':ElementType[_0x4f0c75(0x12c)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x2afbf8[_0x4f0c75(0xef)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x276233){const _0x348b8c=_0x25c5f6,_0x26f74b={'NdmZJ':function(_0x128126,_0x234411){return _0x128126!==_0x234411;},'SUGuP':_0x348b8c(0x10d)};return _0x26f74b[_0x348b8c(0x120)](typeof _0x276233,_0x26f74b['SUGuP'])&&(_0x276233=JSON[_0x348b8c(0x11b)](_0x276233)),{'elementType':ElementType[_0x348b8c(0x104)],'elementId':'','arkElement':{'bytesData':_0x276233,'linkInfo':null,'subElementType':null}};}static[_0x25c5f6(0x12b)](_0x5163d3){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x5163d3}};}}