const _0x4c376c=_0x4ae8;(function(_0x2a5c81,_0x524ff4){const _0x394b7a=_0x4ae8,_0x8270a7=_0x2a5c81();while(!![]){try{const _0x4d13e2=parseInt(_0x394b7a(0x19c))/0x1+parseInt(_0x394b7a(0x1ad))/0x2*(-parseInt(_0x394b7a(0x170))/0x3)+-parseInt(_0x394b7a(0x1a3))/0x4*(parseInt(_0x394b7a(0x1b2))/0x5)+-parseInt(_0x394b7a(0x175))/0x6+-parseInt(_0x394b7a(0x189))/0x7*(parseInt(_0x394b7a(0x1b1))/0x8)+-parseInt(_0x394b7a(0x158))/0x9+parseInt(_0x394b7a(0x1a0))/0xa*(parseInt(_0x394b7a(0x1b3))/0xb);if(_0x4d13e2===_0x524ff4)break;else _0x8270a7['push'](_0x8270a7['shift']());}catch(_0x1f8e5b){_0x8270a7['push'](_0x8270a7['shift']());}}}(_0x3499,0x41a72));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x5dd3ab}from'node:fs';import _0x37859a from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x3499(){const _0x5ec7da=['MARKDOWN','pTipf','VIDEO','VtmUz','string','emoji','catch','QEKCZ','6906BuqzDk','dice','Npwqa','USXYd','width','1495674GeNnTJ','stThm','QRSJe','MFACE','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','SwHNH','face','qqUaG','find','QDes','copyFile','ARK','Vziky','获取视频信息失败','语音转换失败,\x20请检查语音文件是否正常','ptt','stringify','QSid','UTFlq','PIC','7IqLbXP','time','mxDEb','MZduk','dirname','ZZrdj','gApVM','set','lXHuW','PNcld','error','PTT','文件异常，大小为0','join','[骰子]','[商城表情]','zoIsZ','FILE','AniStickerPackId','295084dxpixV','notAt','_0.png','lKsPI','14570mgMvkI','KYxXY','wzMda','4lTJxiA','YCLSq','jpg','REPLY','USskn','sep','AniStickerType','uploadFile','Bot\x20Test','height','192mLzBer','end','Ori','djzzs','1033080tcRUeA','2078305NEPQob','9933aGmtgR','getImageSize','caRbs','toString','2940966rZFtpX','pic','TEXT','size','file','https://www.bilibili.com/','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','AwoBN','replace','nItjL','XcgVi','sysface','kaisR','unlink','FACE','then'];_0x3499=function(){return _0x5ec7da;};return _0x3499();}import _0x31122b from'./face_config.json';import*as _0xc1049c from'node:path';function _0x4ae8(_0x75d879,_0x3b5186){const _0x3499d4=_0x3499();return _0x4ae8=function(_0x4ae869,_0x3ec659){_0x4ae869=_0x4ae869-0x157;let _0x4d7d8a=_0x3499d4[_0x4ae869];return _0x4d7d8a;},_0x4ae8(_0x75d879,_0x3b5186);}import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0xbd02f7){const _0x451bb1=_0x4ae8;return{'elementType':ElementType[_0x451bb1(0x15a)],'elementId':'','textElement':{'content':_0xbd02f7,'atType':AtType[_0x451bb1(0x19d)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x308f16,_0x4ae941,_0x375a2c,_0xbc933e){const _0x566077=_0x4ae8;return{'elementType':ElementType[_0x566077(0x15a)],'elementId':'','textElement':{'content':'@'+_0xbc933e,'atType':_0x375a2c,'atUid':_0x308f16,'atTinyId':'','atNtUid':_0x4ae941}};}static['reply'](_0x571798,_0x4221a7,_0x21d89a,_0x453235){const _0x397a68=_0x4ae8;return{'elementType':ElementType[_0x397a68(0x1a6)],'elementId':'','replyElement':{'replayMsgSeq':_0x571798,'replayMsgId':_0x4221a7,'senderUin':_0x21d89a,'senderUinStr':_0x453235}};}static async[_0x4c376c(0x159)](_0x349551,_0x22b664='',_0x300715=0x0){const _0x320995=_0x4c376c,_0x7992e1={'mxDEb':function(_0x3415fc,_0x3def41){return _0x3415fc===_0x3def41;},'YCLSq':_0x320995(0x195),'XcgVi':function(_0x49e6b0,_0xa94d22){return _0x49e6b0(_0xa94d22);}},{md5:_0x593003,fileName:_0x539b4a,path:_0x764d2a,fileSize:_0x175c81}=await NTQQFileApi['uploadFile'](_0x349551,ElementType['PIC'],_0x300715);if(_0x7992e1[_0x320995(0x18b)](_0x175c81,0x0))throw _0x7992e1[_0x320995(0x1a4)];const _0xc3ef35=await NTQQFileApi[_0x320995(0x1b4)](_0x349551),_0x2dfa7b={'md5HexStr':_0x593003,'fileSize':_0x175c81[_0x320995(0x157)](),'picWidth':_0xc3ef35?.[_0x320995(0x174)],'picHeight':_0xc3ef35?.[_0x320995(0x1ac)],'fileName':_0x539b4a,'sourcePath':_0x764d2a,'original':!![],'picType':_0x7992e1[_0x320995(0x162)](isGIF,_0x349551)?PicType['gif']:PicType[_0x320995(0x1a5)],'picSubType':_0x300715,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x22b664};return{'elementType':ElementType[_0x320995(0x188)],'elementId':'','picElement':_0x2dfa7b};}static async[_0x4c376c(0x15c)](_0x24d309,_0x2937d1=''){const _0x2bf3e7=_0x4c376c,_0x3923={'Npwqa':function(_0x34022e,_0x4f84cc){return _0x34022e===_0x4f84cc;},'lKsPI':_0x2bf3e7(0x195),'SwHNH':function(_0x45d534,_0x3ef806){return _0x45d534||_0x3ef806;}},{md5:_0x2ec3ea,fileName:_0x6c539,path:_0x6a0269,fileSize:_0x52d82e}=await NTQQFileApi[_0x2bf3e7(0x1aa)](_0x24d309,ElementType['FILE']);if(_0x3923[_0x2bf3e7(0x172)](_0x52d82e,0x0))throw _0x3923[_0x2bf3e7(0x19f)];const _0x547062={'elementType':ElementType[_0x2bf3e7(0x19a)],'elementId':'','fileElement':{'fileName':_0x3923[_0x2bf3e7(0x17a)](_0x2937d1,_0x6c539),'filePath':_0x6a0269,'fileSize':_0x52d82e['toString']()}};return _0x547062;}static async['video'](_0x597df2,_0x58f261='',_0x180bcf=''){const _0x394226=_0x4c376c,_0x105279={'QRSJe':'获取视频封面失败，使用默认封面','MZduk':_0x394226(0x1ae),'AwoBN':function(_0xf2ee18,_0xa5ea4b){return _0xf2ee18+_0xa5ea4b;},'nItjL':function(_0x349cc1,_0x25864b){return _0x349cc1===_0x25864b;},'Vziky':_0x394226(0x195),'PNcld':function(_0x434d07,_0x393839){return _0x434d07(_0x393839);},'KYxXY':function(_0xf4d408,_0x416803,_0x3d684b){return _0xf4d408(_0x416803,_0x3d684b);},'UTFlq':_0x394226(0x182),'stThm':function(_0x55fb0b,_0x399352){return _0x55fb0b||_0x399352;},'gApVM':function(_0x167c21,_0x11bf86){return _0x167c21+_0x11bf86;}},{fileName:_0x25f506,path:_0xd3542d,fileSize:_0x16be27,md5:_0x130804}=await NTQQFileApi[_0x394226(0x1aa)](_0x597df2,ElementType[_0x394226(0x16a)]);if(_0x105279[_0x394226(0x161)](_0x16be27,0x0))throw _0x105279[_0x394226(0x181)];let _0x225f8b=_0xd3542d[_0x394226(0x160)](_0xc1049c['sep']+_0x394226(0x1af)+_0xc1049c[_0x394226(0x1a8)],_0xc1049c['sep']+'Thumb'+_0xc1049c[_0x394226(0x1a8)]);_0x225f8b=_0xc1049c[_0x394226(0x18d)](_0x225f8b);let _0x5499d9={'width':0x780,'height':0x438,'time':0xf,'format':'mp4','size':_0x16be27,'filePath':_0x597df2};try{_0x5499d9=await _0x105279[_0x394226(0x192)](getVideoInfo,_0xd3542d);}catch(_0x334eab){_0x105279[_0x394226(0x1a1)](logError,_0x105279[_0x394226(0x187)],_0x334eab);}const _0x1bedf1=new Promise((_0x189493,_0x233eac)=>{const _0x371f3a=_0x394226,_0x41dc74={'qqUaG':function(_0x42af3f,_0x2b0a0f){return _0x42af3f(_0x2b0a0f);},'caRbs':_0x105279[_0x371f3a(0x177)]},_0x84c09=_0x130804+_0x371f3a(0x19e),_0x4545a6=_0xc1049c[_0x371f3a(0x196)](_0x225f8b,_0x84c09);_0x37859a(_0x597df2)['on'](_0x105279[_0x371f3a(0x18c)],()=>{})['on'](_0x371f3a(0x193),_0xa951d=>{const _0x5de922=_0x371f3a;logDebug(_0x41dc74[_0x5de922(0x1b5)],_0xa951d),_0x180bcf?_0x5dd3ab[_0x5de922(0x17f)](_0x180bcf,_0x4545a6)[_0x5de922(0x167)](()=>{const _0x53ebcd=_0x5de922;_0x41dc74[_0x53ebcd(0x17c)](_0x189493,_0x4545a6);})[_0x5de922(0x16e)](_0x233eac):_0x5dd3ab['writeFile'](_0x4545a6,defaultVideoThumb)[_0x5de922(0x167)](()=>{_0x189493(_0x4545a6);})[_0x5de922(0x16e)](_0x233eac);})['screenshots']({'timestamps':[0x0],'filename':_0x84c09,'folder':_0x225f8b,'size':_0x105279[_0x371f3a(0x15f)](_0x5499d9['width'],'x')+_0x5499d9[_0x371f3a(0x1ac)]})['on'](_0x371f3a(0x1ae),()=>{_0x189493(_0x4545a6);});}),_0x4ed22d=new Map(),_0x6780df=await _0x1bedf1,_0x352518=(await _0x5dd3ab['stat'](_0x6780df))[_0x394226(0x15b)];_0x4ed22d[_0x394226(0x190)](0x0,_0x6780df);const _0x34b918=await _0x105279[_0x394226(0x192)](calculateFileMD5,_0x6780df),_0x3a215a={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x105279[_0x394226(0x176)](_0x58f261,_0x25f506),'filePath':_0xd3542d,'videoMd5':_0x130804,'thumbMd5':_0x34b918,'fileTime':_0x5499d9[_0x394226(0x18a)],'thumbPath':_0x4ed22d,'thumbSize':_0x352518,'thumbWidth':_0x5499d9['width'],'thumbHeight':_0x5499d9[_0x394226(0x1ac)],'fileSize':_0x105279[_0x394226(0x18f)]('',_0x16be27)}};return _0x3a215a;}static async[_0x4c376c(0x184)](_0x107fa9){const _0x130a2f=_0x4c376c,_0xd0082c={'djzzs':function(_0x216e6d,_0x305b1d){return _0x216e6d(_0x305b1d);},'xEeSg':_0x130a2f(0x183),'VtmUz':function(_0xee453f,_0x444065){return _0xee453f===_0x444065;},'ZZrdj':_0x130a2f(0x195),'lXHuW':function(_0x391e1a,_0x8f1e13){return _0x391e1a||_0x8f1e13;}},{converted:_0x6c9198,path:_0x7f934b,duration:_0x31e5db}=await _0xd0082c[_0x130a2f(0x1b0)](encodeSilk,_0x107fa9);if(!_0x7f934b)throw _0xd0082c['xEeSg'];const {md5:_0x5520ed,fileName:_0x215e4a,path:_0x224f8d,fileSize:_0x267086}=await NTQQFileApi[_0x130a2f(0x1aa)](_0x7f934b,ElementType[_0x130a2f(0x194)]);if(_0xd0082c[_0x130a2f(0x16b)](_0x267086,0x0))throw _0xd0082c[_0x130a2f(0x18e)];return _0x6c9198&&_0x5dd3ab[_0x130a2f(0x165)](_0x7f934b)[_0x130a2f(0x167)](),{'elementType':ElementType[_0x130a2f(0x194)],'elementId':'','pttElement':{'fileName':_0x215e4a,'filePath':_0x224f8d,'md5HexStr':_0x5520ed,'fileSize':_0x267086,'duration':_0xd0082c[_0x130a2f(0x191)](_0x31e5db,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4c376c(0x17b)](_0x340e19){const _0x1fae96=_0x4c376c,_0x41d5f1={'ZNAzq':function(_0x454d4b,_0x3d2561){return _0x454d4b(_0x3d2561);},'USXYd':function(_0x5444c5,_0x527987){return _0x5444c5>=_0x527987;}},_0x36847d=_0x31122b[_0x1fae96(0x163)],_0x4e61f7=_0x31122b[_0x1fae96(0x16d)],_0x750918=_0x36847d[_0x1fae96(0x17d)](_0x4b1bec=>_0x4b1bec[_0x1fae96(0x186)]===_0x340e19[_0x1fae96(0x157)]());_0x340e19=_0x41d5f1['ZNAzq'](parseInt,_0x340e19[_0x1fae96(0x157)]());let _0x17fa1b=0x1;return _0x41d5f1[_0x1fae96(0x173)](_0x340e19,0xde)&&(_0x17fa1b=0x2),_0x750918['AniStickerType']&&(_0x17fa1b=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x340e19,'faceType':_0x17fa1b,'faceText':_0x750918[_0x1fae96(0x17e)],'stickerId':_0x750918['AniStickerId'],'stickerType':_0x750918[_0x1fae96(0x1a9)],'packId':_0x750918[_0x1fae96(0x19b)],'sourceType':0x1}};}static['mface'](_0x823f69,_0x2c93fd,_0x1eb02e,_0x1f9f7a){const _0x519a85=_0x4c376c,_0x52141d={'QEKCZ':_0x519a85(0x198)};return{'elementType':ElementType[_0x519a85(0x178)],'marketFaceElement':{'emojiPackageId':_0x823f69,'emojiId':_0x2c93fd,'key':_0x1eb02e,'faceName':_0x1f9f7a||mFaceCache['get'](_0x2c93fd)||_0x52141d[_0x519a85(0x16f)]}};}static['dice'](_0x5546a5){const _0x18d323=_0x4c376c,_0x1d6392={'USskn':_0x18d323(0x197)};return{'elementType':ElementType[_0x18d323(0x166)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x18d323(0x171)],'faceType':FaceType['dice'],'faceText':_0x1d6392[_0x18d323(0x1a7)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x135192){const _0x42edb7=_0x4c376c,_0x3af444={'pTipf':'[包剪锤]'};return{'elementType':ElementType[_0x42edb7(0x166)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x3af444[_0x42edb7(0x169)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x11ecdf){const _0x18fd94=_0x4c376c,_0x15bd05={'wzMda':function(_0x1fbd74,_0x4d93e5){return _0x1fbd74!==_0x4d93e5;}};return _0x15bd05[_0x18fd94(0x1a2)](typeof _0x11ecdf,_0x18fd94(0x16c))&&(_0x11ecdf=JSON[_0x18fd94(0x185)](_0x11ecdf)),{'elementType':ElementType[_0x18fd94(0x180)],'elementId':'','arkElement':{'bytesData':_0x11ecdf,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x5ce503){const _0x1e9ee0=_0x4c376c;return{'elementType':ElementType[_0x1e9ee0(0x168)],'elementId':'','markdownElement':{'content':_0x5ce503}};}static async['miniapp'](){const _0xbe2f13=_0x4c376c,_0x19b30a={'OeIsP':_0xbe2f13(0x1ab),'kaisR':_0xbe2f13(0x15d),'zoIsZ':_0xbe2f13(0x179)};let _0x1a90fb=await SignMiniApp({'prompt':_0x19b30a['OeIsP'],'title':_0x19b30a['OeIsP'],'preview':_0xbe2f13(0x15e),'jumpUrl':_0x19b30a[_0xbe2f13(0x164)],'tag':_0x19b30a['OeIsP'],'tagIcon':_0x19b30a[_0xbe2f13(0x199)],'source':_0x19b30a['OeIsP'],'sourcelogo':_0xbe2f13(0x179)});return{'elementType':ElementType[_0xbe2f13(0x180)],'elementId':'','arkElement':{'bytesData':_0x1a90fb,'linkInfo':null,'subElementType':null}};}}