const _0x190902=_0x1994;function _0x93ba(){const _0x5f69db=['dirname','7825laecLE','gif','MARKDOWN','replace','EPRIw','string','TQiOQ','toString','pHjMR','FACE','LLkGK','reply','ZECPz','stat','PTT','mAYxB','uVjzD','uploadFile','145817FDVQWB','FILE','语音转换失败,\x20请检查语音文件是否正常','dice','jpg','430796zOsMnf','TWITz','end','1311723mzPziE','385085ZOXesF','writeFile','pic','104GUFCdY','Ori','24024010JAtcdN','9eDuVcJ','then','normal','JseKl','BEgON','markdown','getImageSize','ARK','ZhgcZ','error','kgWbJ','sep','uLQUC','uhwXP','REPLY','ptt','文件异常，大小为0','MFACE','join','1952248NrBcsy','获取视频封面失败，使用默认封面','get','aPfcx','width','NxYzC','VIDEO','text','set','unlink','cjuXm','stringify','tobTk','PIC','mface','kiLJS','time','_0.png','face','catch','video','normal2','1542dFRzKx','height','Thumb','file','zbHTY','[包剪锤]','获取视频信息失败','eHRUE','TEXT','mp4','size','QeboG','path','图片信息','screenshots'];_0x93ba=function(){return _0x5f69db;};return _0x93ba();}function _0x1994(_0xde64ff,_0x233ee2){const _0x93ba4e=_0x93ba();return _0x1994=function(_0x1994b0,_0xc94dc4){_0x1994b0=_0x1994b0-0xae;let _0x1e45ed=_0x93ba4e[_0x1994b0];return _0x1e45ed;},_0x1994(_0xde64ff,_0x233ee2);}(function(_0x5f8a02,_0x4bb128){const _0xe7854f=_0x1994,_0x4fc39f=_0x5f8a02();while(!![]){try{const _0x92488a=-parseInt(_0xe7854f(0xdb))/0x1+-parseInt(_0xe7854f(0xd7))/0x2*(parseInt(_0xe7854f(0xe1))/0x3)+-parseInt(_0xe7854f(0xf4))/0x4+-parseInt(_0xe7854f(0xc0))/0x5*(parseInt(_0xe7854f(0xb0))/0x6)+-parseInt(_0xe7854f(0xd2))/0x7*(parseInt(_0xe7854f(0xde))/0x8)+parseInt(_0xe7854f(0xda))/0x9+parseInt(_0xe7854f(0xe0))/0xa;if(_0x92488a===_0x4bb128)break;else _0x4fc39f['push'](_0x4fc39f['shift']());}catch(_0x5ee7c6){_0x4fc39f['push'](_0x4fc39f['shift']());}}}(_0x93ba,0x56dd7));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x5c87dd}from'node:fs';import _0x5348b3 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x190902(0xfb)](_0x522b47){const _0x449d9b=_0x190902;return{'elementType':ElementType[_0x449d9b(0xb8)],'elementId':'','textElement':{'content':_0x522b47,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x2cb6e5,_0x1d1acc,_0x1c0605,_0x34cf04){const _0x5fcb24=_0x190902;return{'elementType':ElementType[_0x5fcb24(0xb8)],'elementId':'','textElement':{'content':'@'+_0x34cf04,'atType':_0x1c0605,'atUid':_0x2cb6e5,'atTinyId':'','atNtUid':_0x1d1acc}};}static[_0x190902(0xcb)](_0x164c8f,_0x515b48,_0x5c188e,_0x4f07d6){const _0x1863a2=_0x190902;return{'elementType':ElementType[_0x1863a2(0xef)],'elementId':'','replyElement':{'replayMsgSeq':_0x164c8f,'replayMsgId':_0x515b48,'senderUin':_0x5c188e,'senderUinStr':_0x4f07d6}};}static async[_0x190902(0xdd)](_0x28c08c,_0x15da3e='',_0x12f473=0x0){const _0x1c1427=_0x190902,_0x44a114={'ZECPz':_0x1c1427(0xf1),'cjuXm':function(_0x5c7949,_0x6b4d48){return _0x5c7949(_0x6b4d48);},'tobTk':function(_0x33d48d,_0x87bd7a,_0xb5b73f){return _0x33d48d(_0x87bd7a,_0xb5b73f);},'mAYxB':_0x1c1427(0xbd)},{md5:_0x2ab232,fileName:_0x3beff0,path:_0x4dad5f,fileSize:_0x14a853}=await NTQQFileApi['uploadFile'](_0x28c08c,ElementType[_0x1c1427(0x101)],_0x12f473);if(_0x14a853===0x0)throw _0x44a114[_0x1c1427(0xcc)];const _0x59a949=await NTQQFileApi[_0x1c1427(0xe7)](_0x28c08c),_0x5c7c9d={'md5HexStr':_0x2ab232,'fileSize':_0x14a853[_0x1c1427(0xc7)](),'picWidth':_0x59a949?.['width'],'picHeight':_0x59a949?.['height'],'fileName':_0x3beff0,'sourcePath':_0x4dad5f,'original':!![],'picType':_0x44a114[_0x1c1427(0xfe)](isGIF,_0x28c08c)?PicType[_0x1c1427(0xc1)]:PicType[_0x1c1427(0xd6)],'picSubType':_0x12f473,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x15da3e};return _0x44a114[_0x1c1427(0x100)](logDebug,_0x44a114[_0x1c1427(0xcf)],_0x5c7c9d),{'elementType':ElementType[_0x1c1427(0x101)],'elementId':'','picElement':_0x5c7c9d};}static async[_0x190902(0xb3)](_0xdd349f,_0x494a27=''){const _0x157ddf=_0x190902,_0x9bd423={'zbHTY':_0x157ddf(0xf1)},{md5:_0x31e801,fileName:_0x366fee,path:_0xca5e66,fileSize:_0x329d5c}=await NTQQFileApi[_0x157ddf(0xd1)](_0xdd349f,ElementType[_0x157ddf(0xd3)]);if(_0x329d5c===0x0)throw _0x9bd423[_0x157ddf(0xb4)];const _0x21f605={'elementType':ElementType[_0x157ddf(0xd3)],'elementId':'','fileElement':{'fileName':_0x494a27||_0x366fee,'filePath':_0xca5e66,'fileSize':_0x329d5c['toString']()}};return _0x21f605;}static async[_0x190902(0xae)](_0x4f03d6,_0x2c77ce='',_0x408186=''){const _0x4f70a0=_0x190902,_0x51f713={'uhwXP':function(_0x59ff4a,_0x173a5b){return _0x59ff4a(_0x173a5b);},'NxYzC':function(_0x36e794,_0x21d1ad){return _0x36e794(_0x21d1ad);},'aPfcx':function(_0x1b2a50,_0x55ca62){return _0x1b2a50+_0x55ca62;},'DMtKb':'end','ZhgcZ':function(_0x183be6,_0x799588){return _0x183be6===_0x799588;},'uVjzD':_0x4f70a0(0xf1),'xKVRu':_0x4f70a0(0xb9),'TQiOQ':function(_0x187c00,_0xfb773d,_0xdc75c1){return _0x187c00(_0xfb773d,_0xdc75c1);},'vzsip':'视频信息','pHjMR':function(_0x1b4936,_0x11a2a3){return _0x1b4936(_0x11a2a3);},'BEgON':function(_0x501d87,_0x5b1b19){return _0x501d87||_0x5b1b19;},'TWITz':function(_0x539455,_0x2075c0){return _0x539455+_0x2075c0;}},{fileName:_0x57dfed,path:_0x4b655c,fileSize:_0x37a781,md5:_0x4134a7}=await NTQQFileApi[_0x4f70a0(0xd1)](_0x4f03d6,ElementType[_0x4f70a0(0xfa)]);if(_0x51f713[_0x4f70a0(0xe9)](_0x37a781,0x0))throw _0x51f713[_0x4f70a0(0xd0)];const _0x57307c=_0x51f713[_0x4f70a0(0xee)](require,_0x4f70a0(0xbc));let _0x4c3aa8=_0x4b655c[_0x4f70a0(0xc3)](_0x57307c[_0x4f70a0(0xec)]+_0x4f70a0(0xdf)+_0x57307c[_0x4f70a0(0xec)],_0x57307c['sep']+_0x4f70a0(0xb2)+_0x57307c[_0x4f70a0(0xec)]);_0x4c3aa8=_0x57307c[_0x4f70a0(0xbf)](_0x4c3aa8);let _0x26dd35={'width':0x780,'height':0x438,'time':0xf,'format':_0x51f713['xKVRu'],'size':_0x37a781,'filePath':_0x4f03d6};try{_0x26dd35=await getVideoInfo(_0x4b655c),_0x51f713[_0x4f70a0(0xc6)](logDebug,_0x51f713['vzsip'],_0x26dd35);}catch(_0x10ae98){logError(_0x4f70a0(0xb6),_0x10ae98);}const _0x75fe66=new Promise((_0x33165e,_0x181435)=>{const _0x16892b=_0x4f70a0,_0x368528={'uLQUC':function(_0xf76042,_0x5ab9c6){return _0x51f713['uhwXP'](_0xf76042,_0x5ab9c6);}},_0x2b0b95=_0x4134a7+_0x16892b(0x105),_0x139ce9=_0x57307c[_0x16892b(0xf3)](_0x4c3aa8,_0x2b0b95);_0x51f713[_0x16892b(0xf9)](_0x5348b3,_0x4f03d6)['on'](_0x16892b(0xd9),()=>{})['on'](_0x16892b(0xea),_0x5bb173=>{const _0x59c59d=_0x16892b;logDebug(_0x59c59d(0xf5),_0x5bb173),_0x408186?_0x5c87dd['copyFile'](_0x408186,_0x139ce9)['then'](()=>{_0x33165e(_0x139ce9);})['catch'](_0x181435):_0x5c87dd[_0x59c59d(0xdc)](_0x139ce9,defaultVideoThumb)[_0x59c59d(0xe2)](()=>{const _0x2691cb=_0x59c59d;_0x368528[_0x2691cb(0xed)](_0x33165e,_0x139ce9);})[_0x59c59d(0x107)](_0x181435);})[_0x16892b(0xbe)]({'timestamps':[0x0],'filename':_0x2b0b95,'folder':_0x4c3aa8,'size':_0x51f713[_0x16892b(0xf7)](_0x51f713[_0x16892b(0xf7)](_0x26dd35[_0x16892b(0xf8)],'x'),_0x26dd35[_0x16892b(0xb1)])})['on'](_0x51f713['DMtKb'],()=>{_0x33165e(_0x139ce9);});}),_0xbef643=new Map(),_0x3e273f=await _0x75fe66,_0x3fc8b4=(await _0x5c87dd[_0x4f70a0(0xcd)](_0x3e273f))[_0x4f70a0(0xba)];_0xbef643[_0x4f70a0(0xfc)](0x0,_0x3e273f);const _0x1b3d84=await _0x51f713[_0x4f70a0(0xc8)](calculateFileMD5,_0x3e273f),_0x115ef2={'elementType':ElementType[_0x4f70a0(0xfa)],'elementId':'','videoElement':{'fileName':_0x51f713[_0x4f70a0(0xe5)](_0x2c77ce,_0x57dfed),'filePath':_0x4b655c,'videoMd5':_0x4134a7,'thumbMd5':_0x1b3d84,'fileTime':_0x26dd35[_0x4f70a0(0x104)],'thumbPath':_0xbef643,'thumbSize':_0x3fc8b4,'thumbWidth':_0x26dd35[_0x4f70a0(0xf8)],'thumbHeight':_0x26dd35[_0x4f70a0(0xb1)],'fileSize':_0x51f713[_0x4f70a0(0xd8)]('',_0x37a781)}};return _0x115ef2;}static async[_0x190902(0xf0)](_0x1f8643){const _0x4c8030=_0x190902,_0x5ca74d={'EPRIw':function(_0x42eec9,_0x35343d){return _0x42eec9(_0x35343d);},'QeboG':_0x4c8030(0xd4),'LLkGK':function(_0x53b974,_0x12813c){return _0x53b974===_0x12813c;},'kiLJS':_0x4c8030(0xf1),'JseKl':function(_0x33bbdb,_0x354b0e){return _0x33bbdb||_0x354b0e;}},{converted:_0x4686ea,path:_0x4b67a4,duration:_0x4df546}=await _0x5ca74d[_0x4c8030(0xc4)](encodeSilk,_0x1f8643);if(!_0x4b67a4)throw _0x5ca74d[_0x4c8030(0xbb)];const {md5:_0x5b182e,fileName:_0x7c2117,path:_0x4d836f,fileSize:_0xa67461}=await NTQQFileApi[_0x4c8030(0xd1)](_0x4b67a4,ElementType[_0x4c8030(0xce)]);if(_0x5ca74d[_0x4c8030(0xca)](_0xa67461,0x0))throw _0x5ca74d[_0x4c8030(0x103)];return _0x4686ea&&_0x5c87dd[_0x4c8030(0xfd)](_0x4b67a4)[_0x4c8030(0xe2)](),{'elementType':ElementType[_0x4c8030(0xce)],'elementId':'','pttElement':{'fileName':_0x7c2117,'filePath':_0x4d836f,'md5HexStr':_0x5b182e,'fileSize':_0xa67461,'duration':_0x5ca74d[_0x4c8030(0xe4)](_0x4df546,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x190902(0x106)](_0x22ae75){const _0x286ca0=_0x190902,_0xdcc24c={'kgWbJ':function(_0xb3607d,_0x2c26de){return _0xb3607d<_0x2c26de;}};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x22ae75,'faceType':_0xdcc24c[_0x286ca0(0xeb)](_0x22ae75,0xde)?FaceType[_0x286ca0(0xe3)]:FaceType[_0x286ca0(0xaf)]}};}static[_0x190902(0x102)](_0x529d67,_0x8e3f31,_0x1f4e34,_0x57d59a){const _0x11116a=_0x190902,_0x234040={'PSjdk':'[商城表情]'};return{'elementType':ElementType[_0x11116a(0xf2)],'marketFaceElement':{'emojiPackageId':_0x529d67,'emojiId':_0x8e3f31,'key':_0x1f4e34,'faceName':_0x57d59a||mFaceCache[_0x11116a(0xf6)](_0x8e3f31)||_0x234040['PSjdk']}};}static[_0x190902(0xd5)](_0x1189e7){const _0x1acb13=_0x190902,_0x51a1da={'HuFKe':'[骰子]'};return{'elementType':ElementType[_0x1acb13(0xc9)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x1acb13(0xd5)],'faceText':_0x51a1da['HuFKe'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x156053){const _0xe200d5=_0x190902,_0x4c9730={'eHRUE':_0xe200d5(0xb5)};return{'elementType':ElementType[_0xe200d5(0xc9)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x4c9730[_0xe200d5(0xb7)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x36e1dd){const _0x3fd13b=_0x190902;return typeof _0x36e1dd!==_0x3fd13b(0xc5)&&(_0x36e1dd=JSON[_0x3fd13b(0xff)](_0x36e1dd)),{'elementType':ElementType[_0x3fd13b(0xe8)],'elementId':'','arkElement':{'bytesData':_0x36e1dd,'linkInfo':null,'subElementType':null}};}static[_0x190902(0xe6)](_0x3e4e29){const _0x29a4b8=_0x190902;return{'elementType':ElementType[_0x29a4b8(0xc2)],'elementId':'','markdownElement':{'content':_0x3e4e29}};}}