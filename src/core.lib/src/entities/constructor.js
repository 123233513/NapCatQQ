const _0x46ff16=_0x2671;(function(_0x31d478,_0x522965){const _0x5a53c8=_0x2671,_0xed52ed=_0x31d478();while(!![]){try{const _0x431ea1=parseInt(_0x5a53c8(0x11b))/0x1*(parseInt(_0x5a53c8(0x12d))/0x2)+-parseInt(_0x5a53c8(0x100))/0x3+parseInt(_0x5a53c8(0x138))/0x4*(-parseInt(_0x5a53c8(0x11a))/0x5)+parseInt(_0x5a53c8(0x10b))/0x6+parseInt(_0x5a53c8(0x137))/0x7+-parseInt(_0x5a53c8(0x11f))/0x8+parseInt(_0x5a53c8(0x127))/0x9*(parseInt(_0x5a53c8(0x114))/0xa);if(_0x431ea1===_0x522965)break;else _0xed52ed['push'](_0xed52ed['shift']());}catch(_0x2d4c14){_0xed52ed['push'](_0xed52ed['shift']());}}}(_0x28df,0xe807c));function _0x28df(){const _0x15ec3b=['BouOr','FILE','108ehwnHl','FNrGc','Bot\x20Test','Bsava','video','WbbHK','find','yHvgb','reply','[包剪锤]','110320adlmbn','688072Qzigfv','NTnZf','then','_0.png','PTT','copyFile','TEXT','Rehpb','AniStickerId','catch','dirname','YplsR','toString','writeFile','语音转换失败,\x20请检查语音文件是否正常','ZQRiQ','uploadFile','height','miniapp','end','notAt','HeXkE','biWsV','YFKrC','KXYyo','yxWka','getImageSize','isFYn','time','replace','YIFBh','BQfpQ','ARK','screenshots','get','unlink','msliI','sep','rps','Thumb','AAMUG','XFjyU','ptt','2866584zgObTR','join','获取视频封面失败，使用默认封面','width','mUWjC','text','获取视频信息失败','mp4','sysface','MFACE','stat','5400030XfdJkt','ark','eHfYm','string','MARKDOWN','PUOwz','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','stringify','error','33510LigUJb','AniStickerPackId','UORvq','RPS','[骰子]','gif','5ZaHvfV','15848zLnVCD','AGhRg','dice','https://www.bilibili.com/','2937328cTYsNK','AniStickerType','QSid','[商城表情]','VIDEO','文件异常，大小为0','PIC','FACE','1809vAdCET','REPLY','face','Ori'];_0x28df=function(){return _0x15ec3b;};return _0x28df();}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x5dbce6}from'node:fs';import _0x5f2e1f from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x2671(_0x429833,_0x3e0a25){const _0x28df77=_0x28df();return _0x2671=function(_0x2671c7,_0x38449d){_0x2671c7=_0x2671c7-0xf5;let _0x44cb1f=_0x28df77[_0x2671c7];return _0x44cb1f;},_0x2671(_0x429833,_0x3e0a25);}import _0x16b793 from'./face_config.json';import*as _0x4606ba from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x46ff16(0x105)](_0xa14a03){const _0x5a59e7=_0x46ff16;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0xa14a03,'atType':AtType[_0x5a59e7(0x14c)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x2887d9,_0x1a32c6,_0xa8580,_0x49d824){const _0x13213d=_0x46ff16;return{'elementType':ElementType[_0x13213d(0x13e)],'elementId':'','textElement':{'content':'@'+_0x49d824,'atType':_0xa8580,'atUid':_0x2887d9,'atTinyId':'','atNtUid':_0x1a32c6}};}static[_0x46ff16(0x135)](_0x2049dc,_0x19ca34,_0x21aced,_0x416ea7){const _0x2448ba=_0x46ff16;return{'elementType':ElementType[_0x2448ba(0x128)],'elementId':'','replyElement':{'replayMsgSeq':_0x2049dc,'replayMsgId':_0x19ca34,'senderUin':_0x21aced,'senderUinStr':_0x416ea7}};}static async['pic'](_0x5310a3,_0x1985f9='',_0x30fbf0=0x0){const _0x60e3b=_0x46ff16,_0x3c0e16={'mUWjC':function(_0x4c21b6,_0x201825){return _0x4c21b6===_0x201825;},'AAMUG':_0x60e3b(0x124),'NTnZf':function(_0x33aa33,_0x24a928){return _0x33aa33(_0x24a928);}},{md5:_0x5bb2bf,fileName:_0x1759e2,path:_0x490b91,fileSize:_0x1173b6}=await NTQQFileApi[_0x60e3b(0x148)](_0x5310a3,ElementType[_0x60e3b(0x125)],_0x30fbf0);if(_0x3c0e16[_0x60e3b(0x104)](_0x1173b6,0x0))throw _0x3c0e16[_0x60e3b(0xfd)];const _0x557036=await NTQQFileApi[_0x60e3b(0x152)](_0x5310a3),_0x232de9={'md5HexStr':_0x5bb2bf,'fileSize':_0x1173b6[_0x60e3b(0x144)](),'picWidth':_0x557036?.[_0x60e3b(0x103)],'picHeight':_0x557036?.[_0x60e3b(0x149)],'fileName':_0x1759e2,'sourcePath':_0x490b91,'original':!![],'picType':_0x3c0e16[_0x60e3b(0x139)](isGIF,_0x5310a3)?PicType[_0x60e3b(0x119)]:PicType['jpg'],'picSubType':_0x30fbf0,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x1985f9};return{'elementType':ElementType[_0x60e3b(0x125)],'elementId':'','picElement':_0x232de9};}static async['file'](_0x3dffaf,_0x18cbdf=''){const _0x38f7c7=_0x46ff16,_0x25241e={'HVAzc':function(_0x2ce91c,_0x1230d2){return _0x2ce91c===_0x1230d2;},'FNrGc':'文件异常，大小为0','BouOr':function(_0x495e17,_0x5b14f7){return _0x495e17||_0x5b14f7;}},{md5:_0x1f65c7,fileName:_0x48988b,path:_0x5e2def,fileSize:_0x3a4529}=await NTQQFileApi['uploadFile'](_0x3dffaf,ElementType[_0x38f7c7(0x12c)]);if(_0x25241e['HVAzc'](_0x3a4529,0x0))throw _0x25241e[_0x38f7c7(0x12e)];const _0x2089f1={'elementType':ElementType[_0x38f7c7(0x12c)],'elementId':'','fileElement':{'fileName':_0x25241e[_0x38f7c7(0x12b)](_0x18cbdf,_0x48988b),'filePath':_0x5e2def,'fileSize':_0x3a4529[_0x38f7c7(0x144)]()}};return _0x2089f1;}static async[_0x46ff16(0x131)](_0x4cc369,_0x520fdd='',_0x1c90e0=''){const _0x32cd29=_0x46ff16,_0x478a00={'isFYn':function(_0x15d705,_0x5c5704){return _0x15d705(_0x5c5704);},'msliI':function(_0x2cf2b5,_0x1f9859,_0x3fa2f2){return _0x2cf2b5(_0x1f9859,_0x3fa2f2);},'Bsava':_0x32cd29(0x102),'WbbHK':_0x32cd29(0x14b),'yxWka':function(_0x2d1de5,_0x4af2b5){return _0x2d1de5+_0x4af2b5;},'YFKrC':_0x32cd29(0x107),'yHvgb':function(_0x520f2f,_0x20bbbe,_0xfc716){return _0x520f2f(_0x20bbbe,_0xfc716);},'eHfYm':_0x32cd29(0x106),'KXYyo':function(_0x5c697f,_0x53e81c){return _0x5c697f||_0x53e81c;}},{fileName:_0x373f25,path:_0x1200cc,fileSize:_0x41d745,md5:_0x63da07}=await NTQQFileApi[_0x32cd29(0x148)](_0x4cc369,ElementType[_0x32cd29(0x123)]);if(_0x41d745===0x0)throw _0x32cd29(0x124);let _0x3bddcd=_0x1200cc[_0x32cd29(0x155)](_0x4606ba[_0x32cd29(0xfa)]+_0x32cd29(0x12a)+_0x4606ba[_0x32cd29(0xfa)],_0x4606ba[_0x32cd29(0xfa)]+_0x32cd29(0xfc)+_0x4606ba['sep']);_0x3bddcd=_0x4606ba[_0x32cd29(0x142)](_0x3bddcd);let _0x508130={'width':0x780,'height':0x438,'time':0xf,'format':_0x478a00[_0x32cd29(0x14f)],'size':_0x41d745,'filePath':_0x4cc369};try{_0x508130=await getVideoInfo(_0x1200cc);}catch(_0x4595f3){_0x478a00[_0x32cd29(0x134)](logError,_0x478a00[_0x32cd29(0x10d)],_0x4595f3);}const _0x2cb242=new Promise((_0x31c770,_0x3d811d)=>{const _0x5950b6=_0x32cd29,_0x10d2d7=_0x63da07+_0x5950b6(0x13b),_0xa946a9=_0x4606ba[_0x5950b6(0x101)](_0x3bddcd,_0x10d2d7);_0x478a00[_0x5950b6(0x153)](_0x5f2e1f,_0x4cc369)['on'](_0x478a00[_0x5950b6(0x132)],()=>{})['on'](_0x5950b6(0x113),_0x40da6a=>{const _0x4a400f=_0x5950b6,_0x2bf991={'ZQRiQ':function(_0x3770dc,_0x5af5bb){const _0x59c3c0=_0x2671;return _0x478a00[_0x59c3c0(0x153)](_0x3770dc,_0x5af5bb);}};_0x478a00[_0x4a400f(0xf9)](logDebug,_0x478a00[_0x4a400f(0x130)],_0x40da6a),_0x1c90e0?_0x5dbce6[_0x4a400f(0x13d)](_0x1c90e0,_0xa946a9)[_0x4a400f(0x13a)](()=>{_0x2bf991['ZQRiQ'](_0x31c770,_0xa946a9);})[_0x4a400f(0x141)](_0x3d811d):_0x5dbce6[_0x4a400f(0x145)](_0xa946a9,defaultVideoThumb)[_0x4a400f(0x13a)](()=>{const _0x2af542=_0x4a400f;_0x2bf991[_0x2af542(0x147)](_0x31c770,_0xa946a9);})[_0x4a400f(0x141)](_0x3d811d);})[_0x5950b6(0xf6)]({'timestamps':[0x0],'filename':_0x10d2d7,'folder':_0x3bddcd,'size':_0x478a00['yxWka'](_0x478a00[_0x5950b6(0x151)](_0x508130[_0x5950b6(0x103)],'x'),_0x508130[_0x5950b6(0x149)])})['on'](_0x478a00[_0x5950b6(0x132)],()=>{const _0x1729a9=_0x5950b6;_0x478a00[_0x1729a9(0x153)](_0x31c770,_0xa946a9);});}),_0x4a4d6b=new Map(),_0x146c7b=await _0x2cb242,_0x5ead6f=(await _0x5dbce6[_0x32cd29(0x10a)](_0x146c7b))['size'];_0x4a4d6b['set'](0x0,_0x146c7b);const _0x589af1=await _0x478a00[_0x32cd29(0x153)](calculateFileMD5,_0x146c7b),_0x432021={'elementType':ElementType[_0x32cd29(0x123)],'elementId':'','videoElement':{'fileName':_0x478a00[_0x32cd29(0x150)](_0x520fdd,_0x373f25),'filePath':_0x1200cc,'videoMd5':_0x63da07,'thumbMd5':_0x589af1,'fileTime':_0x508130[_0x32cd29(0x154)],'thumbPath':_0x4a4d6b,'thumbSize':_0x5ead6f,'thumbWidth':_0x508130['width'],'thumbHeight':_0x508130[_0x32cd29(0x149)],'fileSize':_0x478a00[_0x32cd29(0x151)]('',_0x41d745)}};return _0x432021;}static async[_0x46ff16(0xff)](_0x22eee2){const _0x12c1ac=_0x46ff16,_0x21ed67={'BQfpQ':function(_0xe458a0,_0x3bda20){return _0xe458a0(_0x3bda20);},'UORvq':_0x12c1ac(0x146),'YIFBh':function(_0x12e8a8,_0x45397f){return _0x12e8a8===_0x45397f;},'XFjyU':function(_0xbc5093,_0x2ebe85){return _0xbc5093||_0x2ebe85;}},{converted:_0x100689,path:_0x40d90d,duration:_0xec42f5}=await _0x21ed67[_0x12c1ac(0x157)](encodeSilk,_0x22eee2);if(!_0x40d90d)throw _0x21ed67[_0x12c1ac(0x116)];const {md5:_0x32ca24,fileName:_0x207dea,path:_0x1cc2e9,fileSize:_0x1d365a}=await NTQQFileApi['uploadFile'](_0x40d90d,ElementType['PTT']);if(_0x21ed67[_0x12c1ac(0x156)](_0x1d365a,0x0))throw _0x12c1ac(0x124);return _0x100689&&_0x5dbce6[_0x12c1ac(0xf8)](_0x40d90d)['then'](),{'elementType':ElementType[_0x12c1ac(0x13c)],'elementId':'','pttElement':{'fileName':_0x207dea,'filePath':_0x1cc2e9,'md5HexStr':_0x32ca24,'fileSize':_0x1d365a,'duration':_0x21ed67[_0x12c1ac(0xfe)](_0xec42f5,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x46ff16(0x129)](_0x14258b){const _0x4d5279=_0x46ff16,_0x30e916={'YplsR':function(_0xb6a803,_0x7ede5f){return _0xb6a803(_0x7ede5f);},'AGhRg':function(_0x35b751,_0x353003){return _0x35b751>=_0x353003;}},_0x175768=_0x16b793[_0x4d5279(0x108)],_0x59ee2f=_0x16b793['emoji'],_0x17f3c9=_0x175768[_0x4d5279(0x133)](_0x2a0b65=>_0x2a0b65[_0x4d5279(0x121)]===_0x14258b[_0x4d5279(0x144)]());_0x14258b=_0x30e916[_0x4d5279(0x143)](parseInt,_0x14258b['toString']());let _0x581d02=0x1;return _0x30e916[_0x4d5279(0x11c)](_0x14258b,0xde)&&(_0x581d02=0x2),_0x17f3c9[_0x4d5279(0x120)]&&(_0x581d02=0x3),{'elementType':ElementType[_0x4d5279(0x126)],'elementId':'','faceElement':{'faceIndex':_0x14258b,'faceType':_0x581d02,'faceText':_0x17f3c9['QDes'],'stickerId':_0x17f3c9[_0x4d5279(0x140)],'stickerType':_0x17f3c9[_0x4d5279(0x120)],'packId':_0x17f3c9[_0x4d5279(0x115)],'sourceType':0x1}};}static['mface'](_0x498482,_0x204eb0,_0x335141,_0x44d899){const _0x3ec95e=_0x46ff16;return{'elementType':ElementType[_0x3ec95e(0x109)],'marketFaceElement':{'emojiPackageId':_0x498482,'emojiId':_0x204eb0,'key':_0x335141,'faceName':_0x44d899||mFaceCache[_0x3ec95e(0xf7)](_0x204eb0)||_0x3ec95e(0x122)}};}static[_0x46ff16(0x11d)](_0x34979f){const _0x1632bd=_0x46ff16,_0x351205={'Rehpb':_0x1632bd(0x118)};return{'elementType':ElementType[_0x1632bd(0x126)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1632bd(0x11d)],'faceType':FaceType[_0x1632bd(0x11d)],'faceText':_0x351205[_0x1632bd(0x13f)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x46ff16(0xfb)](_0x11df3f){const _0x58beb8=_0x46ff16;return{'elementType':ElementType[_0x58beb8(0x126)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x58beb8(0x117)],'faceText':_0x58beb8(0x136),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x46ff16(0x10c)](_0x2fb9d1){const _0x5cdb12=_0x46ff16;return typeof _0x2fb9d1!==_0x5cdb12(0x10e)&&(_0x2fb9d1=JSON[_0x5cdb12(0x112)](_0x2fb9d1)),{'elementType':ElementType[_0x5cdb12(0xf5)],'elementId':'','arkElement':{'bytesData':_0x2fb9d1,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x3450b2){const _0x123db2=_0x46ff16;return{'elementType':ElementType[_0x123db2(0x10f)],'elementId':'','markdownElement':{'content':_0x3450b2}};}static async[_0x46ff16(0x14a)](){const _0x12da2c=_0x46ff16,_0x459843={'PUOwz':function(_0x11e6fc,_0x2d34ed){return _0x11e6fc(_0x2d34ed);},'HeXkE':'Bot\x20Test','biWsV':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','uUEjn':_0x12da2c(0x111)};let _0x4f0c63=await _0x459843[_0x12da2c(0x110)](SignMiniApp,{'prompt':_0x459843[_0x12da2c(0x14d)],'title':_0x12da2c(0x12f),'preview':_0x459843[_0x12da2c(0x14e)],'jumpUrl':_0x12da2c(0x11e),'tag':_0x12da2c(0x12f),'tagIcon':_0x459843['uUEjn'],'source':_0x459843[_0x12da2c(0x14d)],'sourcelogo':_0x459843['uUEjn']});return{'elementType':ElementType[_0x12da2c(0xf5)],'elementId':'','arkElement':{'bytesData':_0x4f0c63,'linkInfo':null,'subElementType':null}};}}