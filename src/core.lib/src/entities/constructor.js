const _0x29f748=_0x25c4;(function(_0xdf64f1,_0x3ce052){const _0x3077a4=_0x25c4,_0x37f072=_0xdf64f1();while(!![]){try{const _0x735606=-parseInt(_0x3077a4(0x19c))/0x1*(parseInt(_0x3077a4(0x162))/0x2)+-parseInt(_0x3077a4(0x1a1))/0x3*(parseInt(_0x3077a4(0x186))/0x4)+-parseInt(_0x3077a4(0x1a6))/0x5+-parseInt(_0x3077a4(0x19a))/0x6*(parseInt(_0x3077a4(0x1a2))/0x7)+parseInt(_0x3077a4(0x196))/0x8+parseInt(_0x3077a4(0x161))/0x9+parseInt(_0x3077a4(0x165))/0xa;if(_0x735606===_0x3ce052)break;else _0x37f072['push'](_0x37f072['shift']());}catch(_0x449ce6){_0x37f072['push'](_0x37f072['shift']());}}}(_0x5ce0,0xc4d80));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x3e44a3}from'node:fs';import _0x4d75c9 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x5ce0(){const _0x2bf0e4=['VYoWJ','normal2','stat','WrSiv','REPLY','string','PVMZn','file','IbQqq','[包剪锤]','sep','dirname','mp4','sCUJs','error','145608qInDOZ','time','JlORw','GBrCY','getImageSize','normal','MFACE','获取视频信息失败','nBGfS','VIDEO','lUGqo','toString','FACE','CrojM','face','FILE','3998880gaGSMe','_0.png','TEXT','文件异常，大小为0','14970MYXSmy','QmRbT','121RfTtSG','qjPqW','vRdka','copyFile','end','111ODJPwC','658FKFmIr','bqNnp','get','jpg','979045PKDnsr','DVMYv','JXzzc','text','set','dice','PTT','uploadFile','VHqUm','NMjGy','qVTug','catch','rps','jiQZn','qJnrZ','zfKpw','获取视频封面失败，使用默认封面','width','markdown','12280158qRNOuF','10882ztHacQ','GoUyp','path','13775240NuckCM','rGZuH','screenshots','height','video','yMUAT','giiUX','then','PIC','gif','Ori','Thumb','ARK','pic','视频信息','stringify','[骰子]','ark'];_0x5ce0=function(){return _0x2bf0e4;};return _0x5ce0();}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x25c4(_0x562a7a,_0x48fddd){const _0x5ce075=_0x5ce0();return _0x25c4=function(_0x25c4d1,_0x3526bc){_0x25c4d1=_0x25c4d1-0x158;let _0x2764b4=_0x5ce075[_0x25c4d1];return _0x2764b4;},_0x25c4(_0x562a7a,_0x48fddd);}import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x29f748(0x1a9)](_0x4613a9){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x4613a9,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x2c5eb0,_0x4877c6,_0x452a41,_0x81ff12){const _0x3f54da=_0x29f748;return{'elementType':ElementType[_0x3f54da(0x198)],'elementId':'','textElement':{'content':'@'+_0x81ff12,'atType':_0x452a41,'atUid':_0x2c5eb0,'atTinyId':'','atNtUid':_0x4877c6}};}static['reply'](_0x302268,_0xe25c5a,_0x39e926,_0x1d2a7b){const _0x3dec47=_0x29f748;return{'elementType':ElementType[_0x3dec47(0x17b)],'elementId':'','replyElement':{'replayMsgSeq':_0x302268,'replayMsgId':_0xe25c5a,'senderUin':_0x39e926,'senderUinStr':_0x1d2a7b}};}static async[_0x29f748(0x172)](_0x2b759f,_0x5dd59='',_0x3efc0c=0x0){const _0x1708d1=_0x29f748,_0x364b12={'xspBk':function(_0x18bfd2,_0x360510){return _0x18bfd2===_0x360510;},'qJnrZ':_0x1708d1(0x199),'zfKpw':function(_0x4eab26,_0x2e883f,_0xf865f8){return _0x4eab26(_0x2e883f,_0xf865f8);},'NMjGy':'图片信息'},{md5:_0x77e92a,fileName:_0x2696d4,path:_0x446c0f,fileSize:_0x1c5ed2}=await NTQQFileApi['uploadFile'](_0x2b759f,ElementType[_0x1708d1(0x16d)],_0x3efc0c);if(_0x364b12['xspBk'](_0x1c5ed2,0x0))throw _0x364b12[_0x1708d1(0x15c)];const _0x5f4e25=await NTQQFileApi[_0x1708d1(0x18a)](_0x2b759f),_0x235d14={'md5HexStr':_0x77e92a,'fileSize':_0x1c5ed2[_0x1708d1(0x191)](),'picWidth':_0x5f4e25?.[_0x1708d1(0x15f)],'picHeight':_0x5f4e25?.[_0x1708d1(0x168)],'fileName':_0x2696d4,'sourcePath':_0x446c0f,'original':!![],'picType':isGIF(_0x2b759f)?PicType[_0x1708d1(0x16e)]:PicType[_0x1708d1(0x1a5)],'picSubType':_0x3efc0c,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5dd59};return _0x364b12[_0x1708d1(0x15d)](logDebug,_0x364b12[_0x1708d1(0x1af)],_0x235d14),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x235d14};}static async[_0x29f748(0x17e)](_0x8c4bfd,_0x36f0e5=''){const _0x30bfbd=_0x29f748,_0x4df9b9={'giiUX':function(_0x123cd0,_0x2b7c56){return _0x123cd0===_0x2b7c56;},'lmkmk':_0x30bfbd(0x199),'DVMYv':function(_0x2046af,_0x335cc2){return _0x2046af||_0x335cc2;}},{md5:_0x4b06d9,fileName:_0x366faa,path:_0xaca1f0,fileSize:_0x16dfb1}=await NTQQFileApi['uploadFile'](_0x8c4bfd,ElementType[_0x30bfbd(0x195)]);if(_0x4df9b9[_0x30bfbd(0x16b)](_0x16dfb1,0x0))throw _0x4df9b9['lmkmk'];const _0x59dde7={'elementType':ElementType[_0x30bfbd(0x195)],'elementId':'','fileElement':{'fileName':_0x4df9b9[_0x30bfbd(0x1a7)](_0x36f0e5,_0x366faa),'filePath':_0xaca1f0,'fileSize':_0x16dfb1['toString']()}};return _0x59dde7;}static async[_0x29f748(0x169)](_0x2ddf84,_0x2bf334='',_0x1ffee7=''){const _0x32bedd=_0x29f748,_0x1eda28={'sCUJs':function(_0x240453,_0x36d3d8){return _0x240453(_0x36d3d8);},'PVMZn':function(_0x3716d2,_0x37cd6e,_0xe25c54){return _0x3716d2(_0x37cd6e,_0xe25c54);},'bboZr':_0x32bedd(0x15e),'yMUAT':function(_0x2d8f0a,_0x11e3a2){return _0x2d8f0a(_0x11e3a2);},'nBGfS':_0x32bedd(0x1a0),'WrSiv':_0x32bedd(0x185),'bqNnp':function(_0x337096,_0x140c53){return _0x337096+_0x140c53;},'ezWQN':function(_0x3e376b,_0x546b44){return _0x3e376b+_0x546b44;},'CrojM':function(_0x3dab65,_0x411886){return _0x3dab65===_0x411886;},'Lazqz':'文件异常，大小为0','qjPqW':_0x32bedd(0x164),'UQPoH':_0x32bedd(0x183),'GoUyp':_0x32bedd(0x173),'JlORw':function(_0x16911f,_0x456f32,_0x2b9a66){return _0x16911f(_0x456f32,_0x2b9a66);},'jiQZn':_0x32bedd(0x18d),'VHqUm':function(_0x286862,_0x5564a2){return _0x286862(_0x5564a2);},'CIvjW':function(_0x1b2766,_0x240b57){return _0x1b2766||_0x240b57;},'GBrCY':function(_0x13b2b6,_0x39b385){return _0x13b2b6+_0x39b385;}},{fileName:_0x47144e,path:_0x5ad08b,fileSize:_0x18dea7,md5:_0x1c75ff}=await NTQQFileApi['uploadFile'](_0x2ddf84,ElementType['VIDEO']);if(_0x1eda28[_0x32bedd(0x193)](_0x18dea7,0x0))throw _0x1eda28['Lazqz'];const _0x3b88cd=require(_0x1eda28[_0x32bedd(0x19d)]);let _0x294725=_0x5ad08b['replace'](_0x3b88cd[_0x32bedd(0x181)]+_0x32bedd(0x16f)+_0x3b88cd[_0x32bedd(0x181)],_0x3b88cd[_0x32bedd(0x181)]+_0x32bedd(0x170)+_0x3b88cd['sep']);_0x294725=_0x3b88cd[_0x32bedd(0x182)](_0x294725);let _0x58f1ea={'width':0x780,'height':0x438,'time':0xf,'format':_0x1eda28['UQPoH'],'size':_0x18dea7,'filePath':_0x2ddf84};try{_0x58f1ea=await getVideoInfo(_0x5ad08b),_0x1eda28['PVMZn'](logDebug,_0x1eda28[_0x32bedd(0x163)],_0x58f1ea);}catch(_0x26f4af){_0x1eda28[_0x32bedd(0x188)](logError,_0x1eda28[_0x32bedd(0x15b)],_0x26f4af);}const _0x597196=new Promise((_0xd06cb0,_0x1f1647)=>{const _0x1b7f21=_0x32bedd,_0x45d541=_0x1c75ff+_0x1b7f21(0x197),_0x5e8c2e=_0x3b88cd['join'](_0x294725,_0x45d541);_0x4d75c9(_0x2ddf84)['on'](_0x1eda28[_0x1b7f21(0x18e)],()=>{})['on'](_0x1eda28[_0x1b7f21(0x17a)],_0x56ebb6=>{const _0x5207e6=_0x1b7f21,_0x49443c={'JXzzc':function(_0x150ee9,_0x586c6f){const _0x572b2f=_0x25c4;return _0x1eda28[_0x572b2f(0x184)](_0x150ee9,_0x586c6f);}};_0x1eda28[_0x5207e6(0x17d)](logDebug,_0x1eda28['bboZr'],_0x56ebb6),_0x1ffee7?_0x3e44a3[_0x5207e6(0x19f)](_0x1ffee7,_0x5e8c2e)[_0x5207e6(0x16c)](()=>{const _0x3d00e1=_0x5207e6;_0x49443c[_0x3d00e1(0x1a8)](_0xd06cb0,_0x5e8c2e);})[_0x5207e6(0x159)](_0x1f1647):_0x3e44a3['writeFile'](_0x5e8c2e,defaultVideoThumb)['then'](()=>{_0xd06cb0(_0x5e8c2e);})[_0x5207e6(0x159)](_0x1f1647);})[_0x1b7f21(0x167)]({'timestamps':[0x0],'filename':_0x45d541,'folder':_0x294725,'size':_0x1eda28[_0x1b7f21(0x1a3)](_0x1eda28['ezWQN'](_0x58f1ea['width'],'x'),_0x58f1ea[_0x1b7f21(0x168)])})['on'](_0x1eda28[_0x1b7f21(0x18e)],()=>{const _0x2ccb1f=_0x1b7f21;_0x1eda28[_0x2ccb1f(0x16a)](_0xd06cb0,_0x5e8c2e);});}),_0x55147d=new Map(),_0x4683bf=await _0x597196,_0x5fa3d3=(await _0x3e44a3[_0x32bedd(0x179)](_0x4683bf))['size'];_0x55147d[_0x32bedd(0x1aa)](0x0,_0x4683bf);const _0x4c36da=await _0x1eda28[_0x32bedd(0x1ae)](calculateFileMD5,_0x4683bf),_0x50e71f={'elementType':ElementType[_0x32bedd(0x18f)],'elementId':'','videoElement':{'fileName':_0x1eda28['CIvjW'](_0x2bf334,_0x47144e),'filePath':_0x5ad08b,'videoMd5':_0x1c75ff,'thumbMd5':_0x4c36da,'fileTime':_0x58f1ea[_0x32bedd(0x187)],'thumbPath':_0x55147d,'thumbSize':_0x5fa3d3,'thumbWidth':_0x58f1ea[_0x32bedd(0x15f)],'thumbHeight':_0x58f1ea['height'],'fileSize':_0x1eda28[_0x32bedd(0x189)]('',_0x18dea7)}};return _0x50e71f;}static async['ptt'](_0x68cbaf){const _0x4bb6ff=_0x29f748,_0x33cc9f={'IbsCW':function(_0x2fb52f,_0x2b72ec){return _0x2fb52f(_0x2b72ec);},'vRdka':'语音转换失败,\x20请检查语音文件是否正常','qVTug':function(_0x3524df,_0x48e3e9){return _0x3524df===_0x48e3e9;},'rGZuH':_0x4bb6ff(0x199)},{converted:_0x3fabb1,path:_0x383036,duration:_0xbbf255}=await _0x33cc9f['IbsCW'](encodeSilk,_0x68cbaf);if(!_0x383036)throw _0x33cc9f[_0x4bb6ff(0x19e)];const {md5:_0x6d650f,fileName:_0x39e38f,path:_0x225dfb,fileSize:_0x399cdc}=await NTQQFileApi[_0x4bb6ff(0x1ad)](_0x383036,ElementType[_0x4bb6ff(0x1ac)]);if(_0x33cc9f[_0x4bb6ff(0x158)](_0x399cdc,0x0))throw _0x33cc9f[_0x4bb6ff(0x166)];return _0x3fabb1&&_0x3e44a3['unlink'](_0x383036)[_0x4bb6ff(0x16c)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x39e38f,'filePath':_0x225dfb,'md5HexStr':_0x6d650f,'fileSize':_0x399cdc,'duration':_0xbbf255||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x29f748(0x194)](_0x3c6a6b){const _0x23f821=_0x29f748,_0x261a70={'XvXXM':function(_0x4709f8,_0xa2d66b){return _0x4709f8<_0xa2d66b;}};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x3c6a6b,'faceType':_0x261a70['XvXXM'](_0x3c6a6b,0xde)?FaceType[_0x23f821(0x18b)]:FaceType[_0x23f821(0x178)]}};}static['mface'](_0x389aea,_0x5e7ad2,_0x557691,_0x17b29c){const _0x98d8fd=_0x29f748,_0x3a4ddb={'QmRbT':'[商城表情]'};return{'elementType':ElementType[_0x98d8fd(0x18c)],'marketFaceElement':{'emojiPackageId':_0x389aea,'emojiId':_0x5e7ad2,'key':_0x557691,'faceName':_0x17b29c||mFaceCache[_0x98d8fd(0x1a4)](_0x5e7ad2)||_0x3a4ddb[_0x98d8fd(0x19b)]}};}static['dice'](_0x5d2758){const _0x3525cb=_0x29f748;return{'elementType':ElementType[_0x3525cb(0x192)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x3525cb(0x1ab)],'faceType':FaceType[_0x3525cb(0x1ab)],'faceText':_0x3525cb(0x175),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x29f748(0x15a)](_0xb695b7){const _0x4e3094=_0x29f748,_0x333530={'lUGqo':_0x4e3094(0x180)};return{'elementType':ElementType[_0x4e3094(0x192)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x333530[_0x4e3094(0x190)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x29f748(0x176)](_0x77921f){const _0x2d635f=_0x29f748,_0x5a6923={'VYoWJ':function(_0x5f3318,_0x17ddab){return _0x5f3318!==_0x17ddab;},'IbQqq':_0x2d635f(0x17c)};return _0x5a6923[_0x2d635f(0x177)](typeof _0x77921f,_0x5a6923[_0x2d635f(0x17f)])&&(_0x77921f=JSON[_0x2d635f(0x174)](_0x77921f)),{'elementType':ElementType[_0x2d635f(0x171)],'elementId':'','arkElement':{'bytesData':_0x77921f,'linkInfo':null,'subElementType':null}};}static[_0x29f748(0x160)](_0x2ecc1b){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x2ecc1b}};}}