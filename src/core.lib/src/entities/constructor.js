const _0x575111=_0x2b92;(function(_0x567b35,_0x50b58c){const _0x46e46f=_0x2b92,_0x442e9d=_0x567b35();while(!![]){try{const _0x291c58=-parseInt(_0x46e46f(0x1c0))/0x1+-parseInt(_0x46e46f(0x1cd))/0x2*(parseInt(_0x46e46f(0x1d4))/0x3)+parseInt(_0x46e46f(0x1e3))/0x4*(-parseInt(_0x46e46f(0x1df))/0x5)+parseInt(_0x46e46f(0x1a8))/0x6+parseInt(_0x46e46f(0x1f2))/0x7+parseInt(_0x46e46f(0x1a9))/0x8+parseInt(_0x46e46f(0x1b4))/0x9;if(_0x291c58===_0x50b58c)break;else _0x442e9d['push'](_0x442e9d['shift']());}catch(_0x444807){_0x442e9d['push'](_0x442e9d['shift']());}}}(_0x6454,0x8ee0f));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0xe14f74}from'node:fs';import _0x6363d0 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';function _0x2b92(_0x17d65c,_0x3264a9){const _0x6454b7=_0x6454();return _0x2b92=function(_0x2b9266,_0x44559c){_0x2b9266=_0x2b9266-0x1a1;let _0x2d0cca=_0x6454b7[_0x2b9266];return _0x2d0cca;},_0x2b92(_0x17d65c,_0x3264a9);}import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x49e995 from'./face_config.json';import*as _0x4aa4da from'node:path';function _0x6454(){const _0x122abb=['AniStickerPackId','uploadFile','sep','2752746CWjvaj','6382056HtyrOe','unlink','string','end','rps','height','AniStickerId','dGpyn','[骰子]','XwSXG','width','2953332LcNUik','AniStickerType','stat','ptt','pic','[商城表情]','QDes','视频信息','kBjfc','markdown','dice','stringify','250178gvqcuH','error','PTT','kqkzU','XyYFP','gif','VEGPz','FPGqb','vkdRY','JmmTP','size','PIC','reply','22VcpjKX','mface','tAeBM','get','cRwCH','FACE','sysface','129033qKWdqb','Thumb','time','file','text','VwLNS','文件异常，大小为0','getImageSize','获取视频信息失败','REPLY','writeFile','9165jzhdpi','copyFile','ark','语音转换失败,\x20请检查语音文件是否正常','1732vBxOsy','Ori','toString','then','jpg','screenshots','MARKDOWN','video','find','HWnHi','[包剪锤]','TEXT','set','FILE','ksSdh','3622661ifUpEM','ZOEub','VIDEO','nXVKL','face','QoXAB'];_0x6454=function(){return _0x122abb;};return _0x6454();}export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x575111(0x1d8)](_0x3a6d2b){const _0x17fff9=_0x575111;return{'elementType':ElementType[_0x17fff9(0x1ee)],'elementId':'','textElement':{'content':_0x3a6d2b,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x3f7f69,_0x21f355,_0x101cb7,_0x937675){const _0x5ddbcd=_0x575111;return{'elementType':ElementType[_0x5ddbcd(0x1ee)],'elementId':'','textElement':{'content':'@'+_0x937675,'atType':_0x101cb7,'atUid':_0x3f7f69,'atTinyId':'','atNtUid':_0x21f355}};}static[_0x575111(0x1cc)](_0x1ca70c,_0x3bd1f5,_0x2ca0b1,_0x2a1d8c){const _0x380a2a=_0x575111;return{'elementType':ElementType[_0x380a2a(0x1dd)],'elementId':'','replyElement':{'replayMsgSeq':_0x1ca70c,'replayMsgId':_0x3bd1f5,'senderUin':_0x2ca0b1,'senderUinStr':_0x2a1d8c}};}static async[_0x575111(0x1b8)](_0x2ab98d,_0x2b274d='',_0x2068c8=0x0){const _0x4b94f2=_0x575111,_0x2dcc1a={'QoXAB':function(_0x193281,_0x5f20d5){return _0x193281===_0x5f20d5;},'kBjfc':_0x4b94f2(0x1da),'GGGGj':function(_0x51d7e2,_0x411a27){return _0x51d7e2(_0x411a27);},'PEGnA':function(_0x865438,_0xb29cf9,_0x1ad9e1){return _0x865438(_0xb29cf9,_0x1ad9e1);}},{md5:_0x1631d8,fileName:_0x5b8600,path:_0x514471,fileSize:_0x1d79a5}=await NTQQFileApi['uploadFile'](_0x2ab98d,ElementType[_0x4b94f2(0x1cb)],_0x2068c8);if(_0x2dcc1a[_0x4b94f2(0x1a4)](_0x1d79a5,0x0))throw _0x2dcc1a[_0x4b94f2(0x1bc)];const _0x4e1468=await NTQQFileApi[_0x4b94f2(0x1db)](_0x2ab98d),_0x57914f={'md5HexStr':_0x1631d8,'fileSize':_0x1d79a5[_0x4b94f2(0x1e5)](),'picWidth':_0x4e1468?.[_0x4b94f2(0x1b3)],'picHeight':_0x4e1468?.[_0x4b94f2(0x1ae)],'fileName':_0x5b8600,'sourcePath':_0x514471,'original':!![],'picType':_0x2dcc1a['GGGGj'](isGIF,_0x2ab98d)?PicType[_0x4b94f2(0x1c5)]:PicType[_0x4b94f2(0x1e7)],'picSubType':_0x2068c8,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2b274d};return _0x2dcc1a['PEGnA'](logDebug,'图片信息',_0x57914f),{'elementType':ElementType[_0x4b94f2(0x1cb)],'elementId':'','picElement':_0x57914f};}static async[_0x575111(0x1d7)](_0x5ed456,_0x1074e4=''){const _0x3032dd=_0x575111,_0x18fd77={'HWnHi':function(_0x2a8fa1,_0x3ca806){return _0x2a8fa1===_0x3ca806;},'ksSdh':function(_0x1c5600,_0x52fd23){return _0x1c5600||_0x52fd23;}},{md5:_0x5658c9,fileName:_0xa1ce57,path:_0x2f2991,fileSize:_0x1f137a}=await NTQQFileApi[_0x3032dd(0x1a6)](_0x5ed456,ElementType[_0x3032dd(0x1f0)]);if(_0x18fd77[_0x3032dd(0x1ec)](_0x1f137a,0x0))throw _0x3032dd(0x1da);const _0x4e8908={'elementType':ElementType[_0x3032dd(0x1f0)],'elementId':'','fileElement':{'fileName':_0x18fd77[_0x3032dd(0x1f1)](_0x1074e4,_0xa1ce57),'filePath':_0x2f2991,'fileSize':_0x1f137a['toString']()}};return _0x4e8908;}static async[_0x575111(0x1ea)](_0x536240,_0x148ec8='',_0x4dff89=''){const _0x5a6786=_0x575111,_0x1e953e={'tAeBM':function(_0x248797,_0x1b1fa3){return _0x248797(_0x1b1fa3);},'VwLNS':function(_0x288c17,_0x25cf84,_0x250d87){return _0x288c17(_0x25cf84,_0x250d87);},'XscKl':'获取视频封面失败，使用默认封面','kqkzU':'end','dGpyn':_0x5a6786(0x1c1),'vkdRY':function(_0x3b7732,_0x269675){return _0x3b7732+_0x269675;},'XyYFP':_0x5a6786(0x1da),'WDhqP':function(_0x3c1e5d,_0x1b3178,_0x34a4d1){return _0x3c1e5d(_0x1b3178,_0x34a4d1);},'XwSXG':_0x5a6786(0x1bb),'dmArR':_0x5a6786(0x1dc)},{fileName:_0x37ad0a,path:_0x5095bf,fileSize:_0x251d0d,md5:_0x1c3f25}=await NTQQFileApi['uploadFile'](_0x536240,ElementType[_0x5a6786(0x1a1)]);if(_0x251d0d===0x0)throw _0x1e953e[_0x5a6786(0x1c4)];let _0x4a954e=_0x5095bf['replace'](_0x4aa4da[_0x5a6786(0x1a7)]+_0x5a6786(0x1e4)+_0x4aa4da[_0x5a6786(0x1a7)],_0x4aa4da[_0x5a6786(0x1a7)]+_0x5a6786(0x1d5)+_0x4aa4da[_0x5a6786(0x1a7)]);_0x4a954e=_0x4aa4da['dirname'](_0x4a954e);let _0x42068f={'width':0x780,'height':0x438,'time':0xf,'format':'mp4','size':_0x251d0d,'filePath':_0x536240};try{_0x42068f=await _0x1e953e[_0x5a6786(0x1cf)](getVideoInfo,_0x5095bf),_0x1e953e['WDhqP'](logDebug,_0x1e953e[_0x5a6786(0x1b2)],_0x42068f);}catch(_0x2a155d){_0x1e953e[_0x5a6786(0x1d9)](logError,_0x1e953e['dmArR'],_0x2a155d);}const _0x34060d=new Promise((_0x12b0e0,_0x309c4e)=>{const _0x26719a=_0x5a6786,_0x451cc6={'ZOEub':function(_0x416288,_0x2342f5){const _0x1666e2=_0x2b92;return _0x1e953e[_0x1666e2(0x1cf)](_0x416288,_0x2342f5);},'DTORd':function(_0x404b39,_0x9f5f08,_0x1176c4){const _0x2ea9b7=_0x2b92;return _0x1e953e[_0x2ea9b7(0x1d9)](_0x404b39,_0x9f5f08,_0x1176c4);},'JmmTP':_0x1e953e['XscKl']},_0x21b50b=_0x1c3f25+'_0.png',_0x38be02=_0x4aa4da['join'](_0x4a954e,_0x21b50b);_0x6363d0(_0x536240)['on'](_0x1e953e[_0x26719a(0x1c3)],()=>{})['on'](_0x1e953e[_0x26719a(0x1b0)],_0xff81d7=>{const _0x11ad67=_0x26719a,_0x404a5e={'rDCSc':function(_0x381cd1,_0x1e5e1f){return _0x451cc6['ZOEub'](_0x381cd1,_0x1e5e1f);}};_0x451cc6['DTORd'](logDebug,_0x451cc6[_0x11ad67(0x1c9)],_0xff81d7),_0x4dff89?_0xe14f74[_0x11ad67(0x1e0)](_0x4dff89,_0x38be02)[_0x11ad67(0x1e6)](()=>{_0x404a5e['rDCSc'](_0x12b0e0,_0x38be02);})['catch'](_0x309c4e):_0xe14f74[_0x11ad67(0x1de)](_0x38be02,defaultVideoThumb)[_0x11ad67(0x1e6)](()=>{const _0x764fb9=_0x11ad67;_0x451cc6[_0x764fb9(0x1f3)](_0x12b0e0,_0x38be02);})['catch'](_0x309c4e);})[_0x26719a(0x1e8)]({'timestamps':[0x0],'filename':_0x21b50b,'folder':_0x4a954e,'size':_0x1e953e[_0x26719a(0x1c8)](_0x42068f[_0x26719a(0x1b3)],'x')+_0x42068f[_0x26719a(0x1ae)]})['on'](_0x26719a(0x1ac),()=>{_0x12b0e0(_0x38be02);});}),_0x13abdd=new Map(),_0x30b94b=await _0x34060d,_0x5868e1=(await _0xe14f74[_0x5a6786(0x1b6)](_0x30b94b))[_0x5a6786(0x1ca)];_0x13abdd[_0x5a6786(0x1ef)](0x0,_0x30b94b);const _0x5482e9=await calculateFileMD5(_0x30b94b),_0xfec8e3={'elementType':ElementType[_0x5a6786(0x1a1)],'elementId':'','videoElement':{'fileName':_0x148ec8||_0x37ad0a,'filePath':_0x5095bf,'videoMd5':_0x1c3f25,'thumbMd5':_0x5482e9,'fileTime':_0x42068f[_0x5a6786(0x1d6)],'thumbPath':_0x13abdd,'thumbSize':_0x5868e1,'thumbWidth':_0x42068f[_0x5a6786(0x1b3)],'thumbHeight':_0x42068f[_0x5a6786(0x1ae)],'fileSize':_0x1e953e['vkdRY']('',_0x251d0d)}};return _0xfec8e3;}static async[_0x575111(0x1b7)](_0x3cb233){const _0x1ebaee=_0x575111,_0x567474={'HvIMD':function(_0x1a2e64,_0x43db38){return _0x1a2e64(_0x43db38);},'okZXL':function(_0x20a62e,_0x5261a4){return _0x20a62e===_0x5261a4;},'VEGPz':_0x1ebaee(0x1da),'mRcGt':function(_0xb488f8,_0x450b24){return _0xb488f8||_0x450b24;}},{converted:_0x7f0c3,path:_0x5563a0,duration:_0x92356}=await _0x567474['HvIMD'](encodeSilk,_0x3cb233);if(!_0x5563a0)throw _0x1ebaee(0x1e2);const {md5:_0x2b72c4,fileName:_0x52c119,path:_0x256a54,fileSize:_0x1e0499}=await NTQQFileApi[_0x1ebaee(0x1a6)](_0x5563a0,ElementType[_0x1ebaee(0x1c2)]);if(_0x567474['okZXL'](_0x1e0499,0x0))throw _0x567474[_0x1ebaee(0x1c6)];return _0x7f0c3&&_0xe14f74[_0x1ebaee(0x1aa)](_0x5563a0)[_0x1ebaee(0x1e6)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x52c119,'filePath':_0x256a54,'md5HexStr':_0x2b72c4,'fileSize':_0x1e0499,'duration':_0x567474['mRcGt'](_0x92356,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x575111(0x1a3)](_0x87b049){const _0x1d10ab=_0x575111,_0x59e4bf={'cRwCH':function(_0x444536,_0x2b9b55){return _0x444536(_0x2b9b55);},'nXVKL':function(_0x1cdd74,_0x5596ae){return _0x1cdd74>=_0x5596ae;}},_0x23f59f=_0x49e995[_0x1d10ab(0x1d3)],_0x518213=_0x49e995['emoji'],_0xbb703e=_0x23f59f[_0x1d10ab(0x1eb)](_0x696ecb=>_0x696ecb['QSid']===_0x87b049[_0x1d10ab(0x1e5)]());_0x87b049=_0x59e4bf[_0x1d10ab(0x1d1)](parseInt,_0x87b049[_0x1d10ab(0x1e5)]());let _0x29e79f=0x1;return _0x59e4bf[_0x1d10ab(0x1a2)](_0x87b049,0xde)&&(_0x29e79f=0x2),_0xbb703e[_0x1d10ab(0x1b5)]&&(_0x29e79f=0x3),{'elementType':ElementType[_0x1d10ab(0x1d2)],'elementId':'','faceElement':{'faceIndex':_0x87b049,'faceType':_0x29e79f,'faceText':_0xbb703e[_0x1d10ab(0x1ba)],'stickerId':_0xbb703e[_0x1d10ab(0x1af)],'stickerType':_0xbb703e[_0x1d10ab(0x1b5)],'packId':_0xbb703e[_0x1d10ab(0x1a5)],'sourceType':0x1}};}static[_0x575111(0x1ce)](_0x1e5196,_0x582eb2,_0x2f60fc,_0x90e801){const _0x175c55=_0x575111,_0x4ccdd3={'kDreL':_0x175c55(0x1b9)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x1e5196,'emojiId':_0x582eb2,'key':_0x2f60fc,'faceName':_0x90e801||mFaceCache[_0x175c55(0x1d0)](_0x582eb2)||_0x4ccdd3['kDreL']}};}static[_0x575111(0x1be)](_0x1c0300){const _0x267902=_0x575111,_0x4f87ae={'xltTQ':_0x267902(0x1b1)};return{'elementType':ElementType[_0x267902(0x1d2)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':_0x4f87ae['xltTQ'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x575111(0x1ad)](_0x13776e){const _0x23491a=_0x575111,_0x3d35f1={'FPGqb':_0x23491a(0x1ed)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x3d35f1[_0x23491a(0x1c7)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x575111(0x1e1)](_0x16d3a2){const _0x3b3ccf=_0x575111,_0x1865a6={'jOqWQ':function(_0x5e3faa,_0x35a695){return _0x5e3faa!==_0x35a695;},'tUazA':_0x3b3ccf(0x1ab)};return _0x1865a6['jOqWQ'](typeof _0x16d3a2,_0x1865a6['tUazA'])&&(_0x16d3a2=JSON[_0x3b3ccf(0x1bf)](_0x16d3a2)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x16d3a2,'linkInfo':null,'subElementType':null}};}static[_0x575111(0x1bd)](_0x4604cc){const _0x491fe8=_0x575111;return{'elementType':ElementType[_0x491fe8(0x1e9)],'elementId':'','markdownElement':{'content':_0x4604cc}};}}