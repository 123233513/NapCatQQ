const _0x1c9102=_0x3ec8;(function(_0x5c59f1,_0x5cf118){const _0x486894=_0x3ec8,_0x536e94=_0x5c59f1();while(!![]){try{const _0x3082c2=parseInt(_0x486894(0x1fa))/0x1+parseInt(_0x486894(0x200))/0x2*(-parseInt(_0x486894(0x21b))/0x3)+-parseInt(_0x486894(0x1ea))/0x4+parseInt(_0x486894(0x1d6))/0x5+parseInt(_0x486894(0x202))/0x6+parseInt(_0x486894(0x206))/0x7*(-parseInt(_0x486894(0x1e4))/0x8)+parseInt(_0x486894(0x20e))/0x9;if(_0x3082c2===_0x5cf118)break;else _0x536e94['push'](_0x536e94['shift']());}catch(_0x50c04a){_0x536e94['push'](_0x536e94['shift']());}}}(_0x12e4,0xbf11c));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x1e44a5}from'node:fs';import _0xc13242 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';function _0x3ec8(_0x5e526f,_0x3c9358){const _0x12e402=_0x12e4();return _0x3ec8=function(_0x3ec825,_0x258e52){_0x3ec825=_0x3ec825-0x1d4;let _0x3fe486=_0x12e402[_0x3ec825];return _0x3fe486;},_0x3ec8(_0x5e526f,_0x3c9358);}function _0x12e4(){const _0x3da23e=['stat','UzLEM','1776icXnVh','EnYUn','RPS','KVtGM','视频信息','normal','text','GRDgr','PIC','sep','copyFile','ark','69295ahWoPa','EJLJM','获取视频封面失败，使用默认封面','normal2','rtAWJ','jpg','lLSTQ','获取视频信息失败','hzVTN','wbsdb','uPLYX','VIDEO','replace','screenshots','21968MXTrIU','face','TEXT','pGvSd','[包剪锤]','REPLY','5782004mBqEiG','kFdmT','FACE','toString','catch','width','FILE','MWHxv','ypaGK','stringify','ptt','FOGfE','join','height','图片信息','GYjkC','96244TYZJju','dice','unlink','gif','path','fDcAi','2060QXDQsd','wkOVJ','6645864CMVYkG','uploadFile','writeFile','[骰子]','2513ZVCaUd','Thumb','FwxcX','set','reply','PTT','then','markdown','23453532QUbNxp','文件异常，大小为0','getImageSize','ARK','NObFO','AsUbA','MARKDOWN','notAt','jdMqk','pdfbW','语音转换失败,\x20请检查语音文件是否正常'];_0x12e4=function(){return _0x3da23e;};return _0x12e4();}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static[_0x1c9102(0x221)](_0x1a5ca9){const _0x41d4a4=_0x1c9102;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x1a5ca9,'atType':AtType[_0x41d4a4(0x215)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x19ad72,_0x38d7ee,_0x52b830,_0x3a9016){const _0x36efa6=_0x1c9102;return{'elementType':ElementType[_0x36efa6(0x1e6)],'elementId':'','textElement':{'content':'@'+_0x3a9016,'atType':_0x52b830,'atUid':_0x19ad72,'atTinyId':'','atNtUid':_0x38d7ee}};}static[_0x1c9102(0x20a)](_0x13744b,_0x51ceaa,_0xde672,_0x4d6188){const _0x29ec9d=_0x1c9102;return{'elementType':ElementType[_0x29ec9d(0x1e9)],'elementId':'','replyElement':{'replayMsgSeq':_0x13744b,'replayMsgId':_0x51ceaa,'senderUin':_0xde672,'senderUinStr':_0x4d6188}};}static async['pic'](_0x5ec640,_0x58353d='',_0x4c6588=0x0){const _0x536bf6=_0x1c9102,_0x4fbe23={'wkOVJ':function(_0x267e86,_0x31ee2c){return _0x267e86===_0x31ee2c;},'GRDgr':_0x536bf6(0x20f),'FOGfE':function(_0x578f74,_0x35152b){return _0x578f74(_0x35152b);},'dRvho':_0x536bf6(0x1f8)},{md5:_0x1c5447,fileName:_0x49442e,path:_0x5411f0,fileSize:_0x5686b7}=await NTQQFileApi[_0x536bf6(0x203)](_0x5ec640,ElementType['PIC'],_0x4c6588);if(_0x4fbe23[_0x536bf6(0x201)](_0x5686b7,0x0))throw _0x4fbe23[_0x536bf6(0x222)];const _0x4e8dfb=await NTQQFileApi[_0x536bf6(0x210)](_0x5ec640),_0x98fec7={'md5HexStr':_0x1c5447,'fileSize':_0x5686b7['toString'](),'picWidth':_0x4e8dfb?.[_0x536bf6(0x1ef)],'picHeight':_0x4e8dfb?.[_0x536bf6(0x1f7)],'fileName':_0x49442e,'sourcePath':_0x5411f0,'original':!![],'picType':_0x4fbe23[_0x536bf6(0x1f5)](isGIF,_0x5ec640)?PicType[_0x536bf6(0x1fd)]:PicType[_0x536bf6(0x1db)],'picSubType':_0x4c6588,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x58353d};return logDebug(_0x4fbe23['dRvho'],_0x98fec7),{'elementType':ElementType[_0x536bf6(0x223)],'elementId':'','picElement':_0x98fec7};}static async['file'](_0xd2db22,_0x288e75=''){const _0x5b563f=_0x1c9102,_0x2e59ec={'hzVTN':function(_0x5ae302,_0x45496f){return _0x5ae302===_0x45496f;},'NObFO':_0x5b563f(0x20f),'wbsdb':function(_0xc683c3,_0x21ec10){return _0xc683c3||_0x21ec10;}},{md5:_0x8eab5b,fileName:_0x2a2904,path:_0x1d1f73,fileSize:_0x2110dc}=await NTQQFileApi[_0x5b563f(0x203)](_0xd2db22,ElementType[_0x5b563f(0x1f0)]);if(_0x2e59ec[_0x5b563f(0x1de)](_0x2110dc,0x0))throw _0x2e59ec[_0x5b563f(0x212)];const _0x5e3014={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x2e59ec[_0x5b563f(0x1df)](_0x288e75,_0x2a2904),'filePath':_0x1d1f73,'fileSize':_0x2110dc[_0x5b563f(0x1ed)]()}};return _0x5e3014;}static async['video'](_0xe1c204,_0x226ab8='',_0x28dae6=''){const _0x2e037c=_0x1c9102,_0x4dc4fa={'EnYUn':function(_0x205af0,_0x18648e){return _0x205af0(_0x18648e);},'QpoYy':function(_0x85c19d,_0x4b8ef4,_0x5c924a){return _0x85c19d(_0x4b8ef4,_0x5c924a);},'XLXDo':_0x2e037c(0x1d8),'fDcAi':'end','ypaGK':function(_0x4471f0,_0x2a5230){return _0x4471f0+_0x2a5230;},'FwxcX':function(_0x4c3a22,_0x16c6de){return _0x4c3a22===_0x16c6de;},'GYjkC':function(_0x1db8c1,_0x22d56f){return _0x1db8c1(_0x22d56f);},'AsUbA':'mp4','kFdmT':function(_0x2e3d4b,_0x23fcdc,_0x283f2a){return _0x2e3d4b(_0x23fcdc,_0x283f2a);},'jdMqk':_0x2e037c(0x21f),'pdfbW':function(_0xcad02f,_0x21fa98,_0x572721){return _0xcad02f(_0x21fa98,_0x572721);},'BLHgN':function(_0x597d63,_0x2d7bdf){return _0x597d63||_0x2d7bdf;},'UzLEM':function(_0x54e814,_0x16331b){return _0x54e814+_0x16331b;}},{fileName:_0x538f02,path:_0x3f49a5,fileSize:_0x369b9c,md5:_0x44f0d1}=await NTQQFileApi[_0x2e037c(0x203)](_0xe1c204,ElementType[_0x2e037c(0x1e1)]);if(_0x4dc4fa[_0x2e037c(0x208)](_0x369b9c,0x0))throw'文件异常，大小为0';const _0x478a9b=_0x4dc4fa[_0x2e037c(0x1f9)](require,_0x2e037c(0x1fe));let _0x377e05=_0x3f49a5[_0x2e037c(0x1e2)](_0x478a9b[_0x2e037c(0x224)]+'Ori'+_0x478a9b[_0x2e037c(0x224)],_0x478a9b[_0x2e037c(0x224)]+_0x2e037c(0x207)+_0x478a9b[_0x2e037c(0x224)]);_0x377e05=_0x478a9b['dirname'](_0x377e05);let _0x2cd5dd={'width':0x780,'height':0x438,'time':0xf,'format':_0x4dc4fa[_0x2e037c(0x213)],'size':_0x369b9c,'filePath':_0xe1c204};try{_0x2cd5dd=await _0x4dc4fa[_0x2e037c(0x1f9)](getVideoInfo,_0x3f49a5),_0x4dc4fa[_0x2e037c(0x1eb)](logDebug,_0x4dc4fa[_0x2e037c(0x216)],_0x2cd5dd);}catch(_0x4bd73f){_0x4dc4fa[_0x2e037c(0x217)](logError,_0x2e037c(0x1dd),_0x4bd73f);}const _0x177e82=new Promise((_0x1a3f50,_0x22addd)=>{const _0x401c3d=_0x2e037c,_0x14a5dd={'XknuP':function(_0x33d492,_0x414967){const _0x1fde8a=_0x3ec8;return _0x4dc4fa[_0x1fde8a(0x21c)](_0x33d492,_0x414967);},'pAfrn':function(_0x528fb1,_0x112bf7,_0xcc8960){return _0x4dc4fa['QpoYy'](_0x528fb1,_0x112bf7,_0xcc8960);},'uPLYX':_0x4dc4fa['XLXDo']},_0x2ff755=_0x44f0d1+'_0.png',_0x1b2224=_0x478a9b[_0x401c3d(0x1f6)](_0x377e05,_0x2ff755);_0x4dc4fa[_0x401c3d(0x21c)](_0xc13242,_0xe1c204)['on'](_0x4dc4fa[_0x401c3d(0x1ff)],()=>{})['on']('error',_0x3cb5f0=>{const _0x317e55=_0x401c3d,_0x919f60={'rtAWJ':function(_0x303681,_0x2df939){return _0x14a5dd['XknuP'](_0x303681,_0x2df939);}};_0x14a5dd['pAfrn'](logDebug,_0x14a5dd[_0x317e55(0x1e0)],_0x3cb5f0),_0x28dae6?_0x1e44a5[_0x317e55(0x1d4)](_0x28dae6,_0x1b2224)['then'](()=>{const _0x5080ef=_0x317e55;_0x919f60[_0x5080ef(0x1da)](_0x1a3f50,_0x1b2224);})['catch'](_0x22addd):_0x1e44a5[_0x317e55(0x204)](_0x1b2224,defaultVideoThumb)[_0x317e55(0x20c)](()=>{_0x1a3f50(_0x1b2224);})[_0x317e55(0x1ee)](_0x22addd);})[_0x401c3d(0x1e3)]({'timestamps':[0x0],'filename':_0x2ff755,'folder':_0x377e05,'size':_0x4dc4fa[_0x401c3d(0x1f2)](_0x4dc4fa[_0x401c3d(0x1f2)](_0x2cd5dd[_0x401c3d(0x1ef)],'x'),_0x2cd5dd['height'])})['on'](_0x4dc4fa[_0x401c3d(0x1ff)],()=>{const _0x138c58=_0x401c3d;_0x4dc4fa[_0x138c58(0x21c)](_0x1a3f50,_0x1b2224);});}),_0x37fecf=new Map(),_0x3a8a54=await _0x177e82,_0xf1489e=(await _0x1e44a5[_0x2e037c(0x219)](_0x3a8a54))['size'];_0x37fecf[_0x2e037c(0x209)](0x0,_0x3a8a54);const _0x8d0bb4=await _0x4dc4fa[_0x2e037c(0x21c)](calculateFileMD5,_0x3a8a54),_0x4144c4={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x4dc4fa['BLHgN'](_0x226ab8,_0x538f02),'filePath':_0x3f49a5,'videoMd5':_0x44f0d1,'thumbMd5':_0x8d0bb4,'fileTime':_0x2cd5dd['time'],'thumbPath':_0x37fecf,'thumbSize':_0xf1489e,'thumbWidth':_0x2cd5dd[_0x2e037c(0x1ef)],'thumbHeight':_0x2cd5dd['height'],'fileSize':_0x4dc4fa[_0x2e037c(0x21a)]('',_0x369b9c)}};return _0x4144c4;}static async[_0x1c9102(0x1f4)](_0x300822){const _0x607b9c=_0x1c9102,_0x348330={'UOfQV':function(_0x2a6a93,_0x241af8){return _0x2a6a93(_0x241af8);},'GnZkz':_0x607b9c(0x218),'MWHxv':_0x607b9c(0x20f),'EJLJM':function(_0x2f780d,_0xba1633){return _0x2f780d||_0xba1633;}},{converted:_0x29243a,path:_0x29ba32,duration:_0x4388b2}=await _0x348330['UOfQV'](encodeSilk,_0x300822);if(!_0x29ba32)throw _0x348330['GnZkz'];const {md5:_0x397816,fileName:_0x4822f1,path:_0xf07d57,fileSize:_0x18a545}=await NTQQFileApi[_0x607b9c(0x203)](_0x29ba32,ElementType['PTT']);if(_0x18a545===0x0)throw _0x348330[_0x607b9c(0x1f1)];return _0x29243a&&_0x1e44a5[_0x607b9c(0x1fc)](_0x29ba32)[_0x607b9c(0x20c)](),{'elementType':ElementType[_0x607b9c(0x20b)],'elementId':'','pttElement':{'fileName':_0x4822f1,'filePath':_0xf07d57,'md5HexStr':_0x397816,'fileSize':_0x18a545,'duration':_0x348330[_0x607b9c(0x1d7)](_0x4388b2,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x1c9102(0x1e5)](_0xea2b0e){const _0x561cf1=_0x1c9102,_0x3740c1={'lLSTQ':function(_0x383de1,_0x28a63c){return _0x383de1<_0x28a63c;}};return{'elementType':ElementType[_0x561cf1(0x1ec)],'elementId':'','faceElement':{'faceIndex':_0xea2b0e,'faceType':_0x3740c1[_0x561cf1(0x1dc)](_0xea2b0e,0xde)?FaceType[_0x561cf1(0x220)]:FaceType[_0x561cf1(0x1d9)]}};}static[_0x1c9102(0x1fb)](_0x3cd1c7){const _0xbd4544=_0x1c9102;return{'elementType':ElementType[_0xbd4544(0x1ec)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0xbd4544(0x1fb)],'faceType':FaceType['dice'],'faceText':_0xbd4544(0x205),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x4ffcd7){const _0x450786=_0x1c9102;return{'elementType':ElementType[_0x450786(0x1ec)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x450786(0x21d)],'faceText':_0x450786(0x1e8),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x1c9102(0x1d5)](_0x285b50){const _0x19832d=_0x1c9102,_0x517a2e={'KVtGM':function(_0x54ef7f,_0x45ea28){return _0x54ef7f!==_0x45ea28;},'pGvSd':'string'};return _0x517a2e[_0x19832d(0x21e)](typeof _0x285b50,_0x517a2e[_0x19832d(0x1e7)])&&(_0x285b50=JSON[_0x19832d(0x1f3)](_0x285b50)),{'elementType':ElementType[_0x19832d(0x211)],'elementId':'','arkElement':{'bytesData':_0x285b50,'linkInfo':null,'subElementType':null}};}static[_0x1c9102(0x20d)](_0x4566b8){const _0x3ab7a1=_0x1c9102;return{'elementType':ElementType[_0x3ab7a1(0x214)],'elementId':'','markdownElement':{'content':_0x4566b8}};}}