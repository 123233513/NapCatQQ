function _0x2f69(){const _0x4ae1d6=['2507595JtyZGS','JyrRQ','end','Ori','5iwjWeR','UhTsV','pic','6545756QLDeUa','mp4','文件异常，大小为0','unlink','copyFile','ARK','getImageSize','sysface','MARKDOWN','HlLcw','获取视频信息失败','3590400pMVKOz','FACE','THIKs','stringify','dice','text','TEXT','miniapp','markdown','1735919CUzjfK','AniStickerType','get','qFmaV','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','[商城表情]','LZvcZ','Bot\x20Test','QDes','LGnTB','Thumb','PIC','reply','join','set','7047425kOjrln','catch','QSid','xvrMU','https://www.bilibili.com/','PTT','18631728KKkDVQ','dbJOF','width','gif','rps','FILE','dirname','FalVx','RPS','LcikQ','ipOXo','error','sep','string','IEoKs','toString','RRdDG','uploadFile','EYgvR','writeFile','VIDEO','emoji','HpbSh','xxpyY','then','screenshots','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','height','2MieJKy','2484104bbYdKc','notAt','pzZnB','QVSKP','mface','time','tbUnl'];_0x2f69=function(){return _0x4ae1d6;};return _0x2f69();}const _0x19cf61=_0x573d;function _0x573d(_0x3793c9,_0x1ebe6e){const _0x2f69de=_0x2f69();return _0x573d=function(_0x573d70,_0x14d6f1){_0x573d70=_0x573d70-0x102;let _0x91f48e=_0x2f69de[_0x573d70];return _0x91f48e;},_0x573d(_0x3793c9,_0x1ebe6e);}(function(_0x21bf80,_0x360777){const _0x2446f9=_0x573d,_0x2f7226=_0x21bf80();while(!![]){try{const _0x57239e=parseInt(_0x2446f9(0x124))/0x1*(-parseInt(_0x2446f9(0x155))/0x2)+parseInt(_0x2446f9(0x109))/0x3+-parseInt(_0x2446f9(0x110))/0x4*(-parseInt(_0x2446f9(0x10d))/0x5)+-parseInt(_0x2446f9(0x11b))/0x6+-parseInt(_0x2446f9(0x133))/0x7+-parseInt(_0x2446f9(0x102))/0x8+parseInt(_0x2446f9(0x139))/0x9;if(_0x57239e===_0x360777)break;else _0x2f7226['push'](_0x2f7226['shift']());}catch(_0x45eceb){_0x2f7226['push'](_0x2f7226['shift']());}}}(_0x2f69,0xd9809));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x48c8e9}from'node:fs';import _0x4dc900 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x14eb8a from'./face_config.json';import*as _0xd4a029 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x19cf61(0x120)](_0x365fda){const _0x12890e=_0x19cf61;return{'elementType':ElementType[_0x12890e(0x121)],'elementId':'','textElement':{'content':_0x365fda,'atType':AtType[_0x12890e(0x103)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x2e8edc,_0x30d349,_0x2b2b45,_0x5e6a46){const _0x17cb7e=_0x19cf61;return{'elementType':ElementType[_0x17cb7e(0x121)],'elementId':'','textElement':{'content':'@'+_0x5e6a46,'atType':_0x2b2b45,'atUid':_0x2e8edc,'atTinyId':'','atNtUid':_0x30d349}};}static[_0x19cf61(0x130)](_0x65c3a,_0x2b69b7,_0x1c4840,_0x4a1e0a){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x65c3a,'replayMsgId':_0x2b69b7,'senderUin':_0x1c4840,'senderUinStr':_0x4a1e0a}};}static async[_0x19cf61(0x10f)](_0x443911,_0x4e8ce2='',_0x1dc23e=0x0){const _0x5966f2=_0x19cf61,_0x38e9ee={'LcikQ':_0x5966f2(0x112),'RRdDG':function(_0x5cb3d9,_0x3e3c81){return _0x5cb3d9(_0x3e3c81);}},{md5:_0x10e25d,fileName:_0x143e9d,path:_0x15eede,fileSize:_0x8c0a93}=await NTQQFileApi[_0x5966f2(0x14a)](_0x443911,ElementType[_0x5966f2(0x12f)],_0x1dc23e);if(_0x8c0a93===0x0)throw _0x38e9ee[_0x5966f2(0x142)];const _0x2d4f11=await NTQQFileApi[_0x5966f2(0x116)](_0x443911),_0x5e5acb={'md5HexStr':_0x10e25d,'fileSize':_0x8c0a93[_0x5966f2(0x148)](),'picWidth':_0x2d4f11?.[_0x5966f2(0x13b)],'picHeight':_0x2d4f11?.[_0x5966f2(0x154)],'fileName':_0x143e9d,'sourcePath':_0x15eede,'original':!![],'picType':_0x38e9ee[_0x5966f2(0x149)](isGIF,_0x443911)?PicType[_0x5966f2(0x13c)]:PicType['jpg'],'picSubType':_0x1dc23e,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x4e8ce2};return{'elementType':ElementType[_0x5966f2(0x12f)],'elementId':'','picElement':_0x5e5acb};}static async['file'](_0x16ee2c,_0x23c041='',_0x1d6785=''){const _0x5477af=_0x19cf61,_0x51c2be={'zRsnn':function(_0x214395,_0x537aa9){return _0x214395===_0x537aa9;},'QVSKP':function(_0x4086eb,_0x3aac63){return _0x4086eb||_0x3aac63;}},{md5:_0x15e203,fileName:_0x4a6c71,path:_0x3e6549,fileSize:_0x156da0}=await NTQQFileApi[_0x5477af(0x14a)](_0x16ee2c,ElementType[_0x5477af(0x13e)]);if(_0x51c2be['zRsnn'](_0x156da0,0x0))throw _0x5477af(0x112);const _0x45ae3e={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x51c2be[_0x5477af(0x105)](_0x23c041,_0x4a6c71),'folderId':_0x1d6785,'filePath':_0x3e6549,'fileSize':_0x156da0[_0x5477af(0x148)]()}};return _0x45ae3e;}static async['video'](_0x4b423c,_0x5b504a='',_0x12bd4e=''){const _0x3b7355=_0x19cf61,_0xad7688={'xxpyY':function(_0xecc1b8,_0x4a3212,_0x2dd755){return _0xecc1b8(_0x4a3212,_0x2dd755);},'pzZnB':'获取视频封面失败，使用默认封面','NAdzB':function(_0x5cb99d,_0x2532a3){return _0x5cb99d(_0x2532a3);},'THIKs':_0x3b7355(0x10b),'CGvjT':_0x3b7355(0x144),'UhTsV':function(_0x3bd167,_0x2227a6){return _0x3bd167+_0x2227a6;},'HlLcw':function(_0x1f315c,_0xfd4bca){return _0x1f315c===_0xfd4bca;},'xvrMU':_0x3b7355(0x11a),'qFmaV':function(_0x23aebf,_0x5672d2){return _0x23aebf||_0x5672d2;}},{fileName:_0x54c66a,path:_0x1dc99b,fileSize:_0x3d281e,md5:_0x26d876}=await NTQQFileApi[_0x3b7355(0x14a)](_0x4b423c,ElementType[_0x3b7355(0x14d)]);if(_0xad7688[_0x3b7355(0x119)](_0x3d281e,0x0))throw _0x3b7355(0x112);let _0x52ca7c=_0x1dc99b['replace'](_0xd4a029[_0x3b7355(0x145)]+_0x3b7355(0x10c)+_0xd4a029[_0x3b7355(0x145)],_0xd4a029[_0x3b7355(0x145)]+_0x3b7355(0x12e)+_0xd4a029[_0x3b7355(0x145)]);_0x52ca7c=_0xd4a029[_0x3b7355(0x13f)](_0x52ca7c);let _0x4066f0={'width':0x780,'height':0x438,'time':0xf,'format':_0x3b7355(0x111),'size':_0x3d281e,'filePath':_0x4b423c};try{_0x4066f0=await _0xad7688['NAdzB'](getVideoInfo,_0x1dc99b);}catch(_0x464f61){_0xad7688[_0x3b7355(0x150)](logError,_0xad7688[_0x3b7355(0x136)],_0x464f61);}const _0x4e0559=new Promise((_0x1078ca,_0x9943d6)=>{const _0x1d09e8=_0x3b7355,_0x4d090f={'EYgvR':function(_0x1a653e,_0xa884e5){return _0x1a653e(_0xa884e5);}},_0x3696e3=_0x26d876+'_0.png',_0x37d319=_0xd4a029[_0x1d09e8(0x131)](_0x52ca7c,_0x3696e3);_0xad7688['NAdzB'](_0x4dc900,_0x4b423c)['on'](_0xad7688['THIKs'],()=>{})['on'](_0xad7688['CGvjT'],_0x57fcf8=>{const _0x3d60bf=_0x1d09e8,_0xac2f8a={'IEoKs':function(_0x1a3db9,_0x2630c3){return _0x1a3db9(_0x2630c3);}};_0xad7688[_0x3d60bf(0x150)](logDebug,_0xad7688[_0x3d60bf(0x104)],_0x57fcf8),_0x12bd4e?_0x48c8e9[_0x3d60bf(0x114)](_0x12bd4e,_0x37d319)[_0x3d60bf(0x151)](()=>{const _0x3b2c7e=_0x3d60bf;_0xac2f8a[_0x3b2c7e(0x147)](_0x1078ca,_0x37d319);})[_0x3d60bf(0x134)](_0x9943d6):_0x48c8e9[_0x3d60bf(0x14c)](_0x37d319,defaultVideoThumb)[_0x3d60bf(0x151)](()=>{const _0x801dc6=_0x3d60bf;_0x4d090f[_0x801dc6(0x14b)](_0x1078ca,_0x37d319);})[_0x3d60bf(0x134)](_0x9943d6);})[_0x1d09e8(0x152)]({'timestamps':[0x0],'filename':_0x3696e3,'folder':_0x52ca7c,'size':_0xad7688[_0x1d09e8(0x10e)](_0x4066f0[_0x1d09e8(0x13b)]+'x',_0x4066f0[_0x1d09e8(0x154)])})['on'](_0xad7688[_0x1d09e8(0x11d)],()=>{_0x1078ca(_0x37d319);});}),_0x2b15ee=new Map(),_0x5cdd55=await _0x4e0559,_0x17dcc6=(await _0x48c8e9['stat'](_0x5cdd55))['size'];_0x2b15ee[_0x3b7355(0x132)](0x0,_0x5cdd55);const _0x145c71=await calculateFileMD5(_0x5cdd55),_0x54a6c9={'elementType':ElementType[_0x3b7355(0x14d)],'elementId':'','videoElement':{'fileName':_0xad7688[_0x3b7355(0x127)](_0x5b504a,_0x54c66a),'filePath':_0x1dc99b,'videoMd5':_0x26d876,'thumbMd5':_0x145c71,'fileTime':_0x4066f0[_0x3b7355(0x107)],'thumbPath':_0x2b15ee,'thumbSize':_0x17dcc6,'thumbWidth':_0x4066f0[_0x3b7355(0x13b)],'thumbHeight':_0x4066f0[_0x3b7355(0x154)],'fileSize':''+_0x3d281e}};return _0x54a6c9;}static async['ptt'](_0x4feb98){const _0x47596d=_0x19cf61,_0x13e150={'LZvcZ':function(_0x454dca,_0xd0585d){return _0x454dca(_0xd0585d);},'FalVx':function(_0x37ecd7,_0x1e1968){return _0x37ecd7===_0x1e1968;}},{converted:_0x17809c,path:_0x236013,duration:_0x56f005}=await _0x13e150[_0x47596d(0x12a)](encodeSilk,_0x4feb98);if(!_0x236013)throw'语音转换失败,\x20请检查语音文件是否正常';const {md5:_0x2ca1a1,fileName:_0x4c4202,path:_0x5a701b,fileSize:_0x39a997}=await NTQQFileApi[_0x47596d(0x14a)](_0x236013,ElementType[_0x47596d(0x138)]);if(_0x13e150[_0x47596d(0x140)](_0x39a997,0x0))throw'文件异常，大小为0';return _0x17809c&&_0x48c8e9[_0x47596d(0x113)](_0x236013)[_0x47596d(0x151)](),{'elementType':ElementType[_0x47596d(0x138)],'elementId':'','pttElement':{'fileName':_0x4c4202,'filePath':_0x5a701b,'md5HexStr':_0x2ca1a1,'fileSize':_0x39a997,'duration':_0x56f005||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x2d0a57){const _0x2d02ec=_0x19cf61,_0x32b336={'ipOXo':function(_0x5e7a8b,_0x1b8bec){return _0x5e7a8b(_0x1b8bec);},'dbJOF':function(_0x294820,_0x299128){return _0x294820>=_0x299128;}},_0x1106f6=_0x14eb8a[_0x2d02ec(0x117)],_0x245a67=_0x14eb8a[_0x2d02ec(0x14e)],_0x528f20=_0x1106f6['find'](_0x1d8206=>_0x1d8206[_0x2d02ec(0x135)]===_0x2d0a57[_0x2d02ec(0x148)]());_0x2d0a57=_0x32b336[_0x2d02ec(0x143)](parseInt,_0x2d0a57[_0x2d02ec(0x148)]());let _0x32c86c=0x1;return _0x32b336[_0x2d02ec(0x13a)](_0x2d0a57,0xde)&&(_0x32c86c=0x2),_0x528f20[_0x2d02ec(0x125)]&&(_0x32c86c=0x3),{'elementType':ElementType[_0x2d02ec(0x11c)],'elementId':'','faceElement':{'faceIndex':_0x2d0a57,'faceType':_0x32c86c,'faceText':_0x528f20[_0x2d02ec(0x12c)],'stickerId':_0x528f20['AniStickerId'],'stickerType':_0x528f20[_0x2d02ec(0x125)],'packId':_0x528f20['AniStickerPackId'],'sourceType':0x1}};}static[_0x19cf61(0x106)](_0x14095d,_0x29d6b2,_0x4dd8e7,_0x271134){const _0x9d3281=_0x19cf61,_0x34595d={'tbUnl':_0x9d3281(0x129)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x14095d,'emojiId':_0x29d6b2,'key':_0x4dd8e7,'faceName':_0x271134||mFaceCache[_0x9d3281(0x126)](_0x29d6b2)||_0x34595d[_0x9d3281(0x108)]}};}static[_0x19cf61(0x11f)](_0x5b296e){const _0x1914ef=_0x19cf61,_0x6d2ccf={'HpbSh':'[骰子]'};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x1914ef(0x11f)],'faceText':_0x6d2ccf[_0x1914ef(0x14f)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x19cf61(0x13d)](_0x4b15f4){const _0x42e444=_0x19cf61,_0x546eaa={'aGgeu':'[包剪锤]'};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x42e444(0x141)],'faceText':_0x546eaa['aGgeu'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x30c619){const _0x317afb=_0x19cf61,_0x30d1ad={'JyrRQ':_0x317afb(0x146)};return typeof _0x30c619!==_0x30d1ad[_0x317afb(0x10a)]&&(_0x30c619=JSON[_0x317afb(0x11e)](_0x30c619)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x30c619,'linkInfo':null,'subElementType':null}};}static[_0x19cf61(0x123)](_0x29610b){const _0x197401=_0x19cf61;return{'elementType':ElementType[_0x197401(0x118)],'elementId':'','markdownElement':{'content':_0x29610b}};}static async[_0x19cf61(0x122)](){const _0x106b31=_0x19cf61,_0x38f995={'LGnTB':_0x106b31(0x12b),'DLDVC':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0xc3e83e=await SignMiniApp({'prompt':_0x38f995[_0x106b31(0x12d)],'title':_0x38f995[_0x106b31(0x12d)],'preview':_0x106b31(0x153),'jumpUrl':_0x106b31(0x137),'tag':_0x38f995['LGnTB'],'tagIcon':_0x38f995['DLDVC'],'source':_0x106b31(0x12b),'sourcelogo':_0x106b31(0x128)});return{'elementType':ElementType[_0x106b31(0x115)],'elementId':'','arkElement':{'bytesData':_0xc3e83e,'linkInfo':null,'subElementType':null}};}}