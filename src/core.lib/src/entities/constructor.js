const _0xb11d16=_0x640e;(function(_0x113280,_0x58a337){const _0x5631de=_0x640e,_0x288134=_0x113280();while(!![]){try{const _0x27fbce=parseInt(_0x5631de(0x1f7))/0x1*(parseInt(_0x5631de(0x1f0))/0x2)+parseInt(_0x5631de(0x1fe))/0x3*(parseInt(_0x5631de(0x1f1))/0x4)+parseInt(_0x5631de(0x1c7))/0x5*(-parseInt(_0x5631de(0x1ba))/0x6)+parseInt(_0x5631de(0x1e4))/0x7+-parseInt(_0x5631de(0x1e6))/0x8*(parseInt(_0x5631de(0x1dc))/0x9)+parseInt(_0x5631de(0x1b5))/0xa+parseInt(_0x5631de(0x1e5))/0xb;if(_0x27fbce===_0x58a337)break;else _0x288134['push'](_0x288134['shift']());}catch(_0x591691){_0x288134['push'](_0x288134['shift']());}}}(_0x5245,0x8fd40));function _0x5245(){const _0x5ad301=['PNAdv','MARKDOWN','stat','9Fzivnx','zQgpr','_0.png','AUadT','MFACE','video','eBnjZ','PuVYd','replace','cOIxk','LElhO','height','XPcGD','screenshots','pimel','1033700xUpcSA','BLtzc','unlink','ptt','size','18piXWlw','fdRqv','FACE','PMMYH','rQDRV','Thumb','jpg','stringify','文件异常，大小为0','PTT','TEXT','fQWzu','przxm','1209515NKULRI','VIDEO','toString','writeFile','REPLY','pic','width','reply','getImageSize','file','text','whjLW','Zekam','Ori','RPS','copyFile','dirname','XqYGo','gif','get','DAead','9AJtfDG','end','string','then','[商城表情]','face','BGAmf','rps','3934161RkKWbt','3602379gavydY','2528152zdwIrK','WSEqU','ARK','join','ark','FILE','mp4','uploadFile','PIC','UtwoX','10iMNFKc','177028LaeGYx','[包剪锤]','catch','markdown','UocmR','dice','101039JGxnUu','mface','sep','jTbJr'];_0x5245=function(){return _0x5ad301;};return _0x5245();}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';function _0x640e(_0x2486eb,_0x3d5190){const _0x524539=_0x5245();return _0x640e=function(_0x640e72,_0x30ac26){_0x640e72=_0x640e72-0x1ac;let _0xad0fa7=_0x524539[_0x640e72];return _0xad0fa7;},_0x640e(_0x2486eb,_0x3d5190);}import{promises as _0x4c6e13}from'node:fs';import _0x3f3ed5 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0xb11d16(0x1d1)](_0x54a4bf){const _0x542431=_0xb11d16;return{'elementType':ElementType[_0x542431(0x1c4)],'elementId':'','textElement':{'content':_0x54a4bf,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4ffcfc,_0x31f487,_0x2dfc9a,_0x2c5dd4){const _0x3b6c13=_0xb11d16;return{'elementType':ElementType[_0x3b6c13(0x1c4)],'elementId':'','textElement':{'content':'@'+_0x2c5dd4,'atType':_0x2dfc9a,'atUid':_0x4ffcfc,'atTinyId':'','atNtUid':_0x31f487}};}static[_0xb11d16(0x1ce)](_0x3fc200,_0x3b7c00,_0x5acb33,_0x4faae5){const _0x474737=_0xb11d16;return{'elementType':ElementType[_0x474737(0x1cb)],'elementId':'','replyElement':{'replayMsgSeq':_0x3fc200,'replayMsgId':_0x3b7c00,'senderUin':_0x5acb33,'senderUinStr':_0x4faae5}};}static async[_0xb11d16(0x1cc)](_0x1e0f1c,_0x53e994='',_0x4bbd5d=0x0){const _0x3f4036=_0xb11d16,_0x1eed64={'rfEJf':function(_0xc79344,_0x2f8fd7){return _0xc79344===_0x2f8fd7;},'AUadT':_0x3f4036(0x1c2),'WSEqU':function(_0x5740e6,_0x21bc77,_0x305c09){return _0x5740e6(_0x21bc77,_0x305c09);},'XPcGD':'图片信息'},{md5:_0x472516,fileName:_0x2442a0,path:_0x98a04e,fileSize:_0x5c6980}=await NTQQFileApi[_0x3f4036(0x1ed)](_0x1e0f1c,ElementType[_0x3f4036(0x1ee)],_0x4bbd5d);if(_0x1eed64['rfEJf'](_0x5c6980,0x0))throw _0x1eed64[_0x3f4036(0x201)];const _0x6219af=await NTQQFileApi[_0x3f4036(0x1cf)](_0x1e0f1c),_0x51614a={'md5HexStr':_0x472516,'fileSize':_0x5c6980[_0x3f4036(0x1c9)](),'picWidth':_0x6219af?.['width'],'picHeight':_0x6219af?.[_0x3f4036(0x1b1)],'fileName':_0x2442a0,'sourcePath':_0x98a04e,'original':!![],'picType':isGIF(_0x1e0f1c)?PicType[_0x3f4036(0x1d9)]:PicType[_0x3f4036(0x1c0)],'picSubType':_0x4bbd5d,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x53e994};return _0x1eed64[_0x3f4036(0x1e7)](logDebug,_0x1eed64[_0x3f4036(0x1b2)],_0x51614a),{'elementType':ElementType[_0x3f4036(0x1ee)],'elementId':'','picElement':_0x51614a};}static async[_0xb11d16(0x1d0)](_0x455b46,_0x5e7c97=''){const _0x53b889=_0xb11d16,_0x558ca9={'PMMYH':_0x53b889(0x1c2),'LElhO':function(_0x4d0278,_0x2646de){return _0x4d0278||_0x2646de;}},{md5:_0x5aa6de,fileName:_0x210c66,path:_0x74e18e,fileSize:_0x47483d}=await NTQQFileApi[_0x53b889(0x1ed)](_0x455b46,ElementType['FILE']);if(_0x47483d===0x0)throw _0x558ca9[_0x53b889(0x1bd)];const _0x5c4203={'elementType':ElementType[_0x53b889(0x1eb)],'elementId':'','fileElement':{'fileName':_0x558ca9[_0x53b889(0x1b0)](_0x5e7c97,_0x210c66),'filePath':_0x74e18e,'fileSize':_0x47483d[_0x53b889(0x1c9)]()}};return _0x5c4203;}static async[_0xb11d16(0x203)](_0x2f046d,_0x1bcbac='',_0x4ab8d9=''){const _0xf8a337=_0xb11d16,_0x9e9dd7={'UtwoX':function(_0x2bf161,_0x3b74c1,_0x181971){return _0x2bf161(_0x3b74c1,_0x181971);},'Zekam':'获取视频封面失败，使用默认封面','fQWzu':function(_0x3d08b6,_0x1f930e){return _0x3d08b6(_0x1f930e);},'PuVYd':_0xf8a337(0x1dd),'przxm':'error','kEMtR':function(_0x557625,_0x290881){return _0x557625+_0x290881;},'cOIxk':function(_0x21aa73,_0x228d4e){return _0x21aa73===_0x228d4e;},'whjLW':_0xf8a337(0x1c2),'pimel':function(_0x94aec2,_0x4b6a48){return _0x94aec2(_0x4b6a48);},'tloyw':'path','fdRqv':'视频信息','UocmR':function(_0xaf0aa8,_0x3fabac){return _0xaf0aa8(_0x3fabac);},'PFaeg':function(_0x1d78ec,_0x1dba65){return _0x1d78ec||_0x1dba65;}},{fileName:_0x5a1dc1,path:_0x1b9569,fileSize:_0x5a9a9a,md5:_0x282cd9}=await NTQQFileApi[_0xf8a337(0x1ed)](_0x2f046d,ElementType['VIDEO']);if(_0x9e9dd7[_0xf8a337(0x1af)](_0x5a9a9a,0x0))throw _0x9e9dd7[_0xf8a337(0x1d2)];const _0x48777e=_0x9e9dd7[_0xf8a337(0x1b4)](require,_0x9e9dd7['tloyw']);let _0x1cacfb=_0x1b9569[_0xf8a337(0x1ae)](_0x48777e[_0xf8a337(0x1f9)]+_0xf8a337(0x1d4)+_0x48777e['sep'],_0x48777e[_0xf8a337(0x1f9)]+_0xf8a337(0x1bf)+_0x48777e[_0xf8a337(0x1f9)]);_0x1cacfb=_0x48777e[_0xf8a337(0x1d7)](_0x1cacfb);let _0x403699={'width':0x780,'height':0x438,'time':0xf,'format':_0xf8a337(0x1ec),'size':_0x5a9a9a,'filePath':_0x2f046d};try{_0x403699=await _0x9e9dd7['fQWzu'](getVideoInfo,_0x1b9569),_0x9e9dd7[_0xf8a337(0x1ef)](logDebug,_0x9e9dd7[_0xf8a337(0x1bb)],_0x403699);}catch(_0x26b97f){_0x9e9dd7[_0xf8a337(0x1ef)](logError,'获取视频信息失败',_0x26b97f);}const _0x5179b2=new Promise((_0x214586,_0x5c2157)=>{const _0x4c089d=_0xf8a337,_0x187d6a={'XqYGo':function(_0x175414,_0x5535ca){const _0x2abb88=_0x640e;return _0x9e9dd7[_0x2abb88(0x1c5)](_0x175414,_0x5535ca);}},_0x9efc8b=_0x282cd9+_0x4c089d(0x200),_0x226d89=_0x48777e[_0x4c089d(0x1e9)](_0x1cacfb,_0x9efc8b);_0x3f3ed5(_0x2f046d)['on'](_0x9e9dd7[_0x4c089d(0x1ad)],()=>{})['on'](_0x9e9dd7[_0x4c089d(0x1c6)],_0x614dbc=>{const _0x39645d=_0x4c089d,_0x2d088d={'BGAmf':function(_0x5c4427,_0xe8209f){return _0x5c4427(_0xe8209f);}};_0x9e9dd7['UtwoX'](logDebug,_0x9e9dd7[_0x39645d(0x1d3)],_0x614dbc),_0x4ab8d9?_0x4c6e13[_0x39645d(0x1d6)](_0x4ab8d9,_0x226d89)['then'](()=>{const _0x291d35=_0x39645d;_0x2d088d[_0x291d35(0x1e2)](_0x214586,_0x226d89);})[_0x39645d(0x1f3)](_0x5c2157):_0x4c6e13[_0x39645d(0x1ca)](_0x226d89,defaultVideoThumb)[_0x39645d(0x1df)](()=>{const _0x3c7215=_0x39645d;_0x187d6a[_0x3c7215(0x1d8)](_0x214586,_0x226d89);})[_0x39645d(0x1f3)](_0x5c2157);})[_0x4c089d(0x1b3)]({'timestamps':[0x0],'filename':_0x9efc8b,'folder':_0x1cacfb,'size':_0x9e9dd7['kEMtR'](_0x403699['width']+'x',_0x403699['height'])})['on'](_0x9e9dd7['PuVYd'],()=>{_0x214586(_0x226d89);});}),_0x179130=new Map(),_0x435be0=await _0x5179b2,_0x2b8087=(await _0x4c6e13[_0xf8a337(0x1fd)](_0x435be0))[_0xf8a337(0x1b9)];_0x179130['set'](0x0,_0x435be0);const _0x15ac7c=await _0x9e9dd7[_0xf8a337(0x1f5)](calculateFileMD5,_0x435be0),_0x5aa8ac={'elementType':ElementType[_0xf8a337(0x1c8)],'elementId':'','videoElement':{'fileName':_0x9e9dd7['PFaeg'](_0x1bcbac,_0x5a1dc1),'filePath':_0x1b9569,'videoMd5':_0x282cd9,'thumbMd5':_0x15ac7c,'fileTime':_0x403699['time'],'thumbPath':_0x179130,'thumbSize':_0x2b8087,'thumbWidth':_0x403699[_0xf8a337(0x1cd)],'thumbHeight':_0x403699['height'],'fileSize':''+_0x5a9a9a}};return _0x5aa8ac;}static async[_0xb11d16(0x1b8)](_0xab35b7){const _0x49fa00=_0xb11d16,_0x338f5c={'DAead':function(_0x3173b1,_0x20df46){return _0x3173b1(_0x20df46);},'PNAdv':'语音转换失败,\x20请检查语音文件是否正常','zQgpr':function(_0x4e13d2,_0x5c2677){return _0x4e13d2===_0x5c2677;},'eBnjZ':function(_0x276483,_0x24934d){return _0x276483||_0x24934d;}},{converted:_0x3f6968,path:_0x469ca1,duration:_0x30224d}=await _0x338f5c[_0x49fa00(0x1db)](encodeSilk,_0xab35b7);if(!_0x469ca1)throw _0x338f5c[_0x49fa00(0x1fb)];const {md5:_0x277666,fileName:_0x216af2,path:_0x504548,fileSize:_0x238085}=await NTQQFileApi['uploadFile'](_0x469ca1,ElementType[_0x49fa00(0x1c3)]);if(_0x338f5c[_0x49fa00(0x1ff)](_0x238085,0x0))throw'文件异常，大小为0';return _0x3f6968&&_0x4c6e13[_0x49fa00(0x1b7)](_0x469ca1)[_0x49fa00(0x1df)](),{'elementType':ElementType[_0x49fa00(0x1c3)],'elementId':'','pttElement':{'fileName':_0x216af2,'filePath':_0x504548,'md5HexStr':_0x277666,'fileSize':_0x238085,'duration':_0x338f5c[_0x49fa00(0x1ac)](_0x30224d,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0xb11d16(0x1e1)](_0x55cc70){const _0x3061e8=_0xb11d16,_0x3bd1a2={'QJPle':function(_0x44827f,_0x425974){return _0x44827f<_0x425974;}};return{'elementType':ElementType[_0x3061e8(0x1bc)],'elementId':'','faceElement':{'faceIndex':_0x55cc70,'faceType':_0x3bd1a2['QJPle'](_0x55cc70,0xde)?FaceType['normal']:FaceType['normal2']}};}static[_0xb11d16(0x1f8)](_0x176bcb,_0xdc9f5e,_0x48451a,_0x49344b){const _0x2f1202=_0xb11d16,_0x663cdb={'smYXN':_0x2f1202(0x1e0)};return{'elementType':ElementType[_0x2f1202(0x202)],'marketFaceElement':{'emojiPackageId':_0x176bcb,'emojiId':_0xdc9f5e,'key':_0x48451a,'faceName':_0x49344b||mFaceCache[_0x2f1202(0x1da)](_0xdc9f5e)||_0x663cdb['smYXN']}};}static[_0xb11d16(0x1f6)](_0x44e2a3){const _0x1030ea=_0xb11d16,_0xde6f10={'ucnJu':'[骰子]'};return{'elementType':ElementType[_0x1030ea(0x1bc)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1030ea(0x1f6)],'faceType':FaceType['dice'],'faceText':_0xde6f10['ucnJu'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0xb11d16(0x1e3)](_0x1ab601){const _0xe1e6a4=_0xb11d16,_0x5183ff={'rQDRV':_0xe1e6a4(0x1f2)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0xe1e6a4(0x1d5)],'faceText':_0x5183ff[_0xe1e6a4(0x1be)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0xb11d16(0x1ea)](_0x26befb){const _0x3a9c57=_0xb11d16,_0xa75b5b={'jTbJr':function(_0x574b70,_0x3e1cc0){return _0x574b70!==_0x3e1cc0;},'BLtzc':_0x3a9c57(0x1de)};return _0xa75b5b[_0x3a9c57(0x1fa)](typeof _0x26befb,_0xa75b5b[_0x3a9c57(0x1b6)])&&(_0x26befb=JSON[_0x3a9c57(0x1c1)](_0x26befb)),{'elementType':ElementType[_0x3a9c57(0x1e8)],'elementId':'','arkElement':{'bytesData':_0x26befb,'linkInfo':null,'subElementType':null}};}static[_0xb11d16(0x1f4)](_0x3687be){const _0x232370=_0xb11d16;return{'elementType':ElementType[_0x232370(0x1fc)],'elementId':'','markdownElement':{'content':_0x3687be}};}}