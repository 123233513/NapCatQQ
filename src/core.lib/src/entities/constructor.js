const _0x5f0657=_0xe009;(function(_0x335a8b,_0x2f0765){const _0x264181=_0xe009,_0x481ef6=_0x335a8b();while(!![]){try{const _0x27c51d=-parseInt(_0x264181(0x197))/0x1+-parseInt(_0x264181(0x1a2))/0x2+parseInt(_0x264181(0x198))/0x3+-parseInt(_0x264181(0x199))/0x4*(parseInt(_0x264181(0x1b9))/0x5)+-parseInt(_0x264181(0x160))/0x6*(-parseInt(_0x264181(0x19d))/0x7)+parseInt(_0x264181(0x1b5))/0x8+parseInt(_0x264181(0x169))/0x9*(parseInt(_0x264181(0x1ba))/0xa);if(_0x27c51d===_0x2f0765)break;else _0x481ef6['push'](_0x481ef6['shift']());}catch(_0x350d4d){_0x481ef6['push'](_0x481ef6['shift']());}}}(_0x5987,0x316b7));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x530a55}from'node:fs';import _0x5a96e9 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0xe009(_0x2a57da,_0x2e0d52){const _0x5987fb=_0x5987();return _0xe009=function(_0xe00961,_0xb49485){_0xe00961=_0xe00961-0x160;let _0x3c14ed=_0x5987fb[_0xe00961];return _0x3c14ed;},_0xe009(_0x2a57da,_0x2e0d52);}import _0x203081 from'./face_config.json';import*as _0x273d2f from'node:path';import{SignMiniApp}from'../apis';function _0x5987(){const _0x5a68d3=['qsFna','TEXT','find','32854PlDdHo','1098945uqZMYH','10836WANkGw','QSid','VIDEO','stringify','21IoClVh','yKgXG','KStnD','unlink','face','708454IRnAwy','语音转换失败,\x20请检查语音文件是否正常','Cdsgx','height','WRFCS','hKvCp','ZzANe','width','mp4','replace','FILE','_0.png','REPLY','join','dice','文件异常，大小为0','then','QDes','gif','50152bQStDs','kXWiy','writeFile','VSJTx','575GwnyzH','10UtwzPn','FOWPG','error','482694XoKeSX','Bot\x20Test','reply','MXxuY','AniStickerType','catch','pic','ptt','mface','2583972EiYNAI','text','zRQAO','oulmU','ARK','time','xdPQT','MAong','RPS','sep','hWWjU','qbnDl','emoji','iUqYM','markdown','FACE','uploadFile','Thumb','set','copyFile','PIC','[包剪锤]','ark','IcWJu','vDBEh','ZYCuB','[骰子]','miniapp','PlXcV','string','PTT','获取视频信息失败','toString','MARKDOWN','WYYGF','get','IENpe','获取视频封面失败，使用默认封面','KbeiB','rFMci','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','jpg'];_0x5987=function(){return _0x5a68d3;};return _0x5987();}export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x5f0657(0x16a)](_0x476a07){const _0x607a89=_0x5f0657;return{'elementType':ElementType[_0x607a89(0x195)],'elementId':'','textElement':{'content':_0x476a07,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x29927f,_0x5a89c2,_0x14e441,_0xa11d90){const _0x749fc4=_0x5f0657;return{'elementType':ElementType[_0x749fc4(0x195)],'elementId':'','textElement':{'content':'@'+_0xa11d90,'atType':_0x14e441,'atUid':_0x29927f,'atTinyId':'','atNtUid':_0x5a89c2}};}static[_0x5f0657(0x162)](_0x2a6849,_0x1f9dcd,_0x335ce2,_0x1cb77a){const _0x281490=_0x5f0657;return{'elementType':ElementType[_0x281490(0x1ae)],'elementId':'','replyElement':{'replayMsgSeq':_0x2a6849,'replayMsgId':_0x1f9dcd,'senderUin':_0x335ce2,'senderUinStr':_0x1cb77a}};}static async[_0x5f0657(0x166)](_0x3a59ce,_0x2acf4a='',_0x14e285=0x0){const _0xbc0c02=_0x5f0657,_0x314916={'KStnD':function(_0x2fbcf1,_0x14cc29){return _0x2fbcf1===_0x14cc29;},'IzOFk':_0xbc0c02(0x1b1),'hWWjU':function(_0x3ddfb0,_0x1d5672){return _0x3ddfb0(_0x1d5672);}},{md5:_0x3218f4,fileName:_0x103d32,path:_0x4f6afd,fileSize:_0x997589}=await NTQQFileApi[_0xbc0c02(0x179)](_0x3a59ce,ElementType[_0xbc0c02(0x17d)],_0x14e285);if(_0x314916[_0xbc0c02(0x19f)](_0x997589,0x0))throw _0x314916['IzOFk'];const _0x243063=await NTQQFileApi['getImageSize'](_0x3a59ce),_0x45f38e={'md5HexStr':_0x3218f4,'fileSize':_0x997589[_0xbc0c02(0x189)](),'picWidth':_0x243063?.[_0xbc0c02(0x1a9)],'picHeight':_0x243063?.[_0xbc0c02(0x1a5)],'fileName':_0x103d32,'sourcePath':_0x4f6afd,'original':!![],'picType':_0x314916[_0xbc0c02(0x173)](isGIF,_0x3a59ce)?PicType[_0xbc0c02(0x1b4)]:PicType[_0xbc0c02(0x193)],'picSubType':_0x14e285,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2acf4a};return{'elementType':ElementType[_0xbc0c02(0x17d)],'elementId':'','picElement':_0x45f38e};}static async['file'](_0x1e3bbd,_0x26a620=''){const _0x59b5c3=_0x5f0657,_0x42d2f2={'ZzANe':_0x59b5c3(0x1b1),'KbeiB':function(_0xc29f19,_0x166283){return _0xc29f19||_0x166283;}},{md5:_0x424eaf,fileName:_0x40c51f,path:_0x4ca127,fileSize:_0x1e27ba}=await NTQQFileApi[_0x59b5c3(0x179)](_0x1e3bbd,ElementType[_0x59b5c3(0x1ac)]);if(_0x1e27ba===0x0)throw _0x42d2f2[_0x59b5c3(0x1a8)];const _0x2246b3={'elementType':ElementType[_0x59b5c3(0x1ac)],'elementId':'','fileElement':{'fileName':_0x42d2f2[_0x59b5c3(0x18f)](_0x26a620,_0x40c51f),'filePath':_0x4ca127,'fileSize':_0x1e27ba[_0x59b5c3(0x189)]()}};return _0x2246b3;}static async['video'](_0x33076f,_0x28965e='',_0x26aea0=''){const _0x3399b1=_0x5f0657,_0x29f7b1={'yKgXG':function(_0x15ba32,_0x1b551d,_0x134e1b){return _0x15ba32(_0x1b551d,_0x134e1b);},'VSJTx':function(_0x4939aa,_0x54200a){return _0x4939aa(_0x54200a);},'WRFCS':function(_0x106905,_0x20cc93){return _0x106905(_0x20cc93);},'rFMci':function(_0x5e04c6,_0x354dca){return _0x5e04c6(_0x354dca);},'oulmU':'end','hKvCp':_0x3399b1(0x1bc),'MXxuY':function(_0x30e6bf,_0x4a9a69){return _0x30e6bf+_0x4a9a69;},'omlVJ':function(_0x362b55,_0x2d153c){return _0x362b55+_0x2d153c;},'YiUcr':function(_0x4fecf4,_0x34c4ec){return _0x4fecf4===_0x34c4ec;},'ZYCuB':function(_0x42a33a,_0x153a6f){return _0x42a33a(_0x153a6f);},'okmiU':_0x3399b1(0x188),'IENpe':function(_0x3af499,_0x231713){return _0x3af499||_0x231713;},'qbnDl':function(_0x432579,_0x461d44){return _0x432579+_0x461d44;}},{fileName:_0x42cb4d,path:_0xbb1513,fileSize:_0x156b5f,md5:_0x712148}=await NTQQFileApi['uploadFile'](_0x33076f,ElementType[_0x3399b1(0x19b)]);if(_0x29f7b1['YiUcr'](_0x156b5f,0x0))throw _0x3399b1(0x1b1);let _0x1262d1=_0xbb1513[_0x3399b1(0x1ab)](_0x273d2f[_0x3399b1(0x172)]+'Ori'+_0x273d2f[_0x3399b1(0x172)],_0x273d2f['sep']+_0x3399b1(0x17a)+_0x273d2f['sep']);_0x1262d1=_0x273d2f['dirname'](_0x1262d1);let _0x2d3272={'width':0x780,'height':0x438,'time':0xf,'format':_0x3399b1(0x1aa),'size':_0x156b5f,'filePath':_0x33076f};try{_0x2d3272=await _0x29f7b1[_0x3399b1(0x182)](getVideoInfo,_0xbb1513);}catch(_0x2f2a74){_0x29f7b1['yKgXG'](logError,_0x29f7b1['okmiU'],_0x2f2a74);}const _0x502c30=new Promise((_0x306b42,_0x88be3e)=>{const _0x101a9a=_0x3399b1,_0x24b867={'iUqYM':function(_0x4e1b85,_0xa2b0cf){return _0x4e1b85(_0xa2b0cf);},'zRQAO':function(_0x5d7453,_0xcb479b){const _0x533513=_0xe009;return _0x29f7b1[_0x533513(0x1a6)](_0x5d7453,_0xcb479b);}},_0xf04ea3=_0x712148+_0x101a9a(0x1ad),_0x16f35d=_0x273d2f[_0x101a9a(0x1af)](_0x1262d1,_0xf04ea3);_0x29f7b1[_0x101a9a(0x190)](_0x5a96e9,_0x33076f)['on'](_0x29f7b1[_0x101a9a(0x16c)],()=>{})['on'](_0x29f7b1[_0x101a9a(0x1a7)],_0x2c6e55=>{const _0x4194c6=_0x101a9a;_0x29f7b1[_0x4194c6(0x19e)](logDebug,_0x4194c6(0x18e),_0x2c6e55),_0x26aea0?_0x530a55[_0x4194c6(0x17c)](_0x26aea0,_0x16f35d)[_0x4194c6(0x1b2)](()=>{const _0x2a8a76=_0x4194c6;_0x24b867[_0x2a8a76(0x176)](_0x306b42,_0x16f35d);})[_0x4194c6(0x165)](_0x88be3e):_0x530a55[_0x4194c6(0x1b7)](_0x16f35d,defaultVideoThumb)[_0x4194c6(0x1b2)](()=>{const _0x536a7d=_0x4194c6;_0x24b867[_0x536a7d(0x16b)](_0x306b42,_0x16f35d);})[_0x4194c6(0x165)](_0x88be3e);})['screenshots']({'timestamps':[0x0],'filename':_0xf04ea3,'folder':_0x1262d1,'size':_0x29f7b1[_0x101a9a(0x163)](_0x29f7b1['omlVJ'](_0x2d3272[_0x101a9a(0x1a9)],'x'),_0x2d3272['height'])})['on'](_0x29f7b1[_0x101a9a(0x16c)],()=>{const _0xbddb68=_0x101a9a;_0x29f7b1[_0xbddb68(0x1b8)](_0x306b42,_0x16f35d);});}),_0x16bbae=new Map(),_0x524a4c=await _0x502c30,_0x18e246=(await _0x530a55['stat'](_0x524a4c))['size'];_0x16bbae[_0x3399b1(0x17b)](0x0,_0x524a4c);const _0x36077c=await _0x29f7b1['ZYCuB'](calculateFileMD5,_0x524a4c),_0x38b096={'elementType':ElementType[_0x3399b1(0x19b)],'elementId':'','videoElement':{'fileName':_0x29f7b1[_0x3399b1(0x18d)](_0x28965e,_0x42cb4d),'filePath':_0xbb1513,'videoMd5':_0x712148,'thumbMd5':_0x36077c,'fileTime':_0x2d3272[_0x3399b1(0x16e)],'thumbPath':_0x16bbae,'thumbSize':_0x18e246,'thumbWidth':_0x2d3272['width'],'thumbHeight':_0x2d3272[_0x3399b1(0x1a5)],'fileSize':_0x29f7b1[_0x3399b1(0x174)]('',_0x156b5f)}};return _0x38b096;}static async[_0x5f0657(0x167)](_0x13b024){const _0x11830b=_0x5f0657,_0x571008={'vDBEh':function(_0x47bd79,_0xc9b52b){return _0x47bd79(_0xc9b52b);},'PlXcV':_0x11830b(0x1a3),'xdPQT':function(_0x29c084,_0x9a463d){return _0x29c084===_0x9a463d;},'Cdsgx':function(_0x2c31af,_0x4b0bc5){return _0x2c31af||_0x4b0bc5;}},{converted:_0x662867,path:_0x1b22a7,duration:_0x233f53}=await _0x571008[_0x11830b(0x181)](encodeSilk,_0x13b024);if(!_0x1b22a7)throw _0x571008[_0x11830b(0x185)];const {md5:_0xbd4c76,fileName:_0x314e87,path:_0x5e66aa,fileSize:_0x4ded64}=await NTQQFileApi[_0x11830b(0x179)](_0x1b22a7,ElementType[_0x11830b(0x187)]);if(_0x571008[_0x11830b(0x16f)](_0x4ded64,0x0))throw _0x11830b(0x1b1);return _0x662867&&_0x530a55[_0x11830b(0x1a0)](_0x1b22a7)[_0x11830b(0x1b2)](),{'elementType':ElementType[_0x11830b(0x187)],'elementId':'','pttElement':{'fileName':_0x314e87,'filePath':_0x5e66aa,'md5HexStr':_0xbd4c76,'fileSize':_0x4ded64,'duration':_0x571008[_0x11830b(0x1a4)](_0x233f53,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x5f0657(0x1a1)](_0x86ab60){const _0x2a7ed5=_0x5f0657,_0x394486={'WYYGF':function(_0x270035,_0x23d4c6){return _0x270035>=_0x23d4c6;}},_0x57e959=_0x203081['sysface'],_0x21cf18=_0x203081[_0x2a7ed5(0x175)],_0x2ada49=_0x57e959[_0x2a7ed5(0x196)](_0x5df53a=>_0x5df53a[_0x2a7ed5(0x19a)]===_0x86ab60[_0x2a7ed5(0x189)]());_0x86ab60=parseInt(_0x86ab60[_0x2a7ed5(0x189)]());let _0xb7f88c=0x1;return _0x394486[_0x2a7ed5(0x18b)](_0x86ab60,0xde)&&(_0xb7f88c=0x2),_0x2ada49[_0x2a7ed5(0x164)]&&(_0xb7f88c=0x3),{'elementType':ElementType[_0x2a7ed5(0x178)],'elementId':'','faceElement':{'faceIndex':_0x86ab60,'faceType':_0xb7f88c,'faceText':_0x2ada49[_0x2a7ed5(0x1b3)],'stickerId':_0x2ada49['AniStickerId'],'stickerType':_0x2ada49[_0x2a7ed5(0x164)],'packId':_0x2ada49['AniStickerPackId'],'sourceType':0x1}};}static[_0x5f0657(0x168)](_0x2dcc66,_0x54ccdb,_0x430d6e,_0x5626bc){const _0x2ffd90=_0x5f0657,_0x11c85f={'MAong':'[商城表情]'};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x2dcc66,'emojiId':_0x54ccdb,'key':_0x430d6e,'faceName':_0x5626bc||mFaceCache[_0x2ffd90(0x18c)](_0x54ccdb)||_0x11c85f[_0x2ffd90(0x170)]}};}static[_0x5f0657(0x1b0)](_0x19bc19){const _0x1d6c10=_0x5f0657,_0x4ad00a={'SERyt':_0x1d6c10(0x183)};return{'elementType':ElementType[_0x1d6c10(0x178)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1d6c10(0x1b0)],'faceType':FaceType[_0x1d6c10(0x1b0)],'faceText':_0x4ad00a['SERyt'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x138265){const _0x4cce5c=_0x5f0657,_0x1e05ec={'FOWPG':_0x4cce5c(0x17e)};return{'elementType':ElementType[_0x4cce5c(0x178)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4cce5c(0x171)],'faceText':_0x1e05ec[_0x4cce5c(0x1bb)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5f0657(0x17f)](_0x23ec92){const _0x135b3e=_0x5f0657,_0x10f639={'AKGmR':_0x135b3e(0x186)};return typeof _0x23ec92!==_0x10f639['AKGmR']&&(_0x23ec92=JSON[_0x135b3e(0x19c)](_0x23ec92)),{'elementType':ElementType[_0x135b3e(0x16d)],'elementId':'','arkElement':{'bytesData':_0x23ec92,'linkInfo':null,'subElementType':null}};}static[_0x5f0657(0x177)](_0x19a564){const _0xec9338=_0x5f0657;return{'elementType':ElementType[_0xec9338(0x18a)],'elementId':'','markdownElement':{'content':_0x19a564}};}static async[_0x5f0657(0x184)](){const _0x1a9b27=_0x5f0657,_0x55042c={'GEPaB':function(_0x4400c8,_0x532047){return _0x4400c8(_0x532047);},'IcWJu':_0x1a9b27(0x161),'sJBXq':_0x1a9b27(0x191),'kXWiy':'https://www.bilibili.com/','qsFna':_0x1a9b27(0x192)};let _0x305670=await _0x55042c['GEPaB'](SignMiniApp,{'prompt':_0x55042c[_0x1a9b27(0x180)],'title':_0x55042c['IcWJu'],'preview':_0x55042c['sJBXq'],'jumpUrl':_0x55042c[_0x1a9b27(0x1b6)],'tag':_0x55042c[_0x1a9b27(0x180)],'tagIcon':_0x55042c[_0x1a9b27(0x194)],'source':_0x55042c['IcWJu'],'sourcelogo':_0x55042c[_0x1a9b27(0x194)]});return{'elementType':ElementType[_0x1a9b27(0x16d)],'elementId':'','arkElement':{'bytesData':_0x305670,'linkInfo':null,'subElementType':null}};}}