const _0x1753d2=_0x4283;function _0x4283(_0xe9e19c,_0x3b1f6c){const _0x13613a=_0x1361();return _0x4283=function(_0x42831f,_0x46228e){_0x42831f=_0x42831f-0x7d;let _0x673ff0=_0x13613a[_0x42831f];return _0x673ff0;},_0x4283(_0xe9e19c,_0x3b1f6c);}(function(_0x38341b,_0x444c26){const _0x500a53=_0x4283,_0xb162a6=_0x38341b();while(!![]){try{const _0x375d1f=-parseInt(_0x500a53(0xd1))/0x1*(-parseInt(_0x500a53(0x91))/0x2)+-parseInt(_0x500a53(0x96))/0x3+parseInt(_0x500a53(0x8f))/0x4*(parseInt(_0x500a53(0xc1))/0x5)+-parseInt(_0x500a53(0xa5))/0x6*(parseInt(_0x500a53(0xc5))/0x7)+-parseInt(_0x500a53(0x98))/0x8*(parseInt(_0x500a53(0xad))/0x9)+parseInt(_0x500a53(0xbe))/0xa*(parseInt(_0x500a53(0xc2))/0xb)+parseInt(_0x500a53(0x85))/0xc*(parseInt(_0x500a53(0xbc))/0xd);if(_0x375d1f===_0x444c26)break;else _0xb162a6['push'](_0xb162a6['shift']());}catch(_0x3b611a){_0xb162a6['push'](_0xb162a6['shift']());}}}(_0x1361,0xbaffe));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x52c9f8}from'node:fs';function _0x1361(){const _0x46702f=['21515bSKggx','2743565YXpgif','pic','jpg','9893751sxcOTz','uploadFile','naadU','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','get','PIC','[商城表情]','catch','[包剪锤]','https://www.bilibili.com/','face','emoji','198aiQvbm','ptt','获取视频封面失败，使用默认封面','VIDEO','Ori','tXYxU','_0.png','height','end','screenshots','mp4','1182612ZqjKDu','ULccD','idfjH','FACE','getImageSize','sqRPX','replace','file','ark','eCfuk','384vXpDWT','TEXT','11054XZlMLP','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','jDjnw','文件异常，大小为0','video','3571869tWaCRm','AniStickerType','7223768BIwTPV','size','width','MFACE','copyFile','QDes','rps','then','OsECg','markdown','svCSu','lhnqq','sRjsW','6FXHNXl','ARK','toString','sep','SZIJO','Bot\x20Test','unlink','PTT','9LyfRDS','GHzEJ','stat','FSdVl','AniStickerPackId','QeXaF','notAt','stringify','mface','time','writeFile','Thumb','MARKDOWN','获取视频信息失败','join','299jjRcCl','FILE','20VuNLRH','dice','error'];_0x1361=function(){return _0x46702f;};return _0x1361();}import _0x61e612 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x52d501 from'./face_config.json';import*as _0x57fcca from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x261aa5){const _0x493c7a=_0x4283;return{'elementType':ElementType[_0x493c7a(0x90)],'elementId':'','textElement':{'content':_0x261aa5,'atType':AtType[_0x493c7a(0xb3)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x5705ce,_0x3813db,_0x3c6606,_0x5849e1){const _0x5508c5=_0x4283;return{'elementType':ElementType[_0x5508c5(0x90)],'elementId':'','textElement':{'content':'@'+_0x5849e1,'atType':_0x3c6606,'atUid':_0x5705ce,'atTinyId':'','atNtUid':_0x3813db}};}static['reply'](_0x1e5026,_0x28ff4a,_0x7f0bb2,_0x5eb858){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x1e5026,'replayMsgId':_0x28ff4a,'senderUin':_0x7f0bb2,'senderUinStr':_0x5eb858}};}static async[_0x1753d2(0xc3)](_0x10a9b8,_0x25ffd3='',_0x455ffa=0x0){const _0x336abc=_0x1753d2,_0x2f5c8f={'QeXaF':_0x336abc(0x94),'hitsG':function(_0x486024,_0x195dc5){return _0x486024(_0x195dc5);}},{md5:_0x142adb,fileName:_0x4c637a,path:_0x11cf5b,fileSize:_0x1ea408}=await NTQQFileApi[_0x336abc(0xc6)](_0x10a9b8,ElementType[_0x336abc(0xca)],_0x455ffa);if(_0x1ea408===0x0)throw _0x2f5c8f[_0x336abc(0xb2)];const _0x5d34fc=await NTQQFileApi[_0x336abc(0x89)](_0x10a9b8),_0x47beb6={'md5HexStr':_0x142adb,'fileSize':_0x1ea408['toString'](),'picWidth':_0x5d34fc?.[_0x336abc(0x9a)],'picHeight':_0x5d34fc?.[_0x336abc(0x81)],'fileName':_0x4c637a,'sourcePath':_0x11cf5b,'original':!![],'picType':_0x2f5c8f['hitsG'](isGIF,_0x10a9b8)?PicType['gif']:PicType[_0x336abc(0xc4)],'picSubType':_0x455ffa,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x25ffd3};return{'elementType':ElementType[_0x336abc(0xca)],'elementId':'','picElement':_0x47beb6};}static async[_0x1753d2(0x8c)](_0x518958,_0xa6be23='',_0x34ca0e=''){const _0xf38fd8=_0x1753d2,_0x40bf80={'xxOJd':_0xf38fd8(0x94),'naadU':function(_0xd44a4e,_0x3e1fcc){return _0xd44a4e||_0x3e1fcc;}},{md5:_0x589c24,fileName:_0x415e4f,path:_0x598c85,fileSize:_0xb4da5b}=await NTQQFileApi[_0xf38fd8(0xc6)](_0x518958,ElementType['FILE']);if(_0xb4da5b===0x0)throw _0x40bf80['xxOJd'];const _0x212c75={'elementType':ElementType[_0xf38fd8(0xbd)],'elementId':'','fileElement':{'fileName':_0x40bf80[_0xf38fd8(0xc7)](_0xa6be23,_0x415e4f),'folderId':_0x34ca0e,'filePath':_0x598c85,'fileSize':_0xb4da5b['toString']()}};return _0x212c75;}static async[_0x1753d2(0x95)](_0x1d8762,_0x50f06d='',_0x12db9d=''){const _0x57c3f4=_0x1753d2,_0x3422f5={'idfjH':function(_0x3e00b6,_0x249e3a){return _0x3e00b6(_0x249e3a);},'sqRPX':_0x57c3f4(0xd3),'jDjnw':_0x57c3f4(0x82),'pQEIg':function(_0x5e3d17,_0x340b2f){return _0x5e3d17+_0x340b2f;},'iMhMn':function(_0x2753d1,_0x401058){return _0x2753d1+_0x401058;},'piFhN':_0x57c3f4(0x94),'qpWkj':function(_0x166cb5,_0x1359ad,_0x540956){return _0x166cb5(_0x1359ad,_0x540956);},'lhnqq':function(_0x1ae6d7,_0x3a8892){return _0x1ae6d7||_0x3a8892;}},{fileName:_0x37d589,path:_0x1adc35,fileSize:_0x4cd363,md5:_0x11596a}=await NTQQFileApi[_0x57c3f4(0xc6)](_0x1d8762,ElementType[_0x57c3f4(0x7d)]);if(_0x4cd363===0x0)throw _0x3422f5['piFhN'];let _0x5e0c54=_0x1adc35[_0x57c3f4(0x8b)](_0x57fcca[_0x57c3f4(0xa8)]+_0x57c3f4(0x7e)+_0x57fcca[_0x57c3f4(0xa8)],_0x57fcca['sep']+_0x57c3f4(0xb8)+_0x57fcca[_0x57c3f4(0xa8)]);_0x5e0c54=_0x57fcca['dirname'](_0x5e0c54);let _0x9b380c={'width':0x780,'height':0x438,'time':0xf,'format':_0x57c3f4(0x84),'size':_0x4cd363,'filePath':_0x1d8762};try{_0x9b380c=await getVideoInfo(_0x1adc35);}catch(_0x436b53){_0x3422f5['qpWkj'](logError,_0x57c3f4(0xba),_0x436b53);}const _0x95868d=new Promise((_0x478424,_0x312b79)=>{const _0x2a2c20=_0x57c3f4,_0x4bb435={'OsECg':function(_0x485f43,_0x3e921b){const _0x4be121=_0x4283;return _0x3422f5[_0x4be121(0x87)](_0x485f43,_0x3e921b);}},_0xe9b3a3=_0x11596a+_0x2a2c20(0x80),_0x1dad58=_0x57fcca[_0x2a2c20(0xbb)](_0x5e0c54,_0xe9b3a3);_0x61e612(_0x1d8762)['on'](_0x3422f5[_0x2a2c20(0x93)],()=>{})['on'](_0x2a2c20(0xc0),_0x49d568=>{const _0x2522e4=_0x2a2c20,_0x4cc2a7={'ZeyTo':function(_0x1b485e,_0x331a1a){const _0x2b724d=_0x4283;return _0x3422f5[_0x2b724d(0x87)](_0x1b485e,_0x331a1a);}};logDebug(_0x3422f5[_0x2522e4(0x8a)],_0x49d568),_0x12db9d?_0x52c9f8[_0x2522e4(0x9c)](_0x12db9d,_0x1dad58)[_0x2522e4(0x9f)](()=>{_0x4cc2a7['ZeyTo'](_0x478424,_0x1dad58);})[_0x2522e4(0xcc)](_0x312b79):_0x52c9f8[_0x2522e4(0xb7)](_0x1dad58,defaultVideoThumb)['then'](()=>{const _0x1c969a=_0x2522e4;_0x4bb435[_0x1c969a(0xa0)](_0x478424,_0x1dad58);})[_0x2522e4(0xcc)](_0x312b79);})[_0x2a2c20(0x83)]({'timestamps':[0x0],'filename':_0xe9b3a3,'folder':_0x5e0c54,'size':_0x3422f5['pQEIg'](_0x3422f5['iMhMn'](_0x9b380c['width'],'x'),_0x9b380c[_0x2a2c20(0x81)])})['on'](_0x3422f5['jDjnw'],()=>{const _0x2a9e4a=_0x2a2c20;_0x3422f5[_0x2a9e4a(0x87)](_0x478424,_0x1dad58);});}),_0x5d569e=new Map(),_0x27b181=await _0x95868d,_0x2b45f7=(await _0x52c9f8[_0x57c3f4(0xaf)](_0x27b181))[_0x57c3f4(0x99)];_0x5d569e['set'](0x0,_0x27b181);const _0x32470b=await calculateFileMD5(_0x27b181),_0x2a2e92={'elementType':ElementType[_0x57c3f4(0x7d)],'elementId':'','videoElement':{'fileName':_0x3422f5[_0x57c3f4(0xa3)](_0x50f06d,_0x37d589),'filePath':_0x1adc35,'videoMd5':_0x11596a,'thumbMd5':_0x32470b,'fileTime':_0x9b380c[_0x57c3f4(0xb6)],'thumbPath':_0x5d569e,'thumbSize':_0x2b45f7,'thumbWidth':_0x9b380c[_0x57c3f4(0x9a)],'thumbHeight':_0x9b380c['height'],'fileSize':''+_0x4cd363}};return _0x2a2e92;}static async[_0x1753d2(0xd2)](_0x1ff325){const _0x5b8d0d=_0x1753d2,_0x2d7354={'eCfuk':function(_0x462550,_0x2f2ea6){return _0x462550(_0x2f2ea6);},'sRjsW':'文件异常，大小为0','tXYxU':function(_0x480541,_0x25c7bf){return _0x480541||_0x25c7bf;}},{converted:_0x55bdec,path:_0x275d5b,duration:_0x426b87}=await _0x2d7354[_0x5b8d0d(0x8e)](encodeSilk,_0x1ff325);if(!_0x275d5b)throw'语音转换失败,\x20请检查语音文件是否正常';const {md5:_0x361e57,fileName:_0x17e11b,path:_0x1f7366,fileSize:_0x23e67c}=await NTQQFileApi['uploadFile'](_0x275d5b,ElementType[_0x5b8d0d(0xac)]);if(_0x23e67c===0x0)throw _0x2d7354[_0x5b8d0d(0xa4)];return _0x55bdec&&_0x52c9f8[_0x5b8d0d(0xab)](_0x275d5b)[_0x5b8d0d(0x9f)](),{'elementType':ElementType[_0x5b8d0d(0xac)],'elementId':'','pttElement':{'fileName':_0x17e11b,'filePath':_0x1f7366,'md5HexStr':_0x361e57,'fileSize':_0x23e67c,'duration':_0x2d7354[_0x5b8d0d(0x7f)](_0x426b87,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x1753d2(0xcf)](_0x3c3b9f){const _0x55c477=_0x1753d2,_0x23953c={'svCSu':function(_0x3cba8b,_0x13d576){return _0x3cba8b(_0x13d576);}},_0x3ada22=_0x52d501['sysface'],_0x34bfc6=_0x52d501[_0x55c477(0xd0)],_0x4e31b7=_0x3ada22['find'](_0x1334db=>_0x1334db['QSid']===_0x3c3b9f['toString']());_0x3c3b9f=_0x23953c[_0x55c477(0xa2)](parseInt,_0x3c3b9f[_0x55c477(0xa7)]());let _0x5c3383=0x1;return _0x3c3b9f>=0xde&&(_0x5c3383=0x2),_0x4e31b7[_0x55c477(0x97)]&&(_0x5c3383=0x3),{'elementType':ElementType[_0x55c477(0x88)],'elementId':'','faceElement':{'faceIndex':_0x3c3b9f,'faceType':_0x5c3383,'faceText':_0x4e31b7[_0x55c477(0x9d)],'stickerId':_0x4e31b7['AniStickerId'],'stickerType':_0x4e31b7[_0x55c477(0x97)],'packId':_0x4e31b7[_0x55c477(0xb1)],'sourceType':0x1}};}static[_0x1753d2(0xb5)](_0x28e8f9,_0x32d21f,_0x14444f,_0x27d475){const _0x4cde70=_0x1753d2,_0x1c2024={'Xyhjf':_0x4cde70(0xcb)};return{'elementType':ElementType[_0x4cde70(0x9b)],'marketFaceElement':{'emojiPackageId':_0x28e8f9,'emojiId':_0x32d21f,'key':_0x14444f,'faceName':_0x27d475||mFaceCache[_0x4cde70(0xc9)](_0x32d21f)||_0x1c2024['Xyhjf']}};}static[_0x1753d2(0xbf)](_0x811a91){const _0x16baa0=_0x1753d2,_0x341e2a={'SZIJO':'[骰子]'};return{'elementType':ElementType[_0x16baa0(0x88)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x16baa0(0xbf)],'faceType':FaceType[_0x16baa0(0xbf)],'faceText':_0x341e2a[_0x16baa0(0xa9)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x1753d2(0x9e)](_0x2d2c51){const _0x1543cd=_0x1753d2;return{'elementType':ElementType[_0x1543cd(0x88)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x1543cd(0xcd),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x1753d2(0x8d)](_0xae3b1d){const _0xf6aa7=_0x1753d2,_0x4549dc={'UuxQH':function(_0xeed916,_0x548e40){return _0xeed916!==_0x548e40;},'GHzEJ':'string'};return _0x4549dc['UuxQH'](typeof _0xae3b1d,_0x4549dc[_0xf6aa7(0xae)])&&(_0xae3b1d=JSON[_0xf6aa7(0xb4)](_0xae3b1d)),{'elementType':ElementType[_0xf6aa7(0xa6)],'elementId':'','arkElement':{'bytesData':_0xae3b1d,'linkInfo':null,'subElementType':null}};}static[_0x1753d2(0xa1)](_0x433eef){const _0x166db9=_0x1753d2;return{'elementType':ElementType[_0x166db9(0xb9)],'elementId':'','markdownElement':{'content':_0x433eef}};}static async['miniapp'](){const _0x110843=_0x1753d2,_0x31860e={'FSdVl':function(_0x47f03a,_0x4a9f5b){return _0x47f03a(_0x4a9f5b);},'ULccD':_0x110843(0xaa),'kQMkh':_0x110843(0x92)};let _0x514507=await _0x31860e[_0x110843(0xb0)](SignMiniApp,{'prompt':_0x110843(0xaa),'title':_0x31860e['ULccD'],'preview':_0x110843(0xc8),'jumpUrl':_0x110843(0xce),'tag':_0x31860e[_0x110843(0x86)],'tagIcon':_0x31860e['kQMkh'],'source':_0x31860e[_0x110843(0x86)],'sourcelogo':_0x110843(0x92)});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x514507,'linkInfo':null,'subElementType':null}};}}