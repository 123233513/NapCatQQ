const _0xd174d8=_0x4e40;(function(_0x277964,_0x4c41f0){const _0x19a8a3=_0x4e40,_0x3e276e=_0x277964();while(!![]){try{const _0x5dcef0=parseInt(_0x19a8a3(0xe1))/0x1+-parseInt(_0x19a8a3(0xbf))/0x2*(parseInt(_0x19a8a3(0xdd))/0x3)+-parseInt(_0x19a8a3(0xa6))/0x4*(-parseInt(_0x19a8a3(0xcc))/0x5)+-parseInt(_0x19a8a3(0xbd))/0x6+parseInt(_0x19a8a3(0xbe))/0x7*(parseInt(_0x19a8a3(0xbc))/0x8)+-parseInt(_0x19a8a3(0xa9))/0x9+-parseInt(_0x19a8a3(0xb7))/0xa*(parseInt(_0x19a8a3(0xe7))/0xb);if(_0x5dcef0===_0x4c41f0)break;else _0x3e276e['push'](_0x3e276e['shift']());}catch(_0x397427){_0x3e276e['push'](_0x3e276e['shift']());}}}(_0xdea5,0x1ae17));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x2b7b8e}from'node:fs';import _0x347e from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x30f932 from'./face_config.json';import*as _0x369c11 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();function _0x4e40(_0x7d696e,_0x29be40){const _0xdea56d=_0xdea5();return _0x4e40=function(_0x4e40c8,_0x2e01f1){_0x4e40c8=_0x4e40c8-0x93;let _0x3fe188=_0xdea56d[_0x4e40c8];return _0x3fe188;},_0x4e40(_0x7d696e,_0x29be40);}function _0xdea5(){const _0x495cd5=['BsLhv','lkoMT','dMmfP','stat','https://www.bilibili.com/','文件异常，大小为0','_0.png','unlink','time','pic','mp4','scdRq','获取视频信息失败','end','[骰子]','sep','toString','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','copyFile','catch','rps','ptt','icOhU','TpGmq','236jziHmH','AniStickerType','string','1800639sKxqDc','HAYda','uhMGi','[包剪锤]','Ori','wadqh','McnIl','Bot\x20Test','gWnYY','join','euLyh','find','QkIea','QDes','100990XWqdvh','fUZBv','UijEp','jNAPk','PzgnR','8ERhKTF','747972DBkWGg','1351014bksFXs','4ckCLtH','uploadFile','RPS','QxPPc','file','lSzDJ','MFACE','text','FILE','replace','size','FLIRH','BdHRe','9610kUGcLI','iOGUy','getImageSize','set','notAt','sxcxq','emoji','QSid','Thumb','width','REPLY','hwRFC','mface','tgrpX','VJpCq','dice','TBBvE','52407gJYOTt','FACE','then','stringify','173473DJWcHP','KUTeF','AniStickerId','height','[商城表情]','CqIHU','11GDpPFe','reply','PIC','gif','error','screenshots'];_0xdea5=function(){return _0x495cd5;};return _0xdea5();}export class SendMsgElementConstructor{static[_0xd174d8(0xc6)](_0x293de2){const _0x1ae10a=_0xd174d8;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x293de2,'atType':AtType[_0x1ae10a(0xd0)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x15dfe6,_0x474f02,_0x3ecfbe,_0x8382b7){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x8382b7,'atType':_0x3ecfbe,'atUid':_0x15dfe6,'atTinyId':'','atNtUid':_0x474f02}};}static[_0xd174d8(0xe8)](_0x1c7df9,_0x4b67b4,_0x4fb57a,_0x4a32eb){const _0x4c7d0a=_0xd174d8;return{'elementType':ElementType[_0x4c7d0a(0xd6)],'elementId':'','replyElement':{'replayMsgSeq':_0x1c7df9,'replayMsgId':_0x4b67b4,'senderUin':_0x4fb57a,'senderUinStr':_0x4a32eb}};}static async[_0xd174d8(0x97)](_0xfda9,_0x509d03='',_0x41f01d=0x0){const _0x247b80=_0xd174d8,_0x424798={'QxPPc':function(_0x3609d2,_0x1869b9){return _0x3609d2===_0x1869b9;},'sxcxq':_0x247b80(0x93),'PzgnR':function(_0x2a8f97,_0x74cf09){return _0x2a8f97(_0x74cf09);}},{md5:_0x206807,fileName:_0x482ebb,path:_0x1b3cf5,fileSize:_0x127005}=await NTQQFileApi[_0x247b80(0xc0)](_0xfda9,ElementType['PIC'],_0x41f01d);if(_0x424798[_0x247b80(0xc2)](_0x127005,0x0))throw _0x424798[_0x247b80(0xd1)];const _0x454102=await NTQQFileApi[_0x247b80(0xce)](_0xfda9),_0x215938={'md5HexStr':_0x206807,'fileSize':_0x127005[_0x247b80(0x9e)](),'picWidth':_0x454102?.[_0x247b80(0xd5)],'picHeight':_0x454102?.[_0x247b80(0xe4)],'fileName':_0x482ebb,'sourcePath':_0x1b3cf5,'original':!![],'picType':_0x424798[_0x247b80(0xbb)](isGIF,_0xfda9)?PicType[_0x247b80(0xea)]:PicType['jpg'],'picSubType':_0x41f01d,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x509d03};return{'elementType':ElementType[_0x247b80(0xe9)],'elementId':'','picElement':_0x215938};}static async[_0xd174d8(0xc3)](_0x85881d,_0xcc591f='',_0x8959be=''){const _0x315735=_0xd174d8,_0x202ca4={'rtWud':_0x315735(0x93)},{md5:_0x321eed,fileName:_0x112db5,path:_0x23ad12,fileSize:_0x3ce084}=await NTQQFileApi[_0x315735(0xc0)](_0x85881d,ElementType[_0x315735(0xc7)]);if(_0x3ce084===0x0)throw _0x202ca4['rtWud'];const _0x5b1506={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0xcc591f||_0x112db5,'folderId':_0x8959be,'filePath':_0x23ad12,'fileSize':_0x3ce084['toString']()}};return _0x5b1506;}static async['video'](_0x37f1ec,_0x50ceb6='',_0xc0cab2=''){const _0x4d7e3b=_0xd174d8,_0xd1330b={'KUTeF':function(_0x2fef6e,_0x1fc126){return _0x2fef6e(_0x1fc126);},'QkIea':'获取视频封面失败，使用默认封面','VJpCq':_0x4d7e3b(0x9b),'euLyh':function(_0x2755ee,_0x521b64){return _0x2755ee+_0x521b64;},'FLIRH':function(_0x1c4487,_0x33742b){return _0x1c4487===_0x33742b;},'BdHRe':_0x4d7e3b(0x93),'TpGmq':_0x4d7e3b(0x98),'UijEp':function(_0x481e33,_0x2a0856,_0x7514b5){return _0x481e33(_0x2a0856,_0x7514b5);},'uhMGi':function(_0xe7f79,_0x1d3129){return _0xe7f79||_0x1d3129;},'yvHRV':function(_0x14d3ac,_0x1c7f4a){return _0x14d3ac+_0x1c7f4a;}},{fileName:_0x4f78ef,path:_0x5f2a76,fileSize:_0x526baf,md5:_0x5494db}=await NTQQFileApi[_0x4d7e3b(0xc0)](_0x37f1ec,ElementType['VIDEO']);if(_0xd1330b[_0x4d7e3b(0xca)](_0x526baf,0x0))throw _0xd1330b[_0x4d7e3b(0xcb)];let _0x4b7768=_0x5f2a76[_0x4d7e3b(0xc8)](_0x369c11[_0x4d7e3b(0x9d)]+_0x4d7e3b(0xad)+_0x369c11[_0x4d7e3b(0x9d)],_0x369c11[_0x4d7e3b(0x9d)]+_0x4d7e3b(0xd4)+_0x369c11[_0x4d7e3b(0x9d)]);_0x4b7768=_0x369c11['dirname'](_0x4b7768);let _0x5f225b={'width':0x780,'height':0x438,'time':0xf,'format':_0xd1330b[_0x4d7e3b(0xa5)],'size':_0x526baf,'filePath':_0x37f1ec};try{_0x5f225b=await _0xd1330b[_0x4d7e3b(0xe2)](getVideoInfo,_0x5f2a76);}catch(_0x218b9c){_0xd1330b[_0x4d7e3b(0xb9)](logError,_0x4d7e3b(0x9a),_0x218b9c);}const _0x33b4e4=new Promise((_0x319919,_0x37173c)=>{const _0x1c4776=_0x4d7e3b,_0x1aaa12={'CqIHU':function(_0xc7a69b,_0xa2b09c){const _0x310e82=_0x4e40;return _0xd1330b[_0x310e82(0xe2)](_0xc7a69b,_0xa2b09c);},'HAYda':function(_0x238c18,_0x381662,_0x49ece8){return _0x238c18(_0x381662,_0x49ece8);},'jNAPk':_0xd1330b[_0x1c4776(0xb5)]},_0x5ef1de=_0x5494db+_0x1c4776(0x94),_0x3d7cc1=_0x369c11[_0x1c4776(0xb2)](_0x4b7768,_0x5ef1de);_0xd1330b['KUTeF'](_0x347e,_0x37f1ec)['on'](_0xd1330b['VJpCq'],()=>{})['on'](_0x1c4776(0xeb),_0x49ebe6=>{const _0x3d483a=_0x1c4776,_0x41b0ca={'lSzDJ':function(_0x4952f8,_0x3e9dc4){const _0x4c082b=_0x4e40;return _0x1aaa12[_0x4c082b(0xe6)](_0x4952f8,_0x3e9dc4);},'wadqh':function(_0x3aa2b1,_0x9ab1dc){return _0x3aa2b1(_0x9ab1dc);}};_0x1aaa12[_0x3d483a(0xaa)](logDebug,_0x1aaa12[_0x3d483a(0xba)],_0x49ebe6),_0xc0cab2?_0x2b7b8e[_0x3d483a(0xa0)](_0xc0cab2,_0x3d7cc1)['then'](()=>{const _0x2c3229=_0x3d483a;_0x41b0ca[_0x2c3229(0xc4)](_0x319919,_0x3d7cc1);})[_0x3d483a(0xa1)](_0x37173c):_0x2b7b8e['writeFile'](_0x3d7cc1,defaultVideoThumb)[_0x3d483a(0xdf)](()=>{const _0x26e464=_0x3d483a;_0x41b0ca[_0x26e464(0xae)](_0x319919,_0x3d7cc1);})[_0x3d483a(0xa1)](_0x37173c);})[_0x1c4776(0xec)]({'timestamps':[0x0],'filename':_0x5ef1de,'folder':_0x4b7768,'size':_0xd1330b[_0x1c4776(0xb3)](_0x5f225b['width'],'x')+_0x5f225b['height']})['on'](_0xd1330b[_0x1c4776(0xda)],()=>{const _0x4d8ea6=_0x1c4776;_0x1aaa12[_0x4d8ea6(0xe6)](_0x319919,_0x3d7cc1);});}),_0x14831c=new Map(),_0x38261e=await _0x33b4e4,_0x11c1ef=(await _0x2b7b8e[_0x4d7e3b(0xf0)](_0x38261e))[_0x4d7e3b(0xc9)];_0x14831c[_0x4d7e3b(0xcf)](0x0,_0x38261e);const _0x9a87f6=await _0xd1330b['KUTeF'](calculateFileMD5,_0x38261e),_0x5b26a2={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0xd1330b[_0x4d7e3b(0xab)](_0x50ceb6,_0x4f78ef),'filePath':_0x5f2a76,'videoMd5':_0x5494db,'thumbMd5':_0x9a87f6,'fileTime':_0x5f225b[_0x4d7e3b(0x96)],'thumbPath':_0x14831c,'thumbSize':_0x11c1ef,'thumbWidth':_0x5f225b[_0x4d7e3b(0xd5)],'thumbHeight':_0x5f225b[_0x4d7e3b(0xe4)],'fileSize':_0xd1330b['yvHRV']('',_0x526baf)}};return _0x5b26a2;}static async[_0xd174d8(0xa3)](_0x543494){const _0x19d89a=_0xd174d8,_0x658ecd={'fUZBv':function(_0x1815ac,_0x3ba824){return _0x1815ac(_0x3ba824);},'gWnYY':'语音转换失败,\x20请检查语音文件是否正常','McnIl':function(_0x1b1f2e,_0x372b4e){return _0x1b1f2e===_0x372b4e;},'CbtcA':_0x19d89a(0x93),'lkoMT':function(_0x3edee5,_0x1b7bc2){return _0x3edee5||_0x1b7bc2;}},{converted:_0x67e015,path:_0x155c44,duration:_0x265e7b}=await _0x658ecd[_0x19d89a(0xb8)](encodeSilk,_0x543494);if(!_0x155c44)throw _0x658ecd[_0x19d89a(0xb1)];const {md5:_0x4fe698,fileName:_0x16b273,path:_0x325536,fileSize:_0xd00b3c}=await NTQQFileApi[_0x19d89a(0xc0)](_0x155c44,ElementType['PTT']);if(_0x658ecd[_0x19d89a(0xaf)](_0xd00b3c,0x0))throw _0x658ecd['CbtcA'];return _0x67e015&&_0x2b7b8e[_0x19d89a(0x95)](_0x155c44)['then'](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x16b273,'filePath':_0x325536,'md5HexStr':_0x4fe698,'fileSize':_0xd00b3c,'duration':_0x658ecd[_0x19d89a(0xee)](_0x265e7b,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x3dc860){const _0x5d2e7f=_0xd174d8,_0x4021da={'scdRq':function(_0x43ef46,_0x2bdd56){return _0x43ef46>=_0x2bdd56;}},_0x5710b6=_0x30f932['sysface'],_0x45cd7e=_0x30f932[_0x5d2e7f(0xd2)],_0x254b41=_0x5710b6[_0x5d2e7f(0xb4)](_0x4b8ac8=>_0x4b8ac8[_0x5d2e7f(0xd3)]===_0x3dc860[_0x5d2e7f(0x9e)]());_0x3dc860=parseInt(_0x3dc860[_0x5d2e7f(0x9e)]());let _0x2a9445=0x1;return _0x4021da[_0x5d2e7f(0x99)](_0x3dc860,0xde)&&(_0x2a9445=0x2),_0x254b41[_0x5d2e7f(0xa7)]&&(_0x2a9445=0x3),{'elementType':ElementType[_0x5d2e7f(0xde)],'elementId':'','faceElement':{'faceIndex':_0x3dc860,'faceType':_0x2a9445,'faceText':_0x254b41[_0x5d2e7f(0xb6)],'stickerId':_0x254b41[_0x5d2e7f(0xe3)],'stickerType':_0x254b41[_0x5d2e7f(0xa7)],'packId':_0x254b41['AniStickerPackId'],'sourceType':0x1}};}static[_0xd174d8(0xd8)](_0xa34714,_0x26d8ae,_0x584b9f,_0x516aab){const _0x18b444=_0xd174d8,_0x104652={'icOhU':_0x18b444(0xe5)};return{'elementType':ElementType[_0x18b444(0xc5)],'marketFaceElement':{'emojiPackageId':_0xa34714,'emojiId':_0x26d8ae,'key':_0x584b9f,'faceName':_0x516aab||mFaceCache['get'](_0x26d8ae)||_0x104652[_0x18b444(0xa4)]}};}static[_0xd174d8(0xdb)](_0x1c1dcb){const _0x3e44a5=_0xd174d8,_0x50f97b={'hwRFC':_0x3e44a5(0x9c)};return{'elementType':ElementType[_0x3e44a5(0xde)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':_0x50f97b[_0x3e44a5(0xd7)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0xd174d8(0xa2)](_0x400895){const _0x46e31a=_0xd174d8,_0xc3192d={'BsLhv':_0x46e31a(0xac)};return{'elementType':ElementType[_0x46e31a(0xde)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x46e31a(0xc1)],'faceText':_0xc3192d[_0x46e31a(0xed)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x746e45){const _0x22d5bc=_0xd174d8,_0xb93702={'TOkXF':function(_0x1822c4,_0x46b331){return _0x1822c4!==_0x46b331;}};return _0xb93702['TOkXF'](typeof _0x746e45,_0x22d5bc(0xa8))&&(_0x746e45=JSON[_0x22d5bc(0xe0)](_0x746e45)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x746e45,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x2e48e5){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x2e48e5}};}static async['miniapp'](){const _0x1db52d=_0xd174d8,_0x2aba2a={'dMmfP':function(_0x5efd39,_0xf5f847){return _0x5efd39(_0xf5f847);},'iOGUy':'Bot\x20Test','tgrpX':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','TBBvE':_0x1db52d(0xf1)};let _0x48a16e=await _0x2aba2a[_0x1db52d(0xef)](SignMiniApp,{'prompt':_0x2aba2a[_0x1db52d(0xcd)],'title':_0x1db52d(0xb0),'preview':_0x2aba2a[_0x1db52d(0xd9)],'jumpUrl':_0x2aba2a[_0x1db52d(0xdc)],'tag':_0x2aba2a['iOGUy'],'tagIcon':_0x1db52d(0x9f),'source':_0x2aba2a[_0x1db52d(0xcd)],'sourcelogo':_0x1db52d(0x9f)});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x48a16e,'linkInfo':null,'subElementType':null}};}}