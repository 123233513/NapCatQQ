const _0x403a4b=_0x6cee;function _0x6cee(_0x4805bc,_0x405ff7){const _0x4e5f7d=_0x4e5f();return _0x6cee=function(_0x6ceedf,_0x55fae9){_0x6ceedf=_0x6ceedf-0x89;let _0x4d9905=_0x4e5f7d[_0x6ceedf];return _0x4d9905;},_0x6cee(_0x4805bc,_0x405ff7);}(function(_0x1a0407,_0x5a0542){const _0x5c7fe5=_0x6cee,_0x2c4016=_0x1a0407();while(!![]){try{const _0x4bbb9b=parseInt(_0x5c7fe5(0x8f))/0x1+-parseInt(_0x5c7fe5(0xa7))/0x2*(parseInt(_0x5c7fe5(0xb5))/0x3)+parseInt(_0x5c7fe5(0xd5))/0x4+-parseInt(_0x5c7fe5(0xc1))/0x5*(parseInt(_0x5c7fe5(0x8d))/0x6)+parseInt(_0x5c7fe5(0x98))/0x7+parseInt(_0x5c7fe5(0x91))/0x8+-parseInt(_0x5c7fe5(0xd1))/0x9;if(_0x4bbb9b===_0x5a0542)break;else _0x2c4016['push'](_0x2c4016['shift']());}catch(_0xb90ae8){_0x2c4016['push'](_0x2c4016['shift']());}}}(_0x4e5f,0xc59ca));function _0x4e5f(){const _0x34f07f=['face','oqjOK','bxrcq','ark','then','TzmQn','6996206PzEvIV','get','FACE','VlrFR','writeFile','stat','width','fgCJB','YijdE','mp4','视频信息','JDXfz','time','[骰子]','text','2610268fcwVBj','getImageSize','oPJKV','awBph','vKufx','sgjbb','nlTcH','cwFJU','zZjNt','Thumb','wxXlZ','EjfnV','copyFile','rRSIp','3AFUWcM','PkEEF','PIC','string','sep','gKRJF','ptt','set','normal2','unlink','markdown','_0.png','15uBmzeP','MARKDOWN','Ori','toString','ARK','获取视频信息失败','ERWSm','RPS','replace','height','notAt','uploadFile','stringify','DUvzK','gif','screenshots','12513348ilZZTz','图片信息','语音转换失败,\x20请检查语音文件是否正常','jpg','6197744KYaIDu','[商城表情]','dice','size','VIDEO','bHzxN','EidRh','MKoGB','PTT','catch','2220198vQNglp','TEXT','1016303kBahYj','文件异常，大小为0','8398608iTJxef'];_0x4e5f=function(){return _0x34f07f;};return _0x4e5f();}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x4755ee}from'node:fs';import _0x5ef4ff from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x403a4b(0xa6)](_0xfe11a7){const _0x206902=_0x403a4b;return{'elementType':ElementType[_0x206902(0x8e)],'elementId':'','textElement':{'content':_0xfe11a7,'atType':AtType[_0x206902(0xcb)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0xac4130,_0x369b81,_0x3b431b,_0x36bcc2){const _0x4669c5=_0x403a4b;return{'elementType':ElementType[_0x4669c5(0x8e)],'elementId':'','textElement':{'content':'@'+_0x36bcc2,'atType':_0x3b431b,'atUid':_0xac4130,'atTinyId':'','atNtUid':_0x369b81}};}static['reply'](_0xe90a81,_0x3c525d,_0x416e4f,_0x790fa){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0xe90a81,'replayMsgId':_0x3c525d,'senderUin':_0x416e4f,'senderUinStr':_0x790fa}};}static async['pic'](_0x5c75ad,_0x5bf1fb='',_0x447ecb=0x0){const _0x5763e1=_0x403a4b,_0x53af61={'EjfnV':function(_0x5df065,_0x4d6c99){return _0x5df065===_0x4d6c99;},'nlTcH':_0x5763e1(0x90),'SioSm':function(_0x118cb6,_0xeaf03){return _0x118cb6(_0xeaf03);},'uWGhc':function(_0x1b8d98,_0x11749e,_0x2dd813){return _0x1b8d98(_0x11749e,_0x2dd813);}},{md5:_0x54a86a,fileName:_0x5c7043,path:_0x549cdd,fileSize:_0x5b9670}=await NTQQFileApi[_0x5763e1(0xcc)](_0x5c75ad,ElementType[_0x5763e1(0xb7)],_0x447ecb);if(_0x53af61[_0x5763e1(0xb2)](_0x5b9670,0x0))throw _0x53af61[_0x5763e1(0xad)];const _0xd59df4=await NTQQFileApi[_0x5763e1(0xa8)](_0x5c75ad),_0x559323={'md5HexStr':_0x54a86a,'fileSize':_0x5b9670[_0x5763e1(0xc4)](),'picWidth':_0xd59df4?.[_0x5763e1(0x9e)],'picHeight':_0xd59df4?.['height'],'fileName':_0x5c7043,'sourcePath':_0x549cdd,'original':!![],'picType':_0x53af61['SioSm'](isGIF,_0x5c75ad)?PicType[_0x5763e1(0xcf)]:PicType[_0x5763e1(0xd4)],'picSubType':_0x447ecb,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5bf1fb};return _0x53af61['uWGhc'](logDebug,_0x5763e1(0xd2),_0x559323),{'elementType':ElementType[_0x5763e1(0xb7)],'elementId':'','picElement':_0x559323};}static async['file'](_0x235b53,_0x4f6abb=''){const _0x1282a5=_0x403a4b,_0x4d32e9={'YijdE':function(_0x5dba7a,_0x15d6df){return _0x5dba7a===_0x15d6df;},'QXBWy':function(_0x6edfea,_0x957179){return _0x6edfea||_0x957179;}},{md5:_0x4c3195,fileName:_0x557377,path:_0x258d07,fileSize:_0x26dcb3}=await NTQQFileApi[_0x1282a5(0xcc)](_0x235b53,ElementType['FILE']);if(_0x4d32e9[_0x1282a5(0xa0)](_0x26dcb3,0x0))throw _0x1282a5(0x90);const _0x94e23d={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x4d32e9['QXBWy'](_0x4f6abb,_0x557377),'filePath':_0x258d07,'fileSize':_0x26dcb3[_0x1282a5(0xc4)]()}};return _0x94e23d;}static async['video'](_0x5414df,_0x53aaf1='',_0x17064b=''){const _0x5ce81a=_0x403a4b,_0x1528e9={'iWFqO':function(_0xbb362c,_0x584785,_0xb3b9f3){return _0xbb362c(_0x584785,_0xb3b9f3);},'awBph':'获取视频封面失败，使用默认封面','fgCJB':function(_0x2eb672,_0x342073){return _0x2eb672(_0x342073);},'JJMId':'end','TzmQn':'error','ERWSm':function(_0x29dc72,_0x4b99c7){return _0x29dc72+_0x4b99c7;},'sgjbb':function(_0x438b75,_0x5adc97){return _0x438b75===_0x5adc97;},'gKRJF':'文件异常，大小为0','DUvzK':'path','vKufx':_0x5ce81a(0xa1),'rRSIp':function(_0x160534,_0x236bc4){return _0x160534(_0x236bc4);},'cwFJU':function(_0x463178,_0xb8ea23,_0x3fb6a0){return _0x463178(_0xb8ea23,_0x3fb6a0);},'PkEEF':_0x5ce81a(0xa2),'QqyAj':_0x5ce81a(0xc6),'VlrFR':function(_0x46b915,_0x5424e5){return _0x46b915||_0x5424e5;}},{fileName:_0xba03c7,path:_0x3a5a05,fileSize:_0x149410,md5:_0x14629d}=await NTQQFileApi['uploadFile'](_0x5414df,ElementType[_0x5ce81a(0xd9)]);if(_0x1528e9[_0x5ce81a(0xac)](_0x149410,0x0))throw _0x1528e9[_0x5ce81a(0xba)];const _0x3194b0=_0x1528e9[_0x5ce81a(0x9f)](require,_0x1528e9[_0x5ce81a(0xce)]);let _0x5b113e=_0x3a5a05[_0x5ce81a(0xc9)](_0x3194b0[_0x5ce81a(0xb9)]+_0x5ce81a(0xc3)+_0x3194b0[_0x5ce81a(0xb9)],_0x3194b0[_0x5ce81a(0xb9)]+_0x5ce81a(0xb0)+_0x3194b0['sep']);_0x5b113e=_0x3194b0['dirname'](_0x5b113e);let _0x4ff29f={'width':0x780,'height':0x438,'time':0xf,'format':_0x1528e9[_0x5ce81a(0xab)],'size':_0x149410,'filePath':_0x5414df};try{_0x4ff29f=await _0x1528e9[_0x5ce81a(0xb4)](getVideoInfo,_0x3a5a05),_0x1528e9[_0x5ce81a(0xae)](logDebug,_0x1528e9[_0x5ce81a(0xb6)],_0x4ff29f);}catch(_0x408ab6){logError(_0x1528e9['QqyAj'],_0x408ab6);}const _0x3d852e=new Promise((_0x2f675d,_0x412e93)=>{const _0x4041c9=_0x5ce81a,_0xea6249={'JDXfz':function(_0x1a3f43,_0x1058df){return _0x1a3f43(_0x1058df);}},_0x4a3a3f=_0x14629d+_0x4041c9(0xc0),_0x549a8f=_0x3194b0['join'](_0x5b113e,_0x4a3a3f);_0x1528e9[_0x4041c9(0x9f)](_0x5ef4ff,_0x5414df)['on'](_0x1528e9['JJMId'],()=>{})['on'](_0x1528e9[_0x4041c9(0x97)],_0x216055=>{const _0x4a7049=_0x4041c9;_0x1528e9['iWFqO'](logDebug,_0x1528e9[_0x4a7049(0xaa)],_0x216055),_0x17064b?_0x4755ee[_0x4a7049(0xb3)](_0x17064b,_0x549a8f)[_0x4a7049(0x96)](()=>{_0x2f675d(_0x549a8f);})[_0x4a7049(0x8c)](_0x412e93):_0x4755ee[_0x4a7049(0x9c)](_0x549a8f,defaultVideoThumb)[_0x4a7049(0x96)](()=>{const _0x4ac34d=_0x4a7049;_0xea6249[_0x4ac34d(0xa3)](_0x2f675d,_0x549a8f);})[_0x4a7049(0x8c)](_0x412e93);})[_0x4041c9(0xd0)]({'timestamps':[0x0],'filename':_0x4a3a3f,'folder':_0x5b113e,'size':_0x1528e9[_0x4041c9(0xc7)](_0x1528e9[_0x4041c9(0xc7)](_0x4ff29f[_0x4041c9(0x9e)],'x'),_0x4ff29f[_0x4041c9(0xca)])})['on'](_0x1528e9['JJMId'],()=>{_0x1528e9['fgCJB'](_0x2f675d,_0x549a8f);});}),_0x3562c5=new Map(),_0x499e51=await _0x3d852e,_0x1073fd=(await _0x4755ee[_0x5ce81a(0x9d)](_0x499e51))[_0x5ce81a(0xd8)];_0x3562c5[_0x5ce81a(0xbc)](0x0,_0x499e51);const _0x1d0df3=await calculateFileMD5(_0x499e51),_0x4ec38a={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x1528e9[_0x5ce81a(0x9b)](_0x53aaf1,_0xba03c7),'filePath':_0x3a5a05,'videoMd5':_0x14629d,'thumbMd5':_0x1d0df3,'fileTime':_0x4ff29f[_0x5ce81a(0xa4)],'thumbPath':_0x3562c5,'thumbSize':_0x1073fd,'thumbWidth':_0x4ff29f[_0x5ce81a(0x9e)],'thumbHeight':_0x4ff29f[_0x5ce81a(0xca)],'fileSize':_0x1528e9[_0x5ce81a(0xc7)]('',_0x149410)}};return _0x4ec38a;}static async[_0x403a4b(0xbb)](_0x5e1fef){const _0x4e4d29=_0x403a4b,_0x5a4352={'zZjNt':function(_0x282f48,_0x41b3f9){return _0x282f48(_0x41b3f9);},'MKoGB':_0x4e4d29(0xd3),'bHzxN':function(_0x5b2091,_0xa15f1d){return _0x5b2091===_0xa15f1d;},'IzkNa':function(_0x44b117,_0x42086e){return _0x44b117||_0x42086e;}},{converted:_0x52760f,path:_0x26898c,duration:_0x4349f3}=await _0x5a4352[_0x4e4d29(0xaf)](encodeSilk,_0x5e1fef);if(!_0x26898c)throw _0x5a4352[_0x4e4d29(0x8a)];const {md5:_0x19fab3,fileName:_0x22bc85,path:_0x29735f,fileSize:_0x4db942}=await NTQQFileApi[_0x4e4d29(0xcc)](_0x26898c,ElementType[_0x4e4d29(0x8b)]);if(_0x5a4352[_0x4e4d29(0xda)](_0x4db942,0x0))throw _0x4e4d29(0x90);return _0x52760f&&_0x4755ee[_0x4e4d29(0xbe)](_0x26898c)['then'](),{'elementType':ElementType[_0x4e4d29(0x8b)],'elementId':'','pttElement':{'fileName':_0x22bc85,'filePath':_0x29735f,'md5HexStr':_0x19fab3,'fileSize':_0x4db942,'duration':_0x5a4352['IzkNa'](_0x4349f3,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x403a4b(0x92)](_0x2b9e4d){const _0x5287b9=_0x403a4b,_0x445513={'EidRh':function(_0x5c4d09,_0xdc8f99){return _0x5c4d09<_0xdc8f99;}};return{'elementType':ElementType[_0x5287b9(0x9a)],'elementId':'','faceElement':{'faceIndex':_0x2b9e4d,'faceType':_0x445513[_0x5287b9(0x89)](_0x2b9e4d,0xde)?FaceType['normal']:FaceType[_0x5287b9(0xbd)]}};}static['mface'](_0xb3be07,_0x3a4f90,_0x4c69a9,_0x40beeb){const _0x3df575=_0x403a4b,_0x13e8d8={'wxXlZ':_0x3df575(0xd6)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0xb3be07,'emojiId':_0x3a4f90,'key':_0x4c69a9,'faceName':_0x40beeb||mFaceCache[_0x3df575(0x99)](_0x3a4f90)||_0x13e8d8[_0x3df575(0xb1)]}};}static['dice'](_0x1ee5e7){const _0x1c3970=_0x403a4b,_0x544e10={'GekiT':_0x1c3970(0xa5)};return{'elementType':ElementType[_0x1c3970(0x9a)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1c3970(0xd7)],'faceType':FaceType['dice'],'faceText':_0x544e10['GekiT'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x4373f9){const _0x3eaa73=_0x403a4b,_0x3f52f9={'oPJKV':'[包剪锤]'};return{'elementType':ElementType[_0x3eaa73(0x9a)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x3eaa73(0xc8)],'faceText':_0x3f52f9[_0x3eaa73(0xa9)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x403a4b(0x95)](_0x30e22){const _0x562c4c=_0x403a4b,_0x33456c={'bxrcq':function(_0x55a813,_0x310c8a){return _0x55a813!==_0x310c8a;},'oqjOK':_0x562c4c(0xb8)};return _0x33456c[_0x562c4c(0x94)](typeof _0x30e22,_0x33456c[_0x562c4c(0x93)])&&(_0x30e22=JSON[_0x562c4c(0xcd)](_0x30e22)),{'elementType':ElementType[_0x562c4c(0xc5)],'elementId':'','arkElement':{'bytesData':_0x30e22,'linkInfo':null,'subElementType':null}};}static[_0x403a4b(0xbf)](_0x3ae002){const _0x22d9ce=_0x403a4b;return{'elementType':ElementType[_0x22d9ce(0xc2)],'elementId':'','markdownElement':{'content':_0x3ae002}};}}