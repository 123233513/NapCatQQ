const _0x4739a8=_0x17d5;(function(_0x1a1c8e,_0xa9e3fd){const _0x3255df=_0x17d5,_0x3adac6=_0x1a1c8e();while(!![]){try{const _0xfcf3=parseInt(_0x3255df(0xaf))/0x1+-parseInt(_0x3255df(0xa5))/0x2+-parseInt(_0x3255df(0x8c))/0x3+-parseInt(_0x3255df(0xa3))/0x4*(parseInt(_0x3255df(0x99))/0x5)+-parseInt(_0x3255df(0x7c))/0x6+parseInt(_0x3255df(0x97))/0x7*(-parseInt(_0x3255df(0x72))/0x8)+-parseInt(_0x3255df(0x7f))/0x9*(-parseInt(_0x3255df(0xab))/0xa);if(_0xfcf3===_0xa9e3fd)break;else _0x3adac6['push'](_0x3adac6['shift']());}catch(_0xe5ad81){_0x3adac6['push'](_0x3adac6['shift']());}}}(_0x110a,0x815df));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';function _0x110a(){const _0xfe3979=['KANml','4248AmEopV','gif','uploadFile','catch','REvxR','MHuqb','text','PSscf','HkFhn','[骰子]','dfFaY','PIC','ezDPv','1664094DZmQUm','ark','yXOcp','Thumb','writeFile','size','screenshots','feJCk','FILE','jpg','ptt','4607771vzbOVm','path','115oaitzq','join','MVzBh','markdown','file','dirname','FACE','图片信息','BKEIC','string','151516CCsOeX','语音转换失败,\x20请检查语音文件是否正常','573260GuHuUn','gQIIw','zemsn','face','MARKDOWN','文件异常，大小为0','74990dSZJIE','toString','getImageSize','height','52096qaZtbC','stat','replace','width','then','rps','[商城表情]','dice','gKMvf','DjsDt','_0.png','REPLY','kaXwA','sep','WieQU','notAt','8oFkMGU','RPS','IZAza','PTT','VIDEO','pic','normal2','TEXT','iPdUJ','JiveN','4145634flhKCB','video'];_0x110a=function(){return _0xfe3979;};return _0x110a();}import{promises as _0x35c404}from'node:fs';import _0x49a3b7 from'fluent-ffmpeg';function _0x17d5(_0x9b167,_0x2dbad8){const _0x110a47=_0x110a();return _0x17d5=function(_0x17d582,_0x4eddc6){_0x17d582=_0x17d582-0x66;let _0x3f48ac=_0x110a47[_0x17d582];return _0x3f48ac;},_0x17d5(_0x9b167,_0x2dbad8);}import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x4739a8(0x85)](_0x2dfc8e){const _0x184ee4=_0x4739a8;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x2dfc8e,'atType':AtType[_0x184ee4(0x71)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0xb123ce,_0x2f8c5c,_0x1d2f96,_0x4c7dcf){const _0x2d7948=_0x4739a8;return{'elementType':ElementType[_0x2d7948(0x79)],'elementId':'','textElement':{'content':'@'+_0x4c7dcf,'atType':_0x1d2f96,'atUid':_0xb123ce,'atTinyId':'','atNtUid':_0x2f8c5c}};}static['reply'](_0x38465a,_0x753e1,_0x5650d1,_0x17faa9){const _0xebe011=_0x4739a8;return{'elementType':ElementType[_0xebe011(0x6d)],'elementId':'','replyElement':{'replayMsgSeq':_0x38465a,'replayMsgId':_0x753e1,'senderUin':_0x5650d1,'senderUinStr':_0x17faa9}};}static async[_0x4739a8(0x77)](_0x3d7fba,_0x5839e8='',_0x21eaf6=0x0){const _0x5cf41a=_0x4739a8,_0x12fb61={'dfFaY':_0x5cf41a(0xaa),'PSscf':function(_0x2e3ab7,_0x3a1dc6,_0x1d08af){return _0x2e3ab7(_0x3a1dc6,_0x1d08af);},'snWbz':_0x5cf41a(0xa0)},{md5:_0x199363,fileName:_0x165216,path:_0x1915b8,fileSize:_0x434121}=await NTQQFileApi[_0x5cf41a(0x81)](_0x3d7fba,ElementType[_0x5cf41a(0x8a)],_0x21eaf6);if(_0x434121===0x0)throw _0x12fb61[_0x5cf41a(0x89)];const _0x21215b=await NTQQFileApi[_0x5cf41a(0xad)](_0x3d7fba),_0x1f9c9b={'md5HexStr':_0x199363,'fileSize':_0x434121['toString'](),'picWidth':_0x21215b?.[_0x5cf41a(0xb2)],'picHeight':_0x21215b?.[_0x5cf41a(0xae)],'fileName':_0x165216,'sourcePath':_0x1915b8,'original':!![],'picType':isGIF(_0x3d7fba)?PicType[_0x5cf41a(0x80)]:PicType[_0x5cf41a(0x95)],'picSubType':_0x21eaf6,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5839e8};return _0x12fb61[_0x5cf41a(0x86)](logDebug,_0x12fb61['snWbz'],_0x1f9c9b),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x1f9c9b};}static async[_0x4739a8(0x9d)](_0x2719db,_0x3cb17e=''){const _0x47ce31=_0x4739a8,_0x3b9713={'REvxR':function(_0x479cb7,_0x102aa9){return _0x479cb7===_0x102aa9;},'KANml':_0x47ce31(0xaa),'BKEIC':function(_0x5c169e,_0x10f541){return _0x5c169e||_0x10f541;}},{md5:_0x306624,fileName:_0x19f0d6,path:_0x5265d2,fileSize:_0x190543}=await NTQQFileApi['uploadFile'](_0x2719db,ElementType[_0x47ce31(0x94)]);if(_0x3b9713[_0x47ce31(0x83)](_0x190543,0x0))throw _0x3b9713[_0x47ce31(0x7e)];const _0x58556d={'elementType':ElementType[_0x47ce31(0x94)],'elementId':'','fileElement':{'fileName':_0x3b9713[_0x47ce31(0xa1)](_0x3cb17e,_0x19f0d6),'filePath':_0x5265d2,'fileSize':_0x190543[_0x47ce31(0xac)]()}};return _0x58556d;}static async[_0x4739a8(0x7d)](_0x10f44c,_0x3995e7='',_0x495fed=''){const _0x5185a2=_0x4739a8,_0x44283a={'kaXwA':function(_0x38c680,_0x567126){return _0x38c680(_0x567126);},'feJCk':'获取视频封面失败，使用默认封面','HkFhn':function(_0x1d2ca3,_0x45c686){return _0x1d2ca3(_0x45c686);},'KrHsN':function(_0x4ed10a,_0x2f6c88){return _0x4ed10a(_0x2f6c88);},'zemsn':'end','iPdUJ':function(_0x454152,_0x305e04){return _0x454152+_0x305e04;},'MHuqb':function(_0x132ac6,_0x38534e){return _0x132ac6===_0x38534e;},'JiveN':function(_0xa4c1df,_0x172b95){return _0xa4c1df(_0x172b95);},'gQIIw':_0x5185a2(0x98),'IZAza':'mp4','MVzBh':function(_0x3645d4,_0x39ccbc){return _0x3645d4(_0x39ccbc);},'DjsDt':function(_0x2e9c02,_0x42c033,_0x417fc5){return _0x2e9c02(_0x42c033,_0x417fc5);},'WieQU':'视频信息','rpjKE':function(_0x5a6037,_0x30569c,_0x596a46){return _0x5a6037(_0x30569c,_0x596a46);},'zuNcW':function(_0x55f8b1,_0x2f87ac){return _0x55f8b1||_0x2f87ac;}},{fileName:_0x582cb0,path:_0x561b3a,fileSize:_0x4663b5,md5:_0x16aebb}=await NTQQFileApi['uploadFile'](_0x10f44c,ElementType[_0x5185a2(0x76)]);if(_0x44283a[_0x5185a2(0x84)](_0x4663b5,0x0))throw _0x5185a2(0xaa);const _0x536987=_0x44283a[_0x5185a2(0x7b)](require,_0x44283a[_0x5185a2(0xa6)]);let _0x4c514a=_0x561b3a[_0x5185a2(0xb1)](_0x536987['sep']+'Ori'+_0x536987[_0x5185a2(0x6f)],_0x536987[_0x5185a2(0x6f)]+_0x5185a2(0x8f)+_0x536987[_0x5185a2(0x6f)]);_0x4c514a=_0x536987[_0x5185a2(0x9e)](_0x4c514a);let _0x2b84c1={'width':0x780,'height':0x438,'time':0xf,'format':_0x44283a[_0x5185a2(0x74)],'size':_0x4663b5,'filePath':_0x10f44c};try{_0x2b84c1=await _0x44283a[_0x5185a2(0x9b)](getVideoInfo,_0x561b3a),_0x44283a[_0x5185a2(0x6b)](logDebug,_0x44283a[_0x5185a2(0x70)],_0x2b84c1);}catch(_0xabe243){_0x44283a['rpjKE'](logError,'获取视频信息失败',_0xabe243);}const _0x7f833c=new Promise((_0x34300b,_0xaab222)=>{const _0x1de106=_0x5185a2,_0x17c6b8={'gKMvf':function(_0x268738,_0x1bf457){const _0xf4018=_0x17d5;return _0x44283a[_0xf4018(0x6e)](_0x268738,_0x1bf457);}},_0x31b162=_0x16aebb+_0x1de106(0x6c),_0xbb15f4=_0x536987[_0x1de106(0x9a)](_0x4c514a,_0x31b162);_0x44283a['KrHsN'](_0x49a3b7,_0x10f44c)['on'](_0x44283a[_0x1de106(0xa7)],()=>{})['on']('error',_0x40a3e5=>{const _0x40a6dd=_0x1de106,_0x178e29={'ezDPv':function(_0x22cad9,_0x4fd894){return _0x44283a['kaXwA'](_0x22cad9,_0x4fd894);}};logDebug(_0x44283a[_0x40a6dd(0x93)],_0x40a3e5),_0x495fed?_0x35c404['copyFile'](_0x495fed,_0xbb15f4)['then'](()=>{const _0x4cccb3=_0x40a6dd;_0x17c6b8[_0x4cccb3(0x6a)](_0x34300b,_0xbb15f4);})[_0x40a6dd(0x82)](_0xaab222):_0x35c404[_0x40a6dd(0x90)](_0xbb15f4,defaultVideoThumb)[_0x40a6dd(0x66)](()=>{const _0x572fff=_0x40a6dd;_0x178e29[_0x572fff(0x8b)](_0x34300b,_0xbb15f4);})[_0x40a6dd(0x82)](_0xaab222);})[_0x1de106(0x92)]({'timestamps':[0x0],'filename':_0x31b162,'folder':_0x4c514a,'size':_0x44283a['iPdUJ'](_0x44283a[_0x1de106(0x7a)](_0x2b84c1[_0x1de106(0xb2)],'x'),_0x2b84c1[_0x1de106(0xae)])})['on'](_0x44283a[_0x1de106(0xa7)],()=>{const _0x592f50=_0x1de106;_0x44283a[_0x592f50(0x87)](_0x34300b,_0xbb15f4);});}),_0x5d8d8c=new Map(),_0x55675c=await _0x7f833c,_0x312c01=(await _0x35c404[_0x5185a2(0xb0)](_0x55675c))[_0x5185a2(0x91)];_0x5d8d8c['set'](0x0,_0x55675c);const _0x269f6d=await _0x44283a[_0x5185a2(0x87)](calculateFileMD5,_0x55675c),_0x5ceed7={'elementType':ElementType[_0x5185a2(0x76)],'elementId':'','videoElement':{'fileName':_0x44283a['zuNcW'](_0x3995e7,_0x582cb0),'filePath':_0x561b3a,'videoMd5':_0x16aebb,'thumbMd5':_0x269f6d,'fileTime':_0x2b84c1['time'],'thumbPath':_0x5d8d8c,'thumbSize':_0x312c01,'thumbWidth':_0x2b84c1[_0x5185a2(0xb2)],'thumbHeight':_0x2b84c1['height'],'fileSize':_0x44283a[_0x5185a2(0x7a)]('',_0x4663b5)}};return _0x5ceed7;}static async[_0x4739a8(0x96)](_0x133557){const _0x2d3c98=_0x4739a8,_0x475e80={'JfldM':function(_0x2767e2,_0x76eaf){return _0x2767e2(_0x76eaf);},'UaWrY':_0x2d3c98(0xa4),'UAzxy':function(_0x49575e,_0x1dd8c9){return _0x49575e===_0x1dd8c9;},'RvUAS':function(_0x18018b,_0x1ce82e){return _0x18018b||_0x1ce82e;}},{converted:_0x3bc655,path:_0x3af06f,duration:_0x46cd5e}=await _0x475e80['JfldM'](encodeSilk,_0x133557);if(!_0x3af06f)throw _0x475e80['UaWrY'];const {md5:_0x3daa94,fileName:_0x5ad1d4,path:_0x114b82,fileSize:_0x13078a}=await NTQQFileApi['uploadFile'](_0x3af06f,ElementType['PTT']);if(_0x475e80['UAzxy'](_0x13078a,0x0))throw'文件异常，大小为0';return _0x3bc655&&_0x35c404['unlink'](_0x3af06f)[_0x2d3c98(0x66)](),{'elementType':ElementType[_0x2d3c98(0x75)],'elementId':'','pttElement':{'fileName':_0x5ad1d4,'filePath':_0x114b82,'md5HexStr':_0x3daa94,'fileSize':_0x13078a,'duration':_0x475e80['RvUAS'](_0x46cd5e,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4739a8(0xa8)](_0x5afbd9){const _0x1ae383=_0x4739a8;return{'elementType':ElementType[_0x1ae383(0x9f)],'elementId':'','faceElement':{'faceIndex':_0x5afbd9,'faceType':_0x5afbd9<0xde?FaceType['normal']:FaceType[_0x1ae383(0x78)]}};}static['mface'](_0x51007f,_0xb67b70,_0x3828fc,_0x45cd68){const _0x277ba7=_0x4739a8,_0x483ca2={'XsqTM':_0x277ba7(0x68)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x51007f,'emojiId':_0xb67b70,'key':_0x3828fc,'faceName':_0x45cd68||mFaceCache['get'](_0xb67b70)||_0x483ca2['XsqTM']}};}static[_0x4739a8(0x69)](_0x727772){const _0x3007fd=_0x4739a8;return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x3007fd(0x69)],'faceText':_0x3007fd(0x88),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4739a8(0x67)](_0x3e0b3a){const _0xaec2e8=_0x4739a8,_0x48d68f={'yXOcp':'[包剪锤]'};return{'elementType':ElementType[_0xaec2e8(0x9f)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0xaec2e8(0x73)],'faceText':_0x48d68f[_0xaec2e8(0x8e)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4739a8(0x8d)](_0x28bee9){const _0x23ec82=_0x4739a8,_0xe1578e={'Fuyiy':function(_0xbb972a,_0x2733fd){return _0xbb972a!==_0x2733fd;}};return _0xe1578e['Fuyiy'](typeof _0x28bee9,_0x23ec82(0xa2))&&(_0x28bee9=JSON['stringify'](_0x28bee9)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x28bee9,'linkInfo':null,'subElementType':null}};}static[_0x4739a8(0x9c)](_0x1e0c14){const _0x4a5ded=_0x4739a8;return{'elementType':ElementType[_0x4a5ded(0xa9)],'elementId':'','markdownElement':{'content':_0x1e0c14}};}}