const _0x2b1e51=_0x53e0;(function(_0x54cf5f,_0x2bfc5f){const _0xd90fc2=_0x53e0,_0x21d1a0=_0x54cf5f();while(!![]){try{const _0x30497e=parseInt(_0xd90fc2(0x1f5))/0x1+-parseInt(_0xd90fc2(0x1f8))/0x2+parseInt(_0xd90fc2(0x1d5))/0x3+-parseInt(_0xd90fc2(0x1e2))/0x4*(-parseInt(_0xd90fc2(0x1ce))/0x5)+-parseInt(_0xd90fc2(0x210))/0x6*(-parseInt(_0xd90fc2(0x1e1))/0x7)+-parseInt(_0xd90fc2(0x1fe))/0x8+-parseInt(_0xd90fc2(0x1de))/0x9;if(_0x30497e===_0x2bfc5f)break;else _0x21d1a0['push'](_0x21d1a0['shift']());}catch(_0x132392){_0x21d1a0['push'](_0x21d1a0['shift']());}}}(_0x2d97,0x64db7));function _0x53e0(_0xe79374,_0x4ee8bb){const _0x2d97f2=_0x2d97();return _0x53e0=function(_0x53e0d0,_0x49a94a){_0x53e0d0=_0x53e0d0-0x1c6;let _0x1624c0=_0x2d97f2[_0x53e0d0];return _0x1624c0;},_0x53e0(_0xe79374,_0x4ee8bb);}function _0x2d97(){const _0x5c6dc7=['iiGdG','face','rpzkw','bckue','uploadFile','end','pic','PTT','DZPfX','Ori','video','sysface','ptt','TEXT','get','ARK','4778694krZtpC','获取视频信息失败','获取视频封面失败，使用默认封面','unlink','文件异常，大小为0','time','join','RPS','QSid','file','lczrN','toString','getImageSize','then','_0.png','FRRUU','mp4','sep','EbXDX','FILE','reply','stat','VIDEO','writeFile','replace','gif','2980DxAXMV','UfpTW','FACE','RNSNK','XYOOi','Thumb','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','2252472SmiibT','[骰子]','AniStickerPackId','string','ZjPvu','AniStickerType','find','catch','height','19312317nYYdqe','copyFile','[包剪锤]','7EBSTgD','3604iJcDUa','Bot\x20Test','MARKDOWN','width','tLeea','PIC','jpg','stringify','dvRvN','REPLY','rps','tMkcz','MFACE','ZMxlI','screenshots','SMWHQ','dice','jesep','mface','754051VqnvVF','qMlUz','语音转换失败,\x20请检查语音文件是否正常','398418FrSqBe','trlEc','YolIg','size','hzmXc','ZnyyW','641496CNFnwu','markdown'];_0x2d97=function(){return _0x5c6dc7;};return _0x2d97();}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x39151b}from'node:fs';import _0x35f2dd from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x55295e from'./face_config.json';import*as _0x35301f from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x5174ac){const _0x6cbe35=_0x53e0;return{'elementType':ElementType[_0x6cbe35(0x20d)],'elementId':'','textElement':{'content':_0x5174ac,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x88c26,_0x441957,_0x3af8c0,_0x255f3a){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x255f3a,'atType':_0x3af8c0,'atUid':_0x88c26,'atTinyId':'','atNtUid':_0x441957}};}static[_0x2b1e51(0x1c8)](_0x41f691,_0x427b76,_0x21c0b7,_0x47c705){const _0x4dc9f5=_0x2b1e51;return{'elementType':ElementType[_0x4dc9f5(0x1eb)],'elementId':'','replyElement':{'replayMsgSeq':_0x41f691,'replayMsgId':_0x427b76,'senderUin':_0x21c0b7,'senderUinStr':_0x47c705}};}static async[_0x2b1e51(0x206)](_0x4800e0,_0x29497c='',_0x93ff3e=0x0){const _0x5bc5d0=_0x2b1e51,_0x2f98b3={'qQdOF':function(_0x57f00e,_0x511898){return _0x57f00e===_0x511898;},'XYOOi':'文件异常，大小为0','lczrN':function(_0xea791b,_0x49ce32){return _0xea791b(_0x49ce32);}},{md5:_0x3dc29e,fileName:_0x4cc014,path:_0x26cf5d,fileSize:_0x41c8f0}=await NTQQFileApi['uploadFile'](_0x4800e0,ElementType[_0x5bc5d0(0x1e7)],_0x93ff3e);if(_0x2f98b3['qQdOF'](_0x41c8f0,0x0))throw _0x2f98b3[_0x5bc5d0(0x1d2)];const _0x1255ac=await NTQQFileApi[_0x5bc5d0(0x21c)](_0x4800e0),_0x519895={'md5HexStr':_0x3dc29e,'fileSize':_0x41c8f0['toString'](),'picWidth':_0x1255ac?.[_0x5bc5d0(0x1e5)],'picHeight':_0x1255ac?.[_0x5bc5d0(0x1dd)],'fileName':_0x4cc014,'sourcePath':_0x26cf5d,'original':!![],'picType':_0x2f98b3[_0x5bc5d0(0x21a)](isGIF,_0x4800e0)?PicType[_0x5bc5d0(0x1cd)]:PicType[_0x5bc5d0(0x1e8)],'picSubType':_0x93ff3e,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x29497c};return{'elementType':ElementType[_0x5bc5d0(0x1e7)],'elementId':'','picElement':_0x519895};}static async[_0x2b1e51(0x219)](_0x213329,_0x867b01='',_0x1447d0=''){const _0x202c97=_0x2b1e51,_0x190c56={'UfpTW':_0x202c97(0x214),'YaHQZ':function(_0x13453f,_0x48ce45){return _0x13453f||_0x48ce45;}},{md5:_0x1741b8,fileName:_0x15e0e7,path:_0x258e0a,fileSize:_0xeb2522}=await NTQQFileApi[_0x202c97(0x204)](_0x213329,ElementType[_0x202c97(0x1c7)]);if(_0xeb2522===0x0)throw _0x190c56[_0x202c97(0x1cf)];const _0x1db23a={'elementType':ElementType[_0x202c97(0x1c7)],'elementId':'','fileElement':{'fileName':_0x190c56['YaHQZ'](_0x867b01,_0x15e0e7),'folderId':_0x1447d0,'filePath':_0x258e0a,'fileSize':_0xeb2522[_0x202c97(0x21b)]()}};return _0x1db23a;}static async[_0x2b1e51(0x20a)](_0x56112f,_0x3f0dc3='',_0x220bcc=''){const _0x168f7b=_0x2b1e51,_0x586d9a={'EbXDX':function(_0x4fe7ba,_0x3670cc,_0x3ef63e){return _0x4fe7ba(_0x3670cc,_0x3ef63e);},'iiGdG':_0x168f7b(0x212),'tLeea':function(_0x5e2b70,_0x154a85){return _0x5e2b70(_0x154a85);},'rpzkw':'error','IgauL':function(_0x159ad9,_0xbce91f){return _0x159ad9+_0xbce91f;},'SMWHQ':function(_0x37de2c,_0x1bca4b){return _0x37de2c===_0x1bca4b;},'tMkcz':_0x168f7b(0x214),'bckue':_0x168f7b(0x220),'RNSNK':_0x168f7b(0x211),'qMlUz':function(_0x3a111e,_0x3f17ab){return _0x3a111e||_0x3f17ab;}},{fileName:_0x2e469b,path:_0x1003cd,fileSize:_0x4451e2,md5:_0x47a983}=await NTQQFileApi[_0x168f7b(0x204)](_0x56112f,ElementType[_0x168f7b(0x1ca)]);if(_0x586d9a[_0x168f7b(0x1f1)](_0x4451e2,0x0))throw _0x586d9a[_0x168f7b(0x1ed)];let _0x1e315b=_0x1003cd[_0x168f7b(0x1cc)](_0x35301f['sep']+_0x168f7b(0x209)+_0x35301f[_0x168f7b(0x221)],_0x35301f[_0x168f7b(0x221)]+_0x168f7b(0x1d3)+_0x35301f[_0x168f7b(0x221)]);_0x1e315b=_0x35301f['dirname'](_0x1e315b);let _0x382378={'width':0x780,'height':0x438,'time':0xf,'format':_0x586d9a[_0x168f7b(0x203)],'size':_0x4451e2,'filePath':_0x56112f};try{_0x382378=await getVideoInfo(_0x1003cd);}catch(_0x400f4c){logError(_0x586d9a[_0x168f7b(0x1d1)],_0x400f4c);}const _0x2e59d0=new Promise((_0xbdaa95,_0x51ffbe)=>{const _0x38ce28=_0x168f7b,_0x1a67ff={'YolIg':function(_0x47f1ee,_0x3bc04e){const _0x44ed61=_0x53e0;return _0x586d9a[_0x44ed61(0x1e6)](_0x47f1ee,_0x3bc04e);}},_0x439440=_0x47a983+_0x38ce28(0x21e),_0x2b4ed1=_0x35301f[_0x38ce28(0x216)](_0x1e315b,_0x439440);_0x586d9a[_0x38ce28(0x1e6)](_0x35f2dd,_0x56112f)['on']('end',()=>{})['on'](_0x586d9a[_0x38ce28(0x202)],_0x126e54=>{const _0x197d21=_0x38ce28;_0x586d9a[_0x197d21(0x1c6)](logDebug,_0x586d9a[_0x197d21(0x200)],_0x126e54),_0x220bcc?_0x39151b[_0x197d21(0x1df)](_0x220bcc,_0x2b4ed1)[_0x197d21(0x21d)](()=>{const _0x81e3ec=_0x197d21;_0x1a67ff[_0x81e3ec(0x1fa)](_0xbdaa95,_0x2b4ed1);})['catch'](_0x51ffbe):_0x39151b[_0x197d21(0x1cb)](_0x2b4ed1,defaultVideoThumb)[_0x197d21(0x21d)](()=>{_0xbdaa95(_0x2b4ed1);})[_0x197d21(0x1dc)](_0x51ffbe);})[_0x38ce28(0x1f0)]({'timestamps':[0x0],'filename':_0x439440,'folder':_0x1e315b,'size':_0x586d9a['IgauL'](_0x382378[_0x38ce28(0x1e5)],'x')+_0x382378[_0x38ce28(0x1dd)]})['on'](_0x38ce28(0x205),()=>{_0xbdaa95(_0x2b4ed1);});}),_0x1326c4=new Map(),_0x3e0448=await _0x2e59d0,_0x3958a5=(await _0x39151b[_0x168f7b(0x1c9)](_0x3e0448))[_0x168f7b(0x1fb)];_0x1326c4['set'](0x0,_0x3e0448);const _0xac7284=await _0x586d9a[_0x168f7b(0x1e6)](calculateFileMD5,_0x3e0448),_0x2ec9c8={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x586d9a[_0x168f7b(0x1f6)](_0x3f0dc3,_0x2e469b),'filePath':_0x1003cd,'videoMd5':_0x47a983,'thumbMd5':_0xac7284,'fileTime':_0x382378[_0x168f7b(0x215)],'thumbPath':_0x1326c4,'thumbSize':_0x3958a5,'thumbWidth':_0x382378['width'],'thumbHeight':_0x382378[_0x168f7b(0x1dd)],'fileSize':''+_0x4451e2}};return _0x2ec9c8;}static async[_0x2b1e51(0x20c)](_0x14d532){const _0x3765ac=_0x2b1e51,_0x29ba02={'ZjPvu':function(_0x47489d,_0x368818){return _0x47489d(_0x368818);},'afkco':_0x3765ac(0x1f7),'nHGAn':function(_0x5948da,_0xc36f4c){return _0x5948da===_0xc36f4c;},'trlEc':_0x3765ac(0x214),'ZMxlI':function(_0x11392a,_0x297254){return _0x11392a||_0x297254;}},{converted:_0x2f04c4,path:_0x4187f5,duration:_0x115ae6}=await _0x29ba02[_0x3765ac(0x1d9)](encodeSilk,_0x14d532);if(!_0x4187f5)throw _0x29ba02['afkco'];const {md5:_0x40042c,fileName:_0x2703a5,path:_0x2c4d42,fileSize:_0x136dde}=await NTQQFileApi[_0x3765ac(0x204)](_0x4187f5,ElementType[_0x3765ac(0x207)]);if(_0x29ba02['nHGAn'](_0x136dde,0x0))throw _0x29ba02[_0x3765ac(0x1f9)];return _0x2f04c4&&_0x39151b[_0x3765ac(0x213)](_0x4187f5)['then'](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x2703a5,'filePath':_0x2c4d42,'md5HexStr':_0x40042c,'fileSize':_0x136dde,'duration':_0x29ba02[_0x3765ac(0x1ef)](_0x115ae6,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x2b1e51(0x201)](_0x115390){const _0x358570=_0x2b1e51,_0x30c8ac={'dvRvN':function(_0x2154ce,_0x2f1777){return _0x2154ce>=_0x2f1777;}},_0x9255de=_0x55295e[_0x358570(0x20b)],_0x2991d3=_0x55295e['emoji'],_0xe387ab=_0x9255de[_0x358570(0x1db)](_0x290c06=>_0x290c06[_0x358570(0x218)]===_0x115390['toString']());_0x115390=parseInt(_0x115390[_0x358570(0x21b)]());let _0x15c319=0x1;return _0x30c8ac[_0x358570(0x1ea)](_0x115390,0xde)&&(_0x15c319=0x2),_0xe387ab['AniStickerType']&&(_0x15c319=0x3),{'elementType':ElementType[_0x358570(0x1d0)],'elementId':'','faceElement':{'faceIndex':_0x115390,'faceType':_0x15c319,'faceText':_0xe387ab['QDes'],'stickerId':_0xe387ab['AniStickerId'],'stickerType':_0xe387ab[_0x358570(0x1da)],'packId':_0xe387ab[_0x358570(0x1d7)],'sourceType':0x1}};}static[_0x2b1e51(0x1f4)](_0x3e7e83,_0x258046,_0x5801c3,_0x5ec15f){const _0x4c1889=_0x2b1e51,_0x148710={'jesep':'[商城表情]'};return{'elementType':ElementType[_0x4c1889(0x1ee)],'marketFaceElement':{'emojiPackageId':_0x3e7e83,'emojiId':_0x258046,'key':_0x5801c3,'faceName':_0x5ec15f||mFaceCache[_0x4c1889(0x20e)](_0x258046)||_0x148710[_0x4c1889(0x1f3)]}};}static[_0x2b1e51(0x1f2)](_0x1e7a24){const _0x2808ac=_0x2b1e51;return{'elementType':ElementType[_0x2808ac(0x1d0)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x2808ac(0x1f2)],'faceText':_0x2808ac(0x1d6),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2b1e51(0x1ec)](_0x378102){const _0x3518f5=_0x2b1e51,_0x2c6116={'FawxQ':_0x3518f5(0x1e0)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x3518f5(0x217)],'faceText':_0x2c6116['FawxQ'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x2770ca){const _0x34c2d5=_0x2b1e51,_0x4d4d75={'DZPfX':function(_0x546716,_0x3fbfa3){return _0x546716!==_0x3fbfa3;},'FRRUU':_0x34c2d5(0x1d8)};return _0x4d4d75[_0x34c2d5(0x208)](typeof _0x2770ca,_0x4d4d75[_0x34c2d5(0x21f)])&&(_0x2770ca=JSON[_0x34c2d5(0x1e9)](_0x2770ca)),{'elementType':ElementType[_0x34c2d5(0x20f)],'elementId':'','arkElement':{'bytesData':_0x2770ca,'linkInfo':null,'subElementType':null}};}static[_0x2b1e51(0x1ff)](_0x439ed5){const _0x375eed=_0x2b1e51;return{'elementType':ElementType[_0x375eed(0x1e4)],'elementId':'','markdownElement':{'content':_0x439ed5}};}static async['miniapp'](){const _0x39a05a=_0x2b1e51,_0x5b6d2a={'ZnyyW':_0x39a05a(0x1e3),'uqwLI':'https://www.bilibili.com/','hzmXc':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0xf1efd8=await SignMiniApp({'prompt':_0x5b6d2a[_0x39a05a(0x1fd)],'title':_0x39a05a(0x1e3),'preview':_0x39a05a(0x1d4),'jumpUrl':_0x5b6d2a['uqwLI'],'tag':_0x5b6d2a[_0x39a05a(0x1fd)],'tagIcon':_0x5b6d2a['hzmXc'],'source':_0x5b6d2a['ZnyyW'],'sourcelogo':_0x5b6d2a[_0x39a05a(0x1fc)]});return{'elementType':ElementType[_0x39a05a(0x20f)],'elementId':'','arkElement':{'bytesData':_0xf1efd8,'linkInfo':null,'subElementType':null}};}}