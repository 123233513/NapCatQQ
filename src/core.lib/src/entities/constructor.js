const _0x489f3a=_0x2aaa;(function(_0x274000,_0x4673b1){const _0x167f32=_0x2aaa,_0x3c9513=_0x274000();while(!![]){try{const _0x3a4242=parseInt(_0x167f32(0x101))/0x1*(parseInt(_0x167f32(0xe2))/0x2)+-parseInt(_0x167f32(0xe4))/0x3+parseInt(_0x167f32(0xe7))/0x4*(-parseInt(_0x167f32(0xa8))/0x5)+-parseInt(_0x167f32(0xdd))/0x6*(-parseInt(_0x167f32(0x102))/0x7)+-parseInt(_0x167f32(0xd8))/0x8+-parseInt(_0x167f32(0xfd))/0x9*(-parseInt(_0x167f32(0xb1))/0xa)+parseInt(_0x167f32(0xec))/0xb;if(_0x3a4242===_0x4673b1)break;else _0x3c9513['push'](_0x3c9513['shift']());}catch(_0xe0084f){_0x3c9513['push'](_0x3c9513['shift']());}}}(_0x30db,0xe5260));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';function _0x2aaa(_0x3e311b,_0x2e8954){const _0x30dbeb=_0x30db();return _0x2aaa=function(_0x2aaa3f,_0x1ea520){_0x2aaa3f=_0x2aaa3f-0x9d;let _0x4f91c3=_0x30dbeb[_0x2aaa3f];return _0x4f91c3;},_0x2aaa(_0x3e311b,_0x2e8954);}import{promises as _0x28769f}from'node:fs';import _0x31f474 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x2498b9 from'./face_config.json';import*as _0x2421c6 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x489f3a(0xe9)](_0x167d96){const _0x27fae7=_0x489f3a;return{'elementType':ElementType[_0x27fae7(0xd9)],'elementId':'','textElement':{'content':_0x167d96,'atType':AtType[_0x27fae7(0xfc)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x3b632f,_0x592254,_0x5384a7,_0x3cc594){const _0x2c12c5=_0x489f3a;return{'elementType':ElementType[_0x2c12c5(0xd9)],'elementId':'','textElement':{'content':'@'+_0x3cc594,'atType':_0x5384a7,'atUid':_0x3b632f,'atTinyId':'','atNtUid':_0x592254}};}static[_0x489f3a(0xe5)](_0x326e5d,_0x4e7c0e,_0x261b6f,_0x544981){const _0xd2e2a=_0x489f3a;return{'elementType':ElementType[_0xd2e2a(0xd7)],'elementId':'','replyElement':{'replayMsgSeq':_0x326e5d,'replayMsgId':_0x4e7c0e,'senderUin':_0x261b6f,'senderUinStr':_0x544981}};}static async['pic'](_0x2001ff,_0x5b48f0='',_0x28ff98=0x0){const _0x5ab67f=_0x489f3a,_0x551495={'sEkca':_0x5ab67f(0xaa)},{md5:_0xc4ca94,fileName:_0x63576b,path:_0x1302b4,fileSize:_0x11be9b}=await NTQQFileApi[_0x5ab67f(0xe1)](_0x2001ff,ElementType[_0x5ab67f(0xf5)],_0x28ff98);if(_0x11be9b===0x0)throw _0x551495[_0x5ab67f(0xbe)];const _0x4e68f6=await NTQQFileApi[_0x5ab67f(0xc1)](_0x2001ff),_0x3f31bb={'md5HexStr':_0xc4ca94,'fileSize':_0x11be9b[_0x5ab67f(0xa5)](),'picWidth':_0x4e68f6?.[_0x5ab67f(0x100)],'picHeight':_0x4e68f6?.[_0x5ab67f(0xa2)],'fileName':_0x63576b,'sourcePath':_0x1302b4,'original':!![],'picType':isGIF(_0x2001ff)?PicType[_0x5ab67f(0xa6)]:PicType[_0x5ab67f(0xaf)],'picSubType':_0x28ff98,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5b48f0};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x3f31bb};}static async[_0x489f3a(0xd5)](_0x22516a,_0x442ff9='',_0x35b58b=''){const _0x425580=_0x489f3a,_0x2db940={'SXejI':function(_0x50a300,_0x5a4c2a){return _0x50a300===_0x5a4c2a;},'UobJj':_0x425580(0xaa),'jzGuw':function(_0xdcc38,_0xcadbeb){return _0xdcc38||_0xcadbeb;}},{md5:_0xe8bbcc,fileName:_0x2a0363,path:_0x59b754,fileSize:_0x37cec1}=await NTQQFileApi[_0x425580(0xe1)](_0x22516a,ElementType[_0x425580(0xbf)]);if(_0x2db940[_0x425580(0xad)](_0x37cec1,0x0))throw _0x2db940[_0x425580(0xf8)];const _0x241b14={'elementType':ElementType[_0x425580(0xbf)],'elementId':'','fileElement':{'fileName':_0x2db940[_0x425580(0xb7)](_0x442ff9,_0x2a0363),'folderId':_0x35b58b,'filePath':_0x59b754,'fileSize':_0x37cec1[_0x425580(0xa5)]()}};return _0x241b14;}static async[_0x489f3a(0xa3)](_0x525266,_0x2aa272='',_0x2cdbfa=''){const _0x2c03c3=_0x489f3a,_0x1f30da={'pkPYB':function(_0x41f3d8,_0x192d6c){return _0x41f3d8(_0x192d6c);},'IAOlw':function(_0x59504d,_0x3d0609,_0x544847){return _0x59504d(_0x3d0609,_0x544847);},'jmGKM':function(_0xa2939f,_0x9e3710){return _0xa2939f(_0x9e3710);},'cQMwj':_0x2c03c3(0xe8),'bIBkS':_0x2c03c3(0xc6),'hdgXP':function(_0x124b9f,_0x5c691e){return _0x124b9f+_0x5c691e;},'mQiVV':function(_0x4caef7,_0x47601e){return _0x4caef7+_0x47601e;},'vSLNQ':function(_0x29e844,_0x4aab6c){return _0x29e844===_0x4aab6c;},'sVevU':_0x2c03c3(0xaa),'XGDeH':_0x2c03c3(0xcc),'THXCU':function(_0x5c1ecc,_0x358ca3){return _0x5c1ecc(_0x358ca3);},'VkBSp':function(_0x56d251,_0x530c77,_0x339fe4){return _0x56d251(_0x530c77,_0x339fe4);},'oWzxC':_0x2c03c3(0xd6),'LIYUm':function(_0x269e45,_0x28c246){return _0x269e45||_0x28c246;}},{fileName:_0x991af0,path:_0x553d6b,fileSize:_0x3fe676,md5:_0x48f89c}=await NTQQFileApi[_0x2c03c3(0xe1)](_0x525266,ElementType[_0x2c03c3(0xd3)]);if(_0x1f30da[_0x2c03c3(0xfa)](_0x3fe676,0x0))throw _0x1f30da[_0x2c03c3(0xf7)];let _0x2fc4aa=_0x553d6b[_0x2c03c3(0xce)](_0x2421c6[_0x2c03c3(0xb3)]+_0x2c03c3(0xb5)+_0x2421c6[_0x2c03c3(0xb3)],_0x2421c6[_0x2c03c3(0xb3)]+'Thumb'+_0x2421c6[_0x2c03c3(0xb3)]);_0x2fc4aa=_0x2421c6['dirname'](_0x2fc4aa);let _0x28cdc7={'width':0x780,'height':0x438,'time':0xf,'format':_0x1f30da[_0x2c03c3(0xc0)],'size':_0x3fe676,'filePath':_0x525266};try{_0x28cdc7=await _0x1f30da[_0x2c03c3(0xf6)](getVideoInfo,_0x553d6b);}catch(_0x26aa0c){_0x1f30da[_0x2c03c3(0xca)](logError,_0x1f30da[_0x2c03c3(0xb0)],_0x26aa0c);}const _0x5995d7=new Promise((_0x5eda1e,_0xda69a1)=>{const _0x329db2=_0x2c03c3,_0x2a86f9={'oCIEr':function(_0x11abda,_0x24b123){const _0x3da3d4=_0x2aaa;return _0x1f30da[_0x3da3d4(0xc8)](_0x11abda,_0x24b123);}},_0x32f58a=_0x48f89c+_0x329db2(0xe3),_0x212c9b=_0x2421c6[_0x329db2(0xa9)](_0x2fc4aa,_0x32f58a);_0x1f30da[_0x329db2(0xc8)](_0x31f474,_0x525266)['on'](_0x1f30da[_0x329db2(0xba)],()=>{})['on'](_0x1f30da[_0x329db2(0xdb)],_0x345b15=>{const _0x574f6c=_0x329db2,_0x592bfa={'iSFjd':function(_0x142541,_0x1e50a6){return _0x1f30da['pkPYB'](_0x142541,_0x1e50a6);}};_0x1f30da[_0x574f6c(0xe0)](logDebug,_0x574f6c(0xef),_0x345b15),_0x2cdbfa?_0x28769f[_0x574f6c(0xa0)](_0x2cdbfa,_0x212c9b)['then'](()=>{const _0x3948a1=_0x574f6c;_0x592bfa[_0x3948a1(0xc5)](_0x5eda1e,_0x212c9b);})[_0x574f6c(0xb9)](_0xda69a1):_0x28769f[_0x574f6c(0xff)](_0x212c9b,defaultVideoThumb)['then'](()=>{const _0x1f063e=_0x574f6c;_0x592bfa[_0x1f063e(0xc5)](_0x5eda1e,_0x212c9b);})[_0x574f6c(0xb9)](_0xda69a1);})[_0x329db2(0xdf)]({'timestamps':[0x0],'filename':_0x32f58a,'folder':_0x2fc4aa,'size':_0x1f30da['hdgXP'](_0x1f30da[_0x329db2(0xb8)](_0x28cdc7['width'],'x'),_0x28cdc7[_0x329db2(0xa2)])})['on'](_0x1f30da[_0x329db2(0xba)],()=>{const _0x15227c=_0x329db2;_0x2a86f9[_0x15227c(0xf9)](_0x5eda1e,_0x212c9b);});}),_0x655da7=new Map(),_0x577588=await _0x5995d7,_0x4d9362=(await _0x28769f[_0x2c03c3(0xa1)](_0x577588))[_0x2c03c3(0xc3)];_0x655da7[_0x2c03c3(0x103)](0x0,_0x577588);const _0x1bc085=await calculateFileMD5(_0x577588),_0x20cb63={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x1f30da[_0x2c03c3(0xc4)](_0x2aa272,_0x991af0),'filePath':_0x553d6b,'videoMd5':_0x48f89c,'thumbMd5':_0x1bc085,'fileTime':_0x28cdc7[_0x2c03c3(0xab)],'thumbPath':_0x655da7,'thumbSize':_0x4d9362,'thumbWidth':_0x28cdc7[_0x2c03c3(0x100)],'thumbHeight':_0x28cdc7[_0x2c03c3(0xa2)],'fileSize':''+_0x3fe676}};return _0x20cb63;}static async[_0x489f3a(0xcb)](_0x8804a1){const _0x314f3f=_0x489f3a,_0x31bfa7={'DSClR':function(_0x31ffdb,_0x54d2e8){return _0x31ffdb(_0x54d2e8);},'fTPTy':_0x314f3f(0xf1),'GXvDv':function(_0x37b11c,_0x202f5e){return _0x37b11c===_0x202f5e;},'MtInG':_0x314f3f(0xaa)},{converted:_0x2b2216,path:_0x4df898,duration:_0x3bb174}=await _0x31bfa7[_0x314f3f(0xcf)](encodeSilk,_0x8804a1);if(!_0x4df898)throw _0x31bfa7['fTPTy'];const {md5:_0xb958dc,fileName:_0x1908f4,path:_0x42e837,fileSize:_0x197b17}=await NTQQFileApi[_0x314f3f(0xe1)](_0x4df898,ElementType[_0x314f3f(0xa7)]);if(_0x31bfa7[_0x314f3f(0xf3)](_0x197b17,0x0))throw _0x31bfa7[_0x314f3f(0xa4)];return _0x2b2216&&_0x28769f['unlink'](_0x4df898)[_0x314f3f(0xcd)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x1908f4,'filePath':_0x42e837,'md5HexStr':_0xb958dc,'fileSize':_0x197b17,'duration':_0x3bb174||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x489f3a(0xbb)](_0x2b7878){const _0x5a613a=_0x489f3a,_0x442f7b={'PcRzl':function(_0x5e40d4,_0x2e7764){return _0x5e40d4(_0x2e7764);},'rDKyu':function(_0x521656,_0x291db9){return _0x521656>=_0x291db9;}},_0x557ba3=_0x2498b9[_0x5a613a(0xee)],_0x25ac1e=_0x2498b9['emoji'],_0x4095f0=_0x557ba3[_0x5a613a(0xea)](_0x3608a0=>_0x3608a0[_0x5a613a(0xe6)]===_0x2b7878[_0x5a613a(0xa5)]());_0x2b7878=_0x442f7b[_0x5a613a(0xb6)](parseInt,_0x2b7878[_0x5a613a(0xa5)]());let _0x350e5f=0x1;return _0x442f7b[_0x5a613a(0xbd)](_0x2b7878,0xde)&&(_0x350e5f=0x2),_0x4095f0[_0x5a613a(0xc9)]&&(_0x350e5f=0x3),{'elementType':ElementType[_0x5a613a(0xf2)],'elementId':'','faceElement':{'faceIndex':_0x2b7878,'faceType':_0x350e5f,'faceText':_0x4095f0['QDes'],'stickerId':_0x4095f0[_0x5a613a(0xc2)],'stickerType':_0x4095f0['AniStickerType'],'packId':_0x4095f0[_0x5a613a(0xd2)],'sourceType':0x1}};}static['mface'](_0x30e93f,_0x4ab0ac,_0x351196,_0x56b8de){const _0x4c6e69=_0x489f3a,_0x31d54b={'gmLwx':_0x4c6e69(0xed)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x30e93f,'emojiId':_0x4ab0ac,'key':_0x351196,'faceName':_0x56b8de||mFaceCache['get'](_0x4ab0ac)||_0x31d54b['gmLwx']}};}static[_0x489f3a(0x9d)](_0x4da4a3){const _0x45889a=_0x489f3a,_0x52d301={'RTnWc':_0x45889a(0xf0)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x45889a(0x9d)],'faceType':FaceType['dice'],'faceText':_0x52d301[_0x45889a(0x9e)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x489f3a(0xfe)](_0x197295){const _0x303db3=_0x489f3a,_0x4c16a3={'vvaSn':'[包剪锤]'};return{'elementType':ElementType[_0x303db3(0xf2)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x4c16a3['vvaSn'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x1027f6){const _0x5b17c2=_0x489f3a,_0x342ec8={'XCGnr':function(_0x664037,_0x5d3f6f){return _0x664037!==_0x5d3f6f;},'hXBIH':_0x5b17c2(0xd4)};return _0x342ec8['XCGnr'](typeof _0x1027f6,_0x342ec8[_0x5b17c2(0xfb)])&&(_0x1027f6=JSON[_0x5b17c2(0xde)](_0x1027f6)),{'elementType':ElementType[_0x5b17c2(0xac)],'elementId':'','arkElement':{'bytesData':_0x1027f6,'linkInfo':null,'subElementType':null}};}static[_0x489f3a(0x9f)](_0x13ccb2){const _0x116127=_0x489f3a;return{'elementType':ElementType[_0x116127(0xdc)],'elementId':'','markdownElement':{'content':_0x13ccb2}};}static async[_0x489f3a(0xb4)](){const _0x4cac15=_0x489f3a,_0x1a6a90={'cBlPV':function(_0x5d9317,_0x30cbae){return _0x5d9317(_0x30cbae);},'EIMCc':_0x4cac15(0xd1),'qmRwc':_0x4cac15(0xb2),'aSSSH':_0x4cac15(0xbc),'JUfkx':_0x4cac15(0xc7)};let _0x164ad1=await _0x1a6a90[_0x4cac15(0xae)](SignMiniApp,{'prompt':_0x1a6a90[_0x4cac15(0xf4)],'title':_0x4cac15(0xd1),'preview':_0x1a6a90[_0x4cac15(0xda)],'jumpUrl':_0x1a6a90[_0x4cac15(0xeb)],'tag':_0x1a6a90[_0x4cac15(0xf4)],'tagIcon':_0x1a6a90[_0x4cac15(0xd0)],'source':_0x1a6a90['EIMCc'],'sourcelogo':_0x1a6a90[_0x4cac15(0xd0)]});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x164ad1,'linkInfo':null,'subElementType':null}};}}function _0x30db(){const _0x1de806=['133XSIATn','set','dice','RTnWc','markdown','copyFile','stat','height','video','MtInG','toString','gif','PTT','5bRVNFa','join','文件异常，大小为0','time','ARK','SXejI','cBlPV','jpg','oWzxC','10Lsdywg','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','sep','miniapp','Ori','PcRzl','jzGuw','mQiVV','catch','cQMwj','face','https://www.bilibili.com/','rDKyu','sEkca','FILE','XGDeH','getImageSize','AniStickerId','size','LIYUm','iSFjd','error','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','jmGKM','AniStickerType','VkBSp','ptt','mp4','then','replace','DSClR','JUfkx','Bot\x20Test','AniStickerPackId','VIDEO','string','file','获取视频信息失败','REPLY','11848752dFQJWi','TEXT','qmRwc','bIBkS','MARKDOWN','66390pKMRqF','stringify','screenshots','IAOlw','uploadFile','4lrMSam','_0.png','1980879EYeayB','reply','QSid','5091932VjzXWD','end','text','find','aSSSH','22092928oCSwNy','[商城表情]','sysface','获取视频封面失败，使用默认封面','[骰子]','语音转换失败,\x20请检查语音文件是否正常','FACE','GXvDv','EIMCc','PIC','THXCU','sVevU','UobJj','oCIEr','vSLNQ','hXBIH','notAt','5401989ZyVmHq','rps','writeFile','width','767029QRlngI'];_0x30db=function(){return _0x1de806;};return _0x30db();}