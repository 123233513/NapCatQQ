function _0x453f(){const _0x42ddc3=['sysface','TcFDa','face','获取视频封面失败，使用默认封面','tuQVu','TEXT','text','AniStickerType','height','gWfHG','gif','writeFile','tnWpE','find','VIDEO','markdown','hJxRo','mp4','size','PTT','FACE','set','REPLY','iBpwP','then','getImageSize','文件异常，大小为0','DBKpn','Hbicx','tLGYL','fDEtW','Bot\x20Test','932841OirRsy','SJutN','WBWpw','dirname','sWvmr','[商城表情]','sep','stringify','ppfnK','Ori','KZjam','xsvsc','video','catch','ZecZD','9918246MxMrhM','Thumb','517328fKMvvg','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','width','end','4642EZzEtL','screenshots','replace','FXbRi','https://www.bilibili.com/','ark','960qjngYo','ordKh','7811120SfuQfX','string','join','19AwUekn','file','TCzMy','rClBY','[骰子]','dice','pic','PIC','Cxbgy','1985930TrFmaU','mface','emoji','miniapp','91mQvWuM','AniStickerId','QSid','stat','toString','QDes','FILE','获取视频信息失败','MFACE','copyFile','uploadFile','GhCCq','XyKWH','notAt','ptt','3243DqFsJF','ARK','RnoeG','语音转换失败,\x20请检查语音文件是否正常','rLXpf','rps','fqaeo','MARKDOWN'];_0x453f=function(){return _0x42ddc3;};return _0x453f();}const _0x5a12e4=_0x5c12;(function(_0x13cbc5,_0x1b1358){const _0x255049=_0x5c12,_0xa2b68d=_0x13cbc5();while(!![]){try{const _0x1b64e8=-parseInt(_0x255049(0xc6))/0x1*(-parseInt(_0x255049(0xbb))/0x2)+parseInt(_0x255049(0xe2))/0x3*(-parseInt(_0x255049(0xc1))/0x4)+parseInt(_0x255049(0xc3))/0x5+-parseInt(_0x255049(0xb4))/0x6+-parseInt(_0x255049(0xd3))/0x7*(-parseInt(_0x255049(0xb6))/0x8)+parseInt(_0x255049(0xa5))/0x9+parseInt(_0x255049(0xcf))/0xa;if(_0x1b64e8===_0x1b1358)break;else _0xa2b68d['push'](_0xa2b68d['shift']());}catch(_0x59f2b6){_0xa2b68d['push'](_0xa2b68d['shift']());}}}(_0x453f,0xcc486));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';function _0x5c12(_0x42e25b,_0x3f0288){const _0x453fc8=_0x453f();return _0x5c12=function(_0x5c12dc,_0x1588c8){_0x5c12dc=_0x5c12dc-0x98;let _0x286fe3=_0x453fc8[_0x5c12dc];return _0x286fe3;},_0x5c12(_0x42e25b,_0x3f0288);}import{promises as _0x359ba2}from'node:fs';import _0x11320b from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x545460 from'./face_config.json';import*as _0x311ddf from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x5a12e4(0xf0)](_0x3ef49a){const _0x5482d2=_0x5a12e4;return{'elementType':ElementType[_0x5482d2(0xef)],'elementId':'','textElement':{'content':_0x3ef49a,'atType':AtType[_0x5482d2(0xe0)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x36a908,_0x18ee18,_0x5becb4,_0xcd41aa){const _0x5db557=_0x5a12e4;return{'elementType':ElementType[_0x5db557(0xef)],'elementId':'','textElement':{'content':'@'+_0xcd41aa,'atType':_0x5becb4,'atUid':_0x36a908,'atTinyId':'','atNtUid':_0x18ee18}};}static['reply'](_0x82ff1f,_0x30b95a,_0x4a9d90,_0x1d7376){const _0x28d89b=_0x5a12e4;return{'elementType':ElementType[_0x28d89b(0x9b)],'elementId':'','replyElement':{'replayMsgSeq':_0x82ff1f,'replayMsgId':_0x30b95a,'senderUin':_0x4a9d90,'senderUinStr':_0x1d7376}};}static async[_0x5a12e4(0xcc)](_0x1b8f98,_0x5ef649='',_0x39cc9a=0x0){const _0x5b18d5=_0x5a12e4,_0x57ce99={'hJxRo':_0x5b18d5(0x9f)},{md5:_0x4ae8ba,fileName:_0x4a2d73,path:_0x5cd32f,fileSize:_0x16a102}=await NTQQFileApi[_0x5b18d5(0xdd)](_0x1b8f98,ElementType[_0x5b18d5(0xcd)],_0x39cc9a);if(_0x16a102===0x0)throw _0x57ce99[_0x5b18d5(0xfa)];const _0x2f0d7a=await NTQQFileApi[_0x5b18d5(0x9e)](_0x1b8f98),_0x3c5892={'md5HexStr':_0x4ae8ba,'fileSize':_0x16a102[_0x5b18d5(0xd7)](),'picWidth':_0x2f0d7a?.[_0x5b18d5(0xb9)],'picHeight':_0x2f0d7a?.['height'],'fileName':_0x4a2d73,'sourcePath':_0x5cd32f,'original':!![],'picType':isGIF(_0x1b8f98)?PicType[_0x5b18d5(0xf4)]:PicType['jpg'],'picSubType':_0x39cc9a,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5ef649};return{'elementType':ElementType[_0x5b18d5(0xcd)],'elementId':'','picElement':_0x3c5892};}static async[_0x5a12e4(0xc7)](_0x1a3b38,_0xdc34ab='',_0x559f17=''){const _0x416450=_0x5a12e4,_0x51e745={'iBpwP':function(_0x4456b5,_0x7ada49){return _0x4456b5===_0x7ada49;},'ZecZD':'文件异常，大小为0'},{md5:_0x5aefc8,fileName:_0x145cd6,path:_0x3ff682,fileSize:_0x4647ca}=await NTQQFileApi[_0x416450(0xdd)](_0x1a3b38,ElementType['FILE']);if(_0x51e745[_0x416450(0x9c)](_0x4647ca,0x0))throw _0x51e745[_0x416450(0xb3)];const _0x3be241={'elementType':ElementType[_0x416450(0xd9)],'elementId':'','fileElement':{'fileName':_0xdc34ab||_0x145cd6,'folderId':_0x559f17,'filePath':_0x3ff682,'fileSize':_0x4647ca['toString']()}};return _0x3be241;}static async[_0x5a12e4(0xb1)](_0x3f1fe6,_0x848618='',_0x17a472=''){const _0x2684fe=_0x5a12e4,_0xea0df3={'KZjam':function(_0x4feb02,_0x306e0c){return _0x4feb02(_0x306e0c);},'TCzMy':function(_0xfffca3,_0x150a22){return _0xfffca3(_0x150a22);},'ordKh':_0x2684fe(0xba),'Cxbgy':'error','vzLyp':function(_0x5dd18e,_0x2b41be){return _0x5dd18e+_0x2b41be;},'SJutN':function(_0x3c52b5,_0x13c99f){return _0x3c52b5===_0x13c99f;},'TcFDa':_0x2684fe(0x9f),'WBWpw':function(_0x359de3,_0x345975,_0x21d663){return _0x359de3(_0x345975,_0x21d663);},'wJcJN':_0x2684fe(0xda),'FXbRi':function(_0x14b86a,_0x5d4ffc){return _0x14b86a+_0x5d4ffc;}},{fileName:_0x4daf62,path:_0x4e86b1,fileSize:_0x5db5a5,md5:_0xc827ee}=await NTQQFileApi[_0x2684fe(0xdd)](_0x3f1fe6,ElementType[_0x2684fe(0xf8)]);if(_0xea0df3[_0x2684fe(0xa6)](_0x5db5a5,0x0))throw _0xea0df3[_0x2684fe(0xeb)];let _0x35cc3=_0x4e86b1[_0x2684fe(0xbd)](_0x311ddf['sep']+_0x2684fe(0xae)+_0x311ddf['sep'],_0x311ddf[_0x2684fe(0xab)]+_0x2684fe(0xb5)+_0x311ddf[_0x2684fe(0xab)]);_0x35cc3=_0x311ddf[_0x2684fe(0xa8)](_0x35cc3);let _0x3f805e={'width':0x780,'height':0x438,'time':0xf,'format':_0x2684fe(0xfb),'size':_0x5db5a5,'filePath':_0x3f1fe6};try{_0x3f805e=await _0xea0df3[_0x2684fe(0xc8)](getVideoInfo,_0x4e86b1);}catch(_0x3f1f8d){_0xea0df3[_0x2684fe(0xa7)](logError,_0xea0df3['wJcJN'],_0x3f1f8d);}const _0xa68967=new Promise((_0x47c1e7,_0xa2f9fa)=>{const _0x18278b=_0x2684fe,_0x2b6d74={'aaGFR':function(_0x262507,_0x10bf84){const _0x403cb4=_0x5c12;return _0xea0df3[_0x403cb4(0xaf)](_0x262507,_0x10bf84);},'gWfHG':function(_0x1712c6,_0x416ed9,_0x1fd188){return _0x1712c6(_0x416ed9,_0x1fd188);},'lIiJt':_0x18278b(0xed)},_0x299140=_0xc827ee+'_0.png',_0xbac3b4=_0x311ddf[_0x18278b(0xc5)](_0x35cc3,_0x299140);_0xea0df3['TCzMy'](_0x11320b,_0x3f1fe6)['on'](_0xea0df3['ordKh'],()=>{})['on'](_0xea0df3[_0x18278b(0xce)],_0x7fc95d=>{const _0x3dba3d=_0x18278b,_0xb16ae9={'sWvmr':function(_0x574e13,_0x8ef25e){return _0x2b6d74['aaGFR'](_0x574e13,_0x8ef25e);}};_0x2b6d74[_0x3dba3d(0xf3)](logDebug,_0x2b6d74['lIiJt'],_0x7fc95d),_0x17a472?_0x359ba2[_0x3dba3d(0xdc)](_0x17a472,_0xbac3b4)[_0x3dba3d(0x9d)](()=>{const _0x323d14=_0x3dba3d;_0xb16ae9[_0x323d14(0xa9)](_0x47c1e7,_0xbac3b4);})[_0x3dba3d(0xb2)](_0xa2f9fa):_0x359ba2[_0x3dba3d(0xf5)](_0xbac3b4,defaultVideoThumb)[_0x3dba3d(0x9d)](()=>{_0xb16ae9['sWvmr'](_0x47c1e7,_0xbac3b4);})[_0x3dba3d(0xb2)](_0xa2f9fa);})[_0x18278b(0xbc)]({'timestamps':[0x0],'filename':_0x299140,'folder':_0x35cc3,'size':_0xea0df3['vzLyp'](_0x3f805e['width'],'x')+_0x3f805e[_0x18278b(0xf2)]})['on'](_0xea0df3[_0x18278b(0xc2)],()=>{_0x47c1e7(_0xbac3b4);});}),_0x4e0136=new Map(),_0x152cd9=await _0xa68967,_0xa4fbb1=(await _0x359ba2[_0x2684fe(0xd6)](_0x152cd9))[_0x2684fe(0xfc)];_0x4e0136[_0x2684fe(0x9a)](0x0,_0x152cd9);const _0x137991=await calculateFileMD5(_0x152cd9),_0x1a1597={'elementType':ElementType[_0x2684fe(0xf8)],'elementId':'','videoElement':{'fileName':_0x848618||_0x4daf62,'filePath':_0x4e86b1,'videoMd5':_0xc827ee,'thumbMd5':_0x137991,'fileTime':_0x3f805e['time'],'thumbPath':_0x4e0136,'thumbSize':_0xa4fbb1,'thumbWidth':_0x3f805e['width'],'thumbHeight':_0x3f805e[_0x2684fe(0xf2)],'fileSize':_0xea0df3[_0x2684fe(0xbe)]('',_0x5db5a5)}};return _0x1a1597;}static async[_0x5a12e4(0xe1)](_0x504b4c){const _0x51019c=_0x5a12e4,_0xa5bef4={'RnoeG':function(_0x26c1be,_0xfbf70){return _0x26c1be(_0xfbf70);},'rLXpf':function(_0xa67e9f,_0x14d6a7){return _0xa67e9f===_0x14d6a7;},'fDEtW':_0x51019c(0x9f),'GhCCq':function(_0x5a317e,_0x1c5539){return _0x5a317e||_0x1c5539;}},{converted:_0x48854e,path:_0x47c6a5,duration:_0x4ce9d5}=await _0xa5bef4[_0x51019c(0xe4)](encodeSilk,_0x504b4c);if(!_0x47c6a5)throw _0x51019c(0xe5);const {md5:_0x4beeb5,fileName:_0x180e0b,path:_0x44c036,fileSize:_0x2ca72e}=await NTQQFileApi['uploadFile'](_0x47c6a5,ElementType[_0x51019c(0x98)]);if(_0xa5bef4[_0x51019c(0xe6)](_0x2ca72e,0x0))throw _0xa5bef4[_0x51019c(0xa3)];return _0x48854e&&_0x359ba2['unlink'](_0x47c6a5)[_0x51019c(0x9d)](),{'elementType':ElementType[_0x51019c(0x98)],'elementId':'','pttElement':{'fileName':_0x180e0b,'filePath':_0x44c036,'md5HexStr':_0x4beeb5,'fileSize':_0x2ca72e,'duration':_0xa5bef4[_0x51019c(0xde)](_0x4ce9d5,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x5a12e4(0xec)](_0x58c059){const _0x1101ec=_0x5a12e4,_0x420497={'rClBY':function(_0x41eb77,_0x8a1dbb){return _0x41eb77(_0x8a1dbb);},'DBKpn':function(_0x139ed8,_0x5786b4){return _0x139ed8>=_0x5786b4;}},_0x4c6eef=_0x545460[_0x1101ec(0xea)],_0x480d64=_0x545460[_0x1101ec(0xd1)],_0x3eb1f5=_0x4c6eef[_0x1101ec(0xf7)](_0x480974=>_0x480974[_0x1101ec(0xd5)]===_0x58c059[_0x1101ec(0xd7)]());_0x58c059=_0x420497[_0x1101ec(0xc9)](parseInt,_0x58c059[_0x1101ec(0xd7)]());let _0x69ecd8=0x1;return _0x420497[_0x1101ec(0xa0)](_0x58c059,0xde)&&(_0x69ecd8=0x2),_0x3eb1f5[_0x1101ec(0xf1)]&&(_0x69ecd8=0x3),{'elementType':ElementType[_0x1101ec(0x99)],'elementId':'','faceElement':{'faceIndex':_0x58c059,'faceType':_0x69ecd8,'faceText':_0x3eb1f5[_0x1101ec(0xd8)],'stickerId':_0x3eb1f5[_0x1101ec(0xd4)],'stickerType':_0x3eb1f5[_0x1101ec(0xf1)],'packId':_0x3eb1f5['AniStickerPackId'],'sourceType':0x1}};}static[_0x5a12e4(0xd0)](_0x326783,_0x2003c3,_0x1fbc6d,_0x5a4de5){const _0x256f9f=_0x5a12e4,_0x37bbaf={'tLGYL':_0x256f9f(0xaa)};return{'elementType':ElementType[_0x256f9f(0xdb)],'marketFaceElement':{'emojiPackageId':_0x326783,'emojiId':_0x2003c3,'key':_0x1fbc6d,'faceName':_0x5a4de5||mFaceCache['get'](_0x2003c3)||_0x37bbaf[_0x256f9f(0xa2)]}};}static[_0x5a12e4(0xcb)](_0x3b4fde){const _0x3bb769=_0x5a12e4,_0x3310f2={'tuQVu':_0x3bb769(0xca)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x3bb769(0xcb)],'faceText':_0x3310f2[_0x3bb769(0xee)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5a12e4(0xe7)](_0x525f26){return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':'[包剪锤]','faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5a12e4(0xc0)](_0x17fdc7){const _0x2a7f19=_0x5a12e4,_0x555b91={'Hbicx':_0x2a7f19(0xc4)};return typeof _0x17fdc7!==_0x555b91[_0x2a7f19(0xa1)]&&(_0x17fdc7=JSON[_0x2a7f19(0xac)](_0x17fdc7)),{'elementType':ElementType[_0x2a7f19(0xe3)],'elementId':'','arkElement':{'bytesData':_0x17fdc7,'linkInfo':null,'subElementType':null}};}static[_0x5a12e4(0xf9)](_0xd256d7){const _0x46b9d4=_0x5a12e4;return{'elementType':ElementType[_0x46b9d4(0xe9)],'elementId':'','markdownElement':{'content':_0xd256d7}};}static async[_0x5a12e4(0xd2)](){const _0x13d07d=_0x5a12e4,_0x52c353={'tnWpE':function(_0x563b0f,_0x2d619b){return _0x563b0f(_0x2d619b);},'ppfnK':_0x13d07d(0xa4),'xsvsc':_0x13d07d(0xb7),'fqaeo':_0x13d07d(0xbf),'XyKWH':_0x13d07d(0xb8)};let _0x5c1efd=await _0x52c353[_0x13d07d(0xf6)](SignMiniApp,{'prompt':_0x52c353[_0x13d07d(0xad)],'title':'Bot\x20Test','preview':_0x52c353[_0x13d07d(0xb0)],'jumpUrl':_0x52c353[_0x13d07d(0xe8)],'tag':_0x52c353['ppfnK'],'tagIcon':_0x52c353[_0x13d07d(0xdf)],'source':_0x52c353[_0x13d07d(0xad)],'sourcelogo':_0x52c353[_0x13d07d(0xdf)]});return{'elementType':ElementType[_0x13d07d(0xe3)],'elementId':'','arkElement':{'bytesData':_0x5c1efd,'linkInfo':null,'subElementType':null}};}}