function _0x3505(_0x3115ce,_0x5cdeb5){const _0x3fdb8a=_0x3fdb();return _0x3505=function(_0x3505a5,_0x1337d1){_0x3505a5=_0x3505a5-0xfc;let _0x343a2e=_0x3fdb8a[_0x3505a5];return _0x343a2e;},_0x3505(_0x3115ce,_0x5cdeb5);}function _0x3fdb(){const _0x468b47=['语音转换失败,\x20请检查语音文件是否正常','hPEHR','获取视频信息失败','[骰子]','file','FACE','1443804qraERo','文件异常，大小为0','PTT','width','sep','end','ark','PvCml','20297616fKJVIi','[商城表情]','FILE','get','path','BbqCa','ptt','face','Ori','REPLY','eamPz','stringify','[包剪锤]','copyFile','HBzfW','769526PxVhwH','height','aMZrP','3801620JjCYsW','yrNFB','hcbRe','Thumb','dirname','set','error','dice','markdown','27579gxgoZC','DmDJB','pHqeh','reply','uploadFile','wINSn','701712jYetuV','yDEsu','图片信息','GbeGw','KPHiJ','RmOrv','writeFile','yhDIl','normal','PIWAR','mface','mp4','screenshots','toString','oihlx','weTor','MARKDOWN','KwEwl','catch','then','size','text','normal2','rps','PiuAA','128HQvUEZ','time','PIC','getImageSize','OinEV','MFACE','jpg','获取视频封面失败，使用默认封面','TEXT','ARK','notAt','Auxmy','KrhvP','_0.png','8317974VythMB'];_0x3fdb=function(){return _0x468b47;};return _0x3fdb();}const _0x5a89e0=_0x3505;(function(_0x2c4bb7,_0x3d47c6){const _0xd854ae=_0x3505,_0x9e99f6=_0x2c4bb7();while(!![]){try{const _0x14e671=-parseInt(_0xd854ae(0x118))/0x1+parseInt(_0xd854ae(0x143))/0x2*(-parseInt(_0xd854ae(0x124))/0x3)+parseInt(_0xd854ae(0x12a))/0x4+parseInt(_0xd854ae(0x11b))/0x5+-parseInt(_0xd854ae(0x101))/0x6+-parseInt(_0xd854ae(0x151))/0x7+parseInt(_0xd854ae(0x109))/0x8;if(_0x14e671===_0x3d47c6)break;else _0x9e99f6['push'](_0x9e99f6['shift']());}catch(_0x17bdbc){_0x9e99f6['push'](_0x9e99f6['shift']());}}}(_0x3fdb,0xa7850));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0xf72998}from'node:fs';import _0x1698a9 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x5a89e0(0x13f)](_0xb35236){const _0x49d867=_0x5a89e0;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0xb35236,'atType':AtType[_0x49d867(0x14d)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x330b8d,_0x5519a9,_0x55395b,_0x522f1a){const _0x3915d1=_0x5a89e0;return{'elementType':ElementType[_0x3915d1(0x14b)],'elementId':'','textElement':{'content':'@'+_0x522f1a,'atType':_0x55395b,'atUid':_0x330b8d,'atTinyId':'','atNtUid':_0x5519a9}};}static[_0x5a89e0(0x127)](_0x2cee85,_0x14ee7f,_0x32e412,_0x16bab3){const _0x1d831c=_0x5a89e0;return{'elementType':ElementType[_0x1d831c(0x112)],'elementId':'','replyElement':{'replayMsgSeq':_0x2cee85,'replayMsgId':_0x14ee7f,'senderUin':_0x32e412,'senderUinStr':_0x16bab3}};}static async['pic'](_0x4746fb,_0x3e0939='',_0x2f4ef8=0x0){const _0x53f698=_0x5a89e0,_0x456c6b={'CRFjQ':function(_0x55babe,_0x5ed018){return _0x55babe===_0x5ed018;},'Auxmy':'文件异常，大小为0','HWeAT':function(_0x411eff,_0x518c3e){return _0x411eff(_0x518c3e);},'hcbRe':_0x53f698(0x12c)},{md5:_0x24b600,fileName:_0x5b08ef,path:_0x39a6b4,fileSize:_0x165f14}=await NTQQFileApi[_0x53f698(0x128)](_0x4746fb,ElementType[_0x53f698(0x145)],_0x2f4ef8);if(_0x456c6b['CRFjQ'](_0x165f14,0x0))throw _0x456c6b[_0x53f698(0x14e)];const _0x31faa6=await NTQQFileApi[_0x53f698(0x146)](_0x4746fb),_0x1d1e8b={'md5HexStr':_0x24b600,'fileSize':_0x165f14[_0x53f698(0x137)](),'picWidth':_0x31faa6?.[_0x53f698(0x104)],'picHeight':_0x31faa6?.[_0x53f698(0x119)],'fileName':_0x5b08ef,'sourcePath':_0x39a6b4,'original':!![],'picType':_0x456c6b['HWeAT'](isGIF,_0x4746fb)?PicType['gif']:PicType[_0x53f698(0x149)],'picSubType':_0x2f4ef8,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3e0939};return logDebug(_0x456c6b[_0x53f698(0x11d)],_0x1d1e8b),{'elementType':ElementType[_0x53f698(0x145)],'elementId':'','picElement':_0x1d1e8b};}static async[_0x5a89e0(0xff)](_0x5be058,_0xe620d4=''){const _0x37f04b=_0x5a89e0,_0x31e900={'HBzfW':function(_0x4e8e19,_0x1a901f){return _0x4e8e19===_0x1a901f;},'yrNFB':_0x37f04b(0x102),'DmDJB':function(_0x5cf528,_0x2a5e78){return _0x5cf528||_0x2a5e78;}},{md5:_0x17d08f,fileName:_0x34e4ed,path:_0x57ef90,fileSize:_0x3640c7}=await NTQQFileApi[_0x37f04b(0x128)](_0x5be058,ElementType[_0x37f04b(0x10b)]);if(_0x31e900[_0x37f04b(0x117)](_0x3640c7,0x0))throw _0x31e900[_0x37f04b(0x11c)];const _0x2acc42={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x31e900[_0x37f04b(0x125)](_0xe620d4,_0x34e4ed),'filePath':_0x57ef90,'fileSize':_0x3640c7[_0x37f04b(0x137)]()}};return _0x2acc42;}static async['video'](_0x154c2c,_0x3c0653='',_0x5f27b0=''){const _0x555839=_0x5a89e0,_0x3819a6={'wINSn':function(_0x3c346c,_0x34c587,_0x74abe3){return _0x3c346c(_0x34c587,_0x74abe3);},'aMZrP':_0x555839(0x14a),'eamPz':_0x555839(0x106),'KrhvP':_0x555839(0x121),'yDEsu':function(_0x16e928,_0x389c3e){return _0x16e928+_0x389c3e;},'LnBnu':_0x555839(0x102),'yhDIl':function(_0x2df881,_0x502897){return _0x2df881(_0x502897);},'KwEwl':_0x555839(0x10d),'RmOrv':_0x555839(0x135),'PiuAA':function(_0x477d64,_0x391ca6){return _0x477d64(_0x391ca6);},'hPEHR':'视频信息','PrtYU':_0x555839(0xfd),'BbqCa':function(_0x502e02,_0x388fe7){return _0x502e02(_0x388fe7);},'GbeGw':function(_0x2b9432,_0x3d9b6a){return _0x2b9432+_0x3d9b6a;}},{fileName:_0x24fe98,path:_0x1f89b6,fileSize:_0x5e7c7b,md5:_0x59d572}=await NTQQFileApi[_0x555839(0x128)](_0x154c2c,ElementType['VIDEO']);if(_0x5e7c7b===0x0)throw _0x3819a6['LnBnu'];const _0x50eeac=_0x3819a6[_0x555839(0x131)](require,_0x3819a6[_0x555839(0x13b)]);let _0x113ef8=_0x1f89b6['replace'](_0x50eeac['sep']+_0x555839(0x111)+_0x50eeac[_0x555839(0x105)],_0x50eeac[_0x555839(0x105)]+_0x555839(0x11e)+_0x50eeac[_0x555839(0x105)]);_0x113ef8=_0x50eeac[_0x555839(0x11f)](_0x113ef8);let _0x178207={'width':0x780,'height':0x438,'time':0xf,'format':_0x3819a6[_0x555839(0x12f)],'size':_0x5e7c7b,'filePath':_0x154c2c};try{_0x178207=await _0x3819a6[_0x555839(0x142)](getVideoInfo,_0x1f89b6),_0x3819a6[_0x555839(0x129)](logDebug,_0x3819a6[_0x555839(0xfc)],_0x178207);}catch(_0x3f20f4){_0x3819a6[_0x555839(0x129)](logError,_0x3819a6['PrtYU'],_0x3f20f4);}const _0x37421a=new Promise((_0x2b87b4,_0x42e2f4)=>{const _0x2ae8a8=_0x555839,_0x161795={'KPHiJ':function(_0x5c6f82,_0x2e84c0){return _0x5c6f82(_0x2e84c0);}},_0x3d45df=_0x59d572+_0x2ae8a8(0x150),_0x2493f5=_0x50eeac['join'](_0x113ef8,_0x3d45df);_0x1698a9(_0x154c2c)['on'](_0x3819a6[_0x2ae8a8(0x113)],()=>{})['on'](_0x3819a6[_0x2ae8a8(0x14f)],_0x4d0763=>{const _0x1f9681=_0x2ae8a8;_0x3819a6[_0x1f9681(0x129)](logDebug,_0x3819a6[_0x1f9681(0x11a)],_0x4d0763),_0x5f27b0?_0xf72998[_0x1f9681(0x116)](_0x5f27b0,_0x2493f5)['then'](()=>{const _0x24ec0b=_0x1f9681;_0x161795[_0x24ec0b(0x12e)](_0x2b87b4,_0x2493f5);})[_0x1f9681(0x13c)](_0x42e2f4):_0xf72998[_0x1f9681(0x130)](_0x2493f5,defaultVideoThumb)[_0x1f9681(0x13d)](()=>{_0x2b87b4(_0x2493f5);})['catch'](_0x42e2f4);})[_0x2ae8a8(0x136)]({'timestamps':[0x0],'filename':_0x3d45df,'folder':_0x113ef8,'size':_0x3819a6[_0x2ae8a8(0x12b)](_0x178207['width']+'x',_0x178207[_0x2ae8a8(0x119)])})['on'](_0x3819a6[_0x2ae8a8(0x113)],()=>{_0x2b87b4(_0x2493f5);});}),_0x13ac9e=new Map(),_0x44735b=await _0x37421a,_0xc8e93e=(await _0xf72998['stat'](_0x44735b))[_0x555839(0x13e)];_0x13ac9e[_0x555839(0x120)](0x0,_0x44735b);const _0x4b1ee1=await _0x3819a6[_0x555839(0x10e)](calculateFileMD5,_0x44735b),_0x353bea={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x3c0653||_0x24fe98,'filePath':_0x1f89b6,'videoMd5':_0x59d572,'thumbMd5':_0x4b1ee1,'fileTime':_0x178207[_0x555839(0x144)],'thumbPath':_0x13ac9e,'thumbSize':_0xc8e93e,'thumbWidth':_0x178207[_0x555839(0x104)],'thumbHeight':_0x178207[_0x555839(0x119)],'fileSize':_0x3819a6[_0x555839(0x12d)]('',_0x5e7c7b)}};return _0x353bea;}static async[_0x5a89e0(0x10f)](_0x1bef7a){const _0x24001b=_0x5a89e0,_0x1f0d62={'weTor':function(_0x59cf84,_0x3117c4){return _0x59cf84(_0x3117c4);},'PIWAR':_0x24001b(0x152),'pHqeh':function(_0x1879fb,_0x13730f){return _0x1879fb===_0x13730f;},'iwkEY':'文件异常，大小为0','OinEV':function(_0x4cde8e,_0x2b7a9a){return _0x4cde8e||_0x2b7a9a;}},{converted:_0x2148b5,path:_0x4bc9b7,duration:_0x567b6b}=await _0x1f0d62[_0x24001b(0x139)](encodeSilk,_0x1bef7a);if(!_0x4bc9b7)throw _0x1f0d62[_0x24001b(0x133)];const {md5:_0x509e78,fileName:_0x4bf71b,path:_0x480e5c,fileSize:_0x1c30e2}=await NTQQFileApi[_0x24001b(0x128)](_0x4bc9b7,ElementType['PTT']);if(_0x1f0d62[_0x24001b(0x126)](_0x1c30e2,0x0))throw _0x1f0d62['iwkEY'];return _0x2148b5&&_0xf72998['unlink'](_0x4bc9b7)['then'](),{'elementType':ElementType[_0x24001b(0x103)],'elementId':'','pttElement':{'fileName':_0x4bf71b,'filePath':_0x480e5c,'md5HexStr':_0x509e78,'fileSize':_0x1c30e2,'duration':_0x1f0d62[_0x24001b(0x147)](_0x567b6b,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x5a89e0(0x110)](_0xf5aed2){const _0x113a1e=_0x5a89e0,_0x150637={'PvCml':function(_0x1e436b,_0x3d89a0){return _0x1e436b<_0x3d89a0;}};return{'elementType':ElementType[_0x113a1e(0x100)],'elementId':'','faceElement':{'faceIndex':_0xf5aed2,'faceType':_0x150637[_0x113a1e(0x108)](_0xf5aed2,0xde)?FaceType[_0x113a1e(0x132)]:FaceType[_0x113a1e(0x140)]}};}static[_0x5a89e0(0x134)](_0xbbd5e1,_0xecc3ae,_0x117935,_0x1b6e40){const _0x300877=_0x5a89e0,_0x346779={'UhwTX':_0x300877(0x10a)};return{'elementType':ElementType[_0x300877(0x148)],'marketFaceElement':{'emojiPackageId':_0xbbd5e1,'emojiId':_0xecc3ae,'key':_0x117935,'faceName':_0x1b6e40||mFaceCache[_0x300877(0x10c)](_0xecc3ae)||_0x346779['UhwTX']}};}static[_0x5a89e0(0x122)](_0x574746){const _0x8fd682=_0x5a89e0;return{'elementType':ElementType[_0x8fd682(0x100)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x8fd682(0x122)],'faceType':FaceType[_0x8fd682(0x122)],'faceText':_0x8fd682(0xfe),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5a89e0(0x141)](_0x191cbd){const _0x1612e2=_0x5a89e0,_0x3b58b7={'gsvAk':_0x1612e2(0x115)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x3b58b7['gsvAk'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5a89e0(0x107)](_0x311cb1){const _0x59760e=_0x5a89e0,_0x215893={'oihlx':'string'};return typeof _0x311cb1!==_0x215893[_0x59760e(0x138)]&&(_0x311cb1=JSON[_0x59760e(0x114)](_0x311cb1)),{'elementType':ElementType[_0x59760e(0x14c)],'elementId':'','arkElement':{'bytesData':_0x311cb1,'linkInfo':null,'subElementType':null}};}static[_0x5a89e0(0x123)](_0x38c45e){const _0x16a607=_0x5a89e0;return{'elementType':ElementType[_0x16a607(0x13a)],'elementId':'','markdownElement':{'content':_0x38c45e}};}}