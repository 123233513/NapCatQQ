const _0x556832=_0x3f8a;function _0x243c(){const _0x47647b=['RPS','语音转换失败,\x20请检查语音文件是否正常','Wrigr','width','dice','https://www.bilibili.com/','catch','DiUzz','PDGrj','CzpHd','QSid','28688693Yrybbk','text','6SOIHMl','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','then','JQScV','GDbMd','FILE','hOBkU','MFACE','PTT','MARKDOWN','531107KFADUP','xfrHx','获取视频封面失败，使用默认封面','face','DYGwO','HZkGh','ptt','fYPaL','REPLY','replace','文件异常，大小为0','screenshots','JjgFs','cldmC','ekrSv','PIC','hEzGn','miniapp','markdown','Thumb','sep','4372060bBRNyk','Ori','height','end','10614033ScyTQK','getImageSize','mWtmY','10yuazkA','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','rjfNn','_0.png','3875088fuFwlZ','sHdUG','FACE','uploadFile','WEjkR','mface','HVZlL','AniStickerId','toString','jpg','find','28UDIEHz','AniStickerPackId','set','gif','获取视频信息失败','sysface','OUChS','error','4sRKRKT','1315516aWtoBp','VIDEO','file','HjXdK','XLfms','HZVHd','ark','AoZyU','ddUVU','2294574wYpDaC','copyFile','notAt','ARK','TEXT','ZBFBA','AniStickerType'];_0x243c=function(){return _0x47647b;};return _0x243c();}(function(_0xafb36d,_0x35a22f){const _0x3cae36=_0x3f8a,_0xff409c=_0xafb36d();while(!![]){try{const _0x3ea9c4=parseInt(_0x3cae36(0x14a))/0x1*(-parseInt(_0x3cae36(0x122))/0x2)+-parseInt(_0x3cae36(0x140))/0x3*(parseInt(_0x3cae36(0x123))/0x4)+-parseInt(_0x3cae36(0x104))/0x5+-parseInt(_0x3cae36(0x12c))/0x6*(-parseInt(_0x3cae36(0x11a))/0x7)+parseInt(_0x3cae36(0x10f))/0x8+-parseInt(_0x3cae36(0x108))/0x9+parseInt(_0x3cae36(0x10b))/0xa*(parseInt(_0x3cae36(0x13e))/0xb);if(_0x3ea9c4===_0x35a22f)break;else _0xff409c['push'](_0xff409c['shift']());}catch(_0x41603f){_0xff409c['push'](_0xff409c['shift']());}}}(_0x243c,0xcf23c));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x40db07}from'node:fs';import _0x11e775 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x4f9b58 from'./face_config.json';import*as _0x1dea1c from'node:path';import{SignMiniApp}from'../apis';function _0x3f8a(_0x12fe48,_0x56af65){const _0x243c67=_0x243c();return _0x3f8a=function(_0x3f8a54,_0x2ba469){_0x3f8a54=_0x3f8a54-0xf6;let _0x79a5db=_0x243c67[_0x3f8a54];return _0x79a5db;},_0x3f8a(_0x12fe48,_0x56af65);}export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x556832(0x13f)](_0x3ded5c){const _0x5503c1=_0x556832;return{'elementType':ElementType[_0x5503c1(0x130)],'elementId':'','textElement':{'content':_0x3ded5c,'atType':AtType[_0x5503c1(0x12e)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x3eeb54,_0xc271c3,_0x4dd55d,_0x2e1aaa){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x2e1aaa,'atType':_0x4dd55d,'atUid':_0x3eeb54,'atTinyId':'','atNtUid':_0xc271c3}};}static['reply'](_0x29457d,_0xafd800,_0x55e951,_0x4f493e){const _0x24443c=_0x556832;return{'elementType':ElementType[_0x24443c(0xf7)],'elementId':'','replyElement':{'replayMsgSeq':_0x29457d,'replayMsgId':_0xafd800,'senderUin':_0x55e951,'senderUinStr':_0x4f493e}};}static async['pic'](_0xa84808,_0x239974='',_0x28b022=0x0){const _0x195872=_0x556832,_0xd1d51={'xfrHx':function(_0x26ff11,_0x272ba6){return _0x26ff11===_0x272ba6;}},{md5:_0x3e613e,fileName:_0x384298,path:_0x23a650,fileSize:_0x81368}=await NTQQFileApi[_0x195872(0x112)](_0xa84808,ElementType[_0x195872(0xfe)],_0x28b022);if(_0xd1d51[_0x195872(0x14b)](_0x81368,0x0))throw _0x195872(0xf9);const _0x588c2a=await NTQQFileApi[_0x195872(0x109)](_0xa84808),_0x581d37={'md5HexStr':_0x3e613e,'fileSize':_0x81368[_0x195872(0x117)](),'picWidth':_0x588c2a?.[_0x195872(0x136)],'picHeight':_0x588c2a?.[_0x195872(0x106)],'fileName':_0x384298,'sourcePath':_0x23a650,'original':!![],'picType':isGIF(_0xa84808)?PicType[_0x195872(0x11d)]:PicType[_0x195872(0x118)],'picSubType':_0x28b022,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x239974};return{'elementType':ElementType[_0x195872(0xfe)],'elementId':'','picElement':_0x581d37};}static async[_0x556832(0x125)](_0x5d74d8,_0x14fa5b=''){const _0x1a68a7=_0x556832,_0x4d3a7c={'JjgFs':function(_0x303350,_0x507513){return _0x303350===_0x507513;},'HZkGh':_0x1a68a7(0xf9),'cldmC':function(_0x284e1e,_0x25adfe){return _0x284e1e||_0x25adfe;}},{md5:_0x4de684,fileName:_0x2d746c,path:_0x3b155a,fileSize:_0x43e19a}=await NTQQFileApi['uploadFile'](_0x5d74d8,ElementType['FILE']);if(_0x4d3a7c[_0x1a68a7(0xfb)](_0x43e19a,0x0))throw _0x4d3a7c[_0x1a68a7(0x14f)];const _0x51f854={'elementType':ElementType[_0x1a68a7(0x145)],'elementId':'','fileElement':{'fileName':_0x4d3a7c[_0x1a68a7(0xfc)](_0x14fa5b,_0x2d746c),'filePath':_0x3b155a,'fileSize':_0x43e19a['toString']()}};return _0x51f854;}static async['video'](_0x184d25,_0x10bd47='',_0x12ee57=''){const _0xeeaf02=_0x556832,_0x599bcb={'ekrSv':function(_0x10bf8d,_0x439d49,_0x32c842){return _0x10bf8d(_0x439d49,_0x32c842);},'DiUzz':_0xeeaf02(0x14c),'AoZyU':function(_0x3e885d,_0x40d916){return _0x3e885d(_0x40d916);},'fYPaL':_0xeeaf02(0x107),'XkcCi':_0xeeaf02(0x121),'ktbey':function(_0x20ed41,_0x56fd82){return _0x20ed41+_0x56fd82;},'GDbMd':'mp4','TWlrn':function(_0xf31682,_0xe3a0a1,_0x34befe){return _0xf31682(_0xe3a0a1,_0x34befe);},'rjfNn':_0xeeaf02(0x11e),'XLfms':function(_0x7465a9,_0x1d8a44){return _0x7465a9(_0x1d8a44);},'hEzGn':function(_0x441165,_0x3e8ced){return _0x441165||_0x3e8ced;},'hASxI':function(_0x45145b,_0x40f769){return _0x45145b+_0x40f769;}},{fileName:_0x4dc449,path:_0x11fcd2,fileSize:_0x2353df,md5:_0x28912b}=await NTQQFileApi[_0xeeaf02(0x112)](_0x184d25,ElementType[_0xeeaf02(0x124)]);if(_0x2353df===0x0)throw _0xeeaf02(0xf9);let _0x2fef1e=_0x11fcd2[_0xeeaf02(0xf8)](_0x1dea1c[_0xeeaf02(0x103)]+_0xeeaf02(0x105)+_0x1dea1c['sep'],_0x1dea1c['sep']+_0xeeaf02(0x102)+_0x1dea1c[_0xeeaf02(0x103)]);_0x2fef1e=_0x1dea1c['dirname'](_0x2fef1e);let _0x327e88={'width':0x780,'height':0x438,'time':0xf,'format':_0x599bcb[_0xeeaf02(0x144)],'size':_0x2353df,'filePath':_0x184d25};try{_0x327e88=await getVideoInfo(_0x11fcd2);}catch(_0x12c0b0){_0x599bcb['TWlrn'](logError,_0x599bcb[_0xeeaf02(0x10d)],_0x12c0b0);}const _0x5cdf04=new Promise((_0x5a3a8c,_0x19d911)=>{const _0x284ddf=_0xeeaf02,_0x7aecd9=_0x28912b+_0x284ddf(0x10e),_0x3afaf3=_0x1dea1c['join'](_0x2fef1e,_0x7aecd9);_0x599bcb[_0x284ddf(0x12a)](_0x11e775,_0x184d25)['on'](_0x599bcb[_0x284ddf(0xf6)],()=>{})['on'](_0x599bcb['XkcCi'],_0x107321=>{const _0x23286d=_0x284ddf,_0x1ea989={'OUChS':function(_0x4dc11a,_0x479fbc){return _0x4dc11a(_0x479fbc);}};_0x599bcb[_0x23286d(0xfd)](logDebug,_0x599bcb[_0x23286d(0x13a)],_0x107321),_0x12ee57?_0x40db07[_0x23286d(0x12d)](_0x12ee57,_0x3afaf3)[_0x23286d(0x142)](()=>{const _0x45172e=_0x23286d;_0x1ea989[_0x45172e(0x120)](_0x5a3a8c,_0x3afaf3);})['catch'](_0x19d911):_0x40db07['writeFile'](_0x3afaf3,defaultVideoThumb)[_0x23286d(0x142)](()=>{_0x5a3a8c(_0x3afaf3);})[_0x23286d(0x139)](_0x19d911);})[_0x284ddf(0xfa)]({'timestamps':[0x0],'filename':_0x7aecd9,'folder':_0x2fef1e,'size':_0x599bcb['ktbey'](_0x327e88[_0x284ddf(0x136)],'x')+_0x327e88[_0x284ddf(0x106)]})['on']('end',()=>{const _0x19c662=_0x284ddf;_0x599bcb[_0x19c662(0x12a)](_0x5a3a8c,_0x3afaf3);});}),_0x195c19=new Map(),_0x4aa3cb=await _0x5cdf04,_0x10c5e3=(await _0x40db07['stat'](_0x4aa3cb))['size'];_0x195c19[_0xeeaf02(0x11c)](0x0,_0x4aa3cb);const _0x51ba12=await _0x599bcb[_0xeeaf02(0x127)](calculateFileMD5,_0x4aa3cb),_0x11cb92={'elementType':ElementType[_0xeeaf02(0x124)],'elementId':'','videoElement':{'fileName':_0x599bcb[_0xeeaf02(0xff)](_0x10bd47,_0x4dc449),'filePath':_0x11fcd2,'videoMd5':_0x28912b,'thumbMd5':_0x51ba12,'fileTime':_0x327e88['time'],'thumbPath':_0x195c19,'thumbSize':_0x10c5e3,'thumbWidth':_0x327e88[_0xeeaf02(0x136)],'thumbHeight':_0x327e88['height'],'fileSize':_0x599bcb['hASxI']('',_0x2353df)}};return _0x11cb92;}static async[_0x556832(0x150)](_0x41c3f5){const _0x262c8b=_0x556832,_0x5eb7d4={'ddUVU':_0x262c8b(0x134),'DYGwO':function(_0x30879b,_0x225dcd){return _0x30879b===_0x225dcd;},'HZVHd':'文件异常，大小为0','WEjkR':function(_0x577c90,_0x118824){return _0x577c90||_0x118824;}},{converted:_0x4ed91e,path:_0x3ce2f7,duration:_0xf9e7f}=await encodeSilk(_0x41c3f5);if(!_0x3ce2f7)throw _0x5eb7d4[_0x262c8b(0x12b)];const {md5:_0x5d3c8c,fileName:_0x5b7b12,path:_0x382789,fileSize:_0x262ea3}=await NTQQFileApi[_0x262c8b(0x112)](_0x3ce2f7,ElementType[_0x262c8b(0x148)]);if(_0x5eb7d4[_0x262c8b(0x14e)](_0x262ea3,0x0))throw _0x5eb7d4[_0x262c8b(0x128)];return _0x4ed91e&&_0x40db07['unlink'](_0x3ce2f7)[_0x262c8b(0x142)](),{'elementType':ElementType[_0x262c8b(0x148)],'elementId':'','pttElement':{'fileName':_0x5b7b12,'filePath':_0x382789,'md5HexStr':_0x5d3c8c,'fileSize':_0x262ea3,'duration':_0x5eb7d4[_0x262c8b(0x113)](_0xf9e7f,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x556832(0x14d)](_0x16038d){const _0x2466c5=_0x556832,_0x5d60e5={'Wrigr':function(_0x36d26e,_0x310545){return _0x36d26e(_0x310545);},'sHdUG':function(_0x33c860,_0x453ebd){return _0x33c860>=_0x453ebd;}},_0x445219=_0x4f9b58[_0x2466c5(0x11f)],_0x531890=_0x4f9b58['emoji'],_0x554751=_0x445219[_0x2466c5(0x119)](_0x5c7f9e=>_0x5c7f9e[_0x2466c5(0x13d)]===_0x16038d[_0x2466c5(0x117)]());_0x16038d=_0x5d60e5[_0x2466c5(0x135)](parseInt,_0x16038d[_0x2466c5(0x117)]());let _0x34a92f=0x1;return _0x5d60e5[_0x2466c5(0x110)](_0x16038d,0xde)&&(_0x34a92f=0x2),_0x554751[_0x2466c5(0x132)]&&(_0x34a92f=0x3),{'elementType':ElementType[_0x2466c5(0x111)],'elementId':'','faceElement':{'faceIndex':_0x16038d,'faceType':_0x34a92f,'faceText':_0x554751['QDes'],'stickerId':_0x554751[_0x2466c5(0x116)],'stickerType':_0x554751[_0x2466c5(0x132)],'packId':_0x554751[_0x2466c5(0x11b)],'sourceType':0x1}};}static[_0x556832(0x114)](_0x17f9ea,_0x313120,_0x3e176c,_0x58e6a5){const _0x2e9137=_0x556832,_0x25b51e={'HVZlL':'[商城表情]'};return{'elementType':ElementType[_0x2e9137(0x147)],'marketFaceElement':{'emojiPackageId':_0x17f9ea,'emojiId':_0x313120,'key':_0x3e176c,'faceName':_0x58e6a5||mFaceCache['get'](_0x313120)||_0x25b51e[_0x2e9137(0x115)]}};}static['dice'](_0x1c2ce9){const _0x193f56=_0x556832,_0x18914={'HjXdK':'[骰子]'};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType[_0x193f56(0x137)],'faceText':_0x18914[_0x193f56(0x126)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x970f08){const _0x37c173=_0x556832,_0x58e495={'ZBFBA':'[包剪锤]'};return{'elementType':ElementType[_0x37c173(0x111)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x37c173(0x133)],'faceText':_0x58e495[_0x37c173(0x131)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x556832(0x129)](_0x427620){const _0x36825e=_0x556832,_0x2557ed={'mWtmY':function(_0x4a5269,_0x54441d){return _0x4a5269!==_0x54441d;}};return _0x2557ed[_0x36825e(0x10a)](typeof _0x427620,'string')&&(_0x427620=JSON['stringify'](_0x427620)),{'elementType':ElementType[_0x36825e(0x12f)],'elementId':'','arkElement':{'bytesData':_0x427620,'linkInfo':null,'subElementType':null}};}static[_0x556832(0x101)](_0x19f1bc){const _0x322fce=_0x556832;return{'elementType':ElementType[_0x322fce(0x149)],'elementId':'','markdownElement':{'content':_0x19f1bc}};}static async[_0x556832(0x100)](){const _0x4db0af=_0x556832,_0x3a023a={'CzpHd':function(_0x3fec03,_0x2e90d9){return _0x3fec03(_0x2e90d9);},'PDGrj':'Bot\x20Test','JQScV':_0x4db0af(0x141),'hOBkU':_0x4db0af(0x10c)};let _0x5aa7fa=await _0x3a023a[_0x4db0af(0x13c)](SignMiniApp,{'prompt':_0x3a023a[_0x4db0af(0x13b)],'title':_0x3a023a[_0x4db0af(0x13b)],'preview':_0x3a023a[_0x4db0af(0x143)],'jumpUrl':_0x4db0af(0x138),'tag':'Bot\x20Test','tagIcon':_0x3a023a[_0x4db0af(0x146)],'source':_0x3a023a[_0x4db0af(0x13b)],'sourcelogo':_0x3a023a[_0x4db0af(0x146)]});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x5aa7fa,'linkInfo':null,'subElementType':null}};}}