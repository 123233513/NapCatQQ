const _0x29a23d=_0x5e97;function _0x5e97(_0x37c7b5,_0x462fcd){const _0x1a0790=_0x1a07();return _0x5e97=function(_0x5e97e0,_0x17aff8){_0x5e97e0=_0x5e97e0-0x10e;let _0x3c6ae2=_0x1a0790[_0x5e97e0];return _0x3c6ae2;},_0x5e97(_0x37c7b5,_0x462fcd);}(function(_0xf68683,_0x1cf197){const _0x2b57de=_0x5e97,_0x478d19=_0xf68683();while(!![]){try{const _0x4190af=-parseInt(_0x2b57de(0x127))/0x1+-parseInt(_0x2b57de(0x14e))/0x2+-parseInt(_0x2b57de(0x112))/0x3+-parseInt(_0x2b57de(0x11e))/0x4+parseInt(_0x2b57de(0x121))/0x5+-parseInt(_0x2b57de(0x147))/0x6+-parseInt(_0x2b57de(0x13e))/0x7*(-parseInt(_0x2b57de(0x12a))/0x8);if(_0x4190af===_0x1cf197)break;else _0x478d19['push'](_0x478d19['shift']());}catch(_0x4344cf){_0x478d19['push'](_0x478d19['shift']());}}}(_0x1a07,0xdbf67));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x471ae7}from'node:fs';import _0x233586 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x1a07(){const _0x4bef7c=['DKimB','join','KkKox','wTwHj','FACE','end','size','BxOEW','set','tpUxm','error','语音转换失败,\x20请检查语音文件是否正常','ark','jpg','uploadFile','replace','copyFile','text','XwPUY','normal','getImageSize','[包剪锤]','vTSHE','[骰子]','3828309GxHUbJ','markdown','_0.png','lKWTn','video','[商城表情]','stat','screenshots','eacWj','VIDEO','RwGnD','gif','3787020zQdsmi','JVmmO','mface','7208405WksyXM','图片信息','COEMI','toString','iIUoc','wXXzb','221157WYiGfH','get','dirname','209784qxdUkE','rps','unlink','SbHOl','pic','width','nxMBT','KAVcz','ptt','MARKDOWN','文件异常，大小为0','catch','获取视频封面失败，使用默认封面','path','string','reply','xlccH','sep','file','notAt','1099oVKHDm','ARK','then','xtSWX','ocwHX','LrSYk','dice','mp4','HVLcA','2504400KSTijk','TEXT','rMRpy','Thumb','height','RPS','PFHof','3592620kVeXVb','SpOsP','FILE','REPLY','PIC','视频信息'];_0x1a07=function(){return _0x4bef7c;};return _0x1a07();}import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x29a23d(0x165)](_0xb025f5){const _0x3e1193=_0x29a23d;return{'elementType':ElementType[_0x3e1193(0x148)],'elementId':'','textElement':{'content':_0xb025f5,'atType':AtType[_0x3e1193(0x13d)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x430e1f,_0x5066b2,_0x349c0f,_0x1a6579){const _0x37428e=_0x29a23d;return{'elementType':ElementType[_0x37428e(0x148)],'elementId':'','textElement':{'content':'@'+_0x1a6579,'atType':_0x349c0f,'atUid':_0x430e1f,'atTinyId':'','atNtUid':_0x5066b2}};}static[_0x29a23d(0x139)](_0x35a1c1,_0x90fff7,_0x16aa32,_0x3f6567){const _0x1fcb30=_0x29a23d;return{'elementType':ElementType[_0x1fcb30(0x151)],'elementId':'','replyElement':{'replayMsgSeq':_0x35a1c1,'replayMsgId':_0x90fff7,'senderUin':_0x16aa32,'senderUinStr':_0x3f6567}};}static async[_0x29a23d(0x12e)](_0xc841af,_0x40e417='',_0x5287f7=0x0){const _0x433a89=_0x29a23d,_0x33801b={'KkKox':function(_0x11ddf1,_0x1a82d9){return _0x11ddf1===_0x1a82d9;},'vbjLL':_0x433a89(0x134),'DKimB':function(_0x2ec262,_0x582fd8){return _0x2ec262(_0x582fd8);},'SbHOl':function(_0x1d536c,_0x4c4762,_0x4ca616){return _0x1d536c(_0x4c4762,_0x4ca616);},'rMRpy':_0x433a89(0x122)},{md5:_0x21935d,fileName:_0x3fb999,path:_0xa2714c,fileSize:_0xbbc8ec}=await NTQQFileApi[_0x433a89(0x162)](_0xc841af,ElementType[_0x433a89(0x152)],_0x5287f7);if(_0x33801b[_0x433a89(0x156)](_0xbbc8ec,0x0))throw _0x33801b['vbjLL'];const _0x51bd6a=await NTQQFileApi[_0x433a89(0x10e)](_0xc841af),_0x62af3={'md5HexStr':_0x21935d,'fileSize':_0xbbc8ec[_0x433a89(0x124)](),'picWidth':_0x51bd6a?.[_0x433a89(0x12f)],'picHeight':_0x51bd6a?.[_0x433a89(0x14b)],'fileName':_0x3fb999,'sourcePath':_0xa2714c,'original':!![],'picType':_0x33801b[_0x433a89(0x154)](isGIF,_0xc841af)?PicType[_0x433a89(0x11d)]:PicType[_0x433a89(0x161)],'picSubType':_0x5287f7,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x40e417};return _0x33801b[_0x433a89(0x12d)](logDebug,_0x33801b[_0x433a89(0x149)],_0x62af3),{'elementType':ElementType[_0x433a89(0x152)],'elementId':'','picElement':_0x62af3};}static async[_0x29a23d(0x13c)](_0x575658,_0x1e967e=''){const _0x4aeb53=_0x29a23d,_0x5ee0e7={'nxMBT':function(_0x5da367,_0x106116){return _0x5da367===_0x106116;},'wXXzb':_0x4aeb53(0x134),'RwGnD':function(_0x330391,_0xdf6552){return _0x330391||_0xdf6552;}},{md5:_0x532746,fileName:_0x42298e,path:_0x2c1fb7,fileSize:_0x343905}=await NTQQFileApi[_0x4aeb53(0x162)](_0x575658,ElementType[_0x4aeb53(0x150)]);if(_0x5ee0e7[_0x4aeb53(0x130)](_0x343905,0x0))throw _0x5ee0e7[_0x4aeb53(0x126)];const _0x2d368f={'elementType':ElementType[_0x4aeb53(0x150)],'elementId':'','fileElement':{'fileName':_0x5ee0e7[_0x4aeb53(0x11c)](_0x1e967e,_0x42298e),'filePath':_0x2c1fb7,'fileSize':_0x343905['toString']()}};return _0x2d368f;}static async[_0x29a23d(0x116)](_0x3e0057,_0x4961ca='',_0x3fc9ce=''){const _0x5c5dda=_0x29a23d,_0x8dac21={'ocwHX':function(_0x4078ac,_0x6ae3f4,_0x31c98f){return _0x4078ac(_0x6ae3f4,_0x31c98f);},'lKWTn':_0x5c5dda(0x136),'eacWj':function(_0x233e7a,_0x18788e){return _0x233e7a(_0x18788e);},'KAVcz':_0x5c5dda(0x159),'SpOsP':_0x5c5dda(0x15e),'xlccH':function(_0x3c98a7,_0x5345e1){return _0x3c98a7+_0x5345e1;},'WqUbn':function(_0x3f3e6f,_0x3fdeff){return _0x3f3e6f===_0x3fdeff;},'XhcKw':_0x5c5dda(0x134),'vTSHE':_0x5c5dda(0x137),'HVLcA':_0x5c5dda(0x145),'tpUxm':function(_0x20e25c,_0xbc9f80,_0x320255){return _0x20e25c(_0xbc9f80,_0x320255);},'ajjmz':'获取视频信息失败','XwPUY':function(_0x5c2dcf,_0x56cbd6){return _0x5c2dcf||_0x56cbd6;}},{fileName:_0x31a933,path:_0x41ba32,fileSize:_0x4b3145,md5:_0x50952e}=await NTQQFileApi[_0x5c5dda(0x162)](_0x3e0057,ElementType[_0x5c5dda(0x11b)]);if(_0x8dac21['WqUbn'](_0x4b3145,0x0))throw _0x8dac21['XhcKw'];const _0x37188d=require(_0x8dac21[_0x5c5dda(0x110)]);let _0x52b09e=_0x41ba32[_0x5c5dda(0x163)](_0x37188d[_0x5c5dda(0x13b)]+'Ori'+_0x37188d[_0x5c5dda(0x13b)],_0x37188d[_0x5c5dda(0x13b)]+_0x5c5dda(0x14a)+_0x37188d[_0x5c5dda(0x13b)]);_0x52b09e=_0x37188d[_0x5c5dda(0x129)](_0x52b09e);let _0x5af398={'width':0x780,'height':0x438,'time':0xf,'format':_0x8dac21[_0x5c5dda(0x146)],'size':_0x4b3145,'filePath':_0x3e0057};try{_0x5af398=await _0x8dac21['eacWj'](getVideoInfo,_0x41ba32),_0x8dac21['ocwHX'](logDebug,_0x5c5dda(0x153),_0x5af398);}catch(_0x25bfaf){_0x8dac21[_0x5c5dda(0x15d)](logError,_0x8dac21['ajjmz'],_0x25bfaf);}const _0x13ac52=new Promise((_0x5d8d69,_0x470e0c)=>{const _0x39622c=_0x5c5dda,_0x1e8a1c={'JVmmO':function(_0x101b56,_0x3f4bb7){const _0x2044f6=_0x5e97;return _0x8dac21[_0x2044f6(0x11a)](_0x101b56,_0x3f4bb7);}},_0x169f8a=_0x50952e+_0x39622c(0x114),_0x18a19e=_0x37188d[_0x39622c(0x155)](_0x52b09e,_0x169f8a);_0x8dac21[_0x39622c(0x11a)](_0x233586,_0x3e0057)['on'](_0x8dac21[_0x39622c(0x131)],()=>{})['on'](_0x8dac21[_0x39622c(0x14f)],_0xb17c32=>{const _0x1c31dc=_0x39622c,_0x4e8b19={'BxOEW':function(_0x2f09ec,_0x234103){return _0x2f09ec(_0x234103);}};_0x8dac21[_0x1c31dc(0x142)](logDebug,_0x8dac21[_0x1c31dc(0x115)],_0xb17c32),_0x3fc9ce?_0x471ae7[_0x1c31dc(0x164)](_0x3fc9ce,_0x18a19e)[_0x1c31dc(0x140)](()=>{const _0x1d6c7e=_0x1c31dc;_0x1e8a1c[_0x1d6c7e(0x11f)](_0x5d8d69,_0x18a19e);})['catch'](_0x470e0c):_0x471ae7['writeFile'](_0x18a19e,defaultVideoThumb)['then'](()=>{const _0x35cce1=_0x1c31dc;_0x4e8b19[_0x35cce1(0x15b)](_0x5d8d69,_0x18a19e);})[_0x1c31dc(0x135)](_0x470e0c);})[_0x39622c(0x119)]({'timestamps':[0x0],'filename':_0x169f8a,'folder':_0x52b09e,'size':_0x8dac21[_0x39622c(0x13a)](_0x5af398['width']+'x',_0x5af398[_0x39622c(0x14b)])})['on'](_0x8dac21[_0x39622c(0x131)],()=>{const _0x52eed7=_0x39622c;_0x8dac21[_0x52eed7(0x11a)](_0x5d8d69,_0x18a19e);});}),_0x700587=new Map(),_0x40d368=await _0x13ac52,_0x191828=(await _0x471ae7[_0x5c5dda(0x118)](_0x40d368))[_0x5c5dda(0x15a)];_0x700587[_0x5c5dda(0x15c)](0x0,_0x40d368);const _0x13400c=await _0x8dac21[_0x5c5dda(0x11a)](calculateFileMD5,_0x40d368),_0x19095d={'elementType':ElementType[_0x5c5dda(0x11b)],'elementId':'','videoElement':{'fileName':_0x8dac21[_0x5c5dda(0x166)](_0x4961ca,_0x31a933),'filePath':_0x41ba32,'videoMd5':_0x50952e,'thumbMd5':_0x13400c,'fileTime':_0x5af398['time'],'thumbPath':_0x700587,'thumbSize':_0x191828,'thumbWidth':_0x5af398[_0x5c5dda(0x12f)],'thumbHeight':_0x5af398[_0x5c5dda(0x14b)],'fileSize':_0x8dac21[_0x5c5dda(0x13a)]('',_0x4b3145)}};return _0x19095d;}static async[_0x29a23d(0x132)](_0x5ddc0b){const _0x1b1617=_0x29a23d,_0x27ffa6={'LrSYk':function(_0x4b4033,_0x24d0ce){return _0x4b4033(_0x24d0ce);},'wTwHj':_0x1b1617(0x15f),'COEMI':function(_0x389ad7,_0x31b10a){return _0x389ad7===_0x31b10a;},'iIUoc':'文件异常，大小为0'},{converted:_0x1cd7dd,path:_0x1b53cd,duration:_0x1a5240}=await _0x27ffa6[_0x1b1617(0x143)](encodeSilk,_0x5ddc0b);if(!_0x1b53cd)throw _0x27ffa6[_0x1b1617(0x157)];const {md5:_0x6c7005,fileName:_0x4c0c57,path:_0x10e75e,fileSize:_0x5e5a1d}=await NTQQFileApi[_0x1b1617(0x162)](_0x1b53cd,ElementType['PTT']);if(_0x27ffa6[_0x1b1617(0x123)](_0x5e5a1d,0x0))throw _0x27ffa6[_0x1b1617(0x125)];return _0x1cd7dd&&_0x471ae7[_0x1b1617(0x12c)](_0x1b53cd)[_0x1b1617(0x140)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x4c0c57,'filePath':_0x10e75e,'md5HexStr':_0x6c7005,'fileSize':_0x5e5a1d,'duration':_0x1a5240||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x3a9c1a){const _0x3cc70c=_0x29a23d;return{'elementType':ElementType[_0x3cc70c(0x158)],'elementId':'','faceElement':{'faceIndex':_0x3a9c1a,'faceType':_0x3a9c1a<0xde?FaceType[_0x3cc70c(0x167)]:FaceType['normal2']}};}static[_0x29a23d(0x120)](_0x19fadf,_0x2f0036,_0xcaf4e,_0x4ebdc4){const _0x58c0be=_0x29a23d;return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x19fadf,'emojiId':_0x2f0036,'key':_0xcaf4e,'faceName':_0x4ebdc4||mFaceCache[_0x58c0be(0x128)](_0x2f0036)||_0x58c0be(0x117)}};}static[_0x29a23d(0x144)](_0x3fc9d9){const _0x3af700=_0x29a23d;return{'elementType':ElementType[_0x3af700(0x158)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x3af700(0x144)],'faceType':FaceType[_0x3af700(0x144)],'faceText':_0x3af700(0x111),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x29a23d(0x12b)](_0x42812a){const _0x1d406d=_0x29a23d;return{'elementType':ElementType[_0x1d406d(0x158)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1d406d(0x14c)],'faceText':_0x1d406d(0x10f),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x29a23d(0x160)](_0x5cb6f0){const _0x4f61d2=_0x29a23d,_0x2f968d={'PFHof':function(_0x50e53f,_0x36cf2e){return _0x50e53f!==_0x36cf2e;},'xtSWX':_0x4f61d2(0x138)};return _0x2f968d[_0x4f61d2(0x14d)](typeof _0x5cb6f0,_0x2f968d[_0x4f61d2(0x141)])&&(_0x5cb6f0=JSON['stringify'](_0x5cb6f0)),{'elementType':ElementType[_0x4f61d2(0x13f)],'elementId':'','arkElement':{'bytesData':_0x5cb6f0,'linkInfo':null,'subElementType':null}};}static[_0x29a23d(0x113)](_0x4d3a00){const _0x34ebb4=_0x29a23d;return{'elementType':ElementType[_0x34ebb4(0x133)],'elementId':'','markdownElement':{'content':_0x4d3a00}};}}