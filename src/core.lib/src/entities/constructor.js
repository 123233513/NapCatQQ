function _0x16aa(){const _0x5b30aa=['screenshots','stat','OAmdV','DGUAR','BqzBr','FACE','nyUym','oxmov','TEXT','WAAgZ','文件异常，大小为0','file','语音转换失败,\x20请检查语音文件是否正常','RPS','QSid','AniStickerId','replace','jzHsh','get','reply','join','Bot\x20Test','xrnkq','height','Thumb','1089746DXNGjn','notAt','6DNKOUn','PCWNQ','stringify','LJNoB','copyFile','404319PJqAcv','8UCxMVP','HSYDd','find','ark','PTT','1292522JlInGD','[骰子]','ARK','sep','dice','video','UFghA','[商城表情]','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','uploadFile','then','aXoPt','getImageSize','VIDEO','_0.png','wBGCm','ptt','LooiR','set','3950zdljzJ','end','jpg','PIC','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','3975345QwVIkw','string','REPLY','6381xWfdhL','3572000aQgUAh','NrHNr','text','839808xKRmYD','unlink','width','toString','fMVeE','获取视频封面失败，使用默认封面','gif','AniStickerType','FILE','markdown','size','AniStickerPackId','kAqLy','pic','mface','MFACE','lPHgI','MARKDOWN','catch'];_0x16aa=function(){return _0x5b30aa;};return _0x16aa();}const _0xcf1bcc=_0x2a33;(function(_0x2e9a6e,_0x4912dc){const _0x4445fc=_0x2a33,_0x227013=_0x2e9a6e();while(!![]){try{const _0x13713d=parseInt(_0x4445fc(0x1c0))/0x1+parseInt(_0x4445fc(0x1a1))/0x2+parseInt(_0x4445fc(0x19b))/0x3*(-parseInt(_0x4445fc(0x19c))/0x4)+-parseInt(_0x4445fc(0x1b9))/0x5+parseInt(_0x4445fc(0x196))/0x6*(-parseInt(_0x4445fc(0x194))/0x7)+parseInt(_0x4445fc(0x1bd))/0x8+-parseInt(_0x4445fc(0x1bc))/0x9*(parseInt(_0x4445fc(0x1b4))/0xa);if(_0x13713d===_0x4912dc)break;else _0x227013['push'](_0x227013['shift']());}catch(_0x157fd5){_0x227013['push'](_0x227013['shift']());}}}(_0x16aa,0x6985d));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x58f9ac}from'node:fs';import _0x36523d from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x5f288a from'./face_config.json';import*as _0x25e856 from'node:path';import{SignMiniApp}from'../apis';function _0x2a33(_0x489f9c,_0x48ddcb){const _0x16aa44=_0x16aa();return _0x2a33=function(_0x2a3336,_0x5e93bb){_0x2a3336=_0x2a3336-0x172;let _0x341b63=_0x16aa44[_0x2a3336];return _0x341b63;},_0x2a33(_0x489f9c,_0x48ddcb);}export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0xcf1bcc(0x1bf)](_0x2c4fa4){const _0x41d846=_0xcf1bcc;return{'elementType':ElementType[_0x41d846(0x183)],'elementId':'','textElement':{'content':_0x2c4fa4,'atType':AtType[_0x41d846(0x195)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x16f754,_0x2efec4,_0x1412a2,_0x1d9ca1){const _0x130fb1=_0xcf1bcc;return{'elementType':ElementType[_0x130fb1(0x183)],'elementId':'','textElement':{'content':'@'+_0x1d9ca1,'atType':_0x1412a2,'atUid':_0x16f754,'atTinyId':'','atNtUid':_0x2efec4}};}static[_0xcf1bcc(0x18e)](_0x475d20,_0x442043,_0x5e75b9,_0x4fa11f){const _0x4c4b11=_0xcf1bcc;return{'elementType':ElementType[_0x4c4b11(0x1bb)],'elementId':'','replyElement':{'replayMsgSeq':_0x475d20,'replayMsgId':_0x442043,'senderUin':_0x5e75b9,'senderUinStr':_0x4fa11f}};}static async[_0xcf1bcc(0x175)](_0x57bfc3,_0x2280f3='',_0x291bbc=0x0){const _0x2a1055=_0xcf1bcc,_0x4c4447={'aXoPt':_0x2a1055(0x185),'CbVII':function(_0x317369,_0x5ca2b6){return _0x317369(_0x5ca2b6);}},{md5:_0x3e8816,fileName:_0x1ac446,path:_0x42aed6,fileSize:_0x24d6de}=await NTQQFileApi[_0x2a1055(0x1aa)](_0x57bfc3,ElementType[_0x2a1055(0x1b7)],_0x291bbc);if(_0x24d6de===0x0)throw _0x4c4447[_0x2a1055(0x1ac)];const _0x5b5128=await NTQQFileApi[_0x2a1055(0x1ad)](_0x57bfc3),_0x27c190={'md5HexStr':_0x3e8816,'fileSize':_0x24d6de[_0x2a1055(0x1c3)](),'picWidth':_0x5b5128?.['width'],'picHeight':_0x5b5128?.['height'],'fileName':_0x1ac446,'sourcePath':_0x42aed6,'original':!![],'picType':_0x4c4447['CbVII'](isGIF,_0x57bfc3)?PicType[_0x2a1055(0x1c6)]:PicType[_0x2a1055(0x1b6)],'picSubType':_0x291bbc,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2280f3};return{'elementType':ElementType[_0x2a1055(0x1b7)],'elementId':'','picElement':_0x27c190};}static async[_0xcf1bcc(0x186)](_0x273dca,_0x474c2f='',_0x33e179=''){const _0x22939b=_0xcf1bcc,_0x3d12c3={'lPHgI':_0x22939b(0x185),'jzHsh':function(_0x22e1f0,_0x417a95){return _0x22e1f0||_0x417a95;}},{md5:_0x5be01b,fileName:_0x3c63a6,path:_0x2cb72a,fileSize:_0x1d5bd9}=await NTQQFileApi[_0x22939b(0x1aa)](_0x273dca,ElementType[_0x22939b(0x1c8)]);if(_0x1d5bd9===0x0)throw _0x3d12c3[_0x22939b(0x178)];const _0x5db8cf={'elementType':ElementType[_0x22939b(0x1c8)],'elementId':'','fileElement':{'fileName':_0x3d12c3[_0x22939b(0x18c)](_0x474c2f,_0x3c63a6),'folderId':_0x33e179,'filePath':_0x2cb72a,'fileSize':_0x1d5bd9[_0x22939b(0x1c3)]()}};return _0x5db8cf;}static async[_0xcf1bcc(0x1a6)](_0x4d5545,_0x5343ef='',_0x163312=''){const _0x385a83=_0xcf1bcc,_0x3166cb={'ronDu':function(_0x5f29c6,_0x3de5f8,_0x2c5d1b){return _0x5f29c6(_0x3de5f8,_0x2c5d1b);},'Kzlge':_0x385a83(0x1c5),'kAqLy':function(_0x385a03,_0x549407){return _0x385a03(_0x549407);},'xrnkq':'error','WAAgZ':function(_0x4440a2,_0x27960e){return _0x4440a2+_0x27960e;},'UFghA':'end','PCWNQ':function(_0xf02374,_0x2b93e7){return _0xf02374===_0x2b93e7;},'BqzBr':_0x385a83(0x185),'DtAng':'mp4','nyUym':function(_0x38d9b0,_0x1e2e44,_0x172bcc){return _0x38d9b0(_0x1e2e44,_0x172bcc);},'LooiR':'获取视频信息失败','NrHNr':function(_0x6f2a98,_0x2de727){return _0x6f2a98(_0x2de727);},'DGUAR':function(_0x4c8c27,_0x48bb8d){return _0x4c8c27||_0x48bb8d;}},{fileName:_0x24dd35,path:_0x112185,fileSize:_0x3f4372,md5:_0x4d0238}=await NTQQFileApi[_0x385a83(0x1aa)](_0x4d5545,ElementType[_0x385a83(0x1ae)]);if(_0x3166cb[_0x385a83(0x197)](_0x3f4372,0x0))throw _0x3166cb[_0x385a83(0x17f)];let _0x1f6d0d=_0x112185[_0x385a83(0x18b)](_0x25e856['sep']+'Ori'+_0x25e856[_0x385a83(0x1a4)],_0x25e856['sep']+_0x385a83(0x193)+_0x25e856[_0x385a83(0x1a4)]);_0x1f6d0d=_0x25e856['dirname'](_0x1f6d0d);let _0x4089c6={'width':0x780,'height':0x438,'time':0xf,'format':_0x3166cb['DtAng'],'size':_0x3f4372,'filePath':_0x4d5545};try{_0x4089c6=await _0x3166cb[_0x385a83(0x174)](getVideoInfo,_0x112185);}catch(_0x593b57){_0x3166cb[_0x385a83(0x181)](logError,_0x3166cb[_0x385a83(0x1b2)],_0x593b57);}const _0x18e5d1=new Promise((_0x560dbe,_0x5946ad)=>{const _0x1fa102=_0x385a83,_0x1c6613={'MZgXs':function(_0x38058f,_0x23d066){const _0x119215=_0x2a33;return _0x3166cb[_0x119215(0x174)](_0x38058f,_0x23d066);}},_0x55582c=_0x4d0238+_0x1fa102(0x1af),_0x2d562e=_0x25e856[_0x1fa102(0x18f)](_0x1f6d0d,_0x55582c);_0x3166cb[_0x1fa102(0x174)](_0x36523d,_0x4d5545)['on'](_0x1fa102(0x1b5),()=>{})['on'](_0x3166cb[_0x1fa102(0x191)],_0x171fef=>{const _0x41a917=_0x1fa102;_0x3166cb['ronDu'](logDebug,_0x3166cb['Kzlge'],_0x171fef),_0x163312?_0x58f9ac[_0x41a917(0x19a)](_0x163312,_0x2d562e)['then'](()=>{_0x560dbe(_0x2d562e);})['catch'](_0x5946ad):_0x58f9ac['writeFile'](_0x2d562e,defaultVideoThumb)[_0x41a917(0x1ab)](()=>{_0x1c6613['MZgXs'](_0x560dbe,_0x2d562e);})[_0x41a917(0x17a)](_0x5946ad);})[_0x1fa102(0x17b)]({'timestamps':[0x0],'filename':_0x55582c,'folder':_0x1f6d0d,'size':_0x3166cb[_0x1fa102(0x184)](_0x3166cb[_0x1fa102(0x184)](_0x4089c6[_0x1fa102(0x1c2)],'x'),_0x4089c6['height'])})['on'](_0x3166cb[_0x1fa102(0x1a7)],()=>{const _0x2aa7ae=_0x1fa102;_0x3166cb[_0x2aa7ae(0x174)](_0x560dbe,_0x2d562e);});}),_0x49be4b=new Map(),_0x1a6b04=await _0x18e5d1,_0x3be2b0=(await _0x58f9ac[_0x385a83(0x17c)](_0x1a6b04))[_0x385a83(0x172)];_0x49be4b[_0x385a83(0x1b3)](0x0,_0x1a6b04);const _0x420600=await _0x3166cb[_0x385a83(0x1be)](calculateFileMD5,_0x1a6b04),_0x453fb1={'elementType':ElementType[_0x385a83(0x1ae)],'elementId':'','videoElement':{'fileName':_0x3166cb[_0x385a83(0x17e)](_0x5343ef,_0x24dd35),'filePath':_0x112185,'videoMd5':_0x4d0238,'thumbMd5':_0x420600,'fileTime':_0x4089c6['time'],'thumbPath':_0x49be4b,'thumbSize':_0x3be2b0,'thumbWidth':_0x4089c6['width'],'thumbHeight':_0x4089c6[_0x385a83(0x192)],'fileSize':_0x3166cb[_0x385a83(0x184)]('',_0x3f4372)}};return _0x453fb1;}static async[_0xcf1bcc(0x1b1)](_0x14da92){const _0x36774e=_0xcf1bcc,_0x80a326={'OAmdV':'文件异常，大小为0'},{converted:_0x4bf53d,path:_0x3549d8,duration:_0x5871aa}=await encodeSilk(_0x14da92);if(!_0x3549d8)throw _0x36774e(0x187);const {md5:_0x22a588,fileName:_0x2a3399,path:_0x568cb8,fileSize:_0x4e044b}=await NTQQFileApi[_0x36774e(0x1aa)](_0x3549d8,ElementType[_0x36774e(0x1a0)]);if(_0x4e044b===0x0)throw _0x80a326[_0x36774e(0x17d)];return _0x4bf53d&&_0x58f9ac[_0x36774e(0x1c1)](_0x3549d8)[_0x36774e(0x1ab)](),{'elementType':ElementType[_0x36774e(0x1a0)],'elementId':'','pttElement':{'fileName':_0x2a3399,'filePath':_0x568cb8,'md5HexStr':_0x22a588,'fileSize':_0x4e044b,'duration':_0x5871aa||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x15f141){const _0x41577a=_0xcf1bcc,_0x5726b5={'GujZv':function(_0x28c4a5,_0xfc2bab){return _0x28c4a5>=_0xfc2bab;}},_0x4a4e6f=_0x5f288a['sysface'],_0x201c4c=_0x5f288a['emoji'],_0x10e007=_0x4a4e6f[_0x41577a(0x19e)](_0x41abbe=>_0x41abbe[_0x41577a(0x189)]===_0x15f141['toString']());_0x15f141=parseInt(_0x15f141[_0x41577a(0x1c3)]());let _0x3fcb48=0x1;return _0x5726b5['GujZv'](_0x15f141,0xde)&&(_0x3fcb48=0x2),_0x10e007['AniStickerType']&&(_0x3fcb48=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x15f141,'faceType':_0x3fcb48,'faceText':_0x10e007['QDes'],'stickerId':_0x10e007[_0x41577a(0x18a)],'stickerType':_0x10e007[_0x41577a(0x1c7)],'packId':_0x10e007[_0x41577a(0x173)],'sourceType':0x1}};}static[_0xcf1bcc(0x176)](_0x59aa4d,_0x3b0346,_0x478f35,_0x40a5c2){const _0x3b7324=_0xcf1bcc,_0x50e3ff={'HSYDd':_0x3b7324(0x1a8)};return{'elementType':ElementType[_0x3b7324(0x177)],'marketFaceElement':{'emojiPackageId':_0x59aa4d,'emojiId':_0x3b0346,'key':_0x478f35,'faceName':_0x40a5c2||mFaceCache[_0x3b7324(0x18d)](_0x3b0346)||_0x50e3ff[_0x3b7324(0x19d)]}};}static[_0xcf1bcc(0x1a5)](_0x3bf631){const _0x2af76a=_0xcf1bcc,_0x3a339b={'fMVeE':_0x2af76a(0x1a2)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x2af76a(0x1a5)],'faceType':FaceType[_0x2af76a(0x1a5)],'faceText':_0x3a339b[_0x2af76a(0x1c4)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x4a5364){const _0x214a01=_0xcf1bcc;return{'elementType':ElementType[_0x214a01(0x180)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x214a01(0x188)],'faceText':'[包剪锤]','faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0xcf1bcc(0x19f)](_0x1d5271){const _0x1755bb=_0xcf1bcc,_0x20d8e4={'wBGCm':_0x1755bb(0x1ba)};return typeof _0x1d5271!==_0x20d8e4[_0x1755bb(0x1b0)]&&(_0x1d5271=JSON[_0x1755bb(0x198)](_0x1d5271)),{'elementType':ElementType[_0x1755bb(0x1a3)],'elementId':'','arkElement':{'bytesData':_0x1d5271,'linkInfo':null,'subElementType':null}};}static[_0xcf1bcc(0x1c9)](_0xee7189){const _0x500e4e=_0xcf1bcc;return{'elementType':ElementType[_0x500e4e(0x179)],'elementId':'','markdownElement':{'content':_0xee7189}};}static async['miniapp'](){const _0x447cc2=_0xcf1bcc,_0x17b1b6={'OXLaO':function(_0x30f47d,_0x2b7ec5){return _0x30f47d(_0x2b7ec5);},'LJNoB':_0x447cc2(0x190),'oxmov':'https://www.bilibili.com/','iWqgw':_0x447cc2(0x1a9)};let _0xf4adb=await _0x17b1b6['OXLaO'](SignMiniApp,{'prompt':_0x17b1b6[_0x447cc2(0x199)],'title':_0x17b1b6[_0x447cc2(0x199)],'preview':_0x447cc2(0x1b8),'jumpUrl':_0x17b1b6[_0x447cc2(0x182)],'tag':_0x17b1b6[_0x447cc2(0x199)],'tagIcon':_0x447cc2(0x1a9),'source':_0x17b1b6[_0x447cc2(0x199)],'sourcelogo':_0x17b1b6['iWqgw']});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0xf4adb,'linkInfo':null,'subElementType':null}};}}