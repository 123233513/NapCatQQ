function _0x3ba9(_0x332be3,_0x13e089){const _0x52acd1=_0x52ac();return _0x3ba9=function(_0x3ba9b0,_0x26f422){_0x3ba9b0=_0x3ba9b0-0x14b;let _0x56dd2c=_0x52acd1[_0x3ba9b0];return _0x56dd2c;},_0x3ba9(_0x332be3,_0x13e089);}const _0x4d10dc=_0x3ba9;(function(_0x51160a,_0x4bd706){const _0x3420df=_0x3ba9,_0x37b9a3=_0x51160a();while(!![]){try{const _0x55b205=-parseInt(_0x3420df(0x156))/0x1*(-parseInt(_0x3420df(0x159))/0x2)+-parseInt(_0x3420df(0x171))/0x3+parseInt(_0x3420df(0x180))/0x4*(-parseInt(_0x3420df(0x184))/0x5)+-parseInt(_0x3420df(0x151))/0x6*(-parseInt(_0x3420df(0x178))/0x7)+-parseInt(_0x3420df(0x168))/0x8*(parseInt(_0x3420df(0x166))/0x9)+parseInt(_0x3420df(0x14b))/0xa*(-parseInt(_0x3420df(0x160))/0xb)+-parseInt(_0x3420df(0x15f))/0xc*(-parseInt(_0x3420df(0x161))/0xd);if(_0x55b205===_0x4bd706)break;else _0x37b9a3['push'](_0x37b9a3['shift']());}catch(_0x421138){_0x37b9a3['push'](_0x37b9a3['shift']());}}}(_0x52ac,0x4a495));function _0x52ac(){const _0x2470cc=['jEGVD','xdGlO','ptt','sep','eiuqc','height','normal2','获取视频信息失败','_0.png','zmGfo','face','20ichQmj','auhQU','gif','PTT','FACE','dice','968886xrufWV','writeFile','XdChd','end','getImageSize','1TAegKb','set','video','65534EGXXDY','normal','FILE','catch','then','[骰子]','11142744vGyVsC','2073313hpUdbP','13kPzKxI','width','PIC','lNjwS','[包剪锤]','7848WPeZzQ','TEXT','176hfUBzc','rps','ARK','vVayJ','screenshots','REPLY','replace','文件异常，大小为0','fjmAV','1199466eJTBTF','ttGzO','oeNdX','time','kcbMW','eTXjr','copyFile','14oGJiAI','notAt','toString','MARKDOWN','error','stat','ziCuZ','jpg','8zopJrZ','pQtFs','VIDEO','视频信息','460105GoeqPK','ark','reply','inDCM','zyeXX','KYiQm','RPS','zoRZW','uploadFile','Ori'];_0x52ac=function(){return _0x2470cc;};return _0x52ac();}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x4b3312}from'node:fs';import _0x3a3cc2 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static['text'](_0x1f0bff){const _0x40897d=_0x3ba9;return{'elementType':ElementType[_0x40897d(0x167)],'elementId':'','textElement':{'content':_0x1f0bff,'atType':AtType[_0x40897d(0x179)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x5589e0,_0x32a320,_0x4c589b,_0x35bdb6){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x35bdb6,'atType':_0x4c589b,'atUid':_0x5589e0,'atTinyId':'','atNtUid':_0x32a320}};}static[_0x4d10dc(0x186)](_0x2d744e,_0x16141a,_0x3c4bd8,_0x3c4250){const _0x4d294e=_0x4d10dc;return{'elementType':ElementType[_0x4d294e(0x16d)],'elementId':'','replyElement':{'replayMsgSeq':_0x2d744e,'replayMsgId':_0x16141a,'senderUin':_0x3c4bd8,'senderUinStr':_0x3c4250}};}static async['pic'](_0x26157c,_0x143fa9='',_0x1597fd=0x0){const _0x719956=_0x4d10dc,_0xb9a3e2={'auhQU':function(_0xda6453,_0x424ec5){return _0xda6453===_0x424ec5;},'sTTaX':_0x719956(0x16f),'XdChd':function(_0x3cc85e,_0x52494b){return _0x3cc85e(_0x52494b);},'eTXjr':function(_0x2275d4,_0x59cd45,_0x358d8e){return _0x2275d4(_0x59cd45,_0x358d8e);},'inDCM':'图片信息'},{md5:_0x1a4d5e,fileName:_0x5bee39,path:_0x5292ce,fileSize:_0x514680}=await NTQQFileApi[_0x719956(0x18c)](_0x26157c,ElementType[_0x719956(0x163)],_0x1597fd);if(_0xb9a3e2[_0x719956(0x14c)](_0x514680,0x0))throw _0xb9a3e2['sTTaX'];const _0x4b3a6d=await NTQQFileApi[_0x719956(0x155)](_0x26157c),_0x3c8127={'md5HexStr':_0x1a4d5e,'fileSize':_0x514680['toString'](),'picWidth':_0x4b3a6d?.[_0x719956(0x162)],'picHeight':_0x4b3a6d?.[_0x719956(0x193)],'fileName':_0x5bee39,'sourcePath':_0x5292ce,'original':!![],'picType':_0xb9a3e2[_0x719956(0x153)](isGIF,_0x26157c)?PicType[_0x719956(0x14d)]:PicType[_0x719956(0x17f)],'picSubType':_0x1597fd,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x143fa9};return _0xb9a3e2[_0x719956(0x176)](logDebug,_0xb9a3e2[_0x719956(0x187)],_0x3c8127),{'elementType':ElementType[_0x719956(0x163)],'elementId':'','picElement':_0x3c8127};}static async['file'](_0x2b6e2a,_0x2e82b5=''){const _0x2b995b=_0x4d10dc,_0x35f475={'KYiQm':function(_0x1699e1,_0x349c34){return _0x1699e1===_0x349c34;},'zoRZW':function(_0x1bbe60,_0x25c7a7){return _0x1bbe60||_0x25c7a7;}},{md5:_0x35905c,fileName:_0x24419d,path:_0x20d80d,fileSize:_0x2675aa}=await NTQQFileApi[_0x2b995b(0x18c)](_0x2b6e2a,ElementType[_0x2b995b(0x15b)]);if(_0x35f475[_0x2b995b(0x189)](_0x2675aa,0x0))throw'文件异常，大小为0';const _0x2a18be={'elementType':ElementType[_0x2b995b(0x15b)],'elementId':'','fileElement':{'fileName':_0x35f475[_0x2b995b(0x18b)](_0x2e82b5,_0x24419d),'filePath':_0x20d80d,'fileSize':_0x2675aa[_0x2b995b(0x17a)]()}};return _0x2a18be;}static async[_0x4d10dc(0x158)](_0x4993f6,_0x1fd7be='',_0x4f6e34=''){const _0x3ecc5d=_0x4d10dc,_0x4dc86d={'zmGfo':function(_0x5cf016,_0x156495,_0x2b2a0b){return _0x5cf016(_0x156495,_0x2b2a0b);},'ziCuZ':_0x3ecc5d(0x17c),'ttGzO':function(_0x74b9f9,_0x3e15e3){return _0x74b9f9+_0x3e15e3;},'Okksq':_0x3ecc5d(0x154),'smIXj':_0x3ecc5d(0x16f),'zyeXX':function(_0x34fd58,_0x5678e1){return _0x34fd58(_0x5678e1);},'wSnJU':'path','pQtFs':'mp4','nWRpW':_0x3ecc5d(0x183),'eiuqc':_0x3ecc5d(0x195),'sqgBG':function(_0x22455a,_0x46ae30){return _0x22455a(_0x46ae30);},'xdGlO':function(_0x3e4683,_0x4412f1){return _0x3e4683||_0x4412f1;}},{fileName:_0x38351e,path:_0x4fc797,fileSize:_0x33d627,md5:_0x214a0e}=await NTQQFileApi['uploadFile'](_0x4993f6,ElementType['VIDEO']);if(_0x33d627===0x0)throw _0x4dc86d['smIXj'];const _0x42b9d7=_0x4dc86d[_0x3ecc5d(0x188)](require,_0x4dc86d['wSnJU']);let _0x5aef77=_0x4fc797[_0x3ecc5d(0x16e)](_0x42b9d7[_0x3ecc5d(0x191)]+_0x3ecc5d(0x18d)+_0x42b9d7[_0x3ecc5d(0x191)],_0x42b9d7[_0x3ecc5d(0x191)]+'Thumb'+_0x42b9d7[_0x3ecc5d(0x191)]);_0x5aef77=_0x42b9d7['dirname'](_0x5aef77);let _0x7aa4b4={'width':0x780,'height':0x438,'time':0xf,'format':_0x4dc86d[_0x3ecc5d(0x181)],'size':_0x33d627,'filePath':_0x4993f6};try{_0x7aa4b4=await _0x4dc86d[_0x3ecc5d(0x188)](getVideoInfo,_0x4fc797),logDebug(_0x4dc86d['nWRpW'],_0x7aa4b4);}catch(_0x209e8b){_0x4dc86d[_0x3ecc5d(0x197)](logError,_0x4dc86d[_0x3ecc5d(0x192)],_0x209e8b);}const _0x2d4c27=new Promise((_0x10ce3e,_0x4ba519)=>{const _0x4ae2f1=_0x3ecc5d,_0x522543={'lNjwS':function(_0x1956a6,_0x14e5b,_0x2652d2){const _0x2f7d15=_0x3ba9;return _0x4dc86d[_0x2f7d15(0x197)](_0x1956a6,_0x14e5b,_0x2652d2);},'NmiFR':'获取视频封面失败，使用默认封面'},_0x2043e1=_0x214a0e+_0x4ae2f1(0x196),_0x3fa589=_0x42b9d7['join'](_0x5aef77,_0x2043e1);_0x3a3cc2(_0x4993f6)['on']('end',()=>{})['on'](_0x4dc86d[_0x4ae2f1(0x17e)],_0x5c12cb=>{const _0x44034c=_0x4ae2f1,_0x19b934={'vVayJ':function(_0x2e84cf,_0x4611d9){return _0x2e84cf(_0x4611d9);}};_0x522543[_0x44034c(0x164)](logDebug,_0x522543['NmiFR'],_0x5c12cb),_0x4f6e34?_0x4b3312[_0x44034c(0x177)](_0x4f6e34,_0x3fa589)[_0x44034c(0x15d)](()=>{const _0x1032d0=_0x44034c;_0x19b934[_0x1032d0(0x16b)](_0x10ce3e,_0x3fa589);})[_0x44034c(0x15c)](_0x4ba519):_0x4b3312[_0x44034c(0x152)](_0x3fa589,defaultVideoThumb)[_0x44034c(0x15d)](()=>{_0x10ce3e(_0x3fa589);})[_0x44034c(0x15c)](_0x4ba519);})[_0x4ae2f1(0x16c)]({'timestamps':[0x0],'filename':_0x2043e1,'folder':_0x5aef77,'size':_0x4dc86d[_0x4ae2f1(0x172)](_0x7aa4b4[_0x4ae2f1(0x162)]+'x',_0x7aa4b4['height'])})['on'](_0x4dc86d['Okksq'],()=>{_0x10ce3e(_0x3fa589);});}),_0x4d1a18=new Map(),_0x313783=await _0x2d4c27,_0x2e6c18=(await _0x4b3312[_0x3ecc5d(0x17d)](_0x313783))['size'];_0x4d1a18[_0x3ecc5d(0x157)](0x0,_0x313783);const _0x59f6d6=await _0x4dc86d['sqgBG'](calculateFileMD5,_0x313783),_0x76c660={'elementType':ElementType[_0x3ecc5d(0x182)],'elementId':'','videoElement':{'fileName':_0x4dc86d[_0x3ecc5d(0x18f)](_0x1fd7be,_0x38351e),'filePath':_0x4fc797,'videoMd5':_0x214a0e,'thumbMd5':_0x59f6d6,'fileTime':_0x7aa4b4[_0x3ecc5d(0x174)],'thumbPath':_0x4d1a18,'thumbSize':_0x2e6c18,'thumbWidth':_0x7aa4b4[_0x3ecc5d(0x162)],'thumbHeight':_0x7aa4b4['height'],'fileSize':_0x4dc86d[_0x3ecc5d(0x172)]('',_0x33d627)}};return _0x76c660;}static async[_0x4d10dc(0x190)](_0x34b90e){const _0x1e93b3=_0x4d10dc,_0x1651e4={'XiBmz':function(_0xabe4fb,_0x4f693d){return _0xabe4fb(_0x4f693d);},'kcbMW':function(_0x49bbd1,_0x39ad09){return _0x49bbd1===_0x39ad09;},'oeNdX':_0x1e93b3(0x16f),'jEGVD':function(_0x2d7bc8,_0x43ab0e){return _0x2d7bc8||_0x43ab0e;}},{converted:_0xdf6fc8,path:_0x30df17,duration:_0x1a3ec6}=await _0x1651e4['XiBmz'](encodeSilk,_0x34b90e),{md5:_0x3b7c68,fileName:_0x3b021c,path:_0x5d23fd,fileSize:_0xccd11a}=await NTQQFileApi[_0x1e93b3(0x18c)](_0x30df17,ElementType[_0x1e93b3(0x14e)]);if(_0x1651e4[_0x1e93b3(0x175)](_0xccd11a,0x0))throw _0x1651e4[_0x1e93b3(0x173)];return _0xdf6fc8&&_0x4b3312['unlink'](_0x30df17)[_0x1e93b3(0x15d)](),{'elementType':ElementType[_0x1e93b3(0x14e)],'elementId':'','pttElement':{'fileName':_0x3b021c,'filePath':_0x5d23fd,'md5HexStr':_0x3b7c68,'fileSize':_0xccd11a,'duration':_0x1651e4[_0x1e93b3(0x18e)](_0x1a3ec6,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4d10dc(0x198)](_0xda5f6){const _0x540d3d=_0x4d10dc,_0x12d106={'fjmAV':function(_0x8b75e7,_0x5a3158){return _0x8b75e7<_0x5a3158;}};return{'elementType':ElementType[_0x540d3d(0x14f)],'elementId':'','faceElement':{'faceIndex':_0xda5f6,'faceType':_0x12d106[_0x540d3d(0x170)](_0xda5f6,0xde)?FaceType[_0x540d3d(0x15a)]:FaceType[_0x540d3d(0x194)]}};}static[_0x4d10dc(0x150)](_0x28540f){const _0x5e18b1=_0x4d10dc;return{'elementType':ElementType[_0x5e18b1(0x14f)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x5e18b1(0x150)],'faceType':FaceType[_0x5e18b1(0x150)],'faceText':_0x5e18b1(0x15e),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4d10dc(0x169)](_0x339ef4){const _0x4ea7b1=_0x4d10dc,_0x2dd8a0={'pjLvw':_0x4ea7b1(0x165)};return{'elementType':ElementType[_0x4ea7b1(0x14f)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4ea7b1(0x18a)],'faceText':_0x2dd8a0['pjLvw'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4d10dc(0x185)](_0xe6da23){const _0x386fd0=_0x4d10dc;return{'elementType':ElementType[_0x386fd0(0x16a)],'elementId':'','arkElement':{'bytesData':_0xe6da23,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x21a181){const _0x5acdb6=_0x4d10dc;return{'elementType':ElementType[_0x5acdb6(0x17b)],'elementId':'','markdownElement':{'content':_0x21a181}};}}
