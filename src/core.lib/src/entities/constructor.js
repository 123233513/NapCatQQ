function _0x3d6d(){const _0x442260=['98132KCnpbx','stringify','获取视频信息失败','time','Thumb','图片信息','hVyVc','[包剪锤]','TEXT','get','QDes','bsOVA','screenshots','size','视频信息','width','path','mface','writeFile','owZrK','134123EYQlzD','sysface','sep','PTT','ptt','VIDEO','catch','QSid','error','kzgif','zYmlP','27JsSTst','pBUQy','gif','toString','Lfhnv','OxFfS','获取视频封面失败，使用默认封面','Miwix','wwinL','find','QUpOJ','stat','ark','20vLMfIs','itfNH','652797UXzmWO','PIC','FACE','text','video','face','KrfaP','AniStickerId','dirname','getImageSize','AZhlx','height','Ori','ZvFxe','RPS','语音转换失败,\x20请检查语音文件是否正常','pic','then','emoji','306438emhNOd','uploadFile','AniStickerType','[骰子]','1295315OgzsLv','replace','WKAiZ','FILE','eMykT','311610tiblNZ','mp4','jpg','VkxpX','dice','UkMUl','1282584OkCkyr','MFACE','copyFile','ARK','notAt','file'];_0x3d6d=function(){return _0x442260;};return _0x3d6d();}const _0x44b0df=_0x521b;(function(_0x1deeb9,_0x50364e){const _0x369a7f=_0x521b,_0x5710cd=_0x1deeb9();while(!![]){try{const _0x28b71c=-parseInt(_0x369a7f(0x165))/0x1+parseInt(_0x369a7f(0x145))/0x2+parseInt(_0x369a7f(0x11a))/0x3*(parseInt(_0x369a7f(0x151))/0x4)+-parseInt(_0x369a7f(0x127))/0x5*(parseInt(_0x369a7f(0x13c))/0x6)+parseInt(_0x369a7f(0x140))/0x7+-parseInt(_0x369a7f(0x14b))/0x8+parseInt(_0x369a7f(0x129))/0x9;if(_0x28b71c===_0x50364e)break;else _0x5710cd['push'](_0x5710cd['shift']());}catch(_0x4cd10d){_0x5710cd['push'](_0x5710cd['shift']());}}}(_0x3d6d,0x21112));function _0x521b(_0x124e63,_0xd5a107){const _0x3d6d77=_0x3d6d();return _0x521b=function(_0x521b3a,_0x58b533){_0x521b3a=_0x521b3a-0x113;let _0x1e1a0e=_0x3d6d77[_0x521b3a];return _0x1e1a0e;},_0x521b(_0x124e63,_0xd5a107);}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x22d392}from'node:fs';import _0x2ee0f6 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x4f2513 from'./face_config.json';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x44b0df(0x12c)](_0x4c624c){const _0x29b0ad=_0x44b0df;return{'elementType':ElementType[_0x29b0ad(0x159)],'elementId':'','textElement':{'content':_0x4c624c,'atType':AtType[_0x29b0ad(0x14f)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x49dc32,_0x2eb998,_0x3ae47b,_0x186ef2){const _0x3b5b9a=_0x44b0df;return{'elementType':ElementType[_0x3b5b9a(0x159)],'elementId':'','textElement':{'content':'@'+_0x186ef2,'atType':_0x3ae47b,'atUid':_0x49dc32,'atTinyId':'','atNtUid':_0x2eb998}};}static['reply'](_0x2c1e4b,_0x477cd2,_0x24e52e,_0x11c22a){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x2c1e4b,'replayMsgId':_0x477cd2,'senderUin':_0x24e52e,'senderUinStr':_0x11c22a}};}static async[_0x44b0df(0x139)](_0x2a33a8,_0x5c9837='',_0x3f08fb=0x0){const _0x439e9f=_0x44b0df,_0x3167cd={'ZvFxe':'文件异常，大小为0','hVyVc':function(_0x50131b,_0xdfbff9){return _0x50131b(_0xdfbff9);},'Miwix':_0x439e9f(0x156)},{md5:_0x3d480e,fileName:_0x26c7fa,path:_0x1e94f0,fileSize:_0x4d421e}=await NTQQFileApi[_0x439e9f(0x13d)](_0x2a33a8,ElementType[_0x439e9f(0x12a)],_0x3f08fb);if(_0x4d421e===0x0)throw _0x3167cd[_0x439e9f(0x136)];const _0x1f7573=await NTQQFileApi[_0x439e9f(0x132)](_0x2a33a8),_0x34f8fe={'md5HexStr':_0x3d480e,'fileSize':_0x4d421e[_0x439e9f(0x11d)](),'picWidth':_0x1f7573?.[_0x439e9f(0x160)],'picHeight':_0x1f7573?.[_0x439e9f(0x134)],'fileName':_0x26c7fa,'sourcePath':_0x1e94f0,'original':!![],'picType':_0x3167cd[_0x439e9f(0x157)](isGIF,_0x2a33a8)?PicType[_0x439e9f(0x11c)]:PicType[_0x439e9f(0x147)],'picSubType':_0x3f08fb,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5c9837};return logDebug(_0x3167cd[_0x439e9f(0x121)],_0x34f8fe),{'elementType':ElementType[_0x439e9f(0x12a)],'elementId':'','picElement':_0x34f8fe};}static async[_0x44b0df(0x150)](_0x3c50ba,_0x53f1ae=''){const _0x1be519=_0x44b0df,_0xad26f5={'UnHjs':function(_0x434f34,_0x5db3be){return _0x434f34===_0x5db3be;},'mPSpa':'文件异常，大小为0','PiFLD':function(_0x38f791,_0x6d784){return _0x38f791||_0x6d784;}},{md5:_0x4ed230,fileName:_0x4d03b1,path:_0x9de2ff,fileSize:_0x1acf76}=await NTQQFileApi[_0x1be519(0x13d)](_0x3c50ba,ElementType[_0x1be519(0x143)]);if(_0xad26f5['UnHjs'](_0x1acf76,0x0))throw _0xad26f5['mPSpa'];const _0x42d6c3={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0xad26f5['PiFLD'](_0x53f1ae,_0x4d03b1),'filePath':_0x9de2ff,'fileSize':_0x1acf76[_0x1be519(0x11d)]()}};return _0x42d6c3;}static async[_0x44b0df(0x12d)](_0x294128,_0x5598aa='',_0x54efb6=''){const _0x2c0998=_0x44b0df,_0x9daecc={'WKAiZ':function(_0x3fda4e,_0xdcd794){return _0x3fda4e(_0xdcd794);},'AZhlx':_0x2c0998(0x120),'eMykT':function(_0x4de638,_0x54b602){return _0x4de638(_0x54b602);},'pBUQy':function(_0x8f8f3c,_0x4f2a99){return _0x8f8f3c(_0x4f2a99);},'zYmlP':function(_0x160303,_0x1a9faf){return _0x160303+_0x1a9faf;},'UkMUl':'end','kzgif':function(_0x15af4e,_0x439dcb){return _0x15af4e===_0x439dcb;},'QUpOJ':'文件异常，大小为0','KrfaP':_0x2c0998(0x15f),'gKCnp':function(_0xf6b5cb,_0x4109b3,_0x43a55c){return _0xf6b5cb(_0x4109b3,_0x43a55c);},'OxFfS':function(_0x2d9eb6,_0x144d18){return _0x2d9eb6||_0x144d18;},'ezffX':function(_0x1bf5c8,_0x14a20d){return _0x1bf5c8+_0x14a20d;}},{fileName:_0x35b11b,path:_0x5cfc0a,fileSize:_0x39db6c,md5:_0x213e6d}=await NTQQFileApi[_0x2c0998(0x13d)](_0x294128,ElementType[_0x2c0998(0x114)]);if(_0x9daecc[_0x2c0998(0x118)](_0x39db6c,0x0))throw _0x9daecc[_0x2c0998(0x124)];const _0x533947=_0x9daecc[_0x2c0998(0x144)](require,_0x2c0998(0x161));let _0x1a8fe0=_0x5cfc0a[_0x2c0998(0x141)](_0x533947[_0x2c0998(0x167)]+_0x2c0998(0x135)+_0x533947['sep'],_0x533947[_0x2c0998(0x167)]+_0x2c0998(0x155)+_0x533947['sep']);_0x1a8fe0=_0x533947[_0x2c0998(0x131)](_0x1a8fe0);let _0x1a2b06={'width':0x780,'height':0x438,'time':0xf,'format':_0x2c0998(0x146),'size':_0x39db6c,'filePath':_0x294128};try{_0x1a2b06=await _0x9daecc[_0x2c0998(0x11b)](getVideoInfo,_0x5cfc0a),logDebug(_0x9daecc[_0x2c0998(0x12f)],_0x1a2b06);}catch(_0xaf55b4){_0x9daecc['gKCnp'](logError,_0x2c0998(0x153),_0xaf55b4);}const _0x939c09=new Promise((_0x5f4260,_0x17351b)=>{const _0x374b9c=_0x2c0998,_0x2df76d={'bXmIk':function(_0x5ba69e,_0x226e63){const _0x5991c7=_0x521b;return _0x9daecc[_0x5991c7(0x144)](_0x5ba69e,_0x226e63);}},_0x41baec=_0x213e6d+'_0.png',_0x3d4925=_0x533947['join'](_0x1a8fe0,_0x41baec);_0x9daecc[_0x374b9c(0x11b)](_0x2ee0f6,_0x294128)['on']('end',()=>{})['on'](_0x374b9c(0x117),_0x1a23c5=>{const _0x429a0f=_0x374b9c,_0x9860c3={'owZrK':function(_0x4580bb,_0x405784){const _0x146314=_0x521b;return _0x9daecc[_0x146314(0x142)](_0x4580bb,_0x405784);}};logDebug(_0x9daecc[_0x429a0f(0x133)],_0x1a23c5),_0x54efb6?_0x22d392[_0x429a0f(0x14d)](_0x54efb6,_0x3d4925)[_0x429a0f(0x13a)](()=>{_0x2df76d['bXmIk'](_0x5f4260,_0x3d4925);})[_0x429a0f(0x115)](_0x17351b):_0x22d392[_0x429a0f(0x163)](_0x3d4925,defaultVideoThumb)[_0x429a0f(0x13a)](()=>{const _0x3fb272=_0x429a0f;_0x9860c3[_0x3fb272(0x164)](_0x5f4260,_0x3d4925);})[_0x429a0f(0x115)](_0x17351b);})[_0x374b9c(0x15d)]({'timestamps':[0x0],'filename':_0x41baec,'folder':_0x1a8fe0,'size':_0x9daecc[_0x374b9c(0x119)](_0x1a2b06[_0x374b9c(0x160)]+'x',_0x1a2b06[_0x374b9c(0x134)])})['on'](_0x9daecc[_0x374b9c(0x14a)],()=>{_0x9daecc['eMykT'](_0x5f4260,_0x3d4925);});}),_0x58b46d=new Map(),_0x5465bb=await _0x939c09,_0xcd6770=(await _0x22d392[_0x2c0998(0x125)](_0x5465bb))[_0x2c0998(0x15e)];_0x58b46d['set'](0x0,_0x5465bb);const _0x4ee6f4=await calculateFileMD5(_0x5465bb),_0xd18c3d={'elementType':ElementType[_0x2c0998(0x114)],'elementId':'','videoElement':{'fileName':_0x9daecc[_0x2c0998(0x11f)](_0x5598aa,_0x35b11b),'filePath':_0x5cfc0a,'videoMd5':_0x213e6d,'thumbMd5':_0x4ee6f4,'fileTime':_0x1a2b06[_0x2c0998(0x154)],'thumbPath':_0x58b46d,'thumbSize':_0xcd6770,'thumbWidth':_0x1a2b06[_0x2c0998(0x160)],'thumbHeight':_0x1a2b06['height'],'fileSize':_0x9daecc['ezffX']('',_0x39db6c)}};return _0xd18c3d;}static async[_0x44b0df(0x113)](_0x2e6297){const _0x170e73=_0x44b0df,_0x434085={'wwinL':function(_0x4d3e16,_0xa73c69){return _0x4d3e16===_0xa73c69;},'bnsBC':'文件异常，大小为0','bsOVA':function(_0x5233b7,_0x1d7b4f){return _0x5233b7||_0x1d7b4f;}},{converted:_0x330e3b,path:_0x550a2e,duration:_0x5cfbae}=await encodeSilk(_0x2e6297);if(!_0x550a2e)throw _0x170e73(0x138);const {md5:_0x2856b9,fileName:_0x1b7157,path:_0x50b727,fileSize:_0x4b4d3c}=await NTQQFileApi[_0x170e73(0x13d)](_0x550a2e,ElementType['PTT']);if(_0x434085[_0x170e73(0x122)](_0x4b4d3c,0x0))throw _0x434085['bnsBC'];return _0x330e3b&&_0x22d392['unlink'](_0x550a2e)[_0x170e73(0x13a)](),{'elementType':ElementType[_0x170e73(0x168)],'elementId':'','pttElement':{'fileName':_0x1b7157,'filePath':_0x50b727,'md5HexStr':_0x2856b9,'fileSize':_0x4b4d3c,'duration':_0x434085[_0x170e73(0x15c)](_0x5cfbae,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x44b0df(0x12e)](_0x8339df){const _0x164780=_0x44b0df,_0x6694dc={'itfNH':function(_0x23a78b,_0x4f131a){return _0x23a78b>=_0x4f131a;}},_0x161c6e=_0x4f2513[_0x164780(0x166)],_0x380470=_0x4f2513[_0x164780(0x13b)],_0x5d3882=_0x161c6e[_0x164780(0x123)](_0x7ebc4b=>_0x7ebc4b[_0x164780(0x116)]===_0x8339df[_0x164780(0x11d)]());_0x8339df=parseInt(_0x8339df[_0x164780(0x11d)]());let _0x55b566=0x1;return _0x6694dc[_0x164780(0x128)](_0x8339df,0xde)&&(_0x55b566=0x2),_0x5d3882[_0x164780(0x13e)]&&(_0x55b566=0x3),{'elementType':ElementType[_0x164780(0x12b)],'elementId':'','faceElement':{'faceIndex':_0x8339df,'faceType':_0x55b566,'faceText':_0x5d3882[_0x164780(0x15b)],'stickerId':_0x5d3882[_0x164780(0x130)],'stickerType':_0x5d3882[_0x164780(0x13e)],'packId':_0x5d3882['AniStickerPackId'],'sourceType':0x1}};}static[_0x44b0df(0x162)](_0x427bab,_0x10f7eb,_0x3e6e16,_0x1743ee){const _0x59a6b0=_0x44b0df;return{'elementType':ElementType[_0x59a6b0(0x14c)],'marketFaceElement':{'emojiPackageId':_0x427bab,'emojiId':_0x10f7eb,'key':_0x3e6e16,'faceName':_0x1743ee||mFaceCache[_0x59a6b0(0x15a)](_0x10f7eb)||'[商城表情]'}};}static[_0x44b0df(0x149)](_0x15881a){const _0x229276=_0x44b0df,_0x30d49b={'VkxpX':_0x229276(0x13f)};return{'elementType':ElementType[_0x229276(0x12b)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x229276(0x149)],'faceType':FaceType[_0x229276(0x149)],'faceText':_0x30d49b[_0x229276(0x148)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x24cdbc){const _0x17d204=_0x44b0df,_0x23f865={'YqoIB':_0x17d204(0x158)};return{'elementType':ElementType[_0x17d204(0x12b)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x17d204(0x137)],'faceText':_0x23f865['YqoIB'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x44b0df(0x126)](_0x5cdd14){const _0x349189=_0x44b0df,_0x1f2a74={'Lfhnv':function(_0x326f06,_0x2556b9){return _0x326f06!==_0x2556b9;},'tuYBn':'string'};return _0x1f2a74[_0x349189(0x11e)](typeof _0x5cdd14,_0x1f2a74['tuYBn'])&&(_0x5cdd14=JSON[_0x349189(0x152)](_0x5cdd14)),{'elementType':ElementType[_0x349189(0x14e)],'elementId':'','arkElement':{'bytesData':_0x5cdd14,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x17743c){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x17743c}};}}