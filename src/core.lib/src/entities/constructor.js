const _0x1f503b=_0x1c0b;(function(_0x1af77b,_0x3a5a24){const _0x40ccb4=_0x1c0b,_0x1aa633=_0x1af77b();while(!![]){try{const _0x1ddad7=-parseInt(_0x40ccb4(0x154))/0x1+parseInt(_0x40ccb4(0x14f))/0x2+-parseInt(_0x40ccb4(0x137))/0x3+-parseInt(_0x40ccb4(0x178))/0x4*(-parseInt(_0x40ccb4(0x167))/0x5)+parseInt(_0x40ccb4(0x13d))/0x6+-parseInt(_0x40ccb4(0x145))/0x7+parseInt(_0x40ccb4(0x180))/0x8*(-parseInt(_0x40ccb4(0x151))/0x9);if(_0x1ddad7===_0x3a5a24)break;else _0x1aa633['push'](_0x1aa633['shift']());}catch(_0x5c60c0){_0x1aa633['push'](_0x1aa633['shift']());}}}(_0x6b71,0x74a78));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x5b71bb}from'node:fs';import _0x248c92 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x6b71(){const _0x420d97=['yXAgN','height','gif','mp4','3920796sLpOhW','KUoYq','PIC','join','ZbiwR','pic','set','oqQtj','3338573EqbMLW','dCGaR','ftBmf','toString','vPaIO','[包剪锤]','file','MLVFi','BPsWz','TEXT','1551970kegfGe','catch','423kdKJJL','dirname','文件异常，大小为0','219100mAgdjP','MFACE','nTzJD','MARKDOWN','ARK','UOHGt','FILE','then','cVcVy','PTT','dice','stringify','cGhMv','视频信息','notAt','error','copyFile','RFSkO','sep','3271510GZWoom','normal','[商城表情]','width','unlink','bPfJo','normal2','string','ZyoOA','CoLzM','replace','screenshots','uploadFile','face','FstGv','rps','FACE','4CZSIPK','text','writeFile','QREPv','reply','RPS','ZbeTY','图片信息','121784rQvovC','size','获取视频封面失败，使用默认封面','get','qQFGr','kIUsD','time','ptt','getImageSize','语音转换失败,\x20请检查语音文件是否正常','583251DZWsEH','ark'];_0x6b71=function(){return _0x420d97;};return _0x6b71();}import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();function _0x1c0b(_0x47171c,_0x990c8b){const _0x6b7190=_0x6b71();return _0x1c0b=function(_0x1c0b12,_0x4471cd){_0x1c0b12=_0x1c0b12-0x131;let _0x21f57f=_0x6b7190[_0x1c0b12];return _0x21f57f;},_0x1c0b(_0x47171c,_0x990c8b);}export class SendMsgElementConstructor{static[_0x1f503b(0x179)](_0xc07b2a){const _0x5e778f=_0x1f503b;return{'elementType':ElementType[_0x5e778f(0x14e)],'elementId':'','textElement':{'content':_0xc07b2a,'atType':AtType[_0x5e778f(0x162)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x5f2d6e,_0x401ea2,_0x5b8afb,_0xea87da){const _0x4ec479=_0x1f503b;return{'elementType':ElementType[_0x4ec479(0x14e)],'elementId':'','textElement':{'content':'@'+_0xea87da,'atType':_0x5b8afb,'atUid':_0x5f2d6e,'atTinyId':'','atNtUid':_0x401ea2}};}static[_0x1f503b(0x17c)](_0x46ce73,_0x387ec0,_0x5063b6,_0xee1b56){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x46ce73,'replayMsgId':_0x387ec0,'senderUin':_0x5063b6,'senderUinStr':_0xee1b56}};}static async[_0x1f503b(0x142)](_0x35f4cf,_0x977618='',_0x46557a=0x0){const _0x351ffd=_0x1f503b,_0x5d26b4={'CoLzM':_0x351ffd(0x153),'SCOxY':function(_0xceffbb,_0x169ded){return _0xceffbb(_0x169ded);},'ZyoOA':function(_0x2b7499,_0x517a6e,_0xe69c7b){return _0x2b7499(_0x517a6e,_0xe69c7b);},'BPsWz':_0x351ffd(0x17f)},{md5:_0x4844ca,fileName:_0x529bd0,path:_0x2d50bc,fileSize:_0x152c6d}=await NTQQFileApi[_0x351ffd(0x173)](_0x35f4cf,ElementType[_0x351ffd(0x13f)],_0x46557a);if(_0x152c6d===0x0)throw _0x5d26b4[_0x351ffd(0x170)];const _0x400e4f=await NTQQFileApi[_0x351ffd(0x135)](_0x35f4cf),_0x5c5bcf={'md5HexStr':_0x4844ca,'fileSize':_0x152c6d[_0x351ffd(0x148)](),'picWidth':_0x400e4f?.[_0x351ffd(0x16a)],'picHeight':_0x400e4f?.[_0x351ffd(0x13a)],'fileName':_0x529bd0,'sourcePath':_0x2d50bc,'original':!![],'picType':_0x5d26b4['SCOxY'](isGIF,_0x35f4cf)?PicType[_0x351ffd(0x13b)]:PicType['jpg'],'picSubType':_0x46557a,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x977618};return _0x5d26b4[_0x351ffd(0x16f)](logDebug,_0x5d26b4[_0x351ffd(0x14d)],_0x5c5bcf),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x5c5bcf};}static async[_0x1f503b(0x14b)](_0x2ddd2d,_0x39c7f5=''){const _0xd3a4ce=_0x1f503b,_0x11ba1c={'nTzJD':function(_0x2ee23,_0x59163f){return _0x2ee23===_0x59163f;},'yXAgN':_0xd3a4ce(0x153),'MLVFi':function(_0x43ec63,_0x13dd1e){return _0x43ec63||_0x13dd1e;}},{md5:_0x1eaa5c,fileName:_0x49f35e,path:_0x486609,fileSize:_0x4e9083}=await NTQQFileApi[_0xd3a4ce(0x173)](_0x2ddd2d,ElementType[_0xd3a4ce(0x15a)]);if(_0x11ba1c[_0xd3a4ce(0x156)](_0x4e9083,0x0))throw _0x11ba1c[_0xd3a4ce(0x139)];const _0x574fd0={'elementType':ElementType[_0xd3a4ce(0x15a)],'elementId':'','fileElement':{'fileName':_0x11ba1c[_0xd3a4ce(0x14c)](_0x39c7f5,_0x49f35e),'filePath':_0x486609,'fileSize':_0x4e9083['toString']()}};return _0x574fd0;}static async['video'](_0x5e13ce,_0x103d7e='',_0x152f6e=''){const _0x58b538=_0x1f503b,_0x192a1c={'bPfJo':function(_0x128741,_0x251d05){return _0x128741(_0x251d05);},'dCGaR':function(_0xe41e9a,_0x5afe2a,_0x660013){return _0xe41e9a(_0x5afe2a,_0x660013);},'ftBmf':'end','cGhMv':_0x58b538(0x163),'KUoYq':function(_0x3dbf56,_0x4b9e08){return _0x3dbf56+_0x4b9e08;},'kIUsD':function(_0x3e2e89,_0x807d7a){return _0x3e2e89===_0x807d7a;},'qQFGr':_0x58b538(0x13c),'dKAAk':function(_0x5bad4d,_0x5ce2f9,_0x1ace8c){return _0x5bad4d(_0x5ce2f9,_0x1ace8c);},'ZyRYD':_0x58b538(0x161),'QREPv':function(_0x39ff63,_0x4bd32e,_0x1b9a62){return _0x39ff63(_0x4bd32e,_0x1b9a62);},'cVcVy':'获取视频信息失败','oqQtj':function(_0x56891a,_0x3e0424){return _0x56891a||_0x3e0424;}},{fileName:_0x4d0ab5,path:_0x53ebf5,fileSize:_0x5c099f,md5:_0x2e05d9}=await NTQQFileApi[_0x58b538(0x173)](_0x5e13ce,ElementType['VIDEO']);if(_0x192a1c[_0x58b538(0x132)](_0x5c099f,0x0))throw _0x58b538(0x153);const _0x75c95f=_0x192a1c['bPfJo'](require,'path');let _0x41d6d2=_0x53ebf5[_0x58b538(0x171)](_0x75c95f[_0x58b538(0x166)]+'Ori'+_0x75c95f[_0x58b538(0x166)],_0x75c95f[_0x58b538(0x166)]+'Thumb'+_0x75c95f[_0x58b538(0x166)]);_0x41d6d2=_0x75c95f[_0x58b538(0x152)](_0x41d6d2);let _0x46ab4d={'width':0x780,'height':0x438,'time':0xf,'format':_0x192a1c[_0x58b538(0x131)],'size':_0x5c099f,'filePath':_0x5e13ce};try{_0x46ab4d=await _0x192a1c[_0x58b538(0x16c)](getVideoInfo,_0x53ebf5),_0x192a1c['dKAAk'](logDebug,_0x192a1c['ZyRYD'],_0x46ab4d);}catch(_0x2aba99){_0x192a1c[_0x58b538(0x17b)](logError,_0x192a1c[_0x58b538(0x15c)],_0x2aba99);}const _0x2fc381=new Promise((_0x4ae2b5,_0x469b5e)=>{const _0x352397=_0x58b538,_0x19aa3f={'FstGv':function(_0x31d4ca,_0x1e6446){const _0x323ec3=_0x1c0b;return _0x192a1c[_0x323ec3(0x16c)](_0x31d4ca,_0x1e6446);},'ZbeTY':function(_0x3221af,_0x56316b,_0x26f524){const _0x4f069e=_0x1c0b;return _0x192a1c[_0x4f069e(0x146)](_0x3221af,_0x56316b,_0x26f524);}},_0x559c23=_0x2e05d9+'_0.png',_0x47e4dc=_0x75c95f[_0x352397(0x140)](_0x41d6d2,_0x559c23);_0x192a1c[_0x352397(0x16c)](_0x248c92,_0x5e13ce)['on'](_0x192a1c[_0x352397(0x147)],()=>{})['on'](_0x192a1c[_0x352397(0x160)],_0x4cd2ac=>{const _0x29a7da=_0x352397;_0x19aa3f[_0x29a7da(0x17e)](logDebug,_0x29a7da(0x182),_0x4cd2ac),_0x152f6e?_0x5b71bb[_0x29a7da(0x164)](_0x152f6e,_0x47e4dc)['then'](()=>{const _0x43a92a=_0x29a7da;_0x19aa3f[_0x43a92a(0x175)](_0x4ae2b5,_0x47e4dc);})['catch'](_0x469b5e):_0x5b71bb[_0x29a7da(0x17a)](_0x47e4dc,defaultVideoThumb)['then'](()=>{_0x4ae2b5(_0x47e4dc);})[_0x29a7da(0x150)](_0x469b5e);})[_0x352397(0x172)]({'timestamps':[0x0],'filename':_0x559c23,'folder':_0x41d6d2,'size':_0x192a1c['KUoYq'](_0x46ab4d[_0x352397(0x16a)]+'x',_0x46ab4d['height'])})['on'](_0x192a1c[_0x352397(0x147)],()=>{const _0x13e82c=_0x352397;_0x19aa3f[_0x13e82c(0x175)](_0x4ae2b5,_0x47e4dc);});}),_0x39faab=new Map(),_0x1b3b67=await _0x2fc381,_0x471bc3=(await _0x5b71bb['stat'](_0x1b3b67))[_0x58b538(0x181)];_0x39faab[_0x58b538(0x143)](0x0,_0x1b3b67);const _0x5e74df=await _0x192a1c[_0x58b538(0x16c)](calculateFileMD5,_0x1b3b67),_0x5e201b={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x192a1c[_0x58b538(0x144)](_0x103d7e,_0x4d0ab5),'filePath':_0x53ebf5,'videoMd5':_0x2e05d9,'thumbMd5':_0x5e74df,'fileTime':_0x46ab4d[_0x58b538(0x133)],'thumbPath':_0x39faab,'thumbSize':_0x471bc3,'thumbWidth':_0x46ab4d[_0x58b538(0x16a)],'thumbHeight':_0x46ab4d[_0x58b538(0x13a)],'fileSize':_0x192a1c[_0x58b538(0x13e)]('',_0x5c099f)}};return _0x5e201b;}static async[_0x1f503b(0x134)](_0x46d86f){const _0x1aa409=_0x1f503b,_0x4bedad={'BQzlv':function(_0x11fcc5,_0x59530b){return _0x11fcc5(_0x59530b);},'RFSkO':_0x1aa409(0x136),'UOHGt':'文件异常，大小为0','ZbiwR':function(_0x3e20f3,_0x1e78d8){return _0x3e20f3||_0x1e78d8;}},{converted:_0x57ad07,path:_0x257980,duration:_0x430982}=await _0x4bedad['BQzlv'](encodeSilk,_0x46d86f);if(!_0x257980)throw _0x4bedad[_0x1aa409(0x165)];const {md5:_0x2a2016,fileName:_0x5b2673,path:_0x4b0894,fileSize:_0x3e9374}=await NTQQFileApi[_0x1aa409(0x173)](_0x257980,ElementType[_0x1aa409(0x15d)]);if(_0x3e9374===0x0)throw _0x4bedad[_0x1aa409(0x159)];return _0x57ad07&&_0x5b71bb[_0x1aa409(0x16b)](_0x257980)[_0x1aa409(0x15b)](),{'elementType':ElementType[_0x1aa409(0x15d)],'elementId':'','pttElement':{'fileName':_0x5b2673,'filePath':_0x4b0894,'md5HexStr':_0x2a2016,'fileSize':_0x3e9374,'duration':_0x4bedad[_0x1aa409(0x141)](_0x430982,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x1f503b(0x174)](_0x1a4d4c){const _0x59b794=_0x1f503b,_0x56e41c={'LIiPG':function(_0x111c22,_0x3e47a6){return _0x111c22<_0x3e47a6;}};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x1a4d4c,'faceType':_0x56e41c['LIiPG'](_0x1a4d4c,0xde)?FaceType[_0x59b794(0x168)]:FaceType[_0x59b794(0x16d)]}};}static['mface'](_0x1b28d8,_0x2e4976,_0x19b052,_0x133bba){const _0x4b7472=_0x1f503b,_0x47fa5b={'vPaIO':_0x4b7472(0x169)};return{'elementType':ElementType[_0x4b7472(0x155)],'marketFaceElement':{'emojiPackageId':_0x1b28d8,'emojiId':_0x2e4976,'key':_0x19b052,'faceName':_0x133bba||mFaceCache[_0x4b7472(0x183)](_0x2e4976)||_0x47fa5b[_0x4b7472(0x149)]}};}static[_0x1f503b(0x15e)](_0x1b6b81){const _0x44c80a=_0x1f503b;return{'elementType':ElementType[_0x44c80a(0x177)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x44c80a(0x15e)],'faceType':FaceType[_0x44c80a(0x15e)],'faceText':'[骰子]','packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x1f503b(0x176)](_0x17b286){const _0x43786d=_0x1f503b,_0x526dd0={'HiMKN':_0x43786d(0x14a)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x43786d(0x17d)],'faceText':_0x526dd0['HiMKN'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x1f503b(0x138)](_0x385786){const _0x47f466=_0x1f503b;return typeof _0x385786!==_0x47f466(0x16e)&&(_0x385786=JSON[_0x47f466(0x15f)](_0x385786)),{'elementType':ElementType[_0x47f466(0x158)],'elementId':'','arkElement':{'bytesData':_0x385786,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x1f0396){const _0x36f4f8=_0x1f503b;return{'elementType':ElementType[_0x36f4f8(0x157)],'elementId':'','markdownElement':{'content':_0x1f0396}};}}