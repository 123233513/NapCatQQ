const _0x25170b=_0xa499;(function(_0x522fba,_0x58d975){const _0x20831c=_0xa499,_0x225fad=_0x522fba();while(!![]){try{const _0x596283=parseInt(_0x20831c(0x23f))/0x1*(-parseInt(_0x20831c(0x209))/0x2)+-parseInt(_0x20831c(0x217))/0x3+parseInt(_0x20831c(0x20d))/0x4+-parseInt(_0x20831c(0x226))/0x5+-parseInt(_0x20831c(0x205))/0x6+parseInt(_0x20831c(0x235))/0x7+parseInt(_0x20831c(0x228))/0x8*(parseInt(_0x20831c(0x1f5))/0x9);if(_0x596283===_0x58d975)break;else _0x225fad['push'](_0x225fad['shift']());}catch(_0x2901e6){_0x225fad['push'](_0x225fad['shift']());}}}(_0x25d4,0xd913a));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x48a67a}from'node:fs';import _0x3cde93 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';function _0xa499(_0x2c18a0,_0x5a0ba4){const _0x25d48c=_0x25d4();return _0xa499=function(_0xa4991b,_0x52b843){_0xa4991b=_0xa4991b-0x1ec;let _0x21eb30=_0x25d48c[_0xa4991b];return _0x21eb30;},_0xa499(_0x2c18a0,_0x5a0ba4);}import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x5e6b15 from'./face_config.json';import*as _0x2fce9e from'node:path';import{SignMiniApp}from'../apis';function _0x25d4(){const _0x1b45ff=['TAbUd','uploadFile','MARKDOWN','MFACE','1734915PZJCHV','whYLH','ptt','fZpnr','kqdvg','[商城表情]','wjCZf','LDOXq','toString','pic','9LSiPgH','PIC','jpg','AniStickerId','ark','stringify','markdown','catch','FACE','TCkyg','AniStickerType','sSpLg','DTXXW','RPS','join','42893901SGkxFX','Bot\x20Test','writeFile','获取视频封面失败，使用默认封面','replace','mp4','lgfEK','dice','sep','[包剪锤]','FILE','text','face','MJLiL','ayJwK','end','5220036AjmwMh','DEaid','VWyru','TEXT','298436aNRueK','LkuAB','notAt','cKaJa','4006308UnQjmH','ARK','AdFBA','width','emoji','PTT','AniStickerPackId','文件异常，大小为0','Ori','QlRJu','4372032ANrVdh','NYRXH','UzDzq','copyFile','sysface','VIDEO','then','find','_0.png','REPLY','xyymO','shjGP','rps','[骰子]','tiEQv','7279765MgZfRy','mface','8scYNZa','HyRzi','stat','video','string','PvZya','height','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','getImageSize'];_0x25d4=function(){return _0x1b45ff;};return _0x25d4();}export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x25170b(0x200)](_0x1d3442){const _0x3c11c2=_0x25170b;return{'elementType':ElementType[_0x3c11c2(0x208)],'elementId':'','textElement':{'content':_0x1d3442,'atType':AtType[_0x3c11c2(0x20b)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x2dc82c,_0x534fc4,_0x999279,_0x521345){const _0x34338=_0x25170b;return{'elementType':ElementType[_0x34338(0x208)],'elementId':'','textElement':{'content':'@'+_0x521345,'atType':_0x999279,'atUid':_0x2dc82c,'atTinyId':'','atNtUid':_0x534fc4}};}static['reply'](_0x13ce12,_0x39fdc8,_0x5318b7,_0x2f1f3a){const _0xbfb645=_0x25170b;return{'elementType':ElementType[_0xbfb645(0x220)],'elementId':'','replyElement':{'replayMsgSeq':_0x13ce12,'replayMsgId':_0x39fdc8,'senderUin':_0x5318b7,'senderUinStr':_0x2f1f3a}};}static async[_0x25170b(0x23e)](_0x39bdfa,_0x5cdb73='',_0x288032=0x0){const _0x19b61a=_0x25170b,_0x42adca={'cKaJa':function(_0x3c9669,_0x33128a){return _0x3c9669===_0x33128a;},'kqdvg':function(_0x5420ba,_0x431b03){return _0x5420ba(_0x431b03);}},{md5:_0x3f524d,fileName:_0x3c1545,path:_0x384699,fileSize:_0xc0a29d}=await NTQQFileApi[_0x19b61a(0x232)](_0x39bdfa,ElementType[_0x19b61a(0x240)],_0x288032);if(_0x42adca[_0x19b61a(0x20c)](_0xc0a29d,0x0))throw'文件异常，大小为0';const _0x1c346b=await NTQQFileApi[_0x19b61a(0x230)](_0x39bdfa),_0xdbb34f={'md5HexStr':_0x3f524d,'fileSize':_0xc0a29d['toString'](),'picWidth':_0x1c346b?.['width'],'picHeight':_0x1c346b?.[_0x19b61a(0x22e)],'fileName':_0x3c1545,'sourcePath':_0x384699,'original':!![],'picType':_0x42adca[_0x19b61a(0x239)](isGIF,_0x39bdfa)?PicType['gif']:PicType[_0x19b61a(0x241)],'picSubType':_0x288032,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x5cdb73};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0xdbb34f};}static async['file'](_0x41da3f,_0x756f3b='',_0x4bd6ba=''){const _0xe4a6a1=_0x25170b,_0x47b538={'LkuAB':function(_0x114969,_0x5c8b2f){return _0x114969===_0x5c8b2f;},'yHFpV':_0xe4a6a1(0x214),'PGGiY':function(_0x25a9ad,_0x167f88){return _0x25a9ad||_0x167f88;}},{md5:_0x13a338,fileName:_0x5cfee3,path:_0x3a64b9,fileSize:_0x31691e}=await NTQQFileApi[_0xe4a6a1(0x232)](_0x41da3f,ElementType[_0xe4a6a1(0x1ff)]);if(_0x47b538[_0xe4a6a1(0x20a)](_0x31691e,0x0))throw _0x47b538['yHFpV'];const _0x1af2e8={'elementType':ElementType[_0xe4a6a1(0x1ff)],'elementId':'','fileElement':{'fileName':_0x47b538['PGGiY'](_0x756f3b,_0x5cfee3),'folderId':_0x4bd6ba,'filePath':_0x3a64b9,'fileSize':_0x31691e[_0xe4a6a1(0x23d)]()}};return _0x1af2e8;}static async[_0x25170b(0x22b)](_0x53a2ea,_0x180c9c='',_0x133d3a=''){const _0x17cf92=_0x25170b,_0x337ea6={'VWyru':function(_0x4ffe3c,_0x1ef5f8){return _0x4ffe3c(_0x1ef5f8);},'NYRXH':function(_0x52ff3d,_0x43eba8,_0x26d45e){return _0x52ff3d(_0x43eba8,_0x26d45e);},'PvZya':_0x17cf92(0x1f8),'sSpLg':_0x17cf92(0x204),'szQcV':'error','TAbUd':function(_0x306cbd,_0x42cdad){return _0x306cbd+_0x42cdad;},'fZpnr':function(_0x4e6bd0,_0x5c2b18){return _0x4e6bd0===_0x5c2b18;},'lgfEK':'获取视频信息失败','DTXXW':function(_0x6b93df,_0x5aed77){return _0x6b93df+_0x5aed77;}},{fileName:_0x514f56,path:_0x5e9923,fileSize:_0x28f7af,md5:_0x3b3c3d}=await NTQQFileApi['uploadFile'](_0x53a2ea,ElementType['VIDEO']);if(_0x337ea6[_0x17cf92(0x238)](_0x28f7af,0x0))throw'文件异常，大小为0';let _0x219cbf=_0x5e9923[_0x17cf92(0x1f9)](_0x2fce9e['sep']+_0x17cf92(0x215)+_0x2fce9e[_0x17cf92(0x1fd)],_0x2fce9e[_0x17cf92(0x1fd)]+'Thumb'+_0x2fce9e[_0x17cf92(0x1fd)]);_0x219cbf=_0x2fce9e['dirname'](_0x219cbf);let _0x20cd46={'width':0x780,'height':0x438,'time':0xf,'format':_0x17cf92(0x1fa),'size':_0x28f7af,'filePath':_0x53a2ea};try{_0x20cd46=await _0x337ea6[_0x17cf92(0x207)](getVideoInfo,_0x5e9923);}catch(_0x5f4694){_0x337ea6['NYRXH'](logError,_0x337ea6[_0x17cf92(0x1fb)],_0x5f4694);}const _0x59201e=new Promise((_0x594470,_0x63ac32)=>{const _0x3c8c88=_0x17cf92,_0x5aa91c=_0x3b3c3d+_0x3c8c88(0x21f),_0xdb9d40=_0x2fce9e[_0x3c8c88(0x1f4)](_0x219cbf,_0x5aa91c);_0x337ea6['VWyru'](_0x3cde93,_0x53a2ea)['on'](_0x337ea6[_0x3c8c88(0x1f1)],()=>{})['on'](_0x337ea6['szQcV'],_0x25583c=>{const _0x10298b=_0x3c8c88,_0x21a3bc={'MJLiL':function(_0x599c4e,_0x4e30f5){return _0x337ea6['VWyru'](_0x599c4e,_0x4e30f5);}};_0x337ea6[_0x10298b(0x218)](logDebug,_0x337ea6[_0x10298b(0x22d)],_0x25583c),_0x133d3a?_0x48a67a[_0x10298b(0x21a)](_0x133d3a,_0xdb9d40)[_0x10298b(0x21d)](()=>{const _0x294046=_0x10298b;_0x21a3bc[_0x294046(0x202)](_0x594470,_0xdb9d40);})['catch'](_0x63ac32):_0x48a67a[_0x10298b(0x1f7)](_0xdb9d40,defaultVideoThumb)[_0x10298b(0x21d)](()=>{const _0x1192e8=_0x10298b;_0x21a3bc[_0x1192e8(0x202)](_0x594470,_0xdb9d40);})[_0x10298b(0x1ed)](_0x63ac32);})['screenshots']({'timestamps':[0x0],'filename':_0x5aa91c,'folder':_0x219cbf,'size':_0x337ea6[_0x3c8c88(0x231)](_0x20cd46[_0x3c8c88(0x210)]+'x',_0x20cd46[_0x3c8c88(0x22e)])})['on'](_0x3c8c88(0x204),()=>{_0x594470(_0xdb9d40);});}),_0x2ddfb3=new Map(),_0x262306=await _0x59201e,_0x218448=(await _0x48a67a[_0x17cf92(0x22a)](_0x262306))['size'];_0x2ddfb3['set'](0x0,_0x262306);const _0x137d1a=await _0x337ea6[_0x17cf92(0x207)](calculateFileMD5,_0x262306),_0x1db44e={'elementType':ElementType[_0x17cf92(0x21c)],'elementId':'','videoElement':{'fileName':_0x180c9c||_0x514f56,'filePath':_0x5e9923,'videoMd5':_0x3b3c3d,'thumbMd5':_0x137d1a,'fileTime':_0x20cd46['time'],'thumbPath':_0x2ddfb3,'thumbSize':_0x218448,'thumbWidth':_0x20cd46[_0x17cf92(0x210)],'thumbHeight':_0x20cd46['height'],'fileSize':_0x337ea6[_0x17cf92(0x1f2)]('',_0x28f7af)}};return _0x1db44e;}static async[_0x25170b(0x237)](_0x210ad2){const _0x37ec27=_0x25170b,_0x3293b1={'HyRzi':function(_0x80778c,_0x45f89e){return _0x80778c(_0x45f89e);},'AdFBA':'语音转换失败,\x20请检查语音文件是否正常','ayJwK':function(_0x355543,_0x12c54d){return _0x355543===_0x12c54d;},'shjGP':_0x37ec27(0x214)},{converted:_0x45f91b,path:_0x34360a,duration:_0x35c9d2}=await _0x3293b1[_0x37ec27(0x229)](encodeSilk,_0x210ad2);if(!_0x34360a)throw _0x3293b1[_0x37ec27(0x20f)];const {md5:_0x51fb86,fileName:_0x5f161e,path:_0x5142ca,fileSize:_0x3f3953}=await NTQQFileApi[_0x37ec27(0x232)](_0x34360a,ElementType[_0x37ec27(0x212)]);if(_0x3293b1[_0x37ec27(0x203)](_0x3f3953,0x0))throw _0x3293b1[_0x37ec27(0x222)];return _0x45f91b&&_0x48a67a['unlink'](_0x34360a)[_0x37ec27(0x21d)](),{'elementType':ElementType[_0x37ec27(0x212)],'elementId':'','pttElement':{'fileName':_0x5f161e,'filePath':_0x5142ca,'md5HexStr':_0x51fb86,'fileSize':_0x3f3953,'duration':_0x35c9d2||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x25170b(0x201)](_0x3cec58){const _0x552324=_0x25170b,_0x169b5d={'TCkyg':function(_0x3add8e,_0xa49b55){return _0x3add8e(_0xa49b55);},'wjCZf':function(_0x10d8f8,_0x1abd08){return _0x10d8f8>=_0x1abd08;}},_0x491952=_0x5e6b15[_0x552324(0x21b)],_0x5bb291=_0x5e6b15[_0x552324(0x211)],_0x1a8f04=_0x491952[_0x552324(0x21e)](_0x52b643=>_0x52b643['QSid']===_0x3cec58[_0x552324(0x23d)]());_0x3cec58=_0x169b5d[_0x552324(0x1ef)](parseInt,_0x3cec58['toString']());let _0x13f6ce=0x1;return _0x169b5d[_0x552324(0x23b)](_0x3cec58,0xde)&&(_0x13f6ce=0x2),_0x1a8f04['AniStickerType']&&(_0x13f6ce=0x3),{'elementType':ElementType[_0x552324(0x1ee)],'elementId':'','faceElement':{'faceIndex':_0x3cec58,'faceType':_0x13f6ce,'faceText':_0x1a8f04['QDes'],'stickerId':_0x1a8f04[_0x552324(0x242)],'stickerType':_0x1a8f04[_0x552324(0x1f0)],'packId':_0x1a8f04[_0x552324(0x213)],'sourceType':0x1}};}static[_0x25170b(0x227)](_0x25d698,_0x3b387a,_0x27e19c,_0xdd0bb3){const _0x3d9479=_0x25170b;return{'elementType':ElementType[_0x3d9479(0x234)],'marketFaceElement':{'emojiPackageId':_0x25d698,'emojiId':_0x3b387a,'key':_0x27e19c,'faceName':_0xdd0bb3||mFaceCache['get'](_0x3b387a)||_0x3d9479(0x23a)}};}static[_0x25170b(0x1fc)](_0xc92aff){const _0x37c207=_0x25170b,_0x1357e0={'LDOXq':_0x37c207(0x224)};return{'elementType':ElementType[_0x37c207(0x1ee)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x37c207(0x1fc)],'faceType':FaceType[_0x37c207(0x1fc)],'faceText':_0x1357e0[_0x37c207(0x23c)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x25170b(0x223)](_0x14c2c7){const _0x54ce38=_0x25170b,_0x219490={'DEaid':_0x54ce38(0x1fe)};return{'elementType':ElementType[_0x54ce38(0x1ee)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x54ce38(0x1f3)],'faceText':_0x219490[_0x54ce38(0x206)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x25170b(0x243)](_0x4431ac){const _0x76d695=_0x25170b,_0x294ef5={'QlRJu':function(_0x21bbf7,_0x57b010){return _0x21bbf7!==_0x57b010;},'UzDzq':_0x76d695(0x22c)};return _0x294ef5[_0x76d695(0x216)](typeof _0x4431ac,_0x294ef5[_0x76d695(0x219)])&&(_0x4431ac=JSON[_0x76d695(0x244)](_0x4431ac)),{'elementType':ElementType[_0x76d695(0x20e)],'elementId':'','arkElement':{'bytesData':_0x4431ac,'linkInfo':null,'subElementType':null}};}static[_0x25170b(0x1ec)](_0x3bd9fb){const _0x4295df=_0x25170b;return{'elementType':ElementType[_0x4295df(0x233)],'elementId':'','markdownElement':{'content':_0x3bd9fb}};}static async['miniapp'](){const _0xc54915=_0x25170b,_0xaed4ab={'pqhYf':function(_0x1fe97b,_0x44187a){return _0x1fe97b(_0x44187a);},'tiEQv':_0xc54915(0x1f6),'xyymO':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','whYLH':'https://www.bilibili.com/','vLCoG':_0xc54915(0x22f)};let _0x4b04c7=await _0xaed4ab['pqhYf'](SignMiniApp,{'prompt':_0xaed4ab[_0xc54915(0x225)],'title':_0xaed4ab['tiEQv'],'preview':_0xaed4ab[_0xc54915(0x221)],'jumpUrl':_0xaed4ab[_0xc54915(0x236)],'tag':_0xaed4ab[_0xc54915(0x225)],'tagIcon':_0xaed4ab['vLCoG'],'source':_0xaed4ab[_0xc54915(0x225)],'sourcelogo':_0xc54915(0x22f)});return{'elementType':ElementType[_0xc54915(0x20e)],'elementId':'','arkElement':{'bytesData':_0x4b04c7,'linkInfo':null,'subElementType':null}};}}