const _0x12358b=_0x410f;(function(_0x2d79c6,_0x3331d4){const _0x2630f3=_0x410f,_0x5e6c6c=_0x2d79c6();while(!![]){try{const _0x1bc293=-parseInt(_0x2630f3(0x1b4))/0x1*(parseInt(_0x2630f3(0x1da))/0x2)+parseInt(_0x2630f3(0x1be))/0x3*(-parseInt(_0x2630f3(0x1a5))/0x4)+parseInt(_0x2630f3(0x1a8))/0x5*(-parseInt(_0x2630f3(0x19c))/0x6)+-parseInt(_0x2630f3(0x1cf))/0x7+-parseInt(_0x2630f3(0x1d1))/0x8*(parseInt(_0x2630f3(0x1c3))/0x9)+-parseInt(_0x2630f3(0x198))/0xa+parseInt(_0x2630f3(0x1bf))/0xb;if(_0x1bc293===_0x3331d4)break;else _0x5e6c6c['push'](_0x5e6c6c['shift']());}catch(_0x51140b){_0x5e6c6c['push'](_0x5e6c6c['shift']());}}}(_0xaa82,0xce29b));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x9ec4d9}from'node:fs';import _0x36f529 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0xaa82(){const _0x1917f3=['pic','FILE','获取视频信息失败','WCAcO','uVZXq','getImageSize','ark','gHZPC','ssRPM','4131580JcVVyR','[骰子]','toString','UNTxP','18MQQiAp','writeFile','uploadFile','lwzAP','fmMpM','video','then','语音转换失败,\x20请检查语音文件是否正常','face','4FOQXYb','文件异常，大小为0','REPLY','2261925KoHUHQ','ptt','jpg','AniStickerPackId','width','aYZeY','PTT','set','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','unlink','AniStickerType','string','9988LjXhJF','[商城表情]','dice','miniapp','gvSSY','gif','获取视频封面失败，使用默认封面','VpLZZ','ClBLa','time','2487363HneqvL','75110662eaxWaV','ARK','OKYbf','stat','7367679ZWulXs','screenshots','oKWff','IeZOS','TEXT','MtNmg','VIDEO','AniStickerId','FACE','vUqbe','QSid','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','10901317xztYdT','size','16kibvyq','height','kJmop','file','Ori','PYzUN','aNoPO','pXAzH','sysface','38VsPQpU','notAt','reply','sep','rfGWM','dirname','lcUFt','yoNWa','xSVbZ','rps','PIC','pxgxv','MFACE','Bot\x20Test','copyFile','emoji','get','tsabU','replace'];_0xaa82=function(){return _0x1917f3;};return _0xaa82();}import{encodeSilk}from'@/common/utils/audio';function _0x410f(_0x4ea501,_0xb41ad3){const _0xaa82a4=_0xaa82();return _0x410f=function(_0x410fab,_0x1795ee){_0x410fab=_0x410fab-0x185;let _0x540f31=_0xaa82a4[_0x410fab];return _0x540f31;},_0x410f(_0x4ea501,_0xb41ad3);}import _0x3e1271 from'./face_config.json';import*as _0x5e06ff from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0xe86796){const _0x4cf05f=_0x410f;return{'elementType':ElementType[_0x4cf05f(0x1c7)],'elementId':'','textElement':{'content':_0xe86796,'atType':AtType[_0x4cf05f(0x1db)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x14b587,_0x40e843,_0x3ef1fc,_0x5de5c2){const _0x1f7c64=_0x410f;return{'elementType':ElementType[_0x1f7c64(0x1c7)],'elementId':'','textElement':{'content':'@'+_0x5de5c2,'atType':_0x3ef1fc,'atUid':_0x14b587,'atTinyId':'','atNtUid':_0x40e843}};}static[_0x12358b(0x1dc)](_0x5ac16a,_0x14de9a,_0x22600f,_0x2ab8cd){const _0x1a1949=_0x12358b;return{'elementType':ElementType[_0x1a1949(0x1a7)],'elementId':'','replyElement':{'replayMsgSeq':_0x5ac16a,'replayMsgId':_0x14de9a,'senderUin':_0x22600f,'senderUinStr':_0x2ab8cd}};}static async[_0x12358b(0x18f)](_0x449c2e,_0x1ea0b0='',_0x215766=0x0){const _0x388ef5=_0x12358b,_0x53e17a={'xSVbZ':function(_0x10f6fc,_0xec35f8){return _0x10f6fc===_0xec35f8;},'gvSSY':'文件异常，大小为0','wQIqH':function(_0x190f49,_0x5012aa){return _0x190f49(_0x5012aa);}},{md5:_0x27957d,fileName:_0x37332b,path:_0x5dffcd,fileSize:_0x2f614e}=await NTQQFileApi['uploadFile'](_0x449c2e,ElementType[_0x388ef5(0x186)],_0x215766);if(_0x53e17a[_0x388ef5(0x1e2)](_0x2f614e,0x0))throw _0x53e17a[_0x388ef5(0x1b8)];const _0x54b3d5=await NTQQFileApi[_0x388ef5(0x194)](_0x449c2e),_0xb09ca7={'md5HexStr':_0x27957d,'fileSize':_0x2f614e[_0x388ef5(0x19a)](),'picWidth':_0x54b3d5?.['width'],'picHeight':_0x54b3d5?.[_0x388ef5(0x1d2)],'fileName':_0x37332b,'sourcePath':_0x5dffcd,'original':!![],'picType':_0x53e17a['wQIqH'](isGIF,_0x449c2e)?PicType[_0x388ef5(0x1b9)]:PicType[_0x388ef5(0x1aa)],'picSubType':_0x215766,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x1ea0b0};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0xb09ca7};}static async[_0x12358b(0x1d4)](_0x54fb6b,_0x4eeab6='',_0x4d124e=''){const _0x22258e=_0x12358b,_0x1b06b2={'ssRPM':_0x22258e(0x1a6),'pxgxv':function(_0x3e44ce,_0x4759d8){return _0x3e44ce||_0x4759d8;}},{md5:_0xb0dc8,fileName:_0x460fc9,path:_0x55ca61,fileSize:_0x53ee92}=await NTQQFileApi['uploadFile'](_0x54fb6b,ElementType[_0x22258e(0x190)]);if(_0x53ee92===0x0)throw _0x1b06b2[_0x22258e(0x197)];const _0xdda941={'elementType':ElementType[_0x22258e(0x190)],'elementId':'','fileElement':{'fileName':_0x1b06b2[_0x22258e(0x187)](_0x4eeab6,_0x460fc9),'folderId':_0x4d124e,'filePath':_0x55ca61,'fileSize':_0x53ee92['toString']()}};return _0xdda941;}static async[_0x12358b(0x1a1)](_0xa99923,_0x7371f2='',_0x12846a=''){const _0x8f54eb=_0x12358b,_0x52fab9={'VpLZZ':function(_0x36d33d,_0x1ef2e0,_0x2b69d5){return _0x36d33d(_0x1ef2e0,_0x2b69d5);},'oKWff':_0x8f54eb(0x1ba),'lcUFt':function(_0x52406e,_0x580ded){return _0x52406e(_0x580ded);},'yoNWa':'end','wsZDv':'error','pXAzH':function(_0x6ed657,_0x4156e2){return _0x6ed657+_0x4156e2;},'gHZPC':function(_0x5d7d0d,_0xc08744){return _0x5d7d0d===_0xc08744;},'tsabU':'文件异常，大小为0','OKYbf':'mp4','aNoPO':function(_0x126960,_0x4f6ac7,_0x3c88c4){return _0x126960(_0x4f6ac7,_0x3c88c4);},'UNTxP':_0x8f54eb(0x191),'WqVDX':function(_0xe41b46,_0x1d4218){return _0xe41b46+_0x1d4218;}},{fileName:_0x210a5c,path:_0x56aede,fileSize:_0x326059,md5:_0x428771}=await NTQQFileApi['uploadFile'](_0xa99923,ElementType[_0x8f54eb(0x1c9)]);if(_0x52fab9[_0x8f54eb(0x196)](_0x326059,0x0))throw _0x52fab9[_0x8f54eb(0x18d)];let _0x39e19e=_0x56aede[_0x8f54eb(0x18e)](_0x5e06ff[_0x8f54eb(0x1dd)]+_0x8f54eb(0x1d5)+_0x5e06ff[_0x8f54eb(0x1dd)],_0x5e06ff[_0x8f54eb(0x1dd)]+'Thumb'+_0x5e06ff[_0x8f54eb(0x1dd)]);_0x39e19e=_0x5e06ff[_0x8f54eb(0x1df)](_0x39e19e);let _0x4fe3c4={'width':0x780,'height':0x438,'time':0xf,'format':_0x52fab9[_0x8f54eb(0x1c1)],'size':_0x326059,'filePath':_0xa99923};try{_0x4fe3c4=await getVideoInfo(_0x56aede);}catch(_0x1b0533){_0x52fab9[_0x8f54eb(0x1d7)](logError,_0x52fab9[_0x8f54eb(0x19b)],_0x1b0533);}const _0x1f6dad=new Promise((_0x3dfcdb,_0x41a22b)=>{const _0x182884=_0x8f54eb,_0x47af0a={'uVZXq':function(_0x37330b,_0xdc6d65){const _0x40d41d=_0x410f;return _0x52fab9[_0x40d41d(0x1e0)](_0x37330b,_0xdc6d65);}},_0x2bc83f=_0x428771+'_0.png',_0x5b557c=_0x5e06ff['join'](_0x39e19e,_0x2bc83f);_0x52fab9['lcUFt'](_0x36f529,_0xa99923)['on'](_0x52fab9[_0x182884(0x1e1)],()=>{})['on'](_0x52fab9['wsZDv'],_0x2e5c49=>{const _0x4f6205=_0x182884;_0x52fab9[_0x4f6205(0x1bb)](logDebug,_0x52fab9[_0x4f6205(0x1c5)],_0x2e5c49),_0x12846a?_0x9ec4d9[_0x4f6205(0x18a)](_0x12846a,_0x5b557c)[_0x4f6205(0x1a2)](()=>{const _0x230739=_0x4f6205;_0x47af0a[_0x230739(0x193)](_0x3dfcdb,_0x5b557c);})['catch'](_0x41a22b):_0x9ec4d9[_0x4f6205(0x19d)](_0x5b557c,defaultVideoThumb)[_0x4f6205(0x1a2)](()=>{_0x3dfcdb(_0x5b557c);})['catch'](_0x41a22b);})[_0x182884(0x1c4)]({'timestamps':[0x0],'filename':_0x2bc83f,'folder':_0x39e19e,'size':_0x52fab9['pXAzH'](_0x52fab9[_0x182884(0x1d8)](_0x4fe3c4['width'],'x'),_0x4fe3c4[_0x182884(0x1d2)])})['on'](_0x52fab9[_0x182884(0x1e1)],()=>{const _0x107b51=_0x182884;_0x52fab9[_0x107b51(0x1e0)](_0x3dfcdb,_0x5b557c);});}),_0x21ab3f=new Map(),_0xaa4353=await _0x1f6dad,_0x4c5b87=(await _0x9ec4d9[_0x8f54eb(0x1c2)](_0xaa4353))[_0x8f54eb(0x1d0)];_0x21ab3f[_0x8f54eb(0x1af)](0x0,_0xaa4353);const _0x104a7d=await calculateFileMD5(_0xaa4353),_0x32bc3d={'elementType':ElementType[_0x8f54eb(0x1c9)],'elementId':'','videoElement':{'fileName':_0x7371f2||_0x210a5c,'filePath':_0x56aede,'videoMd5':_0x428771,'thumbMd5':_0x104a7d,'fileTime':_0x4fe3c4[_0x8f54eb(0x1bd)],'thumbPath':_0x21ab3f,'thumbSize':_0x4c5b87,'thumbWidth':_0x4fe3c4[_0x8f54eb(0x1ac)],'thumbHeight':_0x4fe3c4['height'],'fileSize':_0x52fab9['WqVDX']('',_0x326059)}};return _0x32bc3d;}static async[_0x12358b(0x1a9)](_0x5762f9){const _0x1c8610=_0x12358b,_0x384eed={'PYzUN':function(_0x54dbf4,_0x31af27){return _0x54dbf4(_0x31af27);},'WCAcO':_0x1c8610(0x1a3),'kJmop':function(_0x2273d6,_0x3aadfd){return _0x2273d6===_0x3aadfd;},'lwzAP':_0x1c8610(0x1a6)},{converted:_0x14a29e,path:_0x41181e,duration:_0x252f3d}=await _0x384eed[_0x1c8610(0x1d6)](encodeSilk,_0x5762f9);if(!_0x41181e)throw _0x384eed[_0x1c8610(0x192)];const {md5:_0x23371f,fileName:_0x4f9460,path:_0x5eb4af,fileSize:_0x3d4196}=await NTQQFileApi[_0x1c8610(0x19e)](_0x41181e,ElementType['PTT']);if(_0x384eed[_0x1c8610(0x1d3)](_0x3d4196,0x0))throw _0x384eed[_0x1c8610(0x19f)];return _0x14a29e&&_0x9ec4d9[_0x1c8610(0x1b1)](_0x41181e)['then'](),{'elementType':ElementType[_0x1c8610(0x1ae)],'elementId':'','pttElement':{'fileName':_0x4f9460,'filePath':_0x5eb4af,'md5HexStr':_0x23371f,'fileSize':_0x3d4196,'duration':_0x252f3d||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x12358b(0x1a4)](_0x26f6a1){const _0x3636c6=_0x12358b,_0x71761c={'ClBLa':function(_0x392613,_0x37694a){return _0x392613(_0x37694a);}},_0x3eea8e=_0x3e1271[_0x3636c6(0x1d9)],_0x5a17c5=_0x3e1271[_0x3636c6(0x18b)],_0x4ed33f=_0x3eea8e['find'](_0x5ca25b=>_0x5ca25b[_0x3636c6(0x1cd)]===_0x26f6a1[_0x3636c6(0x19a)]());_0x26f6a1=_0x71761c[_0x3636c6(0x1bc)](parseInt,_0x26f6a1[_0x3636c6(0x19a)]());let _0x142404=0x1;return _0x26f6a1>=0xde&&(_0x142404=0x2),_0x4ed33f[_0x3636c6(0x1b2)]&&(_0x142404=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x26f6a1,'faceType':_0x142404,'faceText':_0x4ed33f['QDes'],'stickerId':_0x4ed33f[_0x3636c6(0x1ca)],'stickerType':_0x4ed33f[_0x3636c6(0x1b2)],'packId':_0x4ed33f[_0x3636c6(0x1ab)],'sourceType':0x1}};}static['mface'](_0x1f2947,_0x2cf8fd,_0x222c77,_0x3a3855){const _0x2e3290=_0x12358b,_0x164373={'MtNmg':_0x2e3290(0x1b5)};return{'elementType':ElementType[_0x2e3290(0x188)],'marketFaceElement':{'emojiPackageId':_0x1f2947,'emojiId':_0x2cf8fd,'key':_0x222c77,'faceName':_0x3a3855||mFaceCache[_0x2e3290(0x18c)](_0x2cf8fd)||_0x164373[_0x2e3290(0x1c8)]}};}static[_0x12358b(0x1b6)](_0x1618f4){const _0x4adece=_0x12358b,_0x4c1c43={'rDoXU':_0x4adece(0x199)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4adece(0x1b6)],'faceType':FaceType[_0x4adece(0x1b6)],'faceText':_0x4c1c43['rDoXU'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x12358b(0x185)](_0x1c2b56){const _0x3a49b5=_0x12358b;return{'elementType':ElementType[_0x3a49b5(0x1cb)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':'[包剪锤]','faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x12358b(0x195)](_0x28dd5d){const _0x56350e=_0x12358b,_0x228f76={'IeZOS':function(_0x5267a0,_0x31bf30){return _0x5267a0!==_0x31bf30;},'rfGWM':_0x56350e(0x1b3)};return _0x228f76[_0x56350e(0x1c6)](typeof _0x28dd5d,_0x228f76[_0x56350e(0x1de)])&&(_0x28dd5d=JSON['stringify'](_0x28dd5d)),{'elementType':ElementType[_0x56350e(0x1c0)],'elementId':'','arkElement':{'bytesData':_0x28dd5d,'linkInfo':null,'subElementType':null}};}static['markdown'](_0xee87e6){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0xee87e6}};}static async[_0x12358b(0x1b7)](){const _0x445a83=_0x12358b,_0x4bc42b={'ZeKgn':function(_0x462c53,_0x19838a){return _0x462c53(_0x19838a);},'fmMpM':_0x445a83(0x189),'vUqbe':'https://www.bilibili.com/','aYZeY':_0x445a83(0x1ce)};let _0x472eab=await _0x4bc42b['ZeKgn'](SignMiniApp,{'prompt':_0x4bc42b[_0x445a83(0x1a0)],'title':_0x4bc42b[_0x445a83(0x1a0)],'preview':_0x445a83(0x1b0),'jumpUrl':_0x4bc42b[_0x445a83(0x1cc)],'tag':_0x4bc42b[_0x445a83(0x1a0)],'tagIcon':_0x445a83(0x1ce),'source':_0x4bc42b['fmMpM'],'sourcelogo':_0x4bc42b[_0x445a83(0x1ad)]});return{'elementType':ElementType[_0x445a83(0x1c0)],'elementId':'','arkElement':{'bytesData':_0x472eab,'linkInfo':null,'subElementType':null}};}}