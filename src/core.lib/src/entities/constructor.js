function _0x188f(){const _0x4493d7=['uzqZR','fgjkN','reply','xDjTp','12796VdFjhm','time','ARK','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','4moyFRi','IRADt','stat','ZPuUB','atXme','Zojdo','RPS','347104wHJEfM','AniStickerId','_0.png','1524heSjLI','dice','2139300sZrFDQ','FACE','eUuac','get','toString','语音转换失败,\x20请检查语音文件是否正常','VIDEO','Ljyai','gif','zZlDY','join','PTT','error','PIC','QDes','ASlzv','获取视频封面失败，使用默认封面','AniStickerType','face','FILE','then','[包剪锤]','Imsyd','notAt','KYvug','markdown','HGFYi','文件异常，大小为0','6600995DiGyJn','find','ark','QSid','MFvMz','Ori','获取视频信息失败','50PyjIhl','QDtSX','RaXPx','NKKev','Bot\x20Test','TEXT','sep','uploadFile','[骰子]','iOaYk','397242TjnwSZ','rps','tlRVg','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','woelX','UCbfo','miniapp','catch','REPLY','height','1435104RLpDDH','ZBOUd','writeFile','copyFile','size','[商城表情]','SozIj','end','Thumb','SaBTD','width','unlink','getImageSize','video','emoji','625691knkJUH','stringify','ptt','MFACE','AniStickerPackId','wspzi','mbNNi','XIyoG'];_0x188f=function(){return _0x4493d7;};return _0x188f();}const _0x10115a=_0x4d3c;(function(_0x353455,_0x5200e6){const _0x58a152=_0x4d3c,_0x5e64eb=_0x353455();while(!![]){try{const _0x516885=-parseInt(_0x58a152(0x14f))/0x1+-parseInt(_0x58a152(0x166))/0x2+-parseInt(_0x58a152(0x16b))/0x3+-parseInt(_0x58a152(0x15f))/0x4*(-parseInt(_0x58a152(0x187))/0x5)+-parseInt(_0x58a152(0x169))/0x6*(-parseInt(_0x58a152(0x15b))/0x7)+parseInt(_0x58a152(0x140))/0x8+-parseInt(_0x58a152(0x136))/0x9*(-parseInt(_0x58a152(0x18e))/0xa);if(_0x516885===_0x5200e6)break;else _0x5e64eb['push'](_0x5e64eb['shift']());}catch(_0x2589f2){_0x5e64eb['push'](_0x5e64eb['shift']());}}}(_0x188f,0xa41f6));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x454880}from'node:fs';import _0x1bb051 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x34f3e3 from'./face_config.json';import*as _0x124c5f from'node:path';import{SignMiniApp}from'../apis';function _0x4d3c(_0x1a8a77,_0x4bc318){const _0x188fd7=_0x188f();return _0x4d3c=function(_0x4d3c54,_0x1d6509){_0x4d3c54=_0x4d3c54-0x135;let _0xe3db31=_0x188fd7[_0x4d3c54];return _0xe3db31;},_0x4d3c(_0x1a8a77,_0x4bc318);}export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x2cd0c5){const _0x2d7280=_0x4d3c;return{'elementType':ElementType[_0x2d7280(0x193)],'elementId':'','textElement':{'content':_0x2cd0c5,'atType':AtType[_0x2d7280(0x182)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x48d4c1,_0x3549e6,_0x4fc4ae,_0x4b9a99){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x4b9a99,'atType':_0x4fc4ae,'atUid':_0x48d4c1,'atTinyId':'','atNtUid':_0x3549e6}};}static[_0x10115a(0x159)](_0x5bcb92,_0x375345,_0x19d27d,_0x4a8b83){const _0x1de126=_0x10115a;return{'elementType':ElementType[_0x1de126(0x13e)],'elementId':'','replyElement':{'replayMsgSeq':_0x5bcb92,'replayMsgId':_0x375345,'senderUin':_0x19d27d,'senderUinStr':_0x4a8b83}};}static async['pic'](_0x326f64,_0x24f6cb='',_0x51ad7=0x0){const _0x317cfd=_0x10115a,_0x5f5bb2={'KYvug':function(_0x189953,_0x1b3af2){return _0x189953===_0x1b3af2;},'ZBOUd':_0x317cfd(0x186),'Imsyd':function(_0x179a94,_0x7b4391){return _0x179a94(_0x7b4391);}},{md5:_0x2edebf,fileName:_0x30782e,path:_0x4d826d,fileSize:_0x3264f5}=await NTQQFileApi['uploadFile'](_0x326f64,ElementType[_0x317cfd(0x178)],_0x51ad7);if(_0x5f5bb2[_0x317cfd(0x183)](_0x3264f5,0x0))throw _0x5f5bb2[_0x317cfd(0x141)];const _0x3824cf=await NTQQFileApi[_0x317cfd(0x14c)](_0x326f64),_0x263f48={'md5HexStr':_0x2edebf,'fileSize':_0x3264f5[_0x317cfd(0x16f)](),'picWidth':_0x3824cf?.['width'],'picHeight':_0x3824cf?.[_0x317cfd(0x13f)],'fileName':_0x30782e,'sourcePath':_0x4d826d,'original':!![],'picType':_0x5f5bb2[_0x317cfd(0x181)](isGIF,_0x326f64)?PicType[_0x317cfd(0x173)]:PicType['jpg'],'picSubType':_0x51ad7,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x24f6cb};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x263f48};}static async['file'](_0x42d5c6,_0xcf3828='',_0x3072b9=''){const _0x706264=_0x10115a,_0x3af377={'fgjkN':function(_0x2ea247,_0x595dec){return _0x2ea247===_0x595dec;},'Ljyai':_0x706264(0x186),'QDtSX':function(_0x2a4433,_0x5dc7d3){return _0x2a4433||_0x5dc7d3;}},{md5:_0x30fc80,fileName:_0x445404,path:_0x2085f9,fileSize:_0x5cdf86}=await NTQQFileApi['uploadFile'](_0x42d5c6,ElementType[_0x706264(0x17e)]);if(_0x3af377[_0x706264(0x158)](_0x5cdf86,0x0))throw _0x3af377[_0x706264(0x172)];const _0x54fb15={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x3af377[_0x706264(0x18f)](_0xcf3828,_0x445404),'folderId':_0x3072b9,'filePath':_0x2085f9,'fileSize':_0x5cdf86[_0x706264(0x16f)]()}};return _0x54fb15;}static async[_0x10115a(0x14d)](_0x14d0b8,_0x5d2aa0='',_0xfe750=''){const _0x25d344=_0x10115a,_0x44c5f6={'tlRVg':function(_0x304255,_0x5025b0){return _0x304255(_0x5025b0);},'IRADt':function(_0x4ad688,_0x3b9df1){return _0x4ad688(_0x3b9df1);},'HGFYi':function(_0xd2e034,_0x13b1d9,_0x3dee7b){return _0xd2e034(_0x13b1d9,_0x3dee7b);},'ZPuUB':_0x25d344(0x17b),'Zojdo':function(_0x4ba679,_0x4ed3ef){return _0x4ba679+_0x4ed3ef;},'iOaYk':_0x25d344(0x147),'zZlDY':function(_0xfc18f8,_0x1b77c5){return _0xfc18f8===_0x1b77c5;},'uzqZR':_0x25d344(0x186),'ZokDU':'mp4','hXqDh':_0x25d344(0x18d),'wspzi':function(_0x504ff3,_0x4afa37){return _0x504ff3||_0x4afa37;}},{fileName:_0x56fc2a,path:_0x4ea91f,fileSize:_0x83cb8d,md5:_0x9b8b66}=await NTQQFileApi[_0x25d344(0x195)](_0x14d0b8,ElementType[_0x25d344(0x171)]);if(_0x44c5f6[_0x25d344(0x174)](_0x83cb8d,0x0))throw _0x44c5f6[_0x25d344(0x157)];let _0x21d354=_0x4ea91f['replace'](_0x124c5f[_0x25d344(0x194)]+_0x25d344(0x18c)+_0x124c5f[_0x25d344(0x194)],_0x124c5f[_0x25d344(0x194)]+_0x25d344(0x148)+_0x124c5f[_0x25d344(0x194)]);_0x21d354=_0x124c5f['dirname'](_0x21d354);let _0xeeead1={'width':0x780,'height':0x438,'time':0xf,'format':_0x44c5f6['ZokDU'],'size':_0x83cb8d,'filePath':_0x14d0b8};try{_0xeeead1=await _0x44c5f6['tlRVg'](getVideoInfo,_0x4ea91f);}catch(_0x37429b){logError(_0x44c5f6['hXqDh'],_0x37429b);}const _0x42eb78=new Promise((_0x56acc9,_0x30e94f)=>{const _0x16d942=_0x25d344,_0x211f0f={'MFvMz':function(_0x23f3ad,_0x22c179){return _0x23f3ad(_0x22c179);},'mbNNi':function(_0x44cdd1,_0x2722b4){const _0x283627=_0x4d3c;return _0x44c5f6[_0x283627(0x160)](_0x44cdd1,_0x2722b4);},'NKKev':function(_0x33db8c,_0x5d720b,_0x5c456e){const _0x2d6f70=_0x4d3c;return _0x44c5f6[_0x2d6f70(0x185)](_0x33db8c,_0x5d720b,_0x5c456e);},'xDjTp':_0x44c5f6[_0x16d942(0x162)]},_0x405d37=_0x9b8b66+_0x16d942(0x168),_0x3c4e33=_0x124c5f[_0x16d942(0x175)](_0x21d354,_0x405d37);_0x44c5f6[_0x16d942(0x160)](_0x1bb051,_0x14d0b8)['on'](_0x16d942(0x147),()=>{})['on'](_0x16d942(0x177),_0x1e0007=>{const _0x1d75ae=_0x16d942,_0x1c974d={'woelX':function(_0x48b23f,_0x50118d){const _0x25de48=_0x4d3c;return _0x211f0f[_0x25de48(0x155)](_0x48b23f,_0x50118d);}};_0x211f0f[_0x1d75ae(0x191)](logDebug,_0x211f0f[_0x1d75ae(0x15a)],_0x1e0007),_0xfe750?_0x454880[_0x1d75ae(0x143)](_0xfe750,_0x3c4e33)[_0x1d75ae(0x17f)](()=>{const _0x1f68de=_0x1d75ae;_0x1c974d[_0x1f68de(0x13a)](_0x56acc9,_0x3c4e33);})[_0x1d75ae(0x13d)](_0x30e94f):_0x454880[_0x1d75ae(0x142)](_0x3c4e33,defaultVideoThumb)['then'](()=>{const _0x4fdf8e=_0x1d75ae;_0x211f0f[_0x4fdf8e(0x18b)](_0x56acc9,_0x3c4e33);})['catch'](_0x30e94f);})['screenshots']({'timestamps':[0x0],'filename':_0x405d37,'folder':_0x21d354,'size':_0x44c5f6[_0x16d942(0x164)](_0x44c5f6['Zojdo'](_0xeeead1[_0x16d942(0x14a)],'x'),_0xeeead1[_0x16d942(0x13f)])})['on'](_0x44c5f6[_0x16d942(0x135)],()=>{const _0x5a4ffe=_0x16d942;_0x44c5f6[_0x5a4ffe(0x138)](_0x56acc9,_0x3c4e33);});}),_0x583c79=new Map(),_0x519d72=await _0x42eb78,_0x1a0b94=(await _0x454880[_0x25d344(0x161)](_0x519d72))[_0x25d344(0x144)];_0x583c79['set'](0x0,_0x519d72);const _0x6c3c33=await _0x44c5f6[_0x25d344(0x138)](calculateFileMD5,_0x519d72),_0x2e1008={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x44c5f6[_0x25d344(0x154)](_0x5d2aa0,_0x56fc2a),'filePath':_0x4ea91f,'videoMd5':_0x9b8b66,'thumbMd5':_0x6c3c33,'fileTime':_0xeeead1[_0x25d344(0x15c)],'thumbPath':_0x583c79,'thumbSize':_0x1a0b94,'thumbWidth':_0xeeead1[_0x25d344(0x14a)],'thumbHeight':_0xeeead1[_0x25d344(0x13f)],'fileSize':_0x44c5f6[_0x25d344(0x164)]('',_0x83cb8d)}};return _0x2e1008;}static async[_0x10115a(0x151)](_0x2d4688){const _0x22b721=_0x10115a,_0x1e0f5c={'XIyoG':function(_0x5e7176,_0x3ad446){return _0x5e7176(_0x3ad446);},'SaBTD':_0x22b721(0x170),'uGizG':function(_0x377c4e,_0x370882){return _0x377c4e===_0x370882;},'DHdJL':_0x22b721(0x186),'ASlzv':function(_0x44feba,_0x38ab78){return _0x44feba||_0x38ab78;}},{converted:_0x43275d,path:_0x1c2719,duration:_0x1f5405}=await _0x1e0f5c[_0x22b721(0x156)](encodeSilk,_0x2d4688);if(!_0x1c2719)throw _0x1e0f5c[_0x22b721(0x149)];const {md5:_0x3e9f9a,fileName:_0x1b630c,path:_0x5d41f4,fileSize:_0x335434}=await NTQQFileApi[_0x22b721(0x195)](_0x1c2719,ElementType[_0x22b721(0x176)]);if(_0x1e0f5c['uGizG'](_0x335434,0x0))throw _0x1e0f5c['DHdJL'];return _0x43275d&&_0x454880[_0x22b721(0x14b)](_0x1c2719)[_0x22b721(0x17f)](),{'elementType':ElementType[_0x22b721(0x176)],'elementId':'','pttElement':{'fileName':_0x1b630c,'filePath':_0x5d41f4,'md5HexStr':_0x3e9f9a,'fileSize':_0x335434,'duration':_0x1e0f5c[_0x22b721(0x17a)](_0x1f5405,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x10115a(0x17d)](_0x1eefb6){const _0x232d3c=_0x10115a,_0x549a68={'zPVCN':function(_0x506ab5,_0x3ac508){return _0x506ab5(_0x3ac508);},'ohMvT':function(_0xdae10f,_0x57040b){return _0xdae10f>=_0x57040b;}},_0x2cccef=_0x34f3e3['sysface'],_0x114d53=_0x34f3e3[_0x232d3c(0x14e)],_0x4c388b=_0x2cccef[_0x232d3c(0x188)](_0x506aae=>_0x506aae[_0x232d3c(0x18a)]===_0x1eefb6[_0x232d3c(0x16f)]());_0x1eefb6=_0x549a68['zPVCN'](parseInt,_0x1eefb6[_0x232d3c(0x16f)]());let _0x23c038=0x1;return _0x549a68['ohMvT'](_0x1eefb6,0xde)&&(_0x23c038=0x2),_0x4c388b[_0x232d3c(0x17c)]&&(_0x23c038=0x3),{'elementType':ElementType[_0x232d3c(0x16c)],'elementId':'','faceElement':{'faceIndex':_0x1eefb6,'faceType':_0x23c038,'faceText':_0x4c388b[_0x232d3c(0x179)],'stickerId':_0x4c388b[_0x232d3c(0x167)],'stickerType':_0x4c388b['AniStickerType'],'packId':_0x4c388b[_0x232d3c(0x153)],'sourceType':0x1}};}static['mface'](_0x3f4d33,_0x1338ee,_0x53e05f,_0x472620){const _0x148dcc=_0x10115a,_0x470c77={'atXme':_0x148dcc(0x145)};return{'elementType':ElementType[_0x148dcc(0x152)],'marketFaceElement':{'emojiPackageId':_0x3f4d33,'emojiId':_0x1338ee,'key':_0x53e05f,'faceName':_0x472620||mFaceCache[_0x148dcc(0x16e)](_0x1338ee)||_0x470c77[_0x148dcc(0x163)]}};}static['dice'](_0x16a01e){const _0x1a623d=_0x10115a,_0x34b65c={'eUuac':_0x1a623d(0x196)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x1a623d(0x16a)],'faceType':FaceType[_0x1a623d(0x16a)],'faceText':_0x34b65c[_0x1a623d(0x16d)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x10115a(0x137)](_0x5bd076){const _0x390be9=_0x10115a,_0x41a65c={'SozIj':_0x390be9(0x180)};return{'elementType':ElementType[_0x390be9(0x16c)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x390be9(0x165)],'faceText':_0x41a65c[_0x390be9(0x146)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x10115a(0x189)](_0x370416){const _0x8fc172=_0x10115a,_0x1f5df9={'iwNJY':function(_0x1442f5,_0x5aaf1d){return _0x1442f5!==_0x5aaf1d;},'FicKz':'string'};return _0x1f5df9['iwNJY'](typeof _0x370416,_0x1f5df9['FicKz'])&&(_0x370416=JSON[_0x8fc172(0x150)](_0x370416)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x370416,'linkInfo':null,'subElementType':null}};}static[_0x10115a(0x184)](_0x308d92){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x308d92}};}static async[_0x10115a(0x13c)](){const _0x4f7866=_0x10115a,_0x977c96={'YmXfp':function(_0x4b2954,_0x4e87a7){return _0x4b2954(_0x4e87a7);},'RaXPx':_0x4f7866(0x192),'UUTBB':_0x4f7866(0x15e),'HkwpO':'https://www.bilibili.com/','UCbfo':_0x4f7866(0x139)};let _0x1c3c5c=await _0x977c96['YmXfp'](SignMiniApp,{'prompt':_0x977c96[_0x4f7866(0x190)],'title':_0x977c96[_0x4f7866(0x190)],'preview':_0x977c96['UUTBB'],'jumpUrl':_0x977c96['HkwpO'],'tag':_0x4f7866(0x192),'tagIcon':_0x977c96[_0x4f7866(0x13b)],'source':_0x977c96[_0x4f7866(0x190)],'sourcelogo':_0x977c96[_0x4f7866(0x13b)]});return{'elementType':ElementType[_0x4f7866(0x15d)],'elementId':'','arkElement':{'bytesData':_0x1c3c5c,'linkInfo':null,'subElementType':null}};}}