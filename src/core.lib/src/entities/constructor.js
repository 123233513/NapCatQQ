const _0x5764e8=_0xaccd;(function(_0x35e63d,_0x1aa05a){const _0x2282ac=_0xaccd,_0x26afc7=_0x35e63d();while(!![]){try{const _0x30d5c2=parseInt(_0x2282ac(0x15e))/0x1*(parseInt(_0x2282ac(0x14b))/0x2)+parseInt(_0x2282ac(0x196))/0x3+-parseInt(_0x2282ac(0x183))/0x4*(-parseInt(_0x2282ac(0x173))/0x5)+parseInt(_0x2282ac(0x145))/0x6*(-parseInt(_0x2282ac(0x148))/0x7)+parseInt(_0x2282ac(0x17f))/0x8*(parseInt(_0x2282ac(0x182))/0x9)+-parseInt(_0x2282ac(0x16a))/0xa+parseInt(_0x2282ac(0x17a))/0xb;if(_0x30d5c2===_0x1aa05a)break;else _0x26afc7['push'](_0x26afc7['shift']());}catch(_0x22a1d2){_0x26afc7['push'](_0x26afc7['shift']());}}}(_0x4ada,0x3ed9c));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x404e36}from'node:fs';function _0x4ada(){const _0x53db8d=['TEXT','LDbIp','MFACE','Thumb','VIDEO','face','writeFile','uploadFile','stat','size','3001750OnQsjL','dirname','PTT','ksqnR','EZKnW','width','获取视频信息失败','join','_0.png','105BKJRtI','文件异常，大小为0','PCaUc','HaQmF','Sgjea','AniStickerType','emoji','376365GMeLRl','ark','[骰子]','hUfUO','path','1448IXNGnP','TOofN','MARKDOWN','6759jsMpYA','57544acmCHe','mface','NKWJc','screenshots','height','QSid','图片信息','find','sep','[包剪锤]','QDes','replace','toString','dice','PbiHJ','rps','catch','text','CzRHY','53223BoZVJQ','PIC','YmcjI','rvJuy','dFoAP','396jBLfNO','end','ARK','45010IFtmFX','VJHlD','stringify','983996jTevlN','FACE','AniStickerId','sysface','EHKSw','ptt','error','then','[商城表情]','UhDIA','AniStickerPackId','mp4','copyFile','iozNK','gHZlD','time','EffXO','video','getImageSize','1ZjKDeg','gif'];_0x4ada=function(){return _0x53db8d;};return _0x4ada();}import _0x5bb219 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x461464 from'./face_config.json';function _0xaccd(_0x1188b4,_0x44d679){const _0x4ada9b=_0x4ada();return _0xaccd=function(_0xaccd7f,_0x2e1952){_0xaccd7f=_0xaccd7f-0x142;let _0x5777bc=_0x4ada9b[_0xaccd7f];return _0x5777bc;},_0xaccd(_0x1188b4,_0x44d679);}export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x5764e8(0x194)](_0x82da2b){const _0x377e33=_0x5764e8;return{'elementType':ElementType[_0x377e33(0x160)],'elementId':'','textElement':{'content':_0x82da2b,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x81addc,_0x28517a,_0x4a519c,_0x5afe66){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x5afe66,'atType':_0x4a519c,'atUid':_0x81addc,'atTinyId':'','atNtUid':_0x28517a}};}static['reply'](_0x5478a2,_0x109c03,_0x19b13e,_0x1947dd){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x5478a2,'replayMsgId':_0x109c03,'senderUin':_0x19b13e,'senderUinStr':_0x1947dd}};}static async['pic'](_0x22e37b,_0x2d6f88='',_0x13706b=0x0){const _0x34d21c=_0x5764e8,_0x1a7151={'TOofN':function(_0x569414,_0x90bef3){return _0x569414===_0x90bef3;},'CzRHY':function(_0x3a54d3,_0x35f10b){return _0x3a54d3(_0x35f10b);},'PbiHJ':_0x34d21c(0x189)},{md5:_0x2e81c8,fileName:_0x5a508d,path:_0x1abe36,fileSize:_0x2ce90f}=await NTQQFileApi[_0x34d21c(0x167)](_0x22e37b,ElementType[_0x34d21c(0x197)],_0x13706b);if(_0x1a7151[_0x34d21c(0x180)](_0x2ce90f,0x0))throw _0x34d21c(0x174);const _0x15bf48=await NTQQFileApi[_0x34d21c(0x15d)](_0x22e37b),_0x2d89bf={'md5HexStr':_0x2e81c8,'fileSize':_0x2ce90f['toString'](),'picWidth':_0x15bf48?.[_0x34d21c(0x16f)],'picHeight':_0x15bf48?.[_0x34d21c(0x187)],'fileName':_0x5a508d,'sourcePath':_0x1abe36,'original':!![],'picType':_0x1a7151[_0x34d21c(0x195)](isGIF,_0x22e37b)?PicType[_0x34d21c(0x15f)]:PicType['jpg'],'picSubType':_0x13706b,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2d6f88};return logDebug(_0x1a7151[_0x34d21c(0x191)],_0x2d89bf),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x2d89bf};}static async['file'](_0x527492,_0x91342d=''){const _0x16a1e7=_0x5764e8,_0x10c3bf={'YmcjI':function(_0x476305,_0x3a628d){return _0x476305===_0x3a628d;},'hUfUO':'文件异常，大小为0','UhDIA':function(_0x4ee0d5,_0x2098e8){return _0x4ee0d5||_0x2098e8;}},{md5:_0x5b3046,fileName:_0x2d7162,path:_0x32de10,fileSize:_0x492b3f}=await NTQQFileApi[_0x16a1e7(0x167)](_0x527492,ElementType['FILE']);if(_0x10c3bf[_0x16a1e7(0x142)](_0x492b3f,0x0))throw _0x10c3bf[_0x16a1e7(0x17d)];const _0x2592e2={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x10c3bf[_0x16a1e7(0x154)](_0x91342d,_0x2d7162),'filePath':_0x32de10,'fileSize':_0x492b3f['toString']()}};return _0x2592e2;}static async[_0x5764e8(0x15c)](_0x5cf50d,_0x8d2a75='',_0x407004=''){const _0x22c33a=_0x5764e8,_0x4a18e5={'VJHlD':function(_0x15bf73,_0x4cdb33,_0x13dc80){return _0x15bf73(_0x4cdb33,_0x13dc80);},'Sgjea':'获取视频封面失败，使用默认封面','PCaUc':function(_0x1bda17,_0xef3dc7){return _0x1bda17(_0xef3dc7);},'PAdWY':function(_0x109285,_0x28072c){return _0x109285(_0x28072c);},'EffXO':_0x22c33a(0x146),'gHZlD':function(_0xf3a353,_0x104eb2){return _0xf3a353+_0x104eb2;},'EHKSw':'文件异常，大小为0','dNxUc':_0x22c33a(0x17e),'dFoAP':function(_0x1db995,_0x109065){return _0x1db995(_0x109065);},'ZIyTY':function(_0x41bb91,_0x38f070,_0x26d211){return _0x41bb91(_0x38f070,_0x26d211);},'rvJuy':function(_0x1e06a6,_0x28881a){return _0x1e06a6||_0x28881a;}},{fileName:_0xc6751,path:_0x4d1912,fileSize:_0x193c6d,md5:_0x2c596a}=await NTQQFileApi[_0x22c33a(0x167)](_0x5cf50d,ElementType[_0x22c33a(0x164)]);if(_0x193c6d===0x0)throw _0x4a18e5[_0x22c33a(0x14f)];const _0x4f0828=require(_0x4a18e5['dNxUc']);let _0x1fc7ca=_0x4d1912[_0x22c33a(0x18e)](_0x4f0828['sep']+'Ori'+_0x4f0828[_0x22c33a(0x18b)],_0x4f0828['sep']+_0x22c33a(0x163)+_0x4f0828[_0x22c33a(0x18b)]);_0x1fc7ca=_0x4f0828[_0x22c33a(0x16b)](_0x1fc7ca);let _0x497f26={'width':0x780,'height':0x438,'time':0xf,'format':_0x22c33a(0x156),'size':_0x193c6d,'filePath':_0x5cf50d};try{_0x497f26=await _0x4a18e5[_0x22c33a(0x144)](getVideoInfo,_0x4d1912),logDebug('视频信息',_0x497f26);}catch(_0x59caf7){_0x4a18e5['ZIyTY'](logError,_0x22c33a(0x170),_0x59caf7);}const _0x3d35e5=new Promise((_0x5bc802,_0x5dd8ba)=>{const _0x17b647=_0x22c33a,_0x491a32={'ksqnR':function(_0x16d22c,_0x57065e){return _0x4a18e5['PAdWY'](_0x16d22c,_0x57065e);}},_0x26f41e=_0x2c596a+_0x17b647(0x172),_0x309877=_0x4f0828[_0x17b647(0x171)](_0x1fc7ca,_0x26f41e);_0x5bb219(_0x5cf50d)['on'](_0x4a18e5[_0x17b647(0x15b)],()=>{})['on'](_0x17b647(0x151),_0xa9faba=>{const _0x407d5a=_0x17b647,_0x5bb0cf={'EZKnW':function(_0x37cee2,_0x116ed4){return _0x37cee2(_0x116ed4);}};_0x4a18e5[_0x407d5a(0x149)](logDebug,_0x4a18e5[_0x407d5a(0x177)],_0xa9faba),_0x407004?_0x404e36[_0x407d5a(0x157)](_0x407004,_0x309877)[_0x407d5a(0x152)](()=>{const _0x307de7=_0x407d5a;_0x491a32[_0x307de7(0x16d)](_0x5bc802,_0x309877);})[_0x407d5a(0x193)](_0x5dd8ba):_0x404e36[_0x407d5a(0x166)](_0x309877,defaultVideoThumb)[_0x407d5a(0x152)](()=>{const _0x589198=_0x407d5a;_0x5bb0cf[_0x589198(0x16e)](_0x5bc802,_0x309877);})['catch'](_0x5dd8ba);})[_0x17b647(0x186)]({'timestamps':[0x0],'filename':_0x26f41e,'folder':_0x1fc7ca,'size':_0x4a18e5['gHZlD'](_0x4a18e5[_0x17b647(0x159)](_0x497f26[_0x17b647(0x16f)],'x'),_0x497f26[_0x17b647(0x187)])})['on'](_0x4a18e5[_0x17b647(0x15b)],()=>{_0x4a18e5['PCaUc'](_0x5bc802,_0x309877);});}),_0x3d1778=new Map(),_0x1ed97d=await _0x3d35e5,_0x772cdb=(await _0x404e36[_0x22c33a(0x168)](_0x1ed97d))[_0x22c33a(0x169)];_0x3d1778['set'](0x0,_0x1ed97d);const _0x399eec=await _0x4a18e5[_0x22c33a(0x175)](calculateFileMD5,_0x1ed97d),_0x1ea522={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x4a18e5[_0x22c33a(0x143)](_0x8d2a75,_0xc6751),'filePath':_0x4d1912,'videoMd5':_0x2c596a,'thumbMd5':_0x399eec,'fileTime':_0x497f26[_0x22c33a(0x15a)],'thumbPath':_0x3d1778,'thumbSize':_0x772cdb,'thumbWidth':_0x497f26[_0x22c33a(0x16f)],'thumbHeight':_0x497f26[_0x22c33a(0x187)],'fileSize':_0x4a18e5[_0x22c33a(0x159)]('',_0x193c6d)}};return _0x1ea522;}static async[_0x5764e8(0x150)](_0xc908d1){const _0x281707=_0x5764e8,_0x32d353={'NKWJc':function(_0x3cbf98,_0x12719b){return _0x3cbf98(_0x12719b);},'yTPJB':'语音转换失败,\x20请检查语音文件是否正常','HaQmF':function(_0x5ba3ee,_0x1924e3){return _0x5ba3ee===_0x1924e3;},'kyUvz':function(_0x2a624b,_0x3dad26){return _0x2a624b||_0x3dad26;}},{converted:_0x54ec18,path:_0x535759,duration:_0x2fc745}=await _0x32d353[_0x281707(0x185)](encodeSilk,_0xc908d1);if(!_0x535759)throw _0x32d353['yTPJB'];const {md5:_0x41fdca,fileName:_0x41e5e5,path:_0x4e93f3,fileSize:_0xfa638e}=await NTQQFileApi[_0x281707(0x167)](_0x535759,ElementType[_0x281707(0x16c)]);if(_0x32d353[_0x281707(0x176)](_0xfa638e,0x0))throw _0x281707(0x174);return _0x54ec18&&_0x404e36['unlink'](_0x535759)[_0x281707(0x152)](),{'elementType':ElementType[_0x281707(0x16c)],'elementId':'','pttElement':{'fileName':_0x41e5e5,'filePath':_0x4e93f3,'md5HexStr':_0x41fdca,'fileSize':_0xfa638e,'duration':_0x32d353['kyUvz'](_0x2fc745,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x5764e8(0x165)](_0x2ad4aa){const _0x2fcbab=_0x5764e8,_0x53a9f2=_0x461464[_0x2fcbab(0x14e)],_0xdb3721=_0x461464[_0x2fcbab(0x179)],_0x4ce03e=_0x53a9f2[_0x2fcbab(0x18a)](_0x3cd15c=>_0x3cd15c[_0x2fcbab(0x188)]===_0x2ad4aa['toString']());_0x2ad4aa=parseInt(_0x2ad4aa[_0x2fcbab(0x18f)]());let _0x3dda0c=0x1;return _0x2ad4aa>=0xde&&(_0x3dda0c=0x2),_0x4ce03e[_0x2fcbab(0x178)]&&(_0x3dda0c=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x2ad4aa,'faceType':_0x3dda0c,'faceText':_0x4ce03e[_0x2fcbab(0x18d)],'stickerId':_0x4ce03e[_0x2fcbab(0x14d)],'stickerType':_0x4ce03e['AniStickerType'],'packId':_0x4ce03e[_0x2fcbab(0x155)],'sourceType':0x1}};}static[_0x5764e8(0x184)](_0x253ca7,_0x38cb9d,_0x510b98,_0x56483e){const _0x58253f=_0x5764e8,_0x9a9895={'LDbIp':_0x58253f(0x153)};return{'elementType':ElementType[_0x58253f(0x162)],'marketFaceElement':{'emojiPackageId':_0x253ca7,'emojiId':_0x38cb9d,'key':_0x510b98,'faceName':_0x56483e||mFaceCache['get'](_0x38cb9d)||_0x9a9895[_0x58253f(0x161)]}};}static[_0x5764e8(0x190)](_0x419c7d){const _0x21c47e=_0x5764e8;return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':_0x21c47e(0x17c),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5764e8(0x192)](_0x45b0ae){const _0x340464=_0x5764e8,_0x2365cf={'ESLaM':_0x340464(0x18c)};return{'elementType':ElementType[_0x340464(0x14c)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x2365cf['ESLaM'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x5764e8(0x17b)](_0x1dc836){const _0x210be0=_0x5764e8,_0x482e54={'iozNK':function(_0x31b6ab,_0x55c8a3){return _0x31b6ab!==_0x55c8a3;},'NspDr':'string'};return _0x482e54[_0x210be0(0x158)](typeof _0x1dc836,_0x482e54['NspDr'])&&(_0x1dc836=JSON[_0x210be0(0x14a)](_0x1dc836)),{'elementType':ElementType[_0x210be0(0x147)],'elementId':'','arkElement':{'bytesData':_0x1dc836,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x3cdba0){const _0x37225b=_0x5764e8;return{'elementType':ElementType[_0x37225b(0x181)],'elementId':'','markdownElement':{'content':_0x3cdba0}};}}