const _0x2fb4f2=_0x101a;(function(_0x5ee7cd,_0xf43172){const _0x91f074=_0x101a,_0x19ba1a=_0x5ee7cd();while(!![]){try{const _0x4cb920=-parseInt(_0x91f074(0x1d7))/0x1*(parseInt(_0x91f074(0x1cd))/0x2)+parseInt(_0x91f074(0x209))/0x3+-parseInt(_0x91f074(0x1cc))/0x4*(parseInt(_0x91f074(0x1ec))/0x5)+-parseInt(_0x91f074(0x1db))/0x6+-parseInt(_0x91f074(0x1df))/0x7+parseInt(_0x91f074(0x1ff))/0x8+parseInt(_0x91f074(0x1f0))/0x9;if(_0x4cb920===_0xf43172)break;else _0x19ba1a['push'](_0x19ba1a['shift']());}catch(_0x1abeaa){_0x19ba1a['push'](_0x19ba1a['shift']());}}}(_0x104e,0x64906));function _0x101a(_0x440b67,_0x266974){const _0x104ec9=_0x104e();return _0x101a=function(_0x101a14,_0x5bc915){_0x101a14=_0x101a14-0x1c9;let _0x97e1a4=_0x104ec9[_0x101a14];return _0x97e1a4;},_0x101a(_0x440b67,_0x266974);}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x38cc75}from'node:fs';import _0x4f8bbf from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x2f7077 from'./face_config.json';import*as _0x58b254 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();function _0x104e(){const _0x3fa7d3=['3428232eLMsRk','unlink','uploadFile','eVcFl','adTtU','amcGi','getImageSize','sep','sysface','SVPAp','572277bQNHqr','Ori','AHlLH','owSxS','end','mface','mp4','copyFile','get','igNsR','JQTsU','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','AaxCy','MARKDOWN','RPS','xnqsU','cEMoW','text','TEXT','FACE','puMQc','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','stat','jYCzk','catch','PIC','width','UPHlr','uSXhQ','MlaRB','qwWjZ','toString','size','RiKOo','https://www.bilibili.com/','ecPQK','then','screenshots','2874556oAEKOl','2rYxzbh','set','FILE','语音转换失败,\x20请检查语音文件是否正常','rps','find','获取视频信息失败','eOPjf','pic','文件异常，大小为0','557571yVDmRN','VIDEO','[商城表情]','LByHj','192498VMiPOj','writeFile','cstEI','markdown','2659286ApMYpm','PTT','time','_0.png','jpg','QDes','replace','string','eoTlu','cDMqQ','emoji','REPLY','TMwec','5PkfhnU','AniStickerId','join','error','13327317Wgsjox','sNxAi','bUImU','lGSnJ','jSNxK','height','reply','AniStickerType','[包剪锤]','face','Thumb','jslcs','AniStickerPackId','AZPnF','IsPSs'];_0x104e=function(){return _0x3fa7d3;};return _0x104e();}export class SendMsgElementConstructor{static[_0x2fb4f2(0x21a)](_0x177ee0){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x177ee0,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x3c65a5,_0x4fbeac,_0x3cf700,_0x358237){const _0x53cb1c=_0x2fb4f2;return{'elementType':ElementType[_0x53cb1c(0x21b)],'elementId':'','textElement':{'content':'@'+_0x358237,'atType':_0x3cf700,'atUid':_0x3c65a5,'atTinyId':'','atNtUid':_0x4fbeac}};}static[_0x2fb4f2(0x1f6)](_0x556e80,_0x37ce83,_0x24eca4,_0x882c6a){const _0x4a24ac=_0x2fb4f2;return{'elementType':ElementType[_0x4a24ac(0x1ea)],'elementId':'','replyElement':{'replayMsgSeq':_0x556e80,'replayMsgId':_0x37ce83,'senderUin':_0x24eca4,'senderUinStr':_0x882c6a}};}static async[_0x2fb4f2(0x1d5)](_0x1aeaf5,_0x3cd496='',_0x2b899=0x0){const _0x1ec141=_0x2fb4f2,_0x2f96dd={'MlaRB':function(_0x299e4a,_0x145f99){return _0x299e4a===_0x145f99;},'TMwec':_0x1ec141(0x1d6),'igNsR':function(_0x1f459c,_0x322115){return _0x1f459c(_0x322115);}},{md5:_0x34665a,fileName:_0xd7809,path:_0x40f95a,fileSize:_0x91f958}=await NTQQFileApi[_0x1ec141(0x201)](_0x1aeaf5,ElementType[_0x1ec141(0x222)],_0x2b899);if(_0x2f96dd[_0x1ec141(0x226)](_0x91f958,0x0))throw _0x2f96dd[_0x1ec141(0x1eb)];const _0x43fc4f=await NTQQFileApi[_0x1ec141(0x205)](_0x1aeaf5),_0x10c000={'md5HexStr':_0x34665a,'fileSize':_0x91f958[_0x1ec141(0x228)](),'picWidth':_0x43fc4f?.[_0x1ec141(0x223)],'picHeight':_0x43fc4f?.[_0x1ec141(0x1f5)],'fileName':_0xd7809,'sourcePath':_0x40f95a,'original':!![],'picType':_0x2f96dd[_0x1ec141(0x212)](isGIF,_0x1aeaf5)?PicType['gif']:PicType[_0x1ec141(0x1e3)],'picSubType':_0x2b899,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3cd496};return{'elementType':ElementType[_0x1ec141(0x222)],'elementId':'','picElement':_0x10c000};}static async['file'](_0x51bdef,_0x59a432='',_0x344006=''){const _0x3ba733=_0x2fb4f2,_0x260ed0={'owSxS':function(_0x1ae0e8,_0x22e653){return _0x1ae0e8===_0x22e653;},'MyGqu':_0x3ba733(0x1d6)},{md5:_0x27e9c3,fileName:_0x418028,path:_0x28cd7a,fileSize:_0x43fce4}=await NTQQFileApi['uploadFile'](_0x51bdef,ElementType[_0x3ba733(0x1cf)]);if(_0x260ed0[_0x3ba733(0x20c)](_0x43fce4,0x0))throw _0x260ed0['MyGqu'];const _0x55d009={'elementType':ElementType[_0x3ba733(0x1cf)],'elementId':'','fileElement':{'fileName':_0x59a432||_0x418028,'folderId':_0x344006,'filePath':_0x28cd7a,'fileSize':_0x43fce4[_0x3ba733(0x228)]()}};return _0x55d009;}static async['video'](_0x22ec1f,_0x1e63f6='',_0x3d6af5=''){const _0x3f9e97=_0x2fb4f2,_0x27cb18={'SANFC':function(_0xf3923,_0x3d3296){return _0xf3923(_0x3d3296);},'bUImU':function(_0x2d6394,_0x3c0fae,_0x4cda25){return _0x2d6394(_0x3c0fae,_0x4cda25);},'JQTsU':'获取视频封面失败，使用默认封面','OuDrf':function(_0x5134ff,_0x1d37dd){return _0x5134ff(_0x1d37dd);},'AZPnF':function(_0x290991,_0x5b22ad){return _0x290991(_0x5b22ad);},'cstEI':_0x3f9e97(0x20d),'jslcs':_0x3f9e97(0x1ef),'eoTlu':function(_0x5a2205,_0x55bc34){return _0x5a2205+_0x55bc34;},'AaxCy':function(_0x299955,_0x4aff92){return _0x299955+_0x4aff92;},'sNxAi':function(_0x1c8649,_0x4370ba){return _0x1c8649===_0x4370ba;},'ecPQK':_0x3f9e97(0x1d6),'cDMqQ':function(_0x38b99e,_0x4a6a52,_0x702570){return _0x38b99e(_0x4a6a52,_0x702570);},'vUcKN':function(_0x521499,_0x4222ef){return _0x521499||_0x4222ef;},'obzTi':function(_0x4a936d,_0x3b5859){return _0x4a936d+_0x3b5859;}},{fileName:_0xb14119,path:_0x430b62,fileSize:_0x2ecc2f,md5:_0x48f3fb}=await NTQQFileApi['uploadFile'](_0x22ec1f,ElementType[_0x3f9e97(0x1d8)]);if(_0x27cb18[_0x3f9e97(0x1f1)](_0x2ecc2f,0x0))throw _0x27cb18[_0x3f9e97(0x1c9)];let _0x2adf35=_0x430b62[_0x3f9e97(0x1e5)](_0x58b254['sep']+_0x3f9e97(0x20a)+_0x58b254[_0x3f9e97(0x206)],_0x58b254[_0x3f9e97(0x206)]+_0x3f9e97(0x1fa)+_0x58b254['sep']);_0x2adf35=_0x58b254['dirname'](_0x2adf35);let _0x2dda10={'width':0x780,'height':0x438,'time':0xf,'format':_0x3f9e97(0x20f),'size':_0x2ecc2f,'filePath':_0x22ec1f};try{_0x2dda10=await _0x27cb18[_0x3f9e97(0x1fd)](getVideoInfo,_0x430b62);}catch(_0x572415){_0x27cb18[_0x3f9e97(0x1e8)](logError,_0x3f9e97(0x1d3),_0x572415);}const _0x51d470=new Promise((_0x4b1bf9,_0x5a2933)=>{const _0x162506=_0x3f9e97,_0x179af7={'IsPSs':function(_0x11d543,_0x50f577){return _0x27cb18['SANFC'](_0x11d543,_0x50f577);},'uSXhQ':function(_0x3f7868,_0x167828,_0x3bd323){const _0xc3b7ad=_0x101a;return _0x27cb18[_0xc3b7ad(0x1f2)](_0x3f7868,_0x167828,_0x3bd323);},'AHlLH':_0x27cb18[_0x162506(0x213)],'cEMoW':function(_0x2a3df6,_0x249605){return _0x27cb18['OuDrf'](_0x2a3df6,_0x249605);}},_0x4b9b8b=_0x48f3fb+_0x162506(0x1e2),_0x47a858=_0x58b254[_0x162506(0x1ee)](_0x2adf35,_0x4b9b8b);_0x27cb18['AZPnF'](_0x4f8bbf,_0x22ec1f)['on'](_0x27cb18[_0x162506(0x1dd)],()=>{})['on'](_0x27cb18[_0x162506(0x1fb)],_0x1bde15=>{const _0x4ff227=_0x162506,_0x3bd524={'qwWjZ':function(_0x52a63c,_0x1a0af4){const _0x30a9f8=_0x101a;return _0x179af7[_0x30a9f8(0x1fe)](_0x52a63c,_0x1a0af4);}};_0x179af7[_0x4ff227(0x225)](logDebug,_0x179af7[_0x4ff227(0x20b)],_0x1bde15),_0x3d6af5?_0x38cc75[_0x4ff227(0x210)](_0x3d6af5,_0x47a858)[_0x4ff227(0x1ca)](()=>{_0x179af7['IsPSs'](_0x4b1bf9,_0x47a858);})[_0x4ff227(0x221)](_0x5a2933):_0x38cc75[_0x4ff227(0x1dc)](_0x47a858,defaultVideoThumb)[_0x4ff227(0x1ca)](()=>{const _0x3310fb=_0x4ff227;_0x3bd524[_0x3310fb(0x227)](_0x4b1bf9,_0x47a858);})[_0x4ff227(0x221)](_0x5a2933);})[_0x162506(0x1cb)]({'timestamps':[0x0],'filename':_0x4b9b8b,'folder':_0x2adf35,'size':_0x27cb18[_0x162506(0x1e7)](_0x27cb18[_0x162506(0x215)](_0x2dda10[_0x162506(0x223)],'x'),_0x2dda10[_0x162506(0x1f5)])})['on'](_0x27cb18[_0x162506(0x1dd)],()=>{const _0x56a9ce=_0x162506;_0x179af7[_0x56a9ce(0x219)](_0x4b1bf9,_0x47a858);});}),_0x80ee9b=new Map(),_0x520fd4=await _0x51d470,_0x5d1549=(await _0x38cc75[_0x3f9e97(0x21f)](_0x520fd4))[_0x3f9e97(0x229)];_0x80ee9b[_0x3f9e97(0x1ce)](0x0,_0x520fd4);const _0x681679=await calculateFileMD5(_0x520fd4),_0x3e3328={'elementType':ElementType[_0x3f9e97(0x1d8)],'elementId':'','videoElement':{'fileName':_0x27cb18['vUcKN'](_0x1e63f6,_0xb14119),'filePath':_0x430b62,'videoMd5':_0x48f3fb,'thumbMd5':_0x681679,'fileTime':_0x2dda10[_0x3f9e97(0x1e1)],'thumbPath':_0x80ee9b,'thumbSize':_0x5d1549,'thumbWidth':_0x2dda10[_0x3f9e97(0x223)],'thumbHeight':_0x2dda10[_0x3f9e97(0x1f5)],'fileSize':_0x27cb18['obzTi']('',_0x2ecc2f)}};return _0x3e3328;}static async['ptt'](_0x51ce1a){const _0x53f14f=_0x2fb4f2,_0xfd9402={'eVcFl':function(_0x287604,_0x22d7d9){return _0x287604(_0x22d7d9);},'UPHlr':function(_0x7cac6b,_0x224383){return _0x7cac6b===_0x224383;},'puMQc':'文件异常，大小为0','SVPAp':function(_0x5b7183,_0x41a4d1){return _0x5b7183||_0x41a4d1;}},{converted:_0x5f3f9b,path:_0x1802a2,duration:_0x34b4ea}=await _0xfd9402[_0x53f14f(0x202)](encodeSilk,_0x51ce1a);if(!_0x1802a2)throw _0x53f14f(0x1d0);const {md5:_0x3dfc3b,fileName:_0x3536a4,path:_0xc33949,fileSize:_0x4ba289}=await NTQQFileApi[_0x53f14f(0x201)](_0x1802a2,ElementType[_0x53f14f(0x1e0)]);if(_0xfd9402[_0x53f14f(0x224)](_0x4ba289,0x0))throw _0xfd9402[_0x53f14f(0x21d)];return _0x5f3f9b&&_0x38cc75[_0x53f14f(0x200)](_0x1802a2)[_0x53f14f(0x1ca)](),{'elementType':ElementType[_0x53f14f(0x1e0)],'elementId':'','pttElement':{'fileName':_0x3536a4,'filePath':_0xc33949,'md5HexStr':_0x3dfc3b,'fileSize':_0x4ba289,'duration':_0xfd9402[_0x53f14f(0x208)](_0x34b4ea,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x2fb4f2(0x1f9)](_0x5c2269){const _0x179e09=_0x2fb4f2,_0x58eee3={'lGSnJ':function(_0x3dc8dc,_0x30ad55){return _0x3dc8dc(_0x30ad55);}},_0x505ebc=_0x2f7077[_0x179e09(0x207)],_0x2ec696=_0x2f7077[_0x179e09(0x1e9)],_0x175210=_0x505ebc[_0x179e09(0x1d2)](_0xe2e94a=>_0xe2e94a['QSid']===_0x5c2269[_0x179e09(0x228)]());_0x5c2269=_0x58eee3[_0x179e09(0x1f3)](parseInt,_0x5c2269[_0x179e09(0x228)]());let _0x5208d4=0x1;return _0x5c2269>=0xde&&(_0x5208d4=0x2),_0x175210[_0x179e09(0x1f7)]&&(_0x5208d4=0x3),{'elementType':ElementType[_0x179e09(0x21c)],'elementId':'','faceElement':{'faceIndex':_0x5c2269,'faceType':_0x5208d4,'faceText':_0x175210[_0x179e09(0x1e4)],'stickerId':_0x175210[_0x179e09(0x1ed)],'stickerType':_0x175210[_0x179e09(0x1f7)],'packId':_0x175210[_0x179e09(0x1fc)],'sourceType':0x1}};}static[_0x2fb4f2(0x20e)](_0x446a36,_0x4878a2,_0x41a514,_0x1d4475){const _0x2ea8da=_0x2fb4f2,_0x346994={'LByHj':_0x2ea8da(0x1d9)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x446a36,'emojiId':_0x4878a2,'key':_0x41a514,'faceName':_0x1d4475||mFaceCache[_0x2ea8da(0x211)](_0x4878a2)||_0x346994[_0x2ea8da(0x1da)]}};}static['dice'](_0x4b0267){const _0x30482f=_0x2fb4f2;return{'elementType':ElementType[_0x30482f(0x21c)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':'[骰子]','packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x2fb4f2(0x1d1)](_0x38e4b0){const _0x5e1ad6=_0x2fb4f2,_0x2ac623={'amcGi':_0x5e1ad6(0x1f8)};return{'elementType':ElementType[_0x5e1ad6(0x21c)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x5e1ad6(0x217)],'faceText':_0x2ac623[_0x5e1ad6(0x204)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x3c2e6e){const _0x407916=_0x2fb4f2,_0x5632a6={'eOPjf':_0x407916(0x1e6)};return typeof _0x3c2e6e!==_0x5632a6[_0x407916(0x1d4)]&&(_0x3c2e6e=JSON['stringify'](_0x3c2e6e)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x3c2e6e,'linkInfo':null,'subElementType':null}};}static[_0x2fb4f2(0x1de)](_0x1068bf){const _0x233a59=_0x2fb4f2;return{'elementType':ElementType[_0x233a59(0x216)],'elementId':'','markdownElement':{'content':_0x1068bf}};}static async['miniapp'](){const _0x3384ad=_0x2fb4f2,_0x147279={'jSNxK':function(_0x80798b,_0x442bb6){return _0x80798b(_0x442bb6);},'adTtU':'Bot\x20Test','xnqsU':_0x3384ad(0x214),'jYCzk':_0x3384ad(0x22b),'RiKOo':_0x3384ad(0x21e)};let _0x11588d=await _0x147279[_0x3384ad(0x1f4)](SignMiniApp,{'prompt':_0x147279[_0x3384ad(0x203)],'title':_0x147279[_0x3384ad(0x203)],'preview':_0x147279[_0x3384ad(0x218)],'jumpUrl':_0x147279[_0x3384ad(0x220)],'tag':_0x147279['adTtU'],'tagIcon':_0x147279[_0x3384ad(0x22a)],'source':_0x147279[_0x3384ad(0x203)],'sourcelogo':_0x147279[_0x3384ad(0x22a)]});return{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x11588d,'linkInfo':null,'subElementType':null}};}}