const _0x4cb11f=_0x3d62;(function(_0xe7769b,_0x4c841d){const _0x412da8=_0x3d62,_0x39fe13=_0xe7769b();while(!![]){try{const _0x46c558=-parseInt(_0x412da8(0x249))/0x1+-parseInt(_0x412da8(0x238))/0x2*(parseInt(_0x412da8(0x23d))/0x3)+parseInt(_0x412da8(0x217))/0x4+parseInt(_0x412da8(0x224))/0x5+-parseInt(_0x412da8(0x220))/0x6*(parseInt(_0x412da8(0x23a))/0x7)+-parseInt(_0x412da8(0x203))/0x8+parseInt(_0x412da8(0x210))/0x9;if(_0x46c558===_0x4c841d)break;else _0x39fe13['push'](_0x39fe13['shift']());}catch(_0x495605){_0x39fe13['push'](_0x39fe13['shift']());}}}(_0x3a35,0x4c01d));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x65da19}from'node:fs';import _0x44b849 from'fluent-ffmpeg';function _0x3a35(){const _0x24c890=['20524qRxhwa','[商城表情]','43995mlPhqL','cwLKd','find','33jGCpwg','图片信息','skjua','[骰子]','stat','height','TYIFa','crnUD','writeFile','PIC','Thumb','ZrKms','424350NDyhmL','unlink','DrADy','size','lJHFJ','jlqzX','VIDEO','dirname','文件异常，大小为0','jyoCi','catch','cHciP','toString','video','markdown','text','dice','rujmC','face','end','vWzdm','UIToz','set','TEXT','sep','cACjn','PTT','UCuxV','hOgLU','2503136pBQgFq','file','wtlaP','ptt','path','ewkbR','pic','AniStickerId','lBoab','stringify','MjCuO','get','MARKDOWN','6610545MjSheg','sysface','sJfAZ','AniStickerType','QDes','notAt','jpg','2295284hVPoXW','FILE','then','mface','string','emoji','mp4','[包剪锤]','getImageSize','174hqJxyz','rps','gfXyX','AniStickerPackId','176940xdHmjS','SUlNj','gif','QSid','获取视频封面失败，使用默认封面','JFlHc','MFACE','qZUKo','KfMbX','VaOGf','qGjXq','BwRSD','copyFile','FACE','uploadFile','width','UmAeT','reply','error','视频信息'];_0x3a35=function(){return _0x24c890;};return _0x3a35();}import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x3d62(_0x154fa8,_0x2ac87c){const _0x3a3597=_0x3a35();return _0x3d62=function(_0x3d62cc,_0x24d46c){_0x3d62cc=_0x3d62cc-0x1ef;let _0xad7385=_0x3a3597[_0x3d62cc];return _0xad7385;},_0x3d62(_0x154fa8,_0x2ac87c);}import _0x1263a4 from'./face_config.json';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x4cb11f(0x1f5)](_0x7dd7b5){const _0x315d71=_0x4cb11f;return{'elementType':ElementType[_0x315d71(0x1fd)],'elementId':'','textElement':{'content':_0x7dd7b5,'atType':AtType[_0x315d71(0x215)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x13bf15,_0xc10e94,_0x5e2a00,_0x35fd11){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x35fd11,'atType':_0x5e2a00,'atUid':_0x13bf15,'atTinyId':'','atNtUid':_0xc10e94}};}static[_0x4cb11f(0x235)](_0x494c5b,_0x116741,_0x3850bc,_0x454572){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0x494c5b,'replayMsgId':_0x116741,'senderUin':_0x3850bc,'senderUinStr':_0x454572}};}static async[_0x4cb11f(0x209)](_0x109e8c,_0x451568='',_0x3a78c2=0x0){const _0xa71184=_0x4cb11f,_0x3a8289={'qGjXq':function(_0x2c8a92,_0x4b5726){return _0x2c8a92===_0x4b5726;},'hOgLU':_0xa71184(0x251),'UIToz':function(_0x4e7910,_0x47b74a){return _0x4e7910(_0x47b74a);},'KfMbX':function(_0x11e05c,_0x15c7f8,_0x5a9e7f){return _0x11e05c(_0x15c7f8,_0x5a9e7f);},'ewkbR':_0xa71184(0x23e)},{md5:_0xf0bca0,fileName:_0x507808,path:_0x21111d,fileSize:_0x1ec6b8}=await NTQQFileApi[_0xa71184(0x232)](_0x109e8c,ElementType[_0xa71184(0x246)],_0x3a78c2);if(_0x3a8289[_0xa71184(0x22e)](_0x1ec6b8,0x0))throw _0x3a8289[_0xa71184(0x202)];const _0x454ee2=await NTQQFileApi[_0xa71184(0x21f)](_0x109e8c),_0x2a0aea={'md5HexStr':_0xf0bca0,'fileSize':_0x1ec6b8['toString'](),'picWidth':_0x454ee2?.['width'],'picHeight':_0x454ee2?.['height'],'fileName':_0x507808,'sourcePath':_0x21111d,'original':!![],'picType':_0x3a8289[_0xa71184(0x1fb)](isGIF,_0x109e8c)?PicType[_0xa71184(0x226)]:PicType[_0xa71184(0x216)],'picSubType':_0x3a78c2,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x451568};return _0x3a8289[_0xa71184(0x22c)](logDebug,_0x3a8289[_0xa71184(0x208)],_0x2a0aea),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x2a0aea};}static async[_0x4cb11f(0x204)](_0x1780b3,_0x3d418d=''){const _0x408e43=_0x4cb11f,_0x255fe3={'BwRSD':function(_0x1b735f,_0x3046aa){return _0x1b735f===_0x3046aa;},'vWzdm':function(_0x1d18bd,_0x3e96df){return _0x1d18bd||_0x3e96df;}},{md5:_0x1e3634,fileName:_0x121b06,path:_0x5bf31a,fileSize:_0x391737}=await NTQQFileApi['uploadFile'](_0x1780b3,ElementType[_0x408e43(0x218)]);if(_0x255fe3[_0x408e43(0x22f)](_0x391737,0x0))throw'文件异常，大小为0';const _0x30de58={'elementType':ElementType[_0x408e43(0x218)],'elementId':'','fileElement':{'fileName':_0x255fe3[_0x408e43(0x1fa)](_0x3d418d,_0x121b06),'filePath':_0x5bf31a,'fileSize':_0x391737[_0x408e43(0x1f2)]()}};return _0x30de58;}static async[_0x4cb11f(0x1f3)](_0xbbb6ad,_0x31f39e='',_0x485463=''){const _0x623ff5=_0x4cb11f,_0x168f16={'UmAeT':function(_0x23dbcb,_0x30087a){return _0x23dbcb(_0x30087a);},'cwLKd':function(_0x17dee4,_0x1dfa20,_0x5a486e){return _0x17dee4(_0x1dfa20,_0x5a486e);},'sJfAZ':_0x623ff5(0x228),'cACjn':function(_0xa24e94,_0x2bb6a5){return _0xa24e94(_0x2bb6a5);},'SUlNj':function(_0x2c714b,_0x124795){return _0x2c714b(_0x124795);},'wtlaP':function(_0x3f71c2,_0x277dfe){return _0x3f71c2+_0x277dfe;},'rujmC':_0x623ff5(0x1f9),'DrADy':function(_0x497ae4,_0x1b80b5){return _0x497ae4===_0x1b80b5;},'hyLln':_0x623ff5(0x251),'UCuxV':_0x623ff5(0x207),'JFlHc':_0x623ff5(0x21d),'zpQCi':'获取视频信息失败','IKagJ':function(_0x3e1b36,_0x1d2f4a){return _0x3e1b36(_0x1d2f4a);},'NxPNe':function(_0x315766,_0xdbe29d){return _0x315766||_0xdbe29d;},'cHciP':function(_0x32b7d0,_0x178552){return _0x32b7d0+_0x178552;}},{fileName:_0x3f96c3,path:_0x214252,fileSize:_0x18e0b4,md5:_0xec8e99}=await NTQQFileApi[_0x623ff5(0x232)](_0xbbb6ad,ElementType[_0x623ff5(0x24f)]);if(_0x168f16[_0x623ff5(0x24b)](_0x18e0b4,0x0))throw _0x168f16['hyLln'];const _0x2dea58=require(_0x168f16[_0x623ff5(0x201)]);let _0x2c1b3e=_0x214252['replace'](_0x2dea58['sep']+'Ori'+_0x2dea58['sep'],_0x2dea58[_0x623ff5(0x1fe)]+_0x623ff5(0x247)+_0x2dea58[_0x623ff5(0x1fe)]);_0x2c1b3e=_0x2dea58[_0x623ff5(0x250)](_0x2c1b3e);let _0x23bd2a={'width':0x780,'height':0x438,'time':0xf,'format':_0x168f16[_0x623ff5(0x229)],'size':_0x18e0b4,'filePath':_0xbbb6ad};try{_0x23bd2a=await _0x168f16[_0x623ff5(0x234)](getVideoInfo,_0x214252),logDebug(_0x623ff5(0x237),_0x23bd2a);}catch(_0x2c7d78){_0x168f16[_0x623ff5(0x23b)](logError,_0x168f16['zpQCi'],_0x2c7d78);}const _0x2d5b9f=new Promise((_0x534055,_0x1b3273)=>{const _0x479cab=_0x623ff5,_0x15eaa0={'lJHFJ':function(_0x2af60d,_0x2475de){return _0x168f16['UmAeT'](_0x2af60d,_0x2475de);},'qZUKo':function(_0x5b4073,_0x2e9cc0,_0x1c7ae7){const _0x9f20ec=_0x3d62;return _0x168f16[_0x9f20ec(0x23b)](_0x5b4073,_0x2e9cc0,_0x1c7ae7);},'skjua':_0x168f16[_0x479cab(0x212)],'MjCuO':function(_0x15d7f6,_0x5292d4){const _0x11fdf2=_0x479cab;return _0x168f16[_0x11fdf2(0x1ff)](_0x15d7f6,_0x5292d4);}},_0x2128fa=_0xec8e99+'_0.png',_0x3e4de1=_0x2dea58['join'](_0x2c1b3e,_0x2128fa);_0x168f16[_0x479cab(0x225)](_0x44b849,_0xbbb6ad)['on']('end',()=>{})['on'](_0x479cab(0x236),_0x140b4b=>{const _0x583304=_0x479cab;_0x15eaa0[_0x583304(0x22b)](logDebug,_0x15eaa0[_0x583304(0x23f)],_0x140b4b),_0x485463?_0x65da19[_0x583304(0x230)](_0x485463,_0x3e4de1)['then'](()=>{_0x534055(_0x3e4de1);})['catch'](_0x1b3273):_0x65da19[_0x583304(0x245)](_0x3e4de1,defaultVideoThumb)[_0x583304(0x219)](()=>{const _0xb0ed4c=_0x583304;_0x15eaa0[_0xb0ed4c(0x24d)](_0x534055,_0x3e4de1);})[_0x583304(0x1f0)](_0x1b3273);})['screenshots']({'timestamps':[0x0],'filename':_0x2128fa,'folder':_0x2c1b3e,'size':_0x168f16[_0x479cab(0x205)](_0x168f16[_0x479cab(0x205)](_0x23bd2a[_0x479cab(0x233)],'x'),_0x23bd2a[_0x479cab(0x242)])})['on'](_0x168f16[_0x479cab(0x1f7)],()=>{const _0x20044d=_0x479cab;_0x15eaa0[_0x20044d(0x20d)](_0x534055,_0x3e4de1);});}),_0x4c3b4d=new Map(),_0x14bc64=await _0x2d5b9f,_0x2f163e=(await _0x65da19[_0x623ff5(0x241)](_0x14bc64))[_0x623ff5(0x24c)];_0x4c3b4d[_0x623ff5(0x1fc)](0x0,_0x14bc64);const _0x553dfc=await _0x168f16['IKagJ'](calculateFileMD5,_0x14bc64),_0x42e6c7={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x168f16['NxPNe'](_0x31f39e,_0x3f96c3),'filePath':_0x214252,'videoMd5':_0xec8e99,'thumbMd5':_0x553dfc,'fileTime':_0x23bd2a['time'],'thumbPath':_0x4c3b4d,'thumbSize':_0x2f163e,'thumbWidth':_0x23bd2a['width'],'thumbHeight':_0x23bd2a[_0x623ff5(0x242)],'fileSize':_0x168f16[_0x623ff5(0x1f1)]('',_0x18e0b4)}};return _0x42e6c7;}static async[_0x4cb11f(0x206)](_0x18ecc9){const _0x5a1404=_0x4cb11f,_0x212c7b={'jlqzX':function(_0x513a96,_0x3289ca){return _0x513a96(_0x3289ca);},'lBoab':function(_0xe46363,_0x37ebc0){return _0xe46363===_0x37ebc0;},'ZrKms':_0x5a1404(0x251)},{converted:_0x446473,path:_0xc68890,duration:_0x597e1b}=await _0x212c7b[_0x5a1404(0x24e)](encodeSilk,_0x18ecc9);if(!_0xc68890)throw'语音转换失败,\x20请检查语音文件是否正常';const {md5:_0x164098,fileName:_0x28fb8d,path:_0x248de1,fileSize:_0x50aba9}=await NTQQFileApi[_0x5a1404(0x232)](_0xc68890,ElementType[_0x5a1404(0x200)]);if(_0x212c7b[_0x5a1404(0x20b)](_0x50aba9,0x0))throw _0x212c7b[_0x5a1404(0x248)];return _0x446473&&_0x65da19[_0x5a1404(0x24a)](_0xc68890)[_0x5a1404(0x219)](),{'elementType':ElementType[_0x5a1404(0x200)],'elementId':'','pttElement':{'fileName':_0x28fb8d,'filePath':_0x248de1,'md5HexStr':_0x164098,'fileSize':_0x50aba9,'duration':_0x597e1b||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4cb11f(0x1f8)](_0xff0441){const _0x576dfc=_0x4cb11f,_0x29c8c3={'crnUD':function(_0x4f360c,_0x27d043){return _0x4f360c(_0x27d043);},'VaOGf':function(_0x3993fb,_0x3ff8bd){return _0x3993fb>=_0x3ff8bd;}},_0x28eda9=_0x1263a4[_0x576dfc(0x211)],_0x560792=_0x1263a4[_0x576dfc(0x21c)],_0x5ed701=_0x28eda9[_0x576dfc(0x23c)](_0x4e4148=>_0x4e4148[_0x576dfc(0x227)]===_0xff0441[_0x576dfc(0x1f2)]());_0xff0441=_0x29c8c3[_0x576dfc(0x244)](parseInt,_0xff0441[_0x576dfc(0x1f2)]());let _0x4b189e=0x1;return _0x29c8c3[_0x576dfc(0x22d)](_0xff0441,0xde)&&(_0x4b189e=0x2),_0x5ed701[_0x576dfc(0x213)]&&(_0x4b189e=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0xff0441,'faceType':_0x4b189e,'faceText':_0x5ed701[_0x576dfc(0x214)],'stickerId':_0x5ed701[_0x576dfc(0x20a)],'stickerType':_0x5ed701[_0x576dfc(0x213)],'packId':_0x5ed701[_0x576dfc(0x223)],'sourceType':0x1}};}static[_0x4cb11f(0x21a)](_0x5cc79c,_0x339588,_0x5de7ed,_0x5bff82){const _0x238751=_0x4cb11f,_0x44e4b3={'jyoCi':_0x238751(0x239)};return{'elementType':ElementType[_0x238751(0x22a)],'marketFaceElement':{'emojiPackageId':_0x5cc79c,'emojiId':_0x339588,'key':_0x5de7ed,'faceName':_0x5bff82||mFaceCache[_0x238751(0x20e)](_0x339588)||_0x44e4b3[_0x238751(0x1ef)]}};}static[_0x4cb11f(0x1f6)](_0x3e8fed){const _0x25ca2b=_0x4cb11f,_0x11d080={'exGIE':_0x25ca2b(0x240)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x25ca2b(0x1f6)],'faceType':FaceType[_0x25ca2b(0x1f6)],'faceText':_0x11d080['exGIE'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4cb11f(0x221)](_0x52bfd2){const _0x2753c6=_0x4cb11f;return{'elementType':ElementType[_0x2753c6(0x231)],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x2753c6(0x21e),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0xc71dc9){const _0x567ab2=_0x4cb11f,_0x1e3b7f={'gfXyX':function(_0x410971,_0x29295e){return _0x410971!==_0x29295e;},'TYIFa':_0x567ab2(0x21b)};return _0x1e3b7f[_0x567ab2(0x222)](typeof _0xc71dc9,_0x1e3b7f[_0x567ab2(0x243)])&&(_0xc71dc9=JSON[_0x567ab2(0x20c)](_0xc71dc9)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0xc71dc9,'linkInfo':null,'subElementType':null}};}static[_0x4cb11f(0x1f4)](_0x2f688a){const _0x5003ce=_0x4cb11f;return{'elementType':ElementType[_0x5003ce(0x20f)],'elementId':'','markdownElement':{'content':_0x2f688a}};}}