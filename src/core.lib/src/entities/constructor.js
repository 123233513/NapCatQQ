const _0x531a32=_0x2dce;(function(_0x2989b1,_0x38df39){const _0x31e4d6=_0x2dce,_0x1a84fc=_0x2989b1();while(!![]){try{const _0x34e956=parseInt(_0x31e4d6(0x10c))/0x1*(parseInt(_0x31e4d6(0x153))/0x2)+parseInt(_0x31e4d6(0x109))/0x3*(-parseInt(_0x31e4d6(0x116))/0x4)+-parseInt(_0x31e4d6(0x121))/0x5+parseInt(_0x31e4d6(0x13c))/0x6+-parseInt(_0x31e4d6(0x117))/0x7*(-parseInt(_0x31e4d6(0xfe))/0x8)+-parseInt(_0x31e4d6(0x141))/0x9+-parseInt(_0x31e4d6(0x130))/0xa;if(_0x34e956===_0x38df39)break;else _0x1a84fc['push'](_0x1a84fc['shift']());}catch(_0x3907ed){_0x1a84fc['push'](_0x1a84fc['shift']());}}}(_0x30c7,0x77bc4));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x56b733}from'node:fs';import _0xce0e93 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';function _0x30c7(){const _0x249fc5=['width','height','DVhuX','Thumb','Bot\x20Test','getImageSize','ptt','yzTjc','rps','3670680zjHugi','mXdXd','time','TEXT','[包剪锤]','160893oxuyHq','语音转换失败,\x20请检查语音文件是否正常','cejye','end','SqoeV','uploadFile','gif','markdown','PIC','tnJBW','zGATd','文件异常，大小为0','AniStickerPackId','screenshots','AniStickerType','[骰子]','ncqvd','HbWTh','1098026KFIdEh','copyFile','OZDfr','size','writeFile','then','NLVlL','Ori','toString','FACE','16vXvflQ','JPegI','error','miniapp','reply','图片信息','zqfAB','assJX','emoji','EsTSv','MFACE','3pHUSWJ','获取视频封面失败，使用默认封面','aPEkS','1svkiBF','vfLsW','yBFuK','VIDEO','pjdwY','get','sep','ark','cUADB','wyHXx','2642468FrowMD','3367217uYvvJZ','video','ARK','QSid','QDes','WnWoB','RMqir','RaJvw','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','SoJjV','1852520LTtaXA','UdApB','catch','sysface','QqLrq','dirname','qHyhh','FILE','AJVIF','AniStickerId','YlKMp','dice','text','XDGsL','find','5834210nizOWn','set','GerxD'];_0x30c7=function(){return _0x249fc5;};return _0x30c7();}import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x4eeed6 from'./face_config.json';import*as _0xab4e72 from'node:path';function _0x2dce(_0x427d96,_0x20729f){const _0x30c748=_0x30c7();return _0x2dce=function(_0x2dce94,_0x3c2684){_0x2dce94=_0x2dce94-0xfe;let _0x3a8d2b=_0x30c748[_0x2dce94];return _0x3a8d2b;},_0x2dce(_0x427d96,_0x20729f);}import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x531a32(0x12d)](_0x15823b){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x15823b,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x376cba,_0x3d8779,_0x219811,_0x44d7a9){const _0x49a52d=_0x531a32;return{'elementType':ElementType[_0x49a52d(0x13f)],'elementId':'','textElement':{'content':'@'+_0x44d7a9,'atType':_0x219811,'atUid':_0x376cba,'atTinyId':'','atNtUid':_0x3d8779}};}static[_0x531a32(0x102)](_0xc78119,_0x4d558c,_0x2cc69e,_0x2da97e){return{'elementType':ElementType['REPLY'],'elementId':'','replyElement':{'replayMsgSeq':_0xc78119,'replayMsgId':_0x4d558c,'senderUin':_0x2cc69e,'senderUinStr':_0x2da97e}};}static async['pic'](_0x59b95f,_0x256607='',_0xaf80d9=0x0){const _0x93268d=_0x531a32,_0x5dd1b1={'SoJjV':function(_0x150d20,_0x31ebe6){return _0x150d20(_0x31ebe6);},'aPEkS':_0x93268d(0x103)},{md5:_0x2b4b38,fileName:_0x49b52e,path:_0xdb3901,fileSize:_0x478d89}=await NTQQFileApi[_0x93268d(0x146)](_0x59b95f,ElementType['PIC'],_0xaf80d9);if(_0x478d89===0x0)throw _0x93268d(0x14c);const _0x13fe45=await NTQQFileApi[_0x93268d(0x138)](_0x59b95f),_0x8b1ffe={'md5HexStr':_0x2b4b38,'fileSize':_0x478d89['toString'](),'picWidth':_0x13fe45?.[_0x93268d(0x133)],'picHeight':_0x13fe45?.['height'],'fileName':_0x49b52e,'sourcePath':_0xdb3901,'original':!![],'picType':_0x5dd1b1[_0x93268d(0x120)](isGIF,_0x59b95f)?PicType[_0x93268d(0x147)]:PicType['jpg'],'picSubType':_0xaf80d9,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x256607};return logDebug(_0x5dd1b1[_0x93268d(0x10b)],_0x8b1ffe),{'elementType':ElementType[_0x93268d(0x149)],'elementId':'','picElement':_0x8b1ffe};}static async['file'](_0x455d4c,_0x1de465=''){const _0x5e37d2=_0x531a32,_0x1ba9be={'WnWoB':function(_0x283c3e,_0x467089){return _0x283c3e===_0x467089;}},{md5:_0x3f29f2,fileName:_0x181e30,path:_0x3d6b7d,fileSize:_0x4cabcf}=await NTQQFileApi['uploadFile'](_0x455d4c,ElementType['FILE']);if(_0x1ba9be[_0x5e37d2(0x11c)](_0x4cabcf,0x0))throw _0x5e37d2(0x14c);const _0x44917b={'elementType':ElementType[_0x5e37d2(0x128)],'elementId':'','fileElement':{'fileName':_0x1de465||_0x181e30,'filePath':_0x3d6b7d,'fileSize':_0x4cabcf[_0x5e37d2(0x15b)]()}};return _0x44917b;}static async[_0x531a32(0x118)](_0x2a0513,_0x3eb8cb='',_0x89f129=''){const _0x4560e8=_0x531a32,_0xf6ac6e={'xzbwX':_0x4560e8(0x10a),'yzTjc':function(_0x5ab092,_0x47db56){return _0x5ab092(_0x47db56);},'OZDfr':_0x4560e8(0x144),'AJVIF':_0x4560e8(0x100),'HbWTh':function(_0x5b47f3,_0x3bcad8){return _0x5b47f3+_0x3bcad8;},'YlKMp':function(_0x21c52e,_0x26b9b4){return _0x21c52e===_0x26b9b4;},'qHyhh':'mp4','DVhuX':function(_0x1996d0,_0x1df764){return _0x1996d0(_0x1df764);},'RMqir':function(_0x35bd7c,_0x58c2cf,_0x120fe3){return _0x35bd7c(_0x58c2cf,_0x120fe3);},'UdApB':'视频信息','NLVlL':function(_0x5c5bea,_0x4a5000,_0x148b6b){return _0x5c5bea(_0x4a5000,_0x148b6b);},'ncqvd':'获取视频信息失败','cUADB':function(_0x231d55,_0x5d090a){return _0x231d55(_0x5d090a);},'JPegI':function(_0x5b1c14,_0x496685){return _0x5b1c14||_0x496685;},'QqLrq':function(_0x4510af,_0x33cae5){return _0x4510af+_0x33cae5;}},{fileName:_0x2baead,path:_0x537c16,fileSize:_0x1053d8,md5:_0x1f5996}=await NTQQFileApi['uploadFile'](_0x2a0513,ElementType[_0x4560e8(0x10f)]);if(_0xf6ac6e[_0x4560e8(0x12b)](_0x1053d8,0x0))throw _0x4560e8(0x14c);let _0x4fcdfe=_0x537c16['replace'](_0xab4e72[_0x4560e8(0x112)]+_0x4560e8(0x15a)+_0xab4e72[_0x4560e8(0x112)],_0xab4e72[_0x4560e8(0x112)]+_0x4560e8(0x136)+_0xab4e72[_0x4560e8(0x112)]);_0x4fcdfe=_0xab4e72[_0x4560e8(0x126)](_0x4fcdfe);let _0x47ec09={'width':0x780,'height':0x438,'time':0xf,'format':_0xf6ac6e[_0x4560e8(0x127)],'size':_0x1053d8,'filePath':_0x2a0513};try{_0x47ec09=await _0xf6ac6e[_0x4560e8(0x135)](getVideoInfo,_0x537c16),_0xf6ac6e[_0x4560e8(0x11d)](logDebug,_0xf6ac6e[_0x4560e8(0x122)],_0x47ec09);}catch(_0x4f2504){_0xf6ac6e[_0x4560e8(0x159)](logError,_0xf6ac6e[_0x4560e8(0x151)],_0x4f2504);}const _0x3dacd5=new Promise((_0x275008,_0x4778b4)=>{const _0x40ec4e=_0x4560e8,_0x1753ec={'GerxD':function(_0xeb3568,_0x2cf2ee){return _0xeb3568(_0x2cf2ee);},'cejye':_0xf6ac6e['xzbwX'],'rXdNk':function(_0x3c5fc9,_0x32eaa3){const _0x16e2a8=_0x2dce;return _0xf6ac6e[_0x16e2a8(0x13a)](_0x3c5fc9,_0x32eaa3);}},_0x234647=_0x1f5996+'_0.png',_0x3836d3=_0xab4e72['join'](_0x4fcdfe,_0x234647);_0xf6ac6e[_0x40ec4e(0x13a)](_0xce0e93,_0x2a0513)['on'](_0xf6ac6e[_0x40ec4e(0x155)],()=>{})['on'](_0xf6ac6e[_0x40ec4e(0x129)],_0x45eca0=>{const _0x55525e=_0x40ec4e;logDebug(_0x1753ec[_0x55525e(0x143)],_0x45eca0),_0x89f129?_0x56b733[_0x55525e(0x154)](_0x89f129,_0x3836d3)[_0x55525e(0x158)](()=>{const _0x1d468e=_0x55525e;_0x1753ec[_0x1d468e(0x132)](_0x275008,_0x3836d3);})[_0x55525e(0x123)](_0x4778b4):_0x56b733[_0x55525e(0x157)](_0x3836d3,defaultVideoThumb)['then'](()=>{_0x1753ec['GerxD'](_0x275008,_0x3836d3);})[_0x55525e(0x123)](_0x4778b4);})[_0x40ec4e(0x14e)]({'timestamps':[0x0],'filename':_0x234647,'folder':_0x4fcdfe,'size':_0xf6ac6e[_0x40ec4e(0x152)](_0x47ec09[_0x40ec4e(0x133)]+'x',_0x47ec09['height'])})['on'](_0xf6ac6e['OZDfr'],()=>{_0x1753ec['rXdNk'](_0x275008,_0x3836d3);});}),_0x4dec3d=new Map(),_0x49b974=await _0x3dacd5,_0x47456f=(await _0x56b733['stat'](_0x49b974))[_0x4560e8(0x156)];_0x4dec3d[_0x4560e8(0x131)](0x0,_0x49b974);const _0x42c5a1=await _0xf6ac6e[_0x4560e8(0x114)](calculateFileMD5,_0x49b974),_0x3847a0={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0xf6ac6e[_0x4560e8(0xff)](_0x3eb8cb,_0x2baead),'filePath':_0x537c16,'videoMd5':_0x1f5996,'thumbMd5':_0x42c5a1,'fileTime':_0x47ec09[_0x4560e8(0x13e)],'thumbPath':_0x4dec3d,'thumbSize':_0x47456f,'thumbWidth':_0x47ec09[_0x4560e8(0x133)],'thumbHeight':_0x47ec09[_0x4560e8(0x134)],'fileSize':_0xf6ac6e[_0x4560e8(0x125)]('',_0x1053d8)}};return _0x3847a0;}static async[_0x531a32(0x139)](_0x3317ee){const _0x5cd581=_0x531a32,_0x16e0ef={'vfLsW':function(_0xd6b5d2,_0x1d6c94){return _0xd6b5d2(_0x1d6c94);},'yBFuK':function(_0x11032f,_0x765699){return _0x11032f===_0x765699;},'OSQjr':_0x5cd581(0x14c),'mXdXd':function(_0x5c506a,_0x584324){return _0x5c506a||_0x584324;}},{converted:_0x5151fd,path:_0x54d495,duration:_0x412609}=await _0x16e0ef[_0x5cd581(0x10d)](encodeSilk,_0x3317ee);if(!_0x54d495)throw _0x5cd581(0x142);const {md5:_0x1a2daa,fileName:_0x23249b,path:_0x35449b,fileSize:_0x4fb0d3}=await NTQQFileApi[_0x5cd581(0x146)](_0x54d495,ElementType['PTT']);if(_0x16e0ef[_0x5cd581(0x10e)](_0x4fb0d3,0x0))throw _0x16e0ef['OSQjr'];return _0x5151fd&&_0x56b733['unlink'](_0x54d495)['then'](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x23249b,'filePath':_0x35449b,'md5HexStr':_0x1a2daa,'fileSize':_0x4fb0d3,'duration':_0x16e0ef[_0x5cd581(0x13d)](_0x412609,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static['face'](_0x534781){const _0x201930=_0x531a32,_0x26d1c8={'XDGsL':function(_0x35332a,_0x2fe3f9){return _0x35332a(_0x2fe3f9);},'RaJvw':function(_0x25fc3d,_0x3f9fb3){return _0x25fc3d>=_0x3f9fb3;}},_0x4dcad7=_0x4eeed6[_0x201930(0x124)],_0xca002e=_0x4eeed6[_0x201930(0x106)],_0x226a57=_0x4dcad7[_0x201930(0x12f)](_0x4132cb=>_0x4132cb[_0x201930(0x11a)]===_0x534781['toString']());_0x534781=_0x26d1c8[_0x201930(0x12e)](parseInt,_0x534781[_0x201930(0x15b)]());let _0x4be4f3=0x1;return _0x26d1c8[_0x201930(0x11e)](_0x534781,0xde)&&(_0x4be4f3=0x2),_0x226a57[_0x201930(0x14f)]&&(_0x4be4f3=0x3),{'elementType':ElementType[_0x201930(0x15c)],'elementId':'','faceElement':{'faceIndex':_0x534781,'faceType':_0x4be4f3,'faceText':_0x226a57[_0x201930(0x11b)],'stickerId':_0x226a57[_0x201930(0x12a)],'stickerType':_0x226a57[_0x201930(0x14f)],'packId':_0x226a57[_0x201930(0x14d)],'sourceType':0x1}};}static['mface'](_0x10f841,_0x38889f,_0x759d6d,_0xa95505){const _0x492853=_0x531a32,_0x1ca549={'zqfAB':'[商城表情]'};return{'elementType':ElementType[_0x492853(0x108)],'marketFaceElement':{'emojiPackageId':_0x10f841,'emojiId':_0x38889f,'key':_0x759d6d,'faceName':_0xa95505||mFaceCache[_0x492853(0x111)](_0x38889f)||_0x1ca549[_0x492853(0x104)]}};}static[_0x531a32(0x12c)](_0x3fb54a){const _0x9ddb08=_0x531a32,_0x571104={'SqoeV':_0x9ddb08(0x150)};return{'elementType':ElementType[_0x9ddb08(0x15c)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x9ddb08(0x12c)],'faceType':FaceType[_0x9ddb08(0x12c)],'faceText':_0x571104[_0x9ddb08(0x145)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x531a32(0x13b)](_0x2f4efc){const _0x305f9c=_0x531a32,_0x24210a={'EsTSv':_0x305f9c(0x140)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x24210a[_0x305f9c(0x107)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x531a32(0x113)](_0x5871e9){const _0x274003=_0x531a32,_0x66567a={'HwQnh':function(_0x532b67,_0x68c24b){return _0x532b67!==_0x68c24b;},'pjdwY':'string'};return _0x66567a['HwQnh'](typeof _0x5871e9,_0x66567a[_0x274003(0x110)])&&(_0x5871e9=JSON['stringify'](_0x5871e9)),{'elementType':ElementType[_0x274003(0x119)],'elementId':'','arkElement':{'bytesData':_0x5871e9,'linkInfo':null,'subElementType':null}};}static[_0x531a32(0x148)](_0x4eb676){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x4eb676}};}static async[_0x531a32(0x101)](){const _0x452ceb=_0x531a32,_0x1543db={'tnJBW':_0x452ceb(0x137),'zGATd':_0x452ceb(0x11f),'assJX':'https://www.bilibili.com/','wyHXx':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0x2374b9=await SignMiniApp({'prompt':_0x1543db['tnJBW'],'title':_0x1543db['tnJBW'],'preview':_0x1543db[_0x452ceb(0x14b)],'jumpUrl':_0x1543db[_0x452ceb(0x105)],'tag':'Bot\x20Test','tagIcon':_0x1543db[_0x452ceb(0x115)],'source':_0x1543db[_0x452ceb(0x14a)],'sourcelogo':_0x1543db['wyHXx']});return{'elementType':ElementType[_0x452ceb(0x119)],'elementId':'','arkElement':{'bytesData':_0x2374b9,'linkInfo':null,'subElementType':null}};}}