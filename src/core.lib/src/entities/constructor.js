function _0xca0c(_0x27776e,_0x8c2e67){const _0x3c0ada=_0x3c0a();return _0xca0c=function(_0xca0ca1,_0x3dedee){_0xca0ca1=_0xca0ca1-0x81;let _0x90afc1=_0x3c0ada[_0xca0ca1];return _0x90afc1;},_0xca0c(_0x27776e,_0x8c2e67);}const _0x7a6682=_0xca0c;(function(_0x5cb257,_0x437943){const _0x2693e7=_0xca0c,_0x29065a=_0x5cb257();while(!![]){try{const _0x546b31=-parseInt(_0x2693e7(0xb0))/0x1*(-parseInt(_0x2693e7(0x95))/0x2)+-parseInt(_0x2693e7(0xd7))/0x3*(-parseInt(_0x2693e7(0xb7))/0x4)+-parseInt(_0x2693e7(0xba))/0x5*(parseInt(_0x2693e7(0xa3))/0x6)+-parseInt(_0x2693e7(0xd0))/0x7+-parseInt(_0x2693e7(0xc2))/0x8+-parseInt(_0x2693e7(0xab))/0x9*(parseInt(_0x2693e7(0xae))/0xa)+parseInt(_0x2693e7(0xa7))/0xb*(parseInt(_0x2693e7(0xac))/0xc);if(_0x546b31===_0x437943)break;else _0x29065a['push'](_0x29065a['shift']());}catch(_0x6694c8){_0x29065a['push'](_0x29065a['shift']());}}}(_0x3c0a,0x18871));function _0x3c0a(){const _0x3602c6=['rps','oVniw','stringify','file','[包剪锤]','reply','OWgiq','string','Ori','screenshots','mp4','KywYH','dirname','194402ftgmNp','获取视频封面失败，使用默认封面','width','ZtPpR','error','face','[骰子]','ARK','catch','time','normal','path','ptt','zzZoz','3576RucqhZ','end','get','Thumb','3558940CQgygf','TBTeM','图片信息','PTT','135810QkeHtk','12zvOKEq','set','130siRstE','语音转换失败,\x20请检查语音文件是否正常','2roccJo','replace','video','dice','PIC','VIDEO','NjBcv','5760bSYDTK','获取视频信息失败','HXFHI','805yJyXqK','efVib','gODYt','THrmj','视频信息','Rrlmh','sep','text','907072YyHhvt','mface','BtKDL','toString','GJPqF','Vbwov','文件异常，大小为0','uGDFW','[商城表情]','unlink','REPLY','KRAph','normal2','uploadFile','1172409fBgxkE','czOMR','AHZZL','jpg','markdown','FqFFm','height','324MCQVIo','writeFile','size','YtQAK','Rowvc','join','MCcdY','then','FILE','stat'];_0x3c0a=function(){return _0x3602c6;};return _0x3c0a();}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x874698}from'node:fs';import _0x20498b from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x7a6682(0xc1)](_0x45e603){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x45e603,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x4c2be6,_0x204ab6,_0x5ed154,_0x3bf0e2){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x3bf0e2,'atType':_0x5ed154,'atUid':_0x4c2be6,'atTinyId':'','atNtUid':_0x204ab6}};}static[_0x7a6682(0x8d)](_0x4f42e4,_0x5f5238,_0x2d2bc2,_0x277b80){const _0x5a3e5c=_0x7a6682;return{'elementType':ElementType[_0x5a3e5c(0xcc)],'elementId':'','replyElement':{'replayMsgSeq':_0x4f42e4,'replayMsgId':_0x5f5238,'senderUin':_0x2d2bc2,'senderUinStr':_0x277b80}};}static async['pic'](_0x30b84b,_0x37c651='',_0x3776c0=0x0){const _0x2cd186=_0x7a6682,_0x3563f5={'Rrlmh':function(_0x400ffa,_0x251b04){return _0x400ffa===_0x251b04;},'YtQAK':_0x2cd186(0xc8),'czOMR':function(_0x3da284,_0x35c97c){return _0x3da284(_0x35c97c);},'KIkHV':function(_0x87d9ff,_0xd4dc45,_0xe773d1){return _0x87d9ff(_0xd4dc45,_0xe773d1);},'THrmj':_0x2cd186(0xa9)},{md5:_0x18b14b,fileName:_0x36e4c4,path:_0x23b73f,fileSize:_0x14fe33}=await NTQQFileApi[_0x2cd186(0xcf)](_0x30b84b,ElementType['PIC'],_0x3776c0);if(_0x3563f5[_0x2cd186(0xbf)](_0x14fe33,0x0))throw _0x3563f5[_0x2cd186(0x81)];const _0x412067=await NTQQFileApi['getImageSize'](_0x30b84b),_0x4a8812={'md5HexStr':_0x18b14b,'fileSize':_0x14fe33[_0x2cd186(0xc5)](),'picWidth':_0x412067?.[_0x2cd186(0x97)],'picHeight':_0x412067?.[_0x2cd186(0xd6)],'fileName':_0x36e4c4,'sourcePath':_0x23b73f,'original':!![],'picType':_0x3563f5[_0x2cd186(0xd1)](isGIF,_0x30b84b)?PicType['gif']:PicType[_0x2cd186(0xd3)],'picSubType':_0x3776c0,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x37c651};return _0x3563f5['KIkHV'](logDebug,_0x3563f5[_0x2cd186(0xbd)],_0x4a8812),{'elementType':ElementType[_0x2cd186(0xb4)],'elementId':'','picElement':_0x4a8812};}static async[_0x7a6682(0x8b)](_0x2c8dfc,_0x50e44f=''){const _0x3e7ed8=_0x7a6682,_0x33aa2d={'efVib':function(_0x4499f0,_0x3fa5f1){return _0x4499f0===_0x3fa5f1;},'Rowvc':function(_0x5093da,_0x52d0de){return _0x5093da||_0x52d0de;}},{md5:_0x42ca13,fileName:_0x35d1bf,path:_0x2053d7,fileSize:_0xfef90}=await NTQQFileApi['uploadFile'](_0x2c8dfc,ElementType[_0x3e7ed8(0x86)]);if(_0x33aa2d[_0x3e7ed8(0xbb)](_0xfef90,0x0))throw'文件异常，大小为0';const _0x438941={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x33aa2d[_0x3e7ed8(0x82)](_0x50e44f,_0x35d1bf),'filePath':_0x2053d7,'fileSize':_0xfef90[_0x3e7ed8(0xc5)]()}};return _0x438941;}static async[_0x7a6682(0xb2)](_0x34e15b,_0x284f67='',_0x37979d=''){const _0x240462=_0x7a6682,_0x3eaf8f={'NjBcv':function(_0x2ff6c4,_0x3816ea){return _0x2ff6c4(_0x3816ea);},'zzZoz':function(_0xf9e383,_0x38b963){return _0xf9e383(_0x38b963);},'AHZZL':_0x240462(0xa4),'KywYH':_0x240462(0x99),'BtKDL':function(_0x37cd98,_0x59a0a4){return _0x37cd98+_0x59a0a4;},'ixMVQ':function(_0x4d68e8,_0x288246){return _0x4d68e8===_0x288246;},'hIpgw':_0x240462(0xa0),'KRAph':function(_0x3a6df6,_0x31140c,_0x257729){return _0x3a6df6(_0x31140c,_0x257729);},'MCcdY':_0x240462(0xbe),'oVniw':function(_0x423376,_0x5d463d,_0x58b884){return _0x423376(_0x5d463d,_0x58b884);},'ehrhV':_0x240462(0xb8),'HXFHI':function(_0x117b99,_0x525e8a){return _0x117b99(_0x525e8a);}},{fileName:_0x3d3288,path:_0xf7904e,fileSize:_0x564269,md5:_0x5a1c6c}=await NTQQFileApi[_0x240462(0xcf)](_0x34e15b,ElementType[_0x240462(0xb5)]);if(_0x3eaf8f['ixMVQ'](_0x564269,0x0))throw'文件异常，大小为0';const _0x2751e2=require(_0x3eaf8f['hIpgw']);let _0x101640=_0xf7904e[_0x240462(0xb1)](_0x2751e2[_0x240462(0xc0)]+_0x240462(0x90)+_0x2751e2[_0x240462(0xc0)],_0x2751e2['sep']+_0x240462(0xa6)+_0x2751e2[_0x240462(0xc0)]);_0x101640=_0x2751e2[_0x240462(0x94)](_0x101640);let _0x395836={'width':0x780,'height':0x438,'time':0xf,'format':_0x240462(0x92),'size':_0x564269,'filePath':_0x34e15b};try{_0x395836=await _0x3eaf8f[_0x240462(0xb6)](getVideoInfo,_0xf7904e),_0x3eaf8f[_0x240462(0xcd)](logDebug,_0x3eaf8f[_0x240462(0x84)],_0x395836);}catch(_0x28c54f){_0x3eaf8f[_0x240462(0x89)](logError,_0x3eaf8f['ehrhV'],_0x28c54f);}const _0xf86efd=new Promise((_0x1480e3,_0x3ee062)=>{const _0x3a137b=_0x240462,_0x9e7383={'uGDFW':function(_0x887f6,_0x3893b6){const _0x162ffb=_0xca0c;return _0x3eaf8f[_0x162ffb(0xa2)](_0x887f6,_0x3893b6);},'Vbwov':function(_0x344896,_0x17cb7c,_0x1c643b){return _0x344896(_0x17cb7c,_0x1c643b);}},_0x1ca64a=_0x5a1c6c+'_0.png',_0x2369e8=_0x2751e2[_0x3a137b(0x83)](_0x101640,_0x1ca64a);_0x3eaf8f[_0x3a137b(0xa2)](_0x20498b,_0x34e15b)['on'](_0x3eaf8f['AHZZL'],()=>{})['on'](_0x3eaf8f[_0x3a137b(0x93)],_0x22aaf0=>{const _0x4d8c3d=_0x3a137b;_0x9e7383[_0x4d8c3d(0xc7)](logDebug,_0x4d8c3d(0x96),_0x22aaf0),_0x37979d?_0x874698['copyFile'](_0x37979d,_0x2369e8)[_0x4d8c3d(0x85)](()=>{const _0x37e4f8=_0x4d8c3d;_0x9e7383[_0x37e4f8(0xc9)](_0x1480e3,_0x2369e8);})[_0x4d8c3d(0x9d)](_0x3ee062):_0x874698[_0x4d8c3d(0xd8)](_0x2369e8,defaultVideoThumb)['then'](()=>{_0x9e7383['uGDFW'](_0x1480e3,_0x2369e8);})[_0x4d8c3d(0x9d)](_0x3ee062);})[_0x3a137b(0x91)]({'timestamps':[0x0],'filename':_0x1ca64a,'folder':_0x101640,'size':_0x3eaf8f[_0x3a137b(0xc4)](_0x395836[_0x3a137b(0x97)]+'x',_0x395836[_0x3a137b(0xd6)])})['on'](_0x3eaf8f[_0x3a137b(0xd2)],()=>{const _0x3ce375=_0x3a137b;_0x3eaf8f[_0x3ce375(0xb6)](_0x1480e3,_0x2369e8);});}),_0x4de61e=new Map(),_0x1395ee=await _0xf86efd,_0x20b631=(await _0x874698[_0x240462(0x87)](_0x1395ee))[_0x240462(0xd9)];_0x4de61e[_0x240462(0xad)](0x0,_0x1395ee);const _0x2eeac0=await _0x3eaf8f[_0x240462(0xb9)](calculateFileMD5,_0x1395ee),_0x23e695={'elementType':ElementType[_0x240462(0xb5)],'elementId':'','videoElement':{'fileName':_0x284f67||_0x3d3288,'filePath':_0xf7904e,'videoMd5':_0x5a1c6c,'thumbMd5':_0x2eeac0,'fileTime':_0x395836[_0x240462(0x9e)],'thumbPath':_0x4de61e,'thumbSize':_0x20b631,'thumbWidth':_0x395836[_0x240462(0x97)],'thumbHeight':_0x395836[_0x240462(0xd6)],'fileSize':_0x3eaf8f[_0x240462(0xc4)]('',_0x564269)}};return _0x23e695;}static async[_0x7a6682(0xa1)](_0x5a8f83){const _0x2a05dd=_0x7a6682,_0x1367bb={'TBTeM':function(_0x18d865,_0xf8cf68){return _0x18d865(_0xf8cf68);},'gODYt':function(_0x15e3ea,_0x43e4f0){return _0x15e3ea===_0x43e4f0;},'ZtPpR':'文件异常，大小为0','EawpS':function(_0x21e214,_0x2dd388){return _0x21e214||_0x2dd388;}},{converted:_0x14a23a,path:_0x226427,duration:_0x10dc26}=await _0x1367bb[_0x2a05dd(0xa8)](encodeSilk,_0x5a8f83);if(!_0x226427)throw _0x2a05dd(0xaf);const {md5:_0x5860a9,fileName:_0x1dde28,path:_0x17fe8b,fileSize:_0x30bee2}=await NTQQFileApi[_0x2a05dd(0xcf)](_0x226427,ElementType['PTT']);if(_0x1367bb[_0x2a05dd(0xbc)](_0x30bee2,0x0))throw _0x1367bb[_0x2a05dd(0x98)];return _0x14a23a&&_0x874698[_0x2a05dd(0xcb)](_0x226427)[_0x2a05dd(0x85)](),{'elementType':ElementType[_0x2a05dd(0xaa)],'elementId':'','pttElement':{'fileName':_0x1dde28,'filePath':_0x17fe8b,'md5HexStr':_0x5860a9,'fileSize':_0x30bee2,'duration':_0x1367bb['EawpS'](_0x10dc26,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x7a6682(0x9a)](_0x1eb121){const _0x526579=_0x7a6682,_0x1d33e4={'FqFFm':function(_0x542256,_0x31b414){return _0x542256<_0x31b414;}};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x1eb121,'faceType':_0x1d33e4[_0x526579(0xd5)](_0x1eb121,0xde)?FaceType[_0x526579(0x9f)]:FaceType[_0x526579(0xce)]}};}static[_0x7a6682(0xc3)](_0x485120,_0xc35de2,_0x5eca0a,_0x5c53f5){const _0x2ce5ec=_0x7a6682,_0x9cf5d2={'GJPqF':_0x2ce5ec(0xca)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x485120,'emojiId':_0xc35de2,'key':_0x5eca0a,'faceName':_0x5c53f5||mFaceCache[_0x2ce5ec(0xa5)](_0xc35de2)||_0x9cf5d2[_0x2ce5ec(0xc6)]}};}static[_0x7a6682(0xb3)](_0x5b2285){const _0x358d58=_0x7a6682,_0x56253d={'CLrzZ':_0x358d58(0x9b)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x358d58(0xb3)],'faceType':FaceType[_0x358d58(0xb3)],'faceText':_0x56253d['CLrzZ'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x7a6682(0x88)](_0x27bded){const _0x38da68=_0x7a6682,_0x47dd03={'QyVWd':_0x38da68(0x8c)};return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex['RPS'],'faceText':_0x47dd03['QyVWd'],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x5ce105){const _0x6cd973=_0x7a6682,_0x1140f5={'OWgiq':_0x6cd973(0x8f)};return typeof _0x5ce105!==_0x1140f5[_0x6cd973(0x8e)]&&(_0x5ce105=JSON[_0x6cd973(0x8a)](_0x5ce105)),{'elementType':ElementType[_0x6cd973(0x9c)],'elementId':'','arkElement':{'bytesData':_0x5ce105,'linkInfo':null,'subElementType':null}};}static[_0x7a6682(0xd4)](_0x3499a2){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x3499a2}};}}