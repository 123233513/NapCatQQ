function _0x2eca(){const _0xdce127=['bMQOi','3733870FXsBaj','XikXT','error','pic','Ori','FILE','[包剪锤]','MNYgI','end','iYxSh','6846zTgDBv','text','Thumb','normal2','iXrQY','ZivTO','gif','XLkTR','markdown','meJkK','JMfgs','FMXgY','_0.png','gHVGi','1435014CdfNxm','LwFBc','mp4','RyXoc','TEXT','视频信息','dirname','6368454rTjLan','uploadFile','PIC','rps','wOYMC','screenshots','get','2893233gqtjIU','TAvXb','289412IgJlKD','then','811036eTBnFo','VSBhU','unlink','文件异常，大小为0','PTT','2GbaeJO','size','dice','JKLRw','aBwUQ','replace','RPS','NAlOq','REPLY','VIDEO','string','toString','FACE','stat','notAt','Usxaj','video','获取视频信息失败','face','sep','normal','图片信息','ptt','语音转换失败,\x20请检查语音文件是否正常','file','path','1805gMhwNr','reply','height','8Aabnsj','chMCj'];_0x2eca=function(){return _0xdce127;};return _0x2eca();}const _0x4f5b30=_0x2a0f;(function(_0x3f8678,_0x54a6c6){const _0x13a5c6=_0x2a0f,_0x1ccddb=_0x3f8678();while(!![]){try{const _0x797477=-parseInt(_0x13a5c6(0x16c))/0x1*(-parseInt(_0x13a5c6(0x167))/0x2)+-parseInt(_0x13a5c6(0x1a4))/0x3+-parseInt(_0x13a5c6(0x165))/0x4+-parseInt(_0x13a5c6(0x186))/0x5*(parseInt(_0x13a5c6(0x196))/0x6)+parseInt(_0x13a5c6(0x163))/0x7*(-parseInt(_0x13a5c6(0x189))/0x8)+parseInt(_0x13a5c6(0x1ab))/0x9+parseInt(_0x13a5c6(0x18c))/0xa;if(_0x797477===_0x54a6c6)break;else _0x1ccddb['push'](_0x1ccddb['shift']());}catch(_0x415b7a){_0x1ccddb['push'](_0x1ccddb['shift']());}}}(_0x2eca,0x7e016));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x40f80a}from'node:fs';import _0x2b4df0 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x2a0f(_0x5dbc81,_0x186b55){const _0x2ecaf9=_0x2eca();return _0x2a0f=function(_0x2a0f8d,_0x1fea81){_0x2a0f8d=_0x2a0f8d-0x15f;let _0x44b033=_0x2ecaf9[_0x2a0f8d];return _0x44b033;},_0x2a0f(_0x5dbc81,_0x186b55);}export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x4f5b30(0x197)](_0x27c574){const _0x35ecac=_0x4f5b30;return{'elementType':ElementType[_0x35ecac(0x1a8)],'elementId':'','textElement':{'content':_0x27c574,'atType':AtType[_0x35ecac(0x17a)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x498a0d,_0x1ccdad,_0x1c4a51,_0x2aa40b){const _0x215f36=_0x4f5b30;return{'elementType':ElementType[_0x215f36(0x1a8)],'elementId':'','textElement':{'content':'@'+_0x2aa40b,'atType':_0x1c4a51,'atUid':_0x498a0d,'atTinyId':'','atNtUid':_0x1ccdad}};}static[_0x4f5b30(0x187)](_0x4ec685,_0x151e78,_0x124fcc,_0x4a9ac7){const _0x1ab198=_0x4f5b30;return{'elementType':ElementType[_0x1ab198(0x174)],'elementId':'','replyElement':{'replayMsgSeq':_0x4ec685,'replayMsgId':_0x151e78,'senderUin':_0x124fcc,'senderUinStr':_0x4a9ac7}};}static async[_0x4f5b30(0x18f)](_0x4ae897,_0x3d92c3='',_0x22022c=0x0){const _0x4ed145=_0x4f5b30,_0x596172={'LYPmk':function(_0x48a5c1,_0x3ff0c2){return _0x48a5c1===_0x3ff0c2;},'ytvQv':function(_0xcd95d,_0x24d5dc){return _0xcd95d(_0x24d5dc);},'VSBhU':function(_0x3bdd8a,_0x124fb2,_0x3363ef){return _0x3bdd8a(_0x124fb2,_0x3363ef);}},{md5:_0x3886b3,fileName:_0x4a77b8,path:_0x320d3b,fileSize:_0x3110bc}=await NTQQFileApi[_0x4ed145(0x1ac)](_0x4ae897,ElementType['PIC'],_0x22022c);if(_0x596172['LYPmk'](_0x3110bc,0x0))throw _0x4ed145(0x16a);const _0x26b64d=await NTQQFileApi['getImageSize'](_0x4ae897),_0x40c3b4={'md5HexStr':_0x3886b3,'fileSize':_0x3110bc[_0x4ed145(0x177)](),'picWidth':_0x26b64d?.['width'],'picHeight':_0x26b64d?.[_0x4ed145(0x188)],'fileName':_0x4a77b8,'sourcePath':_0x320d3b,'original':!![],'picType':_0x596172['ytvQv'](isGIF,_0x4ae897)?PicType[_0x4ed145(0x19c)]:PicType['jpg'],'picSubType':_0x22022c,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3d92c3};return _0x596172[_0x4ed145(0x168)](logDebug,_0x4ed145(0x181),_0x40c3b4),{'elementType':ElementType[_0x4ed145(0x1ad)],'elementId':'','picElement':_0x40c3b4};}static async[_0x4f5b30(0x184)](_0x49a9aa,_0x18b520=''){const _0xb11667=_0x4f5b30,_0x34ce3d={'meJkK':function(_0x33bd5e,_0x295f02){return _0x33bd5e===_0x295f02;},'GGnbD':_0xb11667(0x16a),'Usxaj':function(_0xdc989d,_0x20cf5a){return _0xdc989d||_0x20cf5a;}},{md5:_0x1f2b88,fileName:_0x3299e1,path:_0x2d8f87,fileSize:_0x15b6d3}=await NTQQFileApi[_0xb11667(0x1ac)](_0x49a9aa,ElementType[_0xb11667(0x191)]);if(_0x34ce3d[_0xb11667(0x19f)](_0x15b6d3,0x0))throw _0x34ce3d['GGnbD'];const _0x5a037d={'elementType':ElementType[_0xb11667(0x191)],'elementId':'','fileElement':{'fileName':_0x34ce3d[_0xb11667(0x17b)](_0x18b520,_0x3299e1),'filePath':_0x2d8f87,'fileSize':_0x15b6d3[_0xb11667(0x177)]()}};return _0x5a037d;}static async[_0x4f5b30(0x17c)](_0x4593f0,_0x35ac7c='',_0x5828ea=''){const _0x3ac0c5=_0x4f5b30,_0x1572f5={'sgnyY':'获取视频封面失败，使用默认封面','FMXgY':function(_0x5b54e1,_0x311d09){return _0x5b54e1(_0x311d09);},'RyXoc':function(_0x3f1549,_0x4e38e1){return _0x3f1549(_0x4e38e1);},'iXrQY':_0x3ac0c5(0x194),'XikXT':_0x3ac0c5(0x18e),'wOYMC':function(_0xe824fc,_0x4091a4){return _0xe824fc+_0x4091a4;},'CYWQS':function(_0x2f6d58,_0x1c177c){return _0x2f6d58===_0x1c177c;},'iYxSh':function(_0x561367,_0x372139){return _0x561367(_0x372139);},'DifeR':_0x3ac0c5(0x185),'JMfgs':_0x3ac0c5(0x1a6),'MNYgI':function(_0x3bf2fe,_0x32bd8e,_0x4f5398){return _0x3bf2fe(_0x32bd8e,_0x4f5398);},'XLkTR':_0x3ac0c5(0x17d),'LcMtr':function(_0x12de79,_0x68525a){return _0x12de79||_0x68525a;},'bghbN':function(_0xb5f382,_0x5f0f9c){return _0xb5f382+_0x5f0f9c;}},{fileName:_0xbe40a2,path:_0x50330a,fileSize:_0x1d0cc8,md5:_0x2f4832}=await NTQQFileApi[_0x3ac0c5(0x1ac)](_0x4593f0,ElementType[_0x3ac0c5(0x175)]);if(_0x1572f5['CYWQS'](_0x1d0cc8,0x0))throw _0x3ac0c5(0x16a);const _0x809c2a=_0x1572f5[_0x3ac0c5(0x195)](require,_0x1572f5['DifeR']);let _0x397f8d=_0x50330a[_0x3ac0c5(0x171)](_0x809c2a[_0x3ac0c5(0x17f)]+_0x3ac0c5(0x190)+_0x809c2a[_0x3ac0c5(0x17f)],_0x809c2a[_0x3ac0c5(0x17f)]+_0x3ac0c5(0x198)+_0x809c2a[_0x3ac0c5(0x17f)]);_0x397f8d=_0x809c2a[_0x3ac0c5(0x1aa)](_0x397f8d);let _0x1a0ec0={'width':0x780,'height':0x438,'time':0xf,'format':_0x1572f5[_0x3ac0c5(0x1a0)],'size':_0x1d0cc8,'filePath':_0x4593f0};try{_0x1a0ec0=await _0x1572f5[_0x3ac0c5(0x195)](getVideoInfo,_0x50330a),_0x1572f5['MNYgI'](logDebug,_0x3ac0c5(0x1a9),_0x1a0ec0);}catch(_0x355e72){_0x1572f5[_0x3ac0c5(0x193)](logError,_0x1572f5[_0x3ac0c5(0x19d)],_0x355e72);}const _0x103885=new Promise((_0x3d0ab4,_0x3abf98)=>{const _0x3b0caa=_0x3ac0c5,_0x506c16={'gHVGi':function(_0x572b15,_0x754db0){const _0x272fbe=_0x2a0f;return _0x1572f5[_0x272fbe(0x1a7)](_0x572b15,_0x754db0);}},_0x17fb21=_0x2f4832+_0x3b0caa(0x1a2),_0x1cefbc=_0x809c2a['join'](_0x397f8d,_0x17fb21);_0x1572f5['RyXoc'](_0x2b4df0,_0x4593f0)['on'](_0x1572f5[_0x3b0caa(0x19a)],()=>{})['on'](_0x1572f5[_0x3b0caa(0x18d)],_0x29485e=>{const _0xef6bbe=_0x3b0caa,_0x58eabd={'NAlOq':function(_0x454faf,_0x25dba8){return _0x454faf(_0x25dba8);}};logDebug(_0x1572f5['sgnyY'],_0x29485e),_0x5828ea?_0x40f80a['copyFile'](_0x5828ea,_0x1cefbc)[_0xef6bbe(0x166)](()=>{const _0x1935f2=_0xef6bbe;_0x506c16[_0x1935f2(0x1a3)](_0x3d0ab4,_0x1cefbc);})['catch'](_0x3abf98):_0x40f80a['writeFile'](_0x1cefbc,defaultVideoThumb)['then'](()=>{const _0x12940e=_0xef6bbe;_0x58eabd[_0x12940e(0x173)](_0x3d0ab4,_0x1cefbc);})['catch'](_0x3abf98);})[_0x3b0caa(0x161)]({'timestamps':[0x0],'filename':_0x17fb21,'folder':_0x397f8d,'size':_0x1572f5[_0x3b0caa(0x160)](_0x1a0ec0['width']+'x',_0x1a0ec0[_0x3b0caa(0x188)])})['on'](_0x1572f5[_0x3b0caa(0x19a)],()=>{const _0x2b1c0f=_0x3b0caa;_0x1572f5[_0x2b1c0f(0x1a1)](_0x3d0ab4,_0x1cefbc);});}),_0x1b1d07=new Map(),_0x49c0b6=await _0x103885,_0x524e1b=(await _0x40f80a[_0x3ac0c5(0x179)](_0x49c0b6))[_0x3ac0c5(0x16d)];_0x1b1d07['set'](0x0,_0x49c0b6);const _0x5c5023=await _0x1572f5[_0x3ac0c5(0x195)](calculateFileMD5,_0x49c0b6),_0x5d1f30={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x1572f5['LcMtr'](_0x35ac7c,_0xbe40a2),'filePath':_0x50330a,'videoMd5':_0x2f4832,'thumbMd5':_0x5c5023,'fileTime':_0x1a0ec0['time'],'thumbPath':_0x1b1d07,'thumbSize':_0x524e1b,'thumbWidth':_0x1a0ec0['width'],'thumbHeight':_0x1a0ec0[_0x3ac0c5(0x188)],'fileSize':_0x1572f5['bghbN']('',_0x1d0cc8)}};return _0x5d1f30;}static async[_0x4f5b30(0x182)](_0x33b02e){const _0x1efcc0=_0x4f5b30,_0x32aa6a={'ZivTO':function(_0x29bd90,_0x1f728f){return _0x29bd90(_0x1f728f);},'TAvXb':_0x1efcc0(0x183),'bMQOi':function(_0x1f5f93,_0x2ce4e3){return _0x1f5f93===_0x2ce4e3;},'LwFBc':_0x1efcc0(0x16a),'DBiKm':function(_0x36f03e,_0x382f6a){return _0x36f03e||_0x382f6a;}},{converted:_0x1b98f1,path:_0x1cb6ae,duration:_0x148643}=await _0x32aa6a[_0x1efcc0(0x19b)](encodeSilk,_0x33b02e);if(!_0x1cb6ae)throw _0x32aa6a[_0x1efcc0(0x164)];const {md5:_0x17f058,fileName:_0x2b57f8,path:_0x481d91,fileSize:_0x1b2076}=await NTQQFileApi['uploadFile'](_0x1cb6ae,ElementType[_0x1efcc0(0x16b)]);if(_0x32aa6a[_0x1efcc0(0x18b)](_0x1b2076,0x0))throw _0x32aa6a[_0x1efcc0(0x1a5)];return _0x1b98f1&&_0x40f80a[_0x1efcc0(0x169)](_0x1cb6ae)['then'](),{'elementType':ElementType[_0x1efcc0(0x16b)],'elementId':'','pttElement':{'fileName':_0x2b57f8,'filePath':_0x481d91,'md5HexStr':_0x17f058,'fileSize':_0x1b2076,'duration':_0x32aa6a['DBiKm'](_0x148643,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4f5b30(0x17e)](_0x5e729c){const _0x8f828b=_0x4f5b30,_0x4dc356={'JKLRw':function(_0x4d814e,_0x1fa53b){return _0x4d814e<_0x1fa53b;}};return{'elementType':ElementType[_0x8f828b(0x178)],'elementId':'','faceElement':{'faceIndex':_0x5e729c,'faceType':_0x4dc356[_0x8f828b(0x16f)](_0x5e729c,0xde)?FaceType[_0x8f828b(0x180)]:FaceType[_0x8f828b(0x199)]}};}static['mface'](_0x342700,_0x6a59d6,_0x534c86,_0x3665eb){const _0x411484=_0x4f5b30,_0x43db23={'chMCj':'[商城表情]'};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x342700,'emojiId':_0x6a59d6,'key':_0x534c86,'faceName':_0x3665eb||mFaceCache[_0x411484(0x162)](_0x6a59d6)||_0x43db23[_0x411484(0x18a)]}};}static[_0x4f5b30(0x16e)](_0x4576f2){const _0x4c8c0d=_0x4f5b30;return{'elementType':ElementType[_0x4c8c0d(0x178)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4c8c0d(0x16e)],'faceType':FaceType[_0x4c8c0d(0x16e)],'faceText':'[骰子]','packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4f5b30(0x15f)](_0x12b152){const _0x235864=_0x4f5b30,_0x35da70={'aBwUQ':_0x235864(0x192)};return{'elementType':ElementType[_0x235864(0x178)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x235864(0x172)],'faceText':_0x35da70[_0x235864(0x170)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x11e41e){const _0x549559=_0x4f5b30;return typeof _0x11e41e!==_0x549559(0x176)&&(_0x11e41e=JSON['stringify'](_0x11e41e)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x11e41e,'linkInfo':null,'subElementType':null}};}static[_0x4f5b30(0x19e)](_0x3c532b){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x3c532b}};}}