const _0x4ad9cc=_0x209c;(function(_0x371d51,_0x262aad){const _0x2d53d1=_0x209c,_0x1979d1=_0x371d51();while(!![]){try{const _0x2cdfd7=parseInt(_0x2d53d1(0x20e))/0x1*(parseInt(_0x2d53d1(0x1fe))/0x2)+-parseInt(_0x2d53d1(0x1c8))/0x3*(parseInt(_0x2d53d1(0x1fb))/0x4)+-parseInt(_0x2d53d1(0x1c6))/0x5*(parseInt(_0x2d53d1(0x1fd))/0x6)+-parseInt(_0x2d53d1(0x1ef))/0x7+parseInt(_0x2d53d1(0x1e1))/0x8+-parseInt(_0x2d53d1(0x1c2))/0x9*(-parseInt(_0x2d53d1(0x1e6))/0xa)+parseInt(_0x2d53d1(0x1cd))/0xb;if(_0x2cdfd7===_0x262aad)break;else _0x1979d1['push'](_0x1979d1['shift']());}catch(_0x2a412e){_0x1979d1['push'](_0x1979d1['shift']());}}}(_0x8361,0x21405));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0xb2518b}from'node:fs';import _0x1ecbbd from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';function _0x8361(){const _0x18bbbc=['FjTZD','cghGG','hjWod','gif','ARK','PnnRs','HGkoJ','miniapp','sysface','Thumb','PkdDg','[骰子]','LxDLA','550320SXvdRx','uploadFile','then','TRWoZ','file','1341690cOHTeO','face','获取视频信息失败','MDkab','VIDEO','ark','QDes','AniStickerPackId','VbDji','1893542HHOZdl','video','catch','OdkwF','width','mface','uFLRV','toString','tQUTG','[包剪锤]','sep','语音转换失败,\x20请检查语音文件是否正常','89268Jscawy','height','12dFRiQN','249244kxfglK','writeFile','FILE','pSfIW','find','string','sIwyW','dice','FACE','copyFile','FajTv','set','stringify','[商城表情]','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','TEXT','2WYpGRo','markdown','https://www.bilibili.com/','uTJbo','AniStickerType','error','notAt','screenshots','REPLY','Bot\x20Test','size','IUGOt','stat','IalxJ','getImageSize','9lgWDex','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','cXuPP','DyUCF','509365rmNLBV','RPS','9fEviIw','文件异常，大小为0','jpg','rps','PIC','2477167CDuRtm','PTT','xinWE','QSid','AniStickerId','get','pic'];_0x8361=function(){return _0x18bbbc;};return _0x8361();}import _0x29779a from'./face_config.json';function _0x209c(_0x4ad0a6,_0x1c57ac){const _0x8361f3=_0x8361();return _0x209c=function(_0x209cc2,_0x2dd4ff){_0x209cc2=_0x209cc2-0x1b9;let _0x46bfbf=_0x8361f3[_0x209cc2];return _0x46bfbf;},_0x209c(_0x4ad0a6,_0x1c57ac);}import*as _0x36be95 from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x4c060f){const _0x256847=_0x209c;return{'elementType':ElementType[_0x256847(0x20d)],'elementId':'','textElement':{'content':_0x4c060f,'atType':AtType[_0x256847(0x1b9)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x29afaf,_0x157a5f,_0x5a8c43,_0x2acb21){const _0x20186b=_0x209c;return{'elementType':ElementType[_0x20186b(0x20d)],'elementId':'','textElement':{'content':'@'+_0x2acb21,'atType':_0x5a8c43,'atUid':_0x29afaf,'atTinyId':'','atNtUid':_0x157a5f}};}static['reply'](_0x13a60e,_0x5cf8fd,_0x2efe88,_0x201df6){const _0x16a5fa=_0x209c;return{'elementType':ElementType[_0x16a5fa(0x1bb)],'elementId':'','replyElement':{'replayMsgSeq':_0x13a60e,'replayMsgId':_0x5cf8fd,'senderUin':_0x2efe88,'senderUinStr':_0x201df6}};}static async[_0x4ad9cc(0x1d3)](_0xd8e1b9,_0x11ec36='',_0x2da173=0x0){const _0x170818=_0x4ad9cc,_0x301391={'IalxJ':function(_0x3fa739,_0x4eb459){return _0x3fa739===_0x4eb459;},'FajTv':_0x170818(0x1c9),'caibV':function(_0x566db9,_0x2850d6){return _0x566db9(_0x2850d6);}},{md5:_0x18ad24,fileName:_0x551d19,path:_0x15a718,fileSize:_0x3efa7e}=await NTQQFileApi[_0x170818(0x1e2)](_0xd8e1b9,ElementType[_0x170818(0x1cc)],_0x2da173);if(_0x301391[_0x170818(0x1c0)](_0x3efa7e,0x0))throw _0x301391[_0x170818(0x208)];const _0x25a207=await NTQQFileApi[_0x170818(0x1c1)](_0xd8e1b9),_0x514f27={'md5HexStr':_0x18ad24,'fileSize':_0x3efa7e[_0x170818(0x1f6)](),'picWidth':_0x25a207?.[_0x170818(0x1f3)],'picHeight':_0x25a207?.[_0x170818(0x1fc)],'fileName':_0x551d19,'sourcePath':_0x15a718,'original':!![],'picType':_0x301391['caibV'](isGIF,_0xd8e1b9)?PicType[_0x170818(0x1d7)]:PicType[_0x170818(0x1ca)],'picSubType':_0x2da173,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x11ec36};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x514f27};}static async[_0x4ad9cc(0x1e5)](_0x5a45de,_0x9d17f0='',_0x8510ad=''){const _0x255a92=_0x4ad9cc,_0x29d154={'pSfIW':function(_0x3ccade,_0x54e22f){return _0x3ccade===_0x54e22f;}},{md5:_0x4c87bc,fileName:_0x36c498,path:_0x1f0079,fileSize:_0x10ebaa}=await NTQQFileApi[_0x255a92(0x1e2)](_0x5a45de,ElementType[_0x255a92(0x200)]);if(_0x29d154[_0x255a92(0x201)](_0x10ebaa,0x0))throw _0x255a92(0x1c9);const _0x1b34e3={'elementType':ElementType['FILE'],'elementId':'','fileElement':{'fileName':_0x9d17f0||_0x36c498,'folderId':_0x8510ad,'filePath':_0x1f0079,'fileSize':_0x10ebaa[_0x255a92(0x1f6)]()}};return _0x1b34e3;}static async[_0x4ad9cc(0x1f0)](_0x566067,_0x1e7708='',_0x589f2b=''){const _0x3d4b1c=_0x4ad9cc,_0x6f9d53={'TRWoZ':function(_0x4a9775,_0x1b0d71){return _0x4a9775(_0x1b0d71);},'xinWE':_0x3d4b1c(0x213),'sIwyW':function(_0x590ece,_0x3edb7b){return _0x590ece+_0x3edb7b;},'PkdDg':'end','uFLRV':function(_0x993a,_0x242d57){return _0x993a===_0x242d57;},'IoawA':_0x3d4b1c(0x1c9),'cXuPP':_0x3d4b1c(0x1e8),'MDkab':function(_0x284ffd,_0x3de936){return _0x284ffd||_0x3de936;}},{fileName:_0x2d8e3b,path:_0xce53cc,fileSize:_0x337f9d,md5:_0x3bfd83}=await NTQQFileApi[_0x3d4b1c(0x1e2)](_0x566067,ElementType['VIDEO']);if(_0x6f9d53[_0x3d4b1c(0x1f5)](_0x337f9d,0x0))throw _0x6f9d53['IoawA'];let _0x4c23a5=_0xce53cc['replace'](_0x36be95[_0x3d4b1c(0x1f9)]+'Ori'+_0x36be95[_0x3d4b1c(0x1f9)],_0x36be95[_0x3d4b1c(0x1f9)]+_0x3d4b1c(0x1dd)+_0x36be95[_0x3d4b1c(0x1f9)]);_0x4c23a5=_0x36be95['dirname'](_0x4c23a5);let _0x33ecc4={'width':0x780,'height':0x438,'time':0xf,'format':'mp4','size':_0x337f9d,'filePath':_0x566067};try{_0x33ecc4=await _0x6f9d53[_0x3d4b1c(0x1e4)](getVideoInfo,_0xce53cc);}catch(_0x2e7ed5){logError(_0x6f9d53[_0x3d4b1c(0x1c4)],_0x2e7ed5);}const _0x249bc9=new Promise((_0x5e5ee5,_0x417caa)=>{const _0x2d6967=_0x3d4b1c,_0x49d683={'FIbnH':function(_0x505e60,_0x1365dd){const _0x5cdf2d=_0x209c;return _0x6f9d53[_0x5cdf2d(0x1e4)](_0x505e60,_0x1365dd);},'HGkoJ':function(_0x59a8f7,_0x50a2a2){return _0x59a8f7(_0x50a2a2);},'DyUCF':'获取视频封面失败，使用默认封面'},_0x1828a4=_0x3bfd83+'_0.png',_0x8adb7c=_0x36be95['join'](_0x4c23a5,_0x1828a4);_0x1ecbbd(_0x566067)['on']('end',()=>{})['on'](_0x6f9d53[_0x2d6967(0x1cf)],_0x4cd392=>{const _0x360644=_0x2d6967,_0x54ee52={'OdkwF':function(_0x2d6f02,_0xe2ea65){return _0x49d683['FIbnH'](_0x2d6f02,_0xe2ea65);},'EGuQh':function(_0x4c0761,_0x31d28d){const _0x4693c9=_0x209c;return _0x49d683[_0x4693c9(0x1da)](_0x4c0761,_0x31d28d);}};logDebug(_0x49d683[_0x360644(0x1c5)],_0x4cd392),_0x589f2b?_0xb2518b[_0x360644(0x207)](_0x589f2b,_0x8adb7c)['then'](()=>{const _0x2486a7=_0x360644;_0x54ee52[_0x2486a7(0x1f2)](_0x5e5ee5,_0x8adb7c);})['catch'](_0x417caa):_0xb2518b[_0x360644(0x1ff)](_0x8adb7c,defaultVideoThumb)[_0x360644(0x1e3)](()=>{_0x54ee52['EGuQh'](_0x5e5ee5,_0x8adb7c);})[_0x360644(0x1f1)](_0x417caa);})[_0x2d6967(0x1ba)]({'timestamps':[0x0],'filename':_0x1828a4,'folder':_0x4c23a5,'size':_0x6f9d53[_0x2d6967(0x204)](_0x33ecc4[_0x2d6967(0x1f3)]+'x',_0x33ecc4[_0x2d6967(0x1fc)])})['on'](_0x6f9d53[_0x2d6967(0x1de)],()=>{_0x5e5ee5(_0x8adb7c);});}),_0x48a808=new Map(),_0x2fb19e=await _0x249bc9,_0x1974fd=(await _0xb2518b[_0x3d4b1c(0x1bf)](_0x2fb19e))[_0x3d4b1c(0x1bd)];_0x48a808[_0x3d4b1c(0x209)](0x0,_0x2fb19e);const _0x978b52=await _0x6f9d53['TRWoZ'](calculateFileMD5,_0x2fb19e),_0x549eb4={'elementType':ElementType[_0x3d4b1c(0x1ea)],'elementId':'','videoElement':{'fileName':_0x6f9d53[_0x3d4b1c(0x1e9)](_0x1e7708,_0x2d8e3b),'filePath':_0xce53cc,'videoMd5':_0x3bfd83,'thumbMd5':_0x978b52,'fileTime':_0x33ecc4['time'],'thumbPath':_0x48a808,'thumbSize':_0x1974fd,'thumbWidth':_0x33ecc4[_0x3d4b1c(0x1f3)],'thumbHeight':_0x33ecc4['height'],'fileSize':_0x6f9d53[_0x3d4b1c(0x204)]('',_0x337f9d)}};return _0x549eb4;}static async['ptt'](_0x3264ce){const _0x3cb49c=_0x4ad9cc,_0x90d199={'LxDLA':function(_0xe651ad,_0x5ed71d){return _0xe651ad(_0x5ed71d);},'staEx':function(_0x462dfc,_0x51af49){return _0x462dfc===_0x51af49;},'gkUVg':function(_0x5d696b,_0xe31af3){return _0x5d696b||_0xe31af3;}},{converted:_0xdfcd12,path:_0x1a4e29,duration:_0x11c7b7}=await _0x90d199[_0x3cb49c(0x1e0)](encodeSilk,_0x3264ce);if(!_0x1a4e29)throw _0x3cb49c(0x1fa);const {md5:_0x28b4a6,fileName:_0x3682d2,path:_0x2fa67e,fileSize:_0x437321}=await NTQQFileApi[_0x3cb49c(0x1e2)](_0x1a4e29,ElementType[_0x3cb49c(0x1ce)]);if(_0x90d199['staEx'](_0x437321,0x0))throw _0x3cb49c(0x1c9);return _0xdfcd12&&_0xb2518b['unlink'](_0x1a4e29)[_0x3cb49c(0x1e3)](),{'elementType':ElementType['PTT'],'elementId':'','pttElement':{'fileName':_0x3682d2,'filePath':_0x2fa67e,'md5HexStr':_0x28b4a6,'fileSize':_0x437321,'duration':_0x90d199['gkUVg'](_0x11c7b7,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4ad9cc(0x1e7)](_0x51df4f){const _0x56f0d0=_0x4ad9cc,_0x3ba231={'PnnRs':function(_0x50cbd0,_0xa13410){return _0x50cbd0(_0xa13410);},'IUGOt':function(_0x3aab1a,_0x4ac8e5){return _0x3aab1a>=_0x4ac8e5;}},_0x1694b1=_0x29779a[_0x56f0d0(0x1dc)],_0x2bf3d4=_0x29779a['emoji'],_0x1bbbe2=_0x1694b1[_0x56f0d0(0x202)](_0x5456e9=>_0x5456e9[_0x56f0d0(0x1d0)]===_0x51df4f[_0x56f0d0(0x1f6)]());_0x51df4f=_0x3ba231[_0x56f0d0(0x1d9)](parseInt,_0x51df4f[_0x56f0d0(0x1f6)]());let _0x309bec=0x1;return _0x3ba231[_0x56f0d0(0x1be)](_0x51df4f,0xde)&&(_0x309bec=0x2),_0x1bbbe2[_0x56f0d0(0x212)]&&(_0x309bec=0x3),{'elementType':ElementType[_0x56f0d0(0x206)],'elementId':'','faceElement':{'faceIndex':_0x51df4f,'faceType':_0x309bec,'faceText':_0x1bbbe2[_0x56f0d0(0x1ec)],'stickerId':_0x1bbbe2[_0x56f0d0(0x1d1)],'stickerType':_0x1bbbe2[_0x56f0d0(0x212)],'packId':_0x1bbbe2[_0x56f0d0(0x1ed)],'sourceType':0x1}};}static[_0x4ad9cc(0x1f4)](_0x589fa9,_0x3733eb,_0x46f2a3,_0x351649){const _0x2b4dfb=_0x4ad9cc,_0x4f2060={'cghGG':_0x2b4dfb(0x20b)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0x589fa9,'emojiId':_0x3733eb,'key':_0x46f2a3,'faceName':_0x351649||mFaceCache[_0x2b4dfb(0x1d2)](_0x3733eb)||_0x4f2060[_0x2b4dfb(0x1d5)]}};}static[_0x4ad9cc(0x205)](_0x2e97eb){const _0x50fb88=_0x4ad9cc,_0x3f18ab={'tQUTG':_0x50fb88(0x1df)};return{'elementType':ElementType[_0x50fb88(0x206)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x50fb88(0x205)],'faceType':FaceType['dice'],'faceText':_0x3f18ab[_0x50fb88(0x1f7)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4ad9cc(0x1cb)](_0x49bb4d){const _0x6e8cb6=_0x4ad9cc,_0x47ca9f={'uTJbo':_0x6e8cb6(0x1f8)};return{'elementType':ElementType[_0x6e8cb6(0x206)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x6e8cb6(0x1c7)],'faceText':_0x47ca9f[_0x6e8cb6(0x211)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4ad9cc(0x1eb)](_0x34570f){const _0x5593a1=_0x4ad9cc,_0x1c2f72={'VbDji':_0x5593a1(0x203)};return typeof _0x34570f!==_0x1c2f72[_0x5593a1(0x1ee)]&&(_0x34570f=JSON[_0x5593a1(0x20a)](_0x34570f)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0x34570f,'linkInfo':null,'subElementType':null}};}static[_0x4ad9cc(0x20f)](_0x2106f9){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x2106f9}};}static async[_0x4ad9cc(0x1db)](){const _0x23d5e8=_0x4ad9cc,_0x44ee3e={'hjWod':'Bot\x20Test','FjTZD':_0x23d5e8(0x210)};let _0x50125e=await SignMiniApp({'prompt':_0x44ee3e['hjWod'],'title':_0x44ee3e['hjWod'],'preview':_0x23d5e8(0x20c),'jumpUrl':_0x44ee3e[_0x23d5e8(0x1d4)],'tag':_0x23d5e8(0x1bc),'tagIcon':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','source':_0x44ee3e[_0x23d5e8(0x1d6)],'sourcelogo':_0x23d5e8(0x1c3)});return{'elementType':ElementType[_0x23d5e8(0x1d8)],'elementId':'','arkElement':{'bytesData':_0x50125e,'linkInfo':null,'subElementType':null}};}}