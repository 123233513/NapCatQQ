const _0x4d16a7=_0x3639;(function(_0x3b5c96,_0x23ea36){const _0x31c236=_0x3639,_0x3db011=_0x3b5c96();while(!![]){try{const _0x9fb526=parseInt(_0x31c236(0x121))/0x1*(parseInt(_0x31c236(0x100))/0x2)+-parseInt(_0x31c236(0xf6))/0x3+parseInt(_0x31c236(0x109))/0x4+parseInt(_0x31c236(0x125))/0x5*(-parseInt(_0x31c236(0x11b))/0x6)+-parseInt(_0x31c236(0x144))/0x7+-parseInt(_0x31c236(0x110))/0x8+-parseInt(_0x31c236(0x13b))/0x9*(-parseInt(_0x31c236(0xff))/0xa);if(_0x9fb526===_0x23ea36)break;else _0x3db011['push'](_0x3db011['shift']());}catch(_0x3a686f){_0x3db011['push'](_0x3db011['shift']());}}}(_0x2b36,0xbf63d));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x5ff26a}from'node:fs';function _0x2b36(){const _0x2c986e=['REPLY','uploadFile','markdown','fmlGP','mface','odigW','size','PTT','2930oKDAxk','38RKblrs','获取视频信息失败','face','unlink','uzcQO','sxEGL','height','获取视频封面失败，使用默认封面','ikkUt','915712ySCgkZ','dice','mxMLL','GHRSE','Nwdoy','Ori','video','5256168tcEJOj','sep','replace','zNxsk','gif','dsvAO','aAsta','string','stringify','QyUNj','ptt','939762xTRfHy','ark','reply','FILE','[商城表情]','normal2','52105lgpaRR','dirname','VIDEO','then','10QnpuLa','notAt','MARKDOWN','pZGCP','pic','文件异常，大小为0','jpg','end','join','FACE','writeFile','iSbbP','set','jkeJw','mp4','qgEkU','path','time','ZFepd','width','uvDCh','mvTyC','48447sUeOmi','Thumb','ARK','error','getImageSize','LSmoI','MSHoc','PMNRf','YSHUc','1432914hZRsyH','语音转换失败,\x20请检查语音文件是否正常','file','screenshots','RPS','iePGy','PIC','trRjm','MFACE','TEXT','copyFile','2511696EovpZz'];_0x2b36=function(){return _0x2c986e;};return _0x2b36();}import _0x384330 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x3639(_0x50ff09,_0x38dece){const _0x2b36bb=_0x2b36();return _0x3639=function(_0x363958,_0xbd08cb){_0x363958=_0x363958-0xf5;let _0x314ce3=_0x2b36bb[_0x363958];return _0x314ce3;},_0x3639(_0x50ff09,_0x38dece);}import{encodeSilk}from'@/common/utils/audio';export const mFaceCache=new Map();export class SendMsgElementConstructor{static['text'](_0x43f9d3){const _0x36d6f8=_0x3639;return{'elementType':ElementType[_0x36d6f8(0x14d)],'elementId':'','textElement':{'content':_0x43f9d3,'atType':AtType[_0x36d6f8(0x126)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x280b8d,_0xaefa9f,_0x3796a7,_0x483331){const _0x12fa99=_0x3639;return{'elementType':ElementType[_0x12fa99(0x14d)],'elementId':'','textElement':{'content':'@'+_0x483331,'atType':_0x3796a7,'atUid':_0x280b8d,'atTinyId':'','atNtUid':_0xaefa9f}};}static[_0x4d16a7(0x11d)](_0x43d317,_0xd73711,_0x1ba1d9,_0x36f8e8){const _0x24e891=_0x4d16a7;return{'elementType':ElementType[_0x24e891(0xf7)],'elementId':'','replyElement':{'replayMsgSeq':_0x43d317,'replayMsgId':_0xd73711,'senderUin':_0x1ba1d9,'senderUinStr':_0x36f8e8}};}static async[_0x4d16a7(0x129)](_0x4bd317,_0x4a8e63='',_0x4aa5fd=0x0){const _0x407a47=_0x4d16a7,_0x9c3fa5={'YSHUc':function(_0x3022ab,_0x2b50de){return _0x3022ab===_0x2b50de;},'MSHoc':_0x407a47(0x12a),'QyUNj':function(_0x4fa3ad,_0x23ac91){return _0x4fa3ad(_0x23ac91);},'dsvAO':function(_0x583f10,_0x23e4a5,_0x3c5a1a){return _0x583f10(_0x23e4a5,_0x3c5a1a);}},{md5:_0x3a3d7f,fileName:_0x8d6a22,path:_0x5f38b6,fileSize:_0x33d759}=await NTQQFileApi[_0x407a47(0xf8)](_0x4bd317,ElementType[_0x407a47(0x14a)],_0x4aa5fd);if(_0x9c3fa5[_0x407a47(0x143)](_0x33d759,0x0))throw _0x9c3fa5[_0x407a47(0x141)];const _0x1ca8dd=await NTQQFileApi[_0x407a47(0x13f)](_0x4bd317),_0x122739={'md5HexStr':_0x3a3d7f,'fileSize':_0x33d759['toString'](),'picWidth':_0x1ca8dd?.['width'],'picHeight':_0x1ca8dd?.['height'],'fileName':_0x8d6a22,'sourcePath':_0x5f38b6,'original':!![],'picType':_0x9c3fa5[_0x407a47(0x119)](isGIF,_0x4bd317)?PicType[_0x407a47(0x114)]:PicType[_0x407a47(0x12b)],'picSubType':_0x4aa5fd,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x4a8e63};return _0x9c3fa5[_0x407a47(0x115)](logDebug,'图片信息',_0x122739),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x122739};}static async[_0x4d16a7(0x146)](_0x29b627,_0x4c9de6=''){const _0x141646=_0x4d16a7,_0x1591f0={'CjFWw':'文件异常，大小为0','GHRSE':function(_0x3ce77c,_0x2d8237){return _0x3ce77c||_0x2d8237;}},{md5:_0x17f090,fileName:_0xb0b59d,path:_0x1d4ec6,fileSize:_0x5346da}=await NTQQFileApi['uploadFile'](_0x29b627,ElementType[_0x141646(0x11e)]);if(_0x5346da===0x0)throw _0x1591f0['CjFWw'];const _0xf66b2c={'elementType':ElementType[_0x141646(0x11e)],'elementId':'','fileElement':{'fileName':_0x1591f0[_0x141646(0x10c)](_0x4c9de6,_0xb0b59d),'filePath':_0x1d4ec6,'fileSize':_0x5346da['toString']()}};return _0xf66b2c;}static async[_0x4d16a7(0x10f)](_0x3a7ab1,_0x50b3ca='',_0x16d651=''){const _0x215b99=_0x4d16a7,_0x511f99={'yUYTa':function(_0x4277b3,_0x543b9a){return _0x4277b3(_0x543b9a);},'PoWAk':function(_0x207242,_0x4e20d0,_0x2025e0){return _0x207242(_0x4e20d0,_0x2025e0);},'iePGy':_0x215b99(0x107),'ikkUt':_0x215b99(0x13e),'LSmoI':function(_0x1edc0f,_0x28deeb){return _0x1edc0f+_0x28deeb;},'Nwdoy':function(_0x41ed19,_0x3e359f){return _0x41ed19===_0x3e359f;},'odigW':_0x215b99(0x12a),'mvTyC':function(_0x5caef1,_0x1ef0bf){return _0x5caef1(_0x1ef0bf);},'pZGCP':function(_0x5c2c4e,_0x4b68bc,_0x5e02b9){return _0x5c2c4e(_0x4b68bc,_0x5e02b9);},'fmlGP':_0x215b99(0x101),'EEBQA':function(_0x1946e7,_0x2389c5){return _0x1946e7+_0x2389c5;}},{fileName:_0x17a39b,path:_0x14939b,fileSize:_0x3ce161,md5:_0x41bf66}=await NTQQFileApi[_0x215b99(0xf8)](_0x3a7ab1,ElementType[_0x215b99(0x123)]);if(_0x511f99[_0x215b99(0x10d)](_0x3ce161,0x0))throw _0x511f99[_0x215b99(0xfc)];const _0x3b24c3=require(_0x215b99(0x135));let _0x680311=_0x14939b[_0x215b99(0x112)](_0x3b24c3[_0x215b99(0x111)]+_0x215b99(0x10e)+_0x3b24c3[_0x215b99(0x111)],_0x3b24c3['sep']+_0x215b99(0x13c)+_0x3b24c3[_0x215b99(0x111)]);_0x680311=_0x3b24c3[_0x215b99(0x122)](_0x680311);let _0x4ca9de={'width':0x780,'height':0x438,'time':0xf,'format':_0x215b99(0x133),'size':_0x3ce161,'filePath':_0x3a7ab1};try{_0x4ca9de=await _0x511f99[_0x215b99(0x13a)](getVideoInfo,_0x14939b),_0x511f99[_0x215b99(0x128)](logDebug,'视频信息',_0x4ca9de);}catch(_0x5948c4){_0x511f99['PoWAk'](logError,_0x511f99[_0x215b99(0xfa)],_0x5948c4);}const _0x4e6104=new Promise((_0x3ad8f3,_0x417a1c)=>{const _0x589eb2=_0x215b99,_0x48bd0f={'aAsta':function(_0x4d0784,_0xc17900){return _0x511f99['yUYTa'](_0x4d0784,_0xc17900);},'hZgKt':function(_0x4871c6,_0x570e59,_0x26fbbd){return _0x511f99['PoWAk'](_0x4871c6,_0x570e59,_0x26fbbd);},'qgEkU':_0x511f99[_0x589eb2(0x149)],'uzcQO':function(_0x3f5413,_0xdbb812){return _0x511f99['yUYTa'](_0x3f5413,_0xdbb812);}},_0x5e6d8c=_0x41bf66+'_0.png',_0x58d178=_0x3b24c3[_0x589eb2(0x12d)](_0x680311,_0x5e6d8c);_0x384330(_0x3a7ab1)['on'](_0x589eb2(0x12c),()=>{})['on'](_0x511f99[_0x589eb2(0x108)],_0xddeb1f=>{const _0x17299b=_0x589eb2;_0x48bd0f['hZgKt'](logDebug,_0x48bd0f[_0x17299b(0x134)],_0xddeb1f),_0x16d651?_0x5ff26a[_0x17299b(0xf5)](_0x16d651,_0x58d178)['then'](()=>{const _0x33f7fc=_0x17299b;_0x48bd0f[_0x33f7fc(0x116)](_0x3ad8f3,_0x58d178);})['catch'](_0x417a1c):_0x5ff26a[_0x17299b(0x12f)](_0x58d178,defaultVideoThumb)[_0x17299b(0x124)](()=>{_0x3ad8f3(_0x58d178);})['catch'](_0x417a1c);})[_0x589eb2(0x147)]({'timestamps':[0x0],'filename':_0x5e6d8c,'folder':_0x680311,'size':_0x511f99[_0x589eb2(0x140)](_0x511f99[_0x589eb2(0x140)](_0x4ca9de['width'],'x'),_0x4ca9de[_0x589eb2(0x106)])})['on'](_0x589eb2(0x12c),()=>{const _0x137f79=_0x589eb2;_0x48bd0f[_0x137f79(0x104)](_0x3ad8f3,_0x58d178);});}),_0x458c5d=new Map(),_0x1b2143=await _0x4e6104,_0x55871e=(await _0x5ff26a['stat'](_0x1b2143))[_0x215b99(0xfd)];_0x458c5d[_0x215b99(0x131)](0x0,_0x1b2143);const _0x2c58c0=await calculateFileMD5(_0x1b2143),_0x34bf4b={'elementType':ElementType[_0x215b99(0x123)],'elementId':'','videoElement':{'fileName':_0x50b3ca||_0x17a39b,'filePath':_0x14939b,'videoMd5':_0x41bf66,'thumbMd5':_0x2c58c0,'fileTime':_0x4ca9de[_0x215b99(0x136)],'thumbPath':_0x458c5d,'thumbSize':_0x55871e,'thumbWidth':_0x4ca9de[_0x215b99(0x138)],'thumbHeight':_0x4ca9de[_0x215b99(0x106)],'fileSize':_0x511f99['EEBQA']('',_0x3ce161)}};return _0x34bf4b;}static async[_0x4d16a7(0x11a)](_0x4768da){const _0x521b4b=_0x4d16a7,_0x41afef={'jkeJw':function(_0x39767c,_0x126c49){return _0x39767c(_0x126c49);},'zNxsk':_0x521b4b(0x145),'mxMLL':_0x521b4b(0x12a),'PMNRf':function(_0x413c48,_0x320484){return _0x413c48||_0x320484;}},{converted:_0x34b195,path:_0x208df7,duration:_0x2906ca}=await _0x41afef[_0x521b4b(0x132)](encodeSilk,_0x4768da);if(!_0x208df7)throw _0x41afef[_0x521b4b(0x113)];const {md5:_0xf510e5,fileName:_0x3b85d3,path:_0x2a69d6,fileSize:_0x18f670}=await NTQQFileApi[_0x521b4b(0xf8)](_0x208df7,ElementType['PTT']);if(_0x18f670===0x0)throw _0x41afef[_0x521b4b(0x10b)];return _0x34b195&&_0x5ff26a[_0x521b4b(0x103)](_0x208df7)[_0x521b4b(0x124)](),{'elementType':ElementType[_0x521b4b(0xfe)],'elementId':'','pttElement':{'fileName':_0x3b85d3,'filePath':_0x2a69d6,'md5HexStr':_0xf510e5,'fileSize':_0x18f670,'duration':_0x41afef[_0x521b4b(0x142)](_0x2906ca,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x4d16a7(0x102)](_0xe83094){const _0x4c706e=_0x4d16a7,_0x34c338={'sxEGL':function(_0x361d17,_0x2ce9be){return _0x361d17<_0x2ce9be;}};return{'elementType':ElementType[_0x4c706e(0x12e)],'elementId':'','faceElement':{'faceIndex':_0xe83094,'faceType':_0x34c338[_0x4c706e(0x105)](_0xe83094,0xde)?FaceType['normal']:FaceType[_0x4c706e(0x120)]}};}static[_0x4d16a7(0xfb)](_0x19536e,_0x3e10c4,_0x5e52e3,_0x5ac52a){const _0x3e0738=_0x4d16a7,_0x594bf8={'trRjm':_0x3e0738(0x11f)};return{'elementType':ElementType[_0x3e0738(0x14c)],'marketFaceElement':{'emojiPackageId':_0x19536e,'emojiId':_0x3e10c4,'key':_0x5e52e3,'faceName':_0x5ac52a||mFaceCache['get'](_0x3e10c4)||_0x594bf8[_0x3e0738(0x14b)]}};}static[_0x4d16a7(0x10a)](_0x5c89da){const _0x5b811d=_0x4d16a7,_0x195b3d={'uvDCh':'[骰子]'};return{'elementType':ElementType[_0x5b811d(0x12e)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x5b811d(0x10a)],'faceType':FaceType[_0x5b811d(0x10a)],'faceText':_0x195b3d[_0x5b811d(0x139)],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['rps'](_0x490fd3){const _0x40de41=_0x4d16a7,_0x4a11c0={'iSbbP':'[包剪锤]'};return{'elementType':ElementType[_0x40de41(0x12e)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x40de41(0x148)],'faceText':_0x4a11c0[_0x40de41(0x130)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x4d16a7(0x11c)](_0x1b170e){const _0x38cd65=_0x4d16a7,_0x5867b8={'ZFepd':_0x38cd65(0x117)};return typeof _0x1b170e!==_0x5867b8[_0x38cd65(0x137)]&&(_0x1b170e=JSON[_0x38cd65(0x118)](_0x1b170e)),{'elementType':ElementType[_0x38cd65(0x13d)],'elementId':'','arkElement':{'bytesData':_0x1b170e,'linkInfo':null,'subElementType':null}};}static[_0x4d16a7(0xf9)](_0x4ca118){const _0x5203a9=_0x4d16a7;return{'elementType':ElementType[_0x5203a9(0x127)],'elementId':'','markdownElement':{'content':_0x4ca118}};}}