function _0x8469(_0x1e775b,_0x34f729){const _0x2bb35e=_0x2bb3();return _0x8469=function(_0x84692e,_0x5ad3a9){_0x84692e=_0x84692e-0x123;let _0x4d0bfd=_0x2bb35e[_0x84692e];return _0x4d0bfd;},_0x8469(_0x1e775b,_0x34f729);}const _0x29a2c3=_0x8469;(function(_0x30e77a,_0x3bae7e){const _0xa0e679=_0x8469,_0x322f4a=_0x30e77a();while(!![]){try{const _0x450044=-parseInt(_0xa0e679(0x14b))/0x1+-parseInt(_0xa0e679(0x133))/0x2+-parseInt(_0xa0e679(0x124))/0x3*(parseInt(_0xa0e679(0x15d))/0x4)+-parseInt(_0xa0e679(0x14c))/0x5+-parseInt(_0xa0e679(0x151))/0x6*(-parseInt(_0xa0e679(0x12a))/0x7)+parseInt(_0xa0e679(0x167))/0x8*(-parseInt(_0xa0e679(0x15b))/0x9)+-parseInt(_0xa0e679(0x155))/0xa*(-parseInt(_0xa0e679(0x157))/0xb);if(_0x450044===_0x3bae7e)break;else _0x322f4a['push'](_0x322f4a['shift']());}catch(_0x164a49){_0x322f4a['push'](_0x322f4a['shift']());}}}(_0x2bb3,0xcc6c8));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';function _0x2bb3(){const _0x1661db=['oUQPN','reply','PIC','dice','3YBvfEI','normal','mp4','获取视频信息失败','CpmsV','catch','2956821ofYwPt','文件异常，大小为0','_0.png','width','lNYSu','Ori','QhgFO','图片信息','ptt','960444GBGPpC','DpVjG','moHhh','tHhdm','join','[骰子]','height','视频信息','获取视频封面失败，使用默认封面','uploadFile','BNTLr','ZJcoj','rps','FACE','jpg','VIDEO','toString','face','file','copyFile','UupGm','REPLY','FILE','video','1443338ZjSrTx','2939205KnkqSW','end','TEXT','urXkn','then','6UXJJun','normal2','jDwwO','ark','2380aboDHe','markdown','178079iNGgUY','MARKDOWN','PTT','size','4027689VpZjbK','hCyTC','1916572yNLzLY','gif','stat','DoxKb','RPS','writeFile','dirname','lerUT','uGPTP','ARK','8URjwJd','DaOSP','[包剪锤]','set','sep','kXNOB','Thumb'];_0x2bb3=function(){return _0x1661db;};return _0x2bb3();}import{promises as _0x3c716a}from'node:fs';import _0x1edfd4 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';export class SendMsgElementConstructor{static['text'](_0x5662b2){const _0x5875ad=_0x8469;return{'elementType':ElementType[_0x5875ad(0x14e)],'elementId':'','textElement':{'content':_0x5662b2,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x3ddd8e,_0x46154f,_0x12abb5,_0x548e21){const _0x2a58c6=_0x8469;return{'elementType':ElementType[_0x2a58c6(0x14e)],'elementId':'','textElement':{'content':'@'+_0x548e21,'atType':_0x12abb5,'atUid':_0x3ddd8e,'atTinyId':'','atNtUid':_0x46154f}};}static[_0x29a2c3(0x16f)](_0x3deb94,_0x28d4ef,_0x495555,_0xc7dd44){const _0x4b600e=_0x29a2c3;return{'elementType':ElementType[_0x4b600e(0x148)],'elementId':'','replyElement':{'replayMsgSeq':_0x3deb94,'replayMsgId':_0x28d4ef,'senderUin':_0x495555,'senderUinStr':_0xc7dd44}};}static async['pic'](_0x47de14,_0x2f4b3b='',_0x38bee2=0x0){const _0x2de8c4=_0x29a2c3,_0x17282f={'AtclC':function(_0xe3d69b,_0x55bc5f){return _0xe3d69b===_0x55bc5f;},'DaOSP':_0x2de8c4(0x12b),'urXkn':function(_0x10075f,_0x321f68){return _0x10075f(_0x321f68);},'moHhh':function(_0x5d65e2,_0x226053,_0x57387b){return _0x5d65e2(_0x226053,_0x57387b);},'ZJcoj':_0x2de8c4(0x131)},{md5:_0x57ad2f,fileName:_0x4949e7,path:_0x299471,fileSize:_0x223605}=await NTQQFileApi[_0x2de8c4(0x13c)](_0x47de14,ElementType[_0x2de8c4(0x170)],_0x38bee2);if(_0x17282f['AtclC'](_0x223605,0x0))throw _0x17282f[_0x2de8c4(0x168)];const _0x5c11ab=await NTQQFileApi['getImageSize'](_0x47de14),_0x563e64={'md5HexStr':_0x57ad2f,'fileSize':_0x223605[_0x2de8c4(0x143)](),'picWidth':_0x5c11ab?.[_0x2de8c4(0x12d)],'picHeight':_0x5c11ab?.['height'],'fileName':_0x4949e7,'sourcePath':_0x299471,'original':!![],'picType':_0x17282f[_0x2de8c4(0x14f)](isGIF,_0x47de14)?PicType[_0x2de8c4(0x15e)]:PicType[_0x2de8c4(0x141)],'picSubType':_0x38bee2,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x2f4b3b};return _0x17282f[_0x2de8c4(0x135)](logDebug,_0x17282f[_0x2de8c4(0x13e)],_0x563e64),{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x563e64};}static async[_0x29a2c3(0x145)](_0x3a4436,_0x5e66bb=''){const _0x338298=_0x29a2c3,_0x1e5843={'eSQNC':function(_0x332615,_0x516721){return _0x332615===_0x516721;},'hCyTC':_0x338298(0x12b)},{md5:_0x1a7a3a,fileName:_0x22a8ed,path:_0x286b48,fileSize:_0x3e76ae}=await NTQQFileApi[_0x338298(0x13c)](_0x3a4436,ElementType[_0x338298(0x149)]);if(_0x1e5843['eSQNC'](_0x3e76ae,0x0))throw _0x1e5843[_0x338298(0x15c)];const _0x59abe7={'elementType':ElementType[_0x338298(0x149)],'elementId':'','fileElement':{'fileName':_0x5e66bb||_0x22a8ed,'filePath':_0x286b48,'fileSize':_0x3e76ae[_0x338298(0x143)]()}};return _0x59abe7;}static async[_0x29a2c3(0x14a)](_0x248e15,_0x5f2de4='',_0x42e67e=''){const _0x1cf5be=_0x29a2c3,_0x8e876f={'lerUT':function(_0x4a0608,_0x1083e8,_0x340d5f){return _0x4a0608(_0x1083e8,_0x340d5f);},'ifZcc':_0x1cf5be(0x13b),'oUQPN':function(_0x417999,_0x18a70c){return _0x417999(_0x18a70c);},'lNYSu':'error','DpVjG':function(_0x4377a3,_0x1b670d){return _0x4377a3+_0x1b670d;},'tHhdm':'end','DoxKb':_0x1cf5be(0x12b),'UupGm':_0x1cf5be(0x126),'kXNOB':_0x1cf5be(0x13a),'hqJlf':function(_0x5460c7,_0x4f57cf){return _0x5460c7(_0x4f57cf);},'BNTLr':function(_0xad1e5e,_0x57f5ee){return _0xad1e5e||_0x57f5ee;},'QhgFO':function(_0x4e4eae,_0x2d80bb){return _0x4e4eae+_0x2d80bb;}},{fileName:_0x5f1325,path:_0x39ff03,fileSize:_0x2d3333,md5:_0x2c3ad4}=await NTQQFileApi[_0x1cf5be(0x13c)](_0x248e15,ElementType[_0x1cf5be(0x142)]);if(_0x2d3333===0x0)throw _0x8e876f[_0x1cf5be(0x160)];const _0x2e5d3f=require('path');let _0x46cf8a=_0x39ff03['replace'](_0x2e5d3f[_0x1cf5be(0x16b)]+_0x1cf5be(0x12f)+_0x2e5d3f['sep'],_0x2e5d3f[_0x1cf5be(0x16b)]+_0x1cf5be(0x16d)+_0x2e5d3f[_0x1cf5be(0x16b)]);_0x46cf8a=_0x2e5d3f[_0x1cf5be(0x163)](_0x46cf8a);let _0x534019={'width':0x780,'height':0x438,'time':0xf,'format':_0x8e876f[_0x1cf5be(0x147)],'size':_0x2d3333,'filePath':_0x248e15};try{_0x534019=await getVideoInfo(_0x39ff03),_0x8e876f[_0x1cf5be(0x164)](logDebug,_0x8e876f[_0x1cf5be(0x16c)],_0x534019);}catch(_0x56e08b){_0x8e876f[_0x1cf5be(0x164)](logError,_0x1cf5be(0x127),_0x56e08b);}const _0x243acb=new Promise((_0x3e6767,_0x445fc4)=>{const _0x4ba9f6=_0x1cf5be,_0x5c520c=_0x2c3ad4+_0x4ba9f6(0x12c),_0x5adffe=_0x2e5d3f[_0x4ba9f6(0x137)](_0x46cf8a,_0x5c520c);_0x8e876f[_0x4ba9f6(0x16e)](_0x1edfd4,_0x248e15)['on'](_0x4ba9f6(0x14d),()=>{})['on'](_0x8e876f[_0x4ba9f6(0x12e)],_0x4aa3b0=>{const _0x3763d8=_0x4ba9f6,_0x3ee1ad={'NdhTD':function(_0xaa60af,_0x55d569){return _0xaa60af(_0x55d569);}};_0x8e876f[_0x3763d8(0x164)](logDebug,_0x8e876f['ifZcc'],_0x4aa3b0),_0x42e67e?_0x3c716a[_0x3763d8(0x146)](_0x42e67e,_0x5adffe)['then'](()=>{_0x3ee1ad['NdhTD'](_0x3e6767,_0x5adffe);})[_0x3763d8(0x129)](_0x445fc4):_0x3c716a[_0x3763d8(0x162)](_0x5adffe,defaultVideoThumb)['then'](()=>{_0x3e6767(_0x5adffe);})['catch'](_0x445fc4);})['screenshots']({'timestamps':[0x0],'filename':_0x5c520c,'folder':_0x46cf8a,'size':_0x8e876f[_0x4ba9f6(0x134)](_0x8e876f['DpVjG'](_0x534019[_0x4ba9f6(0x12d)],'x'),_0x534019[_0x4ba9f6(0x139)])})['on'](_0x8e876f[_0x4ba9f6(0x136)],()=>{const _0x1d6ba2=_0x4ba9f6;_0x8e876f[_0x1d6ba2(0x16e)](_0x3e6767,_0x5adffe);});}),_0x4cd2d6=new Map(),_0x205f6d=await _0x243acb,_0x255b83=(await _0x3c716a[_0x1cf5be(0x15f)](_0x205f6d))[_0x1cf5be(0x15a)];_0x4cd2d6[_0x1cf5be(0x16a)](0x0,_0x205f6d);const _0x29727e=await _0x8e876f['hqJlf'](calculateFileMD5,_0x205f6d),_0x3c0c18={'elementType':ElementType[_0x1cf5be(0x142)],'elementId':'','videoElement':{'fileName':_0x8e876f[_0x1cf5be(0x13d)](_0x5f2de4,_0x5f1325),'filePath':_0x39ff03,'videoMd5':_0x2c3ad4,'thumbMd5':_0x29727e,'fileTime':_0x534019['time'],'thumbPath':_0x4cd2d6,'thumbSize':_0x255b83,'thumbWidth':_0x534019[_0x1cf5be(0x12d)],'thumbHeight':_0x534019['height'],'fileSize':_0x8e876f[_0x1cf5be(0x130)]('',_0x2d3333)}};return _0x3c0c18;}static async[_0x29a2c3(0x132)](_0x41f746){const _0x4ecfe3=_0x29a2c3,_0x1d3aa0={'CpmsV':function(_0x2c7048,_0x36fdb1){return _0x2c7048(_0x36fdb1);},'TFgJW':function(_0x187d51,_0x303e1b){return _0x187d51===_0x303e1b;},'uGPTP':_0x4ecfe3(0x12b),'jDwwO':function(_0xa62fdd,_0x2eb1b3){return _0xa62fdd||_0x2eb1b3;}},{converted:_0x2b11d4,path:_0x370d2f,duration:_0x8ed087}=await _0x1d3aa0[_0x4ecfe3(0x128)](encodeSilk,_0x41f746),{md5:_0x1616fe,fileName:_0x1e3cbb,path:_0x591011,fileSize:_0x3d397b}=await NTQQFileApi[_0x4ecfe3(0x13c)](_0x370d2f,ElementType[_0x4ecfe3(0x159)]);if(_0x1d3aa0['TFgJW'](_0x3d397b,0x0))throw _0x1d3aa0[_0x4ecfe3(0x165)];return _0x2b11d4&&_0x3c716a['unlink'](_0x370d2f)[_0x4ecfe3(0x150)](),{'elementType':ElementType[_0x4ecfe3(0x159)],'elementId':'','pttElement':{'fileName':_0x1e3cbb,'filePath':_0x591011,'md5HexStr':_0x1616fe,'fileSize':_0x3d397b,'duration':_0x1d3aa0[_0x4ecfe3(0x153)](_0x8ed087,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x29a2c3(0x144)](_0x4f9148){const _0x1b039a=_0x29a2c3;return{'elementType':ElementType[_0x1b039a(0x140)],'elementId':'','faceElement':{'faceIndex':_0x4f9148,'faceType':_0x4f9148<0xde?FaceType[_0x1b039a(0x125)]:FaceType[_0x1b039a(0x152)]}};}static[_0x29a2c3(0x123)](_0x20ba37){const _0x3c2b5e=_0x29a2c3,_0x12809c={'YFsPg':_0x3c2b5e(0x138)};return{'elementType':ElementType[_0x3c2b5e(0x140)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x3c2b5e(0x123)],'faceType':FaceType[_0x3c2b5e(0x123)],'faceText':_0x12809c['YFsPg'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x29a2c3(0x13f)](_0x1a038b){const _0x38709e=_0x29a2c3;return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x38709e(0x161)],'faceText':_0x38709e(0x169),'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x29a2c3(0x154)](_0x18a8c5){const _0x261373=_0x29a2c3;return{'elementType':ElementType[_0x261373(0x166)],'elementId':'','arkElement':{'bytesData':_0x18a8c5,'linkInfo':null,'subElementType':null}};}static[_0x29a2c3(0x156)](_0xc46065){const _0x5e60d5=_0x29a2c3;return{'elementType':ElementType[_0x5e60d5(0x158)],'elementId':'','markdownElement':{'content':_0xc46065}};}}