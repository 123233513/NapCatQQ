const _0x96fad1=_0x2177;(function(_0x1a0c75,_0x184716){const _0x21838f=_0x2177,_0x3ccf9d=_0x1a0c75();while(!![]){try{const _0x548628=-parseInt(_0x21838f(0x1ce))/0x1+parseInt(_0x21838f(0x170))/0x2*(-parseInt(_0x21838f(0x187))/0x3)+parseInt(_0x21838f(0x1dd))/0x4*(-parseInt(_0x21838f(0x199))/0x5)+-parseInt(_0x21838f(0x152))/0x6+parseInt(_0x21838f(0x1bd))/0x7+parseInt(_0x21838f(0x1b6))/0x8+parseInt(_0x21838f(0x184))/0x9;if(_0x548628===_0x184716)break;else _0x3ccf9d['push'](_0x3ccf9d['shift']());}catch(_0x2261d9){_0x3ccf9d['push'](_0x3ccf9d['shift']());}}}(_0x2978,0xc068b));function _0x2978(){const _0x552bb8=['2luyLFu','oZQWc','DCwAz','Urzss','SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs','db\x20could\x20not\x20add\x20file','delete','updateMsg\x20db\x20error','msgList',',\x20seq:\x20','WNQbF','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?','echCu','uuid','kcSNk','db\x20getMsgByLongId\x20error','Could\x20not\x20create\x20table\x20temp_uins','fbast','has','FkoiR','26278830ylDIKF','get','yTUxQ','1145067GGFFZY','longId','set','forEach','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','数据库中消息最大短id','uid','getMsgBySeq','oXeFS','catch','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?','all','OPEN_READWRITE','then','eMWvJ','url','aIpxg','chatType','25IbGoUL','peerUid','elementId','tSJbN','gDMTy','db\x20could\x20not\x20get\x20file\x20cache','Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','name','shortId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','Database','SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?','GYDGv','tnnTO','msgSeq','stack','OkwRp','Could\x20not\x20create\x20table\x20msgs','updateMsg','pHrmi','toString','msgId','db\x20could\x20not\x20update\x20file\x20cache','qMnoJ','aCoYC','getMsg','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?','addTempUin','getMsgByLongId','4633024yMsKOv','msgCache','HbaSb','lZCMZ','assign','nxffa','UHQsH','906913piqZjm','bdscE','记录消息到数据库,\x20消息长id:\x20','MvCIq','now','更新消息,\x20shortId:','INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','pIuzO','close',',\x20短id:\x20','aNhAD','getFileCacheByName','XKOWZ','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','jlvyb','OYdgR','updateFileCache','1326964zQwuHW','kQMBd','getCurrentMaxShortId','jkNBA','init','getFileCacheByUuid','getUidByTempUin','YLDPG','cifbW','getMsgsByMsgId','ATTXQ','addMsg','element','path','oZPTe','657776PGddks','voehp','elementType','CvJpJ','wEchR','db\x20could\x20not\x20get\x20temp\x20uin\x20map','bdpWy','CTutd','AOetC','Could\x20not\x20create\x20table\x20files','清理消息缓存','1857462yINAII','frBwt','DFwfL','createTable','prepare','xXYnY','getMsgByShortId','db\x20could\x20not\x20add\x20temp\x20uin','db\x20could\x20not\x20add\x20msg','GenST','lOUta','aLmfV','vPVHx','xdRWd','SELECT\x20*\x20FROM\x20temp_uins','TNRYA','run','stringify','uin','WrRkI','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','Could\x20not\x20get\x20msg','getFileCache','getReceivedTempUinMap','msgTime','xQzsS','VLGfR','qSCqV','maxId','size'];_0x2978=function(){return _0x552bb8;};return _0x2978();}function _0x2177(_0x36f219,_0x5efbe3){const _0x2978ec=_0x2978();return _0x2177=function(_0x2177a9,_0x30111d){_0x2177a9=_0x2177a9-0x149;let _0x3cf4d3=_0x2978ec[_0x2177a9];return _0x3cf4d3;},_0x2177(_0x36f219,_0x5efbe3);}import _0x2abe1b from'sqlite3';import{logDebug,logError}from'@/common/utils/log';import{NTQQMsgApi}from'@/core';class DBUtilBase{['db'];async[_0x96fad1(0x1d2)](_0x44cdd4){const _0x4883ed={'KMylo':function(_0x2dc51f,_0xce554d,_0x3a4611){return _0x2dc51f(_0xce554d,_0x3a4611);},'gsxqC':'Could\x20not\x20connect\x20to\x20database','bdscE':function(_0x24f645,_0x3d7519){return _0x24f645(_0x3d7519);},'WNQbF':function(_0x48739b){return _0x48739b();},'echCu':function(_0x3bafff,_0x3bd813){return _0x3bafff|_0x3bd813;}};if(this['db'])return;return new Promise((_0x434bdb,_0x2ae8fb)=>{const _0x420712=_0x2177,_0x482ef1={'Urzss':function(_0x2d2056,_0x44bcb3,_0x1641e0){return _0x4883ed['KMylo'](_0x2d2056,_0x44bcb3,_0x1641e0);},'WiIHF':_0x4883ed['gsxqC'],'aIpxg':function(_0x86df7c,_0xe64d03){const _0x1a4b59=_0x2177;return _0x4883ed[_0x1a4b59(0x1be)](_0x86df7c,_0xe64d03);},'YLDPG':function(_0x810c92){const _0x254772=_0x2177;return _0x4883ed[_0x254772(0x17a)](_0x810c92);}};this['db']=new _0x2abe1b[(_0x420712(0x1a3))](_0x44cdd4,_0x4883ed[_0x420712(0x17c)](_0x2abe1b[_0x420712(0x193)],_0x2abe1b['OPEN_CREATE']),_0x12c1af=>{const _0x50a82a=_0x420712;if(_0x12c1af){_0x482ef1[_0x50a82a(0x173)](logError,_0x482ef1['WiIHF'],_0x12c1af),_0x482ef1[_0x50a82a(0x197)](_0x2ae8fb,_0x12c1af);return;}this[_0x50a82a(0x155)](),_0x482ef1[_0x50a82a(0x1d5)](_0x434bdb);});});}[_0x96fad1(0x155)](){const _0x145fde=_0x96fad1,_0x49a551={'frBwt':'Method\x20not\x20implemented.'};throw new Error(_0x49a551[_0x145fde(0x153)]);}['close'](){const _0x1506da=_0x96fad1;this['db']?.[_0x1506da(0x1c5)]();}}class DBUtil extends DBUtilBase{[_0x96fad1(0x1b7)]=new Map();['globalMsgShortId']=-0x7ffffff8;constructor(){const _0x3aee2f=_0x96fad1,_0x2769d2={'OkwRp':function(_0x389031,_0x597247){return _0x389031>_0x597247;},'oXeFS':function(_0x40d9d1,_0x29b182){return _0x40d9d1-_0x29b182;},'aNhAD':function(_0x41beb3,_0x350eff){return _0x41beb3*_0x350eff;},'TkiKR':function(_0x465795,_0x48d977){return _0x465795(_0x48d977);},'fbast':function(_0x45a698,_0x169f14){return _0x45a698*_0x169f14;}};super();const _0x48258c=_0x2769d2[_0x3aee2f(0x181)](_0x2769d2[_0x3aee2f(0x181)](0x3e8,0x3c),0xa);setInterval(()=>{const _0x1d9456=_0x3aee2f,_0x385fbf={'MvCIq':function(_0x1df6d1,_0x1f79e5){const _0x55a26a=_0x2177;return _0x2769d2[_0x55a26a(0x1a9)](_0x1df6d1,_0x1f79e5);},'nxffa':function(_0x2326a7,_0x132388){const _0x1d8dc5=_0x2177;return _0x2769d2[_0x1d8dc5(0x18f)](_0x2326a7,_0x132388);},'cMKVR':function(_0xb751c,_0x40ea9b){const _0x533bc8=_0x2177;return _0x2769d2[_0x533bc8(0x1c7)](_0xb751c,_0x40ea9b);},'voehp':function(_0x2cce09,_0x104d07){return _0x2cce09(_0x104d07);}};_0x2769d2['TkiKR'](logDebug,_0x1d9456(0x151)),this[_0x1d9456(0x1b7)][_0x1d9456(0x18a)]((_0x16f42e,_0x41a868)=>{const _0x4072c4=_0x1d9456;_0x385fbf[_0x4072c4(0x1c0)](_0x385fbf[_0x4072c4(0x1bb)](Date[_0x4072c4(0x1c1)](),_0x385fbf['cMKVR'](_0x385fbf[_0x4072c4(0x1de)](parseInt,_0x16f42e[_0x4072c4(0x16a)]),0x3e8)),_0x48258c)&&this['msgCache'][_0x4072c4(0x176)](_0x41a868);});},_0x48258c);}async[_0x96fad1(0x1d2)](_0x33d767){await super['init'](_0x33d767),this['globalMsgShortId']=await this['getCurrentMaxShortId']();}['createTable'](){const _0x2c9ffb=_0x96fad1,_0x3afe08={'tSJbN':_0x2c9ffb(0x1aa),'LcxMG':_0x2c9ffb(0x150),'VPzAU':function(_0x4a2d3f,_0x59fa97,_0x7bc500){return _0x4a2d3f(_0x59fa97,_0x7bc500);}},_0x17f60f=_0x2c9ffb(0x1a2);this['db'][_0x2c9ffb(0x162)](_0x17f60f,function(_0x430c4b){const _0x2b85fe=_0x2c9ffb;_0x430c4b&&logError(_0x3afe08[_0x2b85fe(0x19c)],_0x430c4b[_0x2b85fe(0x1a8)]);});const _0x9de920=_0x2c9ffb(0x18b);this['db'][_0x2c9ffb(0x162)](_0x9de920,function(_0x2694e5){_0x2694e5&&logError(_0x3afe08['LcxMG'],_0x2694e5);});const _0xaa0c7e=_0x2c9ffb(0x166);this['db']['run'](_0xaa0c7e,function(_0x38829b){const _0x1403c2=_0x2c9ffb;_0x38829b&&_0x3afe08['VPzAU'](logError,_0x1403c2(0x180),_0x38829b);});}async[_0x96fad1(0x1d0)](){const _0x34d0c6=_0x96fad1,_0x1a3d1b={'TNRYA':function(_0x1e9d35,_0x909b1e,_0xbe24df){return _0x1e9d35(_0x909b1e,_0xbe24df);},'reiCS':_0x34d0c6(0x18c),'xdRWd':function(_0x4e8e15,_0x2c8295){return _0x4e8e15(_0x2c8295);},'HbaSb':_0x34d0c6(0x174)};return new Promise((_0x583ba3,_0x30da59)=>{const _0x4bf9f4=_0x34d0c6;this['db'][_0x4bf9f4(0x185)](_0x1a3d1b[_0x4bf9f4(0x1b8)],(_0x25aa8a,_0xc03f34)=>{const _0x113206=_0x4bf9f4;if(_0x25aa8a)return logDebug(_0x113206(0x19f),_0x25aa8a),_0x583ba3(-0x7ffffff8);_0x1a3d1b[_0x113206(0x161)](logDebug,_0x1a3d1b['reiCS'],_0xc03f34?.[_0x113206(0x16e)]),_0x1a3d1b[_0x113206(0x15f)](_0x583ba3,_0xc03f34?.[_0x113206(0x16e)]??-0x7ffffff8);});});}async['getMsg'](_0x323024,_0x55ca4a){const _0x2ff8f6=_0x96fad1,_0x24e5e5={'mSZqg':function(_0x443a0d,_0x5746a7){return _0x443a0d(_0x5746a7);},'OYdgR':_0x2ff8f6(0x167),'qSCqV':function(_0x40429a,_0x2957a9){return _0x40429a(_0x2957a9);},'cifbW':function(_0x5b3651,_0x372e26){return _0x5b3651(_0x372e26);}},_0xa05beb=this['db']['prepare'](_0x323024);return new Promise((_0x4562ac,_0x3fdb4c)=>{const _0x2f4bb0=_0x2ff8f6,_0x5f26c8={'SDanB':function(_0x5545bf,_0x5453de){const _0xa595c4=_0x2177;return _0x24e5e5[_0xa595c4(0x1d6)](_0x5545bf,_0x5453de);}};_0xa05beb[_0x2f4bb0(0x185)](..._0x55ca4a,(_0x2434e0,_0x14b5c6)=>{const _0x392efb=_0x2f4bb0,_0x29adaa={'XKOWZ':function(_0x7031a1,_0x31ca4f){return _0x24e5e5['mSZqg'](_0x7031a1,_0x31ca4f);}};if(_0x2434e0)return logError(_0x24e5e5[_0x392efb(0x1cc)],_0x2434e0,_0x323024,_0x55ca4a),_0x24e5e5[_0x392efb(0x16d)](_0x4562ac,null);if(!_0x14b5c6){_0x24e5e5['mSZqg'](_0x4562ac,null);return;}const _0x5070da=_0x14b5c6[_0x392efb(0x188)];NTQQMsgApi[_0x392efb(0x1d7)]({'peerUid':_0x14b5c6[_0x392efb(0x19a)],'chatType':_0x14b5c6[_0x392efb(0x198)]},[_0x5070da])[_0x392efb(0x194)](_0x383563=>{const _0x434aed=_0x392efb,_0x160c39=_0x383563[_0x434aed(0x178)][0x0];if(!_0x160c39){_0x29adaa[_0x434aed(0x1c9)](_0x4562ac,null);return;}_0x160c39['id']=_0x14b5c6[_0x434aed(0x1a1)],_0x4562ac(_0x160c39);})['catch'](_0x175670=>{_0x5f26c8['SDanB'](_0x4562ac,null);});});});}async[_0x96fad1(0x158)](_0x363d2b){const _0x3b7b9a=_0x96fad1;if(this[_0x3b7b9a(0x1b7)][_0x3b7b9a(0x182)](_0x363d2b))return this[_0x3b7b9a(0x1b7)][_0x3b7b9a(0x185)](_0x363d2b);const _0x2201f2=_0x3b7b9a(0x17b);return this[_0x3b7b9a(0x1b2)](_0x2201f2,[_0x363d2b]);}async[_0x96fad1(0x1b5)](_0x37a120){const _0x85e428=_0x96fad1,_0x460c29={'pIuzO':_0x85e428(0x191)};if(this[_0x85e428(0x1b7)][_0x85e428(0x182)](_0x37a120))return this[_0x85e428(0x1b7)][_0x85e428(0x185)](_0x37a120);return this[_0x85e428(0x1b2)](_0x460c29[_0x85e428(0x1c4)],[_0x37a120]);}async[_0x96fad1(0x18e)](_0x23aa38,_0x465763){const _0x4e5be7=_0x96fad1,_0x3fd77b={'gDMTy':_0x4e5be7(0x1b3)},_0x2e1112=_0x3fd77b[_0x4e5be7(0x19d)];return this[_0x4e5be7(0x1b2)](_0x2e1112,[_0x23aa38,_0x465763]);}async[_0x96fad1(0x1d9)](_0x596ab8,_0x38430f=!![]){const _0x49af4f=_0x96fad1,_0x556d4d={'GenST':function(_0xc791ab,_0x4365aa,_0x5b84c4){return _0xc791ab(_0x4365aa,_0x5b84c4);},'DCwAz':function(_0x214493,_0x49c2b4){return _0x214493===_0x49c2b4;},'FkoiR':_0x49af4f(0x15a),'CTutd':_0x49af4f(0x1ca),'jkNBA':function(_0x1f13c4,_0x105157){return _0x1f13c4(_0x105157);}},_0x584053=await this['getMsgByLongId'](_0x596ab8['msgId']);if(_0x584053){if(_0x38430f)this[_0x49af4f(0x1ab)](_0x596ab8)[_0x49af4f(0x194)]();return _0x584053['id'];}const _0x51250f=this['db'][_0x49af4f(0x156)](_0x556d4d[_0x49af4f(0x14e)]),_0xc69729=++this['globalMsgShortId'];return _0x596ab8['id']=_0xc69729,_0x556d4d[_0x49af4f(0x1d1)](logDebug,_0x49af4f(0x1bf)+_0x596ab8[_0x49af4f(0x1ae)]+_0x49af4f(0x1c6)+_0x596ab8['id']),this['msgCache'][_0x49af4f(0x189)](_0xc69729,_0x596ab8),this['msgCache'][_0x49af4f(0x189)](_0x596ab8['msgId'],_0x596ab8),_0x51250f[_0x49af4f(0x162)](this['globalMsgShortId'],_0x596ab8['msgId'],_0x596ab8['msgSeq'][_0x49af4f(0x1ad)](),_0x596ab8['peerUid'],_0x596ab8[_0x49af4f(0x198)],_0x48eaf0=>{const _0x379267=_0x49af4f;_0x48eaf0&&(_0x556d4d[_0x379267(0x172)](_0x48eaf0['errno'],0x13)?this[_0x379267(0x1b5)](_0x596ab8['msgId'])['then'](_0x5ed8a0=>{const _0x1ffe36=_0x379267;_0x5ed8a0?(this[_0x1ffe36(0x1b7)][_0x1ffe36(0x189)](_0xc69729,_0x5ed8a0),this[_0x1ffe36(0x1b7)][_0x1ffe36(0x189)](_0x5ed8a0[_0x1ffe36(0x1ae)],_0x5ed8a0)):_0x556d4d[_0x1ffe36(0x15b)](logError,'db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id',_0x48eaf0);})[_0x379267(0x190)](_0x170fdd=>logError(_0x379267(0x17f),_0x170fdd)):_0x556d4d[_0x379267(0x15b)](logError,_0x556d4d[_0x379267(0x183)],_0x48eaf0));}),_0xc69729;}async[_0x96fad1(0x1ab)](_0x305e93){const _0x268f72=_0x96fad1,_0xee907={'rJzRG':function(_0x195d3d,_0x5c2543,_0x23fca9){return _0x195d3d(_0x5c2543,_0x23fca9);},'AOetC':_0x268f72(0x177),'fYTTC':function(_0x433fe1,_0x477734){return _0x433fe1(_0x477734);},'jlvyb':'UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?'},_0x116a1e=this[_0x268f72(0x1b7)][_0x268f72(0x185)](_0x305e93[_0x268f72(0x1ae)]);_0x116a1e&&Object[_0x268f72(0x1ba)](_0x116a1e,_0x305e93);_0xee907['fYTTC'](logDebug,_0x268f72(0x1c2)+_0x305e93['id']+_0x268f72(0x179)+_0x305e93[_0x268f72(0x1a7)]+',\x20msgId:\x20'+_0x305e93[_0x268f72(0x1ae)]);const _0x2bebba=this['db'][_0x268f72(0x156)](_0xee907[_0x268f72(0x1cb)]);_0x2bebba['run'](_0x305e93[_0x268f72(0x1a7)],_0x305e93[_0x268f72(0x1ae)],_0x135656=>{const _0xea3977=_0x268f72;_0x135656&&_0xee907['rJzRG'](logError,_0xee907[_0xea3977(0x14f)],_0x135656);});}async['addFileCache'](_0x250b6e){const _0x5d2c05=_0x96fad1,_0x173aa1={'GmOeP':function(_0x406970,_0x10f7c3,_0x12e240){return _0x406970(_0x10f7c3,_0x12e240);},'vPVHx':_0x5d2c05(0x175),'wEchR':function(_0x249344,_0x54cf88){return _0x249344(_0x54cf88);}},_0x509b20=this['db']['prepare'](_0x5d2c05(0x1c3));return new Promise((_0x52ba96,_0x4711e4)=>{const _0x5a17a6=_0x5d2c05;_0x509b20[_0x5a17a6(0x162)](_0x250b6e[_0x5a17a6(0x1a0)],_0x250b6e[_0x5a17a6(0x1db)],_0x250b6e[_0x5a17a6(0x196)],_0x250b6e[_0x5a17a6(0x16f)],_0x250b6e['uuid'],_0x250b6e[_0x5a17a6(0x149)],JSON[_0x5a17a6(0x163)](_0x250b6e[_0x5a17a6(0x1da)]),_0x250b6e[_0x5a17a6(0x19b)],_0x250b6e['msgId'],function(_0x248208){const _0x41cbd0=_0x5a17a6;_0x248208&&(_0x173aa1['GmOeP'](logError,_0x173aa1[_0x41cbd0(0x15e)],_0x248208),_0x173aa1[_0x41cbd0(0x14b)](_0x4711e4,_0x248208)),_0x173aa1[_0x41cbd0(0x14b)](_0x52ba96,null);});});}async['getFileCache'](_0x3473ef,_0x477afa){const _0x27fe00=_0x96fad1,_0x279184={'kcSNk':function(_0x341d53,_0xf1f25e,_0x15738e){return _0x341d53(_0xf1f25e,_0x15738e);},'xXYnY':_0x27fe00(0x19e),'cNvMb':function(_0x4e3be7,_0x230ecc){return _0x4e3be7(_0x230ecc);}},_0x885366=this['db']['prepare'](_0x3473ef);return new Promise((_0x16dde7,_0xbd0a34)=>{const _0x25e766=_0x27fe00,_0x2db187={'UHQsH':function(_0x304dfa,_0x42b657,_0x39f6f7){const _0x1a4927=_0x2177;return _0x279184[_0x1a4927(0x17e)](_0x304dfa,_0x42b657,_0x39f6f7);},'lZCMZ':_0x279184[_0x25e766(0x157)],'kQMBd':function(_0x3d8da6,_0x75f225){return _0x279184['cNvMb'](_0x3d8da6,_0x75f225);}};_0x885366['get'](..._0x477afa,(_0x2cfaa7,_0x2d765d)=>{const _0x20516d=_0x25e766;_0x2cfaa7&&(_0x2db187[_0x20516d(0x1bc)](logError,_0x2db187[_0x20516d(0x1b9)],_0x2cfaa7),_0x2db187['kQMBd'](_0xbd0a34,_0x2cfaa7)),_0x2d765d&&(_0x2d765d['element']=JSON['parse'](_0x2d765d[_0x20516d(0x1da)])),_0x2db187[_0x20516d(0x1cf)](_0x16dde7,_0x2d765d);});});}async[_0x96fad1(0x1c8)](_0x1470f5){const _0x212cd0=_0x96fad1;return this[_0x212cd0(0x168)](_0x212cd0(0x1a4),[_0x1470f5]);}async[_0x96fad1(0x1d3)](_0x5011c8){const _0x3cab01=_0x96fad1;return this[_0x3cab01(0x168)]('SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?',[_0x5011c8]);}async[_0x96fad1(0x1cd)](_0x624c58){const _0x50da4d=_0x96fad1,_0xd63bfb={'lOUta':function(_0x4148c5,_0x301744,_0x4d4413){return _0x4148c5(_0x301744,_0x4d4413);},'ATTXQ':_0x50da4d(0x1af),'fkPTP':function(_0x4bd826,_0x388460){return _0x4bd826(_0x388460);},'VLGfR':function(_0x2008d3,_0x161285){return _0x2008d3(_0x161285);}},_0x369057=this['db'][_0x50da4d(0x156)]('UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?');return new Promise((_0xe4742b,_0x25ece3)=>{const _0x5d60a3=_0x50da4d;_0x369057['run'](_0x624c58['path'],_0x624c58['url'],_0x624c58[_0x5d60a3(0x17d)],function(_0x3f7305){const _0x3673c9=_0x5d60a3;_0x3f7305&&(_0xd63bfb[_0x3673c9(0x15c)](logError,_0xd63bfb[_0x3673c9(0x1d8)],_0x3f7305),_0xd63bfb['fkPTP'](_0x25ece3,_0x3f7305)),_0xd63bfb[_0x3673c9(0x16c)](_0xe4742b,null);});});}async[_0x96fad1(0x169)](){const _0x35f455=_0x96fad1,_0x20e409={'yTUxQ':function(_0x559cc1,_0x50137c,_0x4e2402){return _0x559cc1(_0x50137c,_0x4e2402);},'DFwfL':function(_0x29ed94,_0x1be72c){return _0x29ed94(_0x1be72c);},'WrRkI':_0x35f455(0x160)},_0x66837c=_0x20e409[_0x35f455(0x165)];return new Promise((_0x168c92,_0xc99f70)=>{const _0x4920ae=_0x35f455,_0x3b255e={'oZQWc':function(_0x5868e7,_0x992d82,_0x46d80c){const _0xfc1894=_0x2177;return _0x20e409[_0xfc1894(0x186)](_0x5868e7,_0x992d82,_0x46d80c);},'GYDGv':function(_0x23099c,_0x4069bd){const _0x140800=_0x2177;return _0x20e409[_0x140800(0x154)](_0x23099c,_0x4069bd);}};this['db'][_0x4920ae(0x192)](_0x66837c,(_0x4798d4,_0x23a032)=>{const _0x39bb89=_0x4920ae;_0x4798d4&&(_0x3b255e[_0x39bb89(0x171)](logError,_0x39bb89(0x14c),_0x4798d4),_0x3b255e['GYDGv'](_0xc99f70,_0x4798d4));const _0x23e17e={};_0x23a032['forEach'](_0x4db3b3=>{const _0x12d4bf=_0x39bb89;_0x23e17e[_0x4db3b3[_0x12d4bf(0x164)]]=_0x4db3b3[_0x12d4bf(0x18d)];}),_0x3b255e[_0x39bb89(0x1a5)](_0x168c92,_0x23e17e);});});}async[_0x96fad1(0x1d4)](_0xf17617){const _0x378690=_0x96fad1,_0x10d385={'aCoYC':function(_0x200e85,_0x555271,_0x45baba){return _0x200e85(_0x555271,_0x45baba);},'UHGeN':_0x378690(0x14c),'CvJpJ':function(_0x22db90,_0xf18bbd){return _0x22db90(_0xf18bbd);},'pHrmi':'SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?'},_0xd8e31a=_0x10d385[_0x378690(0x1ac)];return new Promise((_0x315451,_0x56092a)=>{const _0x2232cd=_0x378690,_0x37fedc={'aLmfV':function(_0x3b62ad,_0x54282b,_0x1764df){const _0x48aab7=_0x2177;return _0x10d385[_0x48aab7(0x1b1)](_0x3b62ad,_0x54282b,_0x1764df);},'brUWg':_0x10d385['UHGeN'],'oZPTe':function(_0x3b9db7,_0x4b5cdc){const _0x49f76d=_0x2177;return _0x10d385[_0x49f76d(0x14a)](_0x3b9db7,_0x4b5cdc);}};this['db'][_0x2232cd(0x185)](_0xd8e31a,[_0xf17617],(_0x5f700,_0x83efb5)=>{const _0x5e1f71=_0x2232cd;_0x5f700&&(_0x37fedc[_0x5e1f71(0x15d)](logError,_0x37fedc['brUWg'],_0x5f700),_0x37fedc[_0x5e1f71(0x1dc)](_0x56092a,_0x5f700)),_0x315451(_0x83efb5?.[_0x5e1f71(0x18d)]);});});}async[_0x96fad1(0x1b4)](_0x1ad266,_0x653a8a){const _0x2885bf=_0x96fad1,_0x581a19={'eMWvJ':function(_0x5f429e,_0xa75950,_0x333423){return _0x5f429e(_0xa75950,_0x333423);},'qMnoJ':_0x2885bf(0x159),'ZzrTR':function(_0x31e7e6,_0x40033b){return _0x31e7e6(_0x40033b);},'eFHkN':'INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)'},_0x230f11=await this['getUidByTempUin'](_0x1ad266);if(!_0x230f11){const _0xd477d6=this['db']['prepare'](_0x581a19['eFHkN']);return new Promise((_0x4152bb,_0x1812f0)=>{const _0x110976=_0x2885bf,_0x2a9255={'xQzsS':function(_0x1363ab,_0x1a1e62,_0xeb3bba){const _0x2445a2=_0x2177;return _0x581a19[_0x2445a2(0x195)](_0x1363ab,_0x1a1e62,_0xeb3bba);},'tnnTO':_0x581a19[_0x110976(0x1b0)],'bdpWy':function(_0x11498c,_0x24a931){return _0x581a19['ZzrTR'](_0x11498c,_0x24a931);}};_0xd477d6[_0x110976(0x162)](_0x1ad266,_0x653a8a,function(_0xecccf3){const _0x39dae2=_0x110976;_0xecccf3&&(_0x2a9255[_0x39dae2(0x16b)](logError,_0x2a9255[_0x39dae2(0x1a6)],_0xecccf3),_0x1812f0(_0xecccf3)),_0x2a9255[_0x39dae2(0x14d)](_0x4152bb,null);});});}}}export const dbUtil=new DBUtil();