const _0x2f482f=_0x2624;(function(_0x1062b3,_0x340baf){const _0x121ea4=_0x2624,_0x2916c1=_0x1062b3();while(!![]){try{const _0x16ba65=parseInt(_0x121ea4(0xdb))/0x1*(-parseInt(_0x121ea4(0x105))/0x2)+-parseInt(_0x121ea4(0x9e))/0x3*(-parseInt(_0x121ea4(0xe8))/0x4)+parseInt(_0x121ea4(0xb6))/0x5*(-parseInt(_0x121ea4(0xd0))/0x6)+-parseInt(_0x121ea4(0xe9))/0x7*(parseInt(_0x121ea4(0x99))/0x8)+parseInt(_0x121ea4(0x90))/0x9*(parseInt(_0x121ea4(0xf5))/0xa)+-parseInt(_0x121ea4(0xa4))/0xb+-parseInt(_0x121ea4(0xba))/0xc*(-parseInt(_0x121ea4(0xbb))/0xd);if(_0x16ba65===_0x340baf)break;else _0x2916c1['push'](_0x2916c1['shift']());}catch(_0x64a9dd){_0x2916c1['push'](_0x2916c1['shift']());}}}(_0x5903,0xdace8));import _0x401680 from'sqlite3';import{logDebug,logError}from'@/common/utils/log';import{NTQQMsgApi}from'@/core';function _0x2624(_0xef4ddb,_0x199b52){const _0x5903f8=_0x5903();return _0x2624=function(_0x2624ad,_0x21b6ac){_0x2624ad=_0x2624ad-0x8f;let _0x32d05e=_0x5903f8[_0x2624ad];return _0x32d05e;},_0x2624(_0xef4ddb,_0x199b52);}class DBUtilBase{['db'];async['init'](_0x5bc0b4){const _0x315020={'QDkiT':function(_0x5d9eea,_0xeba3f0){return _0x5d9eea(_0xeba3f0);},'yQiSG':function(_0x26720d){return _0x26720d();}};if(this['db'])return;return new Promise((_0x494d06,_0x164b4e)=>{const _0x1a3913=_0x2624,_0x55c498={'fRDKh':function(_0x297e83,_0x3ce32b){const _0x4bb567=_0x2624;return _0x315020[_0x4bb567(0xeb)](_0x297e83,_0x3ce32b);},'rxTLq':function(_0x42c8b3){const _0x583b45=_0x2624;return _0x315020[_0x583b45(0x100)](_0x42c8b3);}};this['db']=new _0x401680[(_0x1a3913(0xec))](_0x5bc0b4,_0x401680['OPEN_READWRITE']|_0x401680[_0x1a3913(0x10f)],_0x1a79b7=>{const _0x2ce8c3=_0x1a3913;if(_0x1a79b7){logError(_0x2ce8c3(0x123),_0x1a79b7),_0x55c498[_0x2ce8c3(0x10c)](_0x164b4e,_0x1a79b7);return;}this[_0x2ce8c3(0x118)](),_0x55c498[_0x2ce8c3(0xd9)](_0x494d06);});});}[_0x2f482f(0x118)](){throw new Error('Method\x20not\x20implemented.');}[_0x2f482f(0xf3)](){this['db']?.['close']();}}class DBUtil extends DBUtilBase{[_0x2f482f(0x104)]=new Map();['globalMsgShortId']=-0x7ffffff8;constructor(){const _0x3f1847=_0x2f482f,_0x39ede0={'OoSYV':function(_0x3eef39,_0x899be2){return _0x3eef39*_0x899be2;},'ZcUIZ':'清理消息缓存'};super();const _0x1ee398=_0x39ede0[_0x3f1847(0xe2)](0x3e8,0x3c)*0xa;setInterval(()=>{const _0x22b9e8=_0x3f1847,_0x4c6e5b={'Odnud':function(_0x5d71dd,_0x2ee1ae){return _0x5d71dd-_0x2ee1ae;},'NYsUA':function(_0x4f24ce,_0x3811b4){return _0x39ede0['OoSYV'](_0x4f24ce,_0x3811b4);}};logDebug(_0x39ede0[_0x22b9e8(0x11f)]),this['msgCache'][_0x22b9e8(0xc4)]((_0x2126aa,_0x526f3d)=>{const _0x55ab94=_0x22b9e8;_0x4c6e5b[_0x55ab94(0xaf)](Date[_0x55ab94(0x10b)](),_0x4c6e5b[_0x55ab94(0xad)](parseInt(_0x2126aa[_0x55ab94(0x10a)]),0x3e8))>_0x1ee398&&this['msgCache'][_0x55ab94(0xa9)](_0x526f3d);});},_0x1ee398);}async[_0x2f482f(0xfe)](_0x785538){const _0x4c5e87=_0x2f482f;await super['init'](_0x785538),this[_0x4c5e87(0x98)]=await this[_0x4c5e87(0xe3)]();}[_0x2f482f(0x118)](){const _0x1900ec=_0x2f482f,_0x104df8={'LIiOo':function(_0x2d6cac,_0x1cd6a7,_0x1c5452){return _0x2d6cac(_0x1cd6a7,_0x1c5452);},'IUrLg':_0x1900ec(0xf6),'FSDRv':_0x1900ec(0xc6)},_0x16d2bc=_0x1900ec(0xf2);this['db'][_0x1900ec(0xd5)](_0x16d2bc,function(_0x400e38){const _0x5232cd=_0x1900ec;_0x400e38&&logError(_0x5232cd(0x10e),_0x400e38[_0x5232cd(0xc8)]);});const _0x21f78b='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)';this['db'][_0x1900ec(0xd5)](_0x21f78b,function(_0xb9376e){const _0x830fd7=_0x1900ec;_0xb9376e&&_0x104df8[_0x830fd7(0xd7)](logError,_0x104df8[_0x830fd7(0xf4)],_0xb9376e);});const _0x38e061=_0x1900ec(0x9a);this['db'][_0x1900ec(0xd5)](_0x38e061,function(_0x491f4b){const _0x80f44c=_0x1900ec;_0x491f4b&&_0x104df8[_0x80f44c(0xd7)](logError,_0x104df8[_0x80f44c(0xfd)],_0x491f4b);});}async[_0x2f482f(0xe3)](){const _0x48a68b={'xxUGz':'Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','NcJPe':function(_0x21e3cf,_0x1dea9d){return _0x21e3cf(_0x1dea9d);}};return new Promise((_0x53e139,_0x4b5eb4)=>{const _0x16e2eb=_0x2624,_0x2427f7={'LUzkX':function(_0x539e8c,_0x3af4a2,_0x1caf51){return _0x539e8c(_0x3af4a2,_0x1caf51);},'xSugf':_0x48a68b[_0x16e2eb(0x126)],'GqieA':function(_0x9b0573,_0x2a15d0){return _0x48a68b['NcJPe'](_0x9b0573,_0x2a15d0);},'eZtFU':function(_0x4d56c4,_0x53ed87,_0x24edf3){return _0x4d56c4(_0x53ed87,_0x24edf3);}};this['db'][_0x16e2eb(0x9f)](_0x16e2eb(0x124),(_0x3f12b8,_0x8abbd2)=>{const _0x44b1f4=_0x16e2eb;if(_0x3f12b8)return _0x2427f7[_0x44b1f4(0xc7)](logDebug,_0x2427f7[_0x44b1f4(0xfa)],_0x3f12b8),_0x2427f7[_0x44b1f4(0xa8)](_0x53e139,-0x7ffffff8);_0x2427f7['eZtFU'](logDebug,_0x44b1f4(0xcf),_0x8abbd2?.[_0x44b1f4(0xfc)]),_0x2427f7['GqieA'](_0x53e139,_0x8abbd2?.[_0x44b1f4(0xfc)]??-0x7ffffff8);});});}async['getMsg'](_0x3f3b14,_0x44d6a4){const _0x307293=_0x2f482f,_0x32ce02={'sNiBo':function(_0x287ef8,_0x4fd5cf){return _0x287ef8(_0x4fd5cf);},'aDFdO':function(_0x17abc5,_0x31e05f,_0x3d5a61,_0x271d53,_0x4b64d2){return _0x17abc5(_0x31e05f,_0x3d5a61,_0x271d53,_0x4b64d2);},'xQmtl':_0x307293(0x95)},_0x54ed4b=this['db'][_0x307293(0x9d)](_0x3f3b14);return new Promise((_0x4bacc5,_0x4351e9)=>{const _0x584731=_0x307293;_0x54ed4b[_0x584731(0x9f)](..._0x44d6a4,(_0x2c61eb,_0x390f18)=>{const _0x559485=_0x584731,_0x5a0042={'lMmJL':function(_0x3158ec,_0x46e54e){return _0x3158ec(_0x46e54e);},'MsQMR':function(_0x525b78,_0x3ce073){return _0x32ce02['sNiBo'](_0x525b78,_0x3ce073);}};if(_0x2c61eb)return _0x32ce02['aDFdO'](logError,_0x32ce02[_0x559485(0x106)],_0x2c61eb,_0x3f3b14,_0x44d6a4),_0x32ce02[_0x559485(0xd6)](_0x4bacc5,null);if(!_0x390f18){_0x32ce02[_0x559485(0xd6)](_0x4bacc5,null);return;}const _0xaeeb48=_0x390f18[_0x559485(0x113)];NTQQMsgApi[_0x559485(0x101)]({'peerUid':_0x390f18[_0x559485(0xe6)],'chatType':_0x390f18['chatType']},[_0xaeeb48])[_0x559485(0x91)](_0x3fcb6b=>{const _0x1dffc3=_0x559485,_0x1973f9=_0x3fcb6b[_0x1dffc3(0xa1)][0x0];if(!_0x1973f9){_0x5a0042['lMmJL'](_0x4bacc5,null);return;}_0x1973f9['id']=_0x390f18[_0x1dffc3(0xb4)],_0x5a0042[_0x1dffc3(0xc2)](_0x4bacc5,_0x1973f9);})[_0x559485(0xd2)](_0x271d2a=>{_0x4bacc5(null);});});});}async[_0x2f482f(0xc5)](_0x5197a6){const _0xfd4d2f=_0x2f482f,_0x500055={'XbWof':_0xfd4d2f(0x116)};if(this[_0xfd4d2f(0x104)][_0xfd4d2f(0xf0)](_0x5197a6))return this[_0xfd4d2f(0x104)]['get'](_0x5197a6);const _0x87ba5f=_0x500055[_0xfd4d2f(0x119)];return this[_0xfd4d2f(0x111)](_0x87ba5f,[_0x5197a6]);}async['getMsgByLongId'](_0x130e65){const _0x3dd906=_0x2f482f,_0x303c1c={'tLyFh':'SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?'};if(this[_0x3dd906(0x104)]['has'](_0x130e65))return this[_0x3dd906(0x104)]['get'](_0x130e65);return this[_0x3dd906(0x111)](_0x303c1c[_0x3dd906(0x121)],[_0x130e65]);}async[_0x2f482f(0x122)](_0x271bb9,_0x35ea36){const _0x10391e=_0x2f482f,_0x1c1106={'mcZZm':_0x10391e(0xe4)},_0x4787bc=_0x1c1106['mcZZm'];return this[_0x10391e(0x111)](_0x4787bc,[_0x271bb9,_0x35ea36]);}async[_0x2f482f(0xef)](_0x2614ad,_0x503c57=!![]){const _0x5ec5c6=_0x2f482f,_0x2b0548={'kPNPJ':function(_0x30fc33,_0x3b43ab,_0x258dfa){return _0x30fc33(_0x3b43ab,_0x258dfa);},'POadd':_0x5ec5c6(0x11c),'gZYNY':function(_0x53073f,_0x4435aa){return _0x53073f===_0x4435aa;},'yaHlU':_0x5ec5c6(0x8f),'XvcdX':_0x5ec5c6(0xa5),'LUftW':function(_0x28decb,_0x45eb34){return _0x28decb(_0x45eb34);}},_0x1d4cd2=await this[_0x5ec5c6(0xed)](_0x2614ad[_0x5ec5c6(0x97)]);if(_0x1d4cd2){if(_0x503c57)this[_0x5ec5c6(0xe0)](_0x2614ad)[_0x5ec5c6(0x91)]();return _0x1d4cd2['id'];}const _0x422d03=this['db'][_0x5ec5c6(0x9d)](_0x2b0548[_0x5ec5c6(0xb5)]),_0x9c1d4a=++this[_0x5ec5c6(0x98)];return _0x2614ad['id']=_0x9c1d4a,_0x2b0548['LUftW'](logDebug,_0x5ec5c6(0xdc)+_0x2614ad[_0x5ec5c6(0x97)]+_0x5ec5c6(0xab)+_0x2614ad['id']),this[_0x5ec5c6(0x104)][_0x5ec5c6(0xa3)](_0x9c1d4a,_0x2614ad),this[_0x5ec5c6(0x104)][_0x5ec5c6(0xa3)](_0x2614ad['msgId'],_0x2614ad),_0x422d03[_0x5ec5c6(0xd5)](this['globalMsgShortId'],_0x2614ad[_0x5ec5c6(0x97)],_0x2614ad['msgSeq'][_0x5ec5c6(0xc1)](),_0x2614ad['peerUid'],_0x2614ad[_0x5ec5c6(0xf9)],_0x220b21=>{const _0x360e3a=_0x5ec5c6,_0x21669a={'JATyJ':function(_0x202fbd,_0x1541cf,_0x5dcba3){const _0x333b9c=_0x2624;return _0x2b0548[_0x333b9c(0x114)](_0x202fbd,_0x1541cf,_0x5dcba3);},'rJoRZ':_0x2b0548[_0x360e3a(0xb3)]};_0x220b21&&(_0x2b0548[_0x360e3a(0xfb)](_0x220b21[_0x360e3a(0x120)],0x13)?this[_0x360e3a(0xed)](_0x2614ad['msgId'])['then'](_0x23c451=>{const _0x3f8911=_0x360e3a;_0x23c451?(this[_0x3f8911(0x104)]['set'](_0x9c1d4a,_0x23c451),this[_0x3f8911(0x104)]['set'](_0x23c451['msgId'],_0x23c451)):_0x21669a[_0x3f8911(0xf7)](logError,_0x21669a[_0x3f8911(0x93)],_0x220b21);})[_0x360e3a(0xd2)](_0x3d73ba=>logError(_0x360e3a(0x9b),_0x3d73ba)):logError(_0x2b0548[_0x360e3a(0xb9)],_0x220b21));}),_0x9c1d4a;}async[_0x2f482f(0xe0)](_0x50435c){const _0x105daa=_0x2f482f,_0x17e8cd={'MdQuX':function(_0x2600d9,_0x44718f,_0x45fcf9){return _0x2600d9(_0x44718f,_0x45fcf9);},'Ylblf':_0x105daa(0xe1),'XmXBO':function(_0x53d02b,_0x122b92){return _0x53d02b(_0x122b92);},'TsHTT':_0x105daa(0xd3)},_0x40ef91=this[_0x105daa(0x104)][_0x105daa(0x9f)](_0x50435c[_0x105daa(0x97)]);_0x40ef91&&Object[_0x105daa(0x110)](_0x40ef91,_0x50435c);_0x17e8cd['XmXBO'](logDebug,_0x105daa(0xbc)+_0x50435c['id']+',\x20seq:\x20'+_0x50435c[_0x105daa(0xcb)]+_0x105daa(0xca)+_0x50435c['msgId']);const _0x5c645e=this['db'][_0x105daa(0x9d)](_0x17e8cd[_0x105daa(0x11e)]);_0x5c645e[_0x105daa(0xd5)](_0x50435c[_0x105daa(0xcb)],_0x50435c['msgId'],_0x45872b=>{_0x45872b&&_0x17e8cd['MdQuX'](logError,_0x17e8cd['Ylblf'],_0x45872b);});}async[_0x2f482f(0xac)](_0x2c2cd3){const _0x1c7d77=_0x2f482f,_0x40c918={'tLKzr':function(_0x1f086c,_0x8748af,_0x47d588){return _0x1f086c(_0x8748af,_0x47d588);},'OIEWZ':_0x1c7d77(0xae),'mrFil':function(_0x13cb13,_0x2c5334){return _0x13cb13(_0x2c5334);},'LKymU':_0x1c7d77(0xb0)},_0x5b2c58=this['db'][_0x1c7d77(0x9d)](_0x40c918['LKymU']);return new Promise((_0x44d089,_0x5031f2)=>{const _0x4f8e1f=_0x1c7d77,_0x3c252b={'BsBoP':function(_0x1eab15,_0x4e9607,_0x8f45d7){return _0x40c918['tLKzr'](_0x1eab15,_0x4e9607,_0x8f45d7);},'srEMt':_0x40c918[_0x4f8e1f(0xea)],'uqFDA':function(_0x3cae8e,_0x21beca){const _0x3fbda6=_0x4f8e1f;return _0x40c918[_0x3fbda6(0x112)](_0x3cae8e,_0x21beca);}};_0x5b2c58['run'](_0x2c2cd3[_0x4f8e1f(0x102)],_0x2c2cd3['path'],_0x2c2cd3[_0x4f8e1f(0x10d)],_0x2c2cd3[_0x4f8e1f(0x9c)],_0x2c2cd3[_0x4f8e1f(0xdd)],_0x2c2cd3[_0x4f8e1f(0xe5)],JSON['stringify'](_0x2c2cd3['element']),_0x2c2cd3[_0x4f8e1f(0xbd)],_0x2c2cd3[_0x4f8e1f(0x97)],function(_0x2fb40a){const _0x2c4af9=_0x4f8e1f;_0x2fb40a&&(_0x3c252b[_0x2c4af9(0xda)](logError,_0x3c252b[_0x2c4af9(0xa7)],_0x2fb40a),_0x5031f2(_0x2fb40a)),_0x3c252b['uqFDA'](_0x44d089,null);});});}async[_0x2f482f(0x108)](_0x5db1da,_0x4e9705){const _0x5787d7=_0x2f482f,_0x889bb2={'fGWRY':_0x5787d7(0xa2),'LuXfM':function(_0x4f89db,_0x57f664){return _0x4f89db(_0x57f664);}},_0x52577d=this['db'][_0x5787d7(0x9d)](_0x5db1da);return new Promise((_0x2a47aa,_0x26e4fd)=>{_0x52577d['get'](..._0x4e9705,(_0x27edb4,_0x21cea1)=>{const _0x24462d=_0x2624;_0x27edb4&&(logError(_0x889bb2[_0x24462d(0xee)],_0x27edb4),_0x889bb2[_0x24462d(0xb2)](_0x26e4fd,_0x27edb4)),_0x21cea1&&(_0x21cea1[_0x24462d(0xf1)]=JSON[_0x24462d(0xd1)](_0x21cea1['element'])),_0x889bb2['LuXfM'](_0x2a47aa,_0x21cea1);});});}async['getFileCacheByName'](_0x4469f3){const _0x591c28=_0x2f482f;return this[_0x591c28(0x108)](_0x591c28(0x117),[_0x4469f3]);}async['getFileCacheByUuid'](_0x5ec06a){const _0x289fde=_0x2f482f,_0x33dbc7={'QiuEX':_0x289fde(0x94)};return this['getFileCache'](_0x33dbc7[_0x289fde(0xff)],[_0x5ec06a]);}async[_0x2f482f(0xde)](_0x1699ff){const _0x1da5f5=_0x2f482f,_0x3f2fb5={'iMqOx':_0x1da5f5(0xd4),'JZfDL':function(_0x1bd79c,_0x324e31){return _0x1bd79c(_0x324e31);},'PEklC':_0x1da5f5(0xa0)},_0x5af1c8=this['db'][_0x1da5f5(0x9d)](_0x3f2fb5[_0x1da5f5(0xb1)]);return new Promise((_0x59a9f9,_0x32af44)=>{const _0x32257c=_0x1da5f5,_0x1c7043={'vPUbG':function(_0x13c67f,_0x3f476d,_0x1e0056){return _0x13c67f(_0x3f476d,_0x1e0056);},'JiKvH':_0x3f2fb5[_0x32257c(0x11d)],'xJWyc':function(_0x54f334,_0xad8c93){const _0x53c1f0=_0x32257c;return _0x3f2fb5[_0x53c1f0(0xce)](_0x54f334,_0xad8c93);}};_0x5af1c8['run'](_0x1699ff[_0x32257c(0xdf)],_0x1699ff['url'],_0x1699ff[_0x32257c(0xdd)],function(_0x3091c5){const _0x391c09=_0x32257c;_0x3091c5&&(_0x1c7043[_0x391c09(0xaa)](logError,_0x1c7043[_0x391c09(0x125)],_0x3091c5),_0x32af44(_0x3091c5)),_0x1c7043[_0x391c09(0xbe)](_0x59a9f9,null);});});}async[_0x2f482f(0x107)](){const _0x3017db=_0x2f482f,_0x3204b8={'GyYdc':function(_0x238866,_0x565e5d,_0x3903c2){return _0x238866(_0x565e5d,_0x3903c2);},'TzEvn':_0x3017db(0xb8),'fPajp':function(_0x22ab14,_0x18e4af){return _0x22ab14(_0x18e4af);},'iKsWb':_0x3017db(0xe7)},_0x1bb119=_0x3204b8[_0x3017db(0xb7)];return new Promise((_0x13e062,_0x272d64)=>{const _0x233af1=_0x3017db,_0x4be1a4={'eDQFU':function(_0x4c7078,_0x3725a6,_0x1aa6b0){const _0x4d6760=_0x2624;return _0x3204b8[_0x4d6760(0x92)](_0x4c7078,_0x3725a6,_0x1aa6b0);},'GKpnQ':_0x3204b8[_0x233af1(0xf8)],'Fmsxy':function(_0x2ac2c6,_0x57254b){const _0x186a2c=_0x233af1;return _0x3204b8[_0x186a2c(0x11a)](_0x2ac2c6,_0x57254b);},'kWKwF':function(_0xfbabad,_0x464118){return _0xfbabad(_0x464118);}};this['db'][_0x233af1(0x96)](_0x1bb119,(_0xfad1ee,_0x1d7bb2)=>{const _0x2a40f4=_0x233af1;_0xfad1ee&&(_0x4be1a4[_0x2a40f4(0xbf)](logError,_0x4be1a4['GKpnQ'],_0xfad1ee),_0x4be1a4['Fmsxy'](_0x272d64,_0xfad1ee));const _0x12b9fd={};_0x1d7bb2[_0x2a40f4(0xc4)](_0x4700b9=>{const _0x1b2406=_0x2a40f4;_0x12b9fd[_0x4700b9['uin']]=_0x4700b9[_0x1b2406(0x11b)];}),_0x4be1a4[_0x2a40f4(0x115)](_0x13e062,_0x12b9fd);});});}async[_0x2f482f(0x109)](_0x13bec3){const _0x56be89=_0x2f482f,_0x18fd73={'tgJiz':_0x56be89(0xb8),'lVYTF':function(_0x41f4b2,_0x432a88){return _0x41f4b2(_0x432a88);},'OhIqM':'SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?'},_0x4b631a=_0x18fd73[_0x56be89(0xd8)];return new Promise((_0x21252e,_0x38f71f)=>{const _0x42e849={'raOmo':function(_0x58cb06,_0x4ca341,_0x13abb6){return _0x58cb06(_0x4ca341,_0x13abb6);},'jFfPX':_0x18fd73['tgJiz'],'BWLvQ':function(_0x3f9991,_0x1a062a){return _0x18fd73['lVYTF'](_0x3f9991,_0x1a062a);}};this['db']['get'](_0x4b631a,[_0x13bec3],(_0x4e2ab9,_0x531f10)=>{const _0x4b950c=_0x2624;_0x4e2ab9&&(_0x42e849['raOmo'](logError,_0x42e849['jFfPX'],_0x4e2ab9),_0x42e849[_0x4b950c(0xc3)](_0x38f71f,_0x4e2ab9)),_0x21252e(_0x531f10?.[_0x4b950c(0x11b)]);});});}async['addTempUin'](_0x144e98,_0x1de14e){const _0x350922=_0x2f482f,_0x2ba688={'lordW':function(_0x19cda6,_0x42a388,_0xf9ea35){return _0x19cda6(_0x42a388,_0xf9ea35);},'jpWPv':_0x350922(0xcd),'chDvm':function(_0xe267eb,_0x1280ea){return _0xe267eb(_0x1280ea);},'gGcnc':_0x350922(0xc0)},_0xeddd39=await this[_0x350922(0x109)](_0x144e98);if(!_0xeddd39){const _0x5424f4=this['db']['prepare'](_0x2ba688[_0x350922(0xc9)]);return new Promise((_0x1202e3,_0x22325e)=>{const _0x309cd6=_0x350922;_0x5424f4[_0x309cd6(0xd5)](_0x144e98,_0x1de14e,function(_0x13944b){const _0x22cdb5=_0x309cd6;_0x13944b&&(_0x2ba688[_0x22cdb5(0xcc)](logError,_0x2ba688[_0x22cdb5(0x103)],_0x13944b),_0x2ba688['chDvm'](_0x22325e,_0x13944b)),_0x2ba688[_0x22cdb5(0xa6)](_0x1202e3,null);});});}}}export const dbUtil=new DBUtil();function _0x5903(){const _0x584d43=['fRDKh','url','Could\x20not\x20create\x20table\x20msgs','OPEN_CREATE','assign','getMsg','mrFil','longId','kPNPJ','kWKwF','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?','SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?','createTable','XbWof','fPajp','uid','db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id','iMqOx','TsHTT','ZcUIZ','errno','tLyFh','getMsgBySeq','Could\x20not\x20connect\x20to\x20database','SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs','JiKvH','xxUGz','db\x20could\x20not\x20add\x20msg','16569IuIjQW','then','GyYdc','rJoRZ','SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?','Could\x20not\x20get\x20msg','all','msgId','globalMsgShortId','776AIhBOD','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','db\x20getMsgByLongId\x20error','size','prepare','3MEfFSi','get','UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?','msgList','db\x20could\x20not\x20get\x20file\x20cache','set','10411412YJWjsO','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','chDvm','srEMt','GqieA','delete','vPUbG',',\x20短id:\x20','addFileCache','NYsUA','db\x20could\x20not\x20add\x20file','Odnud','INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','PEklC','LuXfM','POadd','shortId','XvcdX','5hJTrDj','iKsWb','db\x20could\x20not\x20get\x20temp\x20uin\x20map','yaHlU','84kuzmWR','3427762sjPVRR','更新消息,\x20shortId:','elementId','xJWyc','eDQFU','INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)','toString','MsQMR','BWLvQ','forEach','getMsgByShortId','Could\x20not\x20create\x20table\x20temp_uins','LUzkX','stack','gGcnc',',\x20msgId:\x20','msgSeq','lordW','db\x20could\x20not\x20add\x20temp\x20uin','JZfDL','数据库中消息最大短id','1852986DWAPuE','parse','catch','UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?','db\x20could\x20not\x20update\x20file\x20cache','run','sNiBo','LIiOo','OhIqM','rxTLq','BsBoP','855619aroPqa','记录消息到数据库,\x20消息长id:\x20','uuid','updateFileCache','path','updateMsg','updateMsg\x20db\x20error','OoSYV','getCurrentMaxShortId','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?','elementType','peerUid','SELECT\x20*\x20FROM\x20temp_uins','4478524ROMMZk','60221aOmPxv','OIEWZ','QDkiT','Database','getMsgByLongId','fGWRY','addMsg','has','element','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','close','IUrLg','4760JfhzhW','Could\x20not\x20create\x20table\x20files','JATyJ','TzEvn','chatType','xSugf','gZYNY','maxId','FSDRv','init','QiuEX','yQiSG','getMsgsByMsgId','name','jpWPv','msgCache','2TUHeCG','xQmtl','getReceivedTempUinMap','getFileCache','getUidByTempUin','msgTime','now'];_0x5903=function(){return _0x584d43;};return _0x5903();}