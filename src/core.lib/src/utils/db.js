const _0x23eb40=_0x3aa1;(function(_0xac58c4,_0x1ab0c0){const _0x35c3a7=_0x3aa1,_0x5b226a=_0xac58c4();while(!![]){try{const _0x2d798c=-parseInt(_0x35c3a7(0x1cd))/0x1*(-parseInt(_0x35c3a7(0x1e7))/0x2)+parseInt(_0x35c3a7(0x1f3))/0x3+parseInt(_0x35c3a7(0x1c4))/0x4+parseInt(_0x35c3a7(0x171))/0x5*(parseInt(_0x35c3a7(0x1c0))/0x6)+-parseInt(_0x35c3a7(0x1ee))/0x7*(parseInt(_0x35c3a7(0x1bf))/0x8)+parseInt(_0x35c3a7(0x1ed))/0x9*(parseInt(_0x35c3a7(0x1b2))/0xa)+-parseInt(_0x35c3a7(0x19a))/0xb*(parseInt(_0x35c3a7(0x1e8))/0xc);if(_0x2d798c===_0x1ab0c0)break;else _0x5b226a['push'](_0x5b226a['shift']());}catch(_0x24cacc){_0x5b226a['push'](_0x5b226a['shift']());}}}(_0x5bb7,0x8ec8d));import _0x2998e9 from'sqlite3';function _0x3aa1(_0x175737,_0x4208db){const _0x5bb7ab=_0x5bb7();return _0x3aa1=function(_0x3aa149,_0x18bb8d){_0x3aa149=_0x3aa149-0x168;let _0x3b3f14=_0x5bb7ab[_0x3aa149];return _0x3b3f14;},_0x3aa1(_0x175737,_0x4208db);}import{logDebug,logError}from'@/common/utils/log';import{NTQQMsgApi}from'@/core';class DBUtilBase{['db'];async[_0x23eb40(0x16c)](_0x2f9963){const _0x4286f8=_0x23eb40,_0x55aafc={'KGpYn':_0x4286f8(0x17b)};if(this['db'])return;return new Promise((_0x5cd6fb,_0x4abaaf)=>{const _0x3e649c=_0x4286f8,_0x53a64e={'YYWir':_0x55aafc[_0x3e649c(0x199)],'Xqabc':function(_0x267a10,_0x514351){return _0x267a10(_0x514351);},'lNZga':function(_0x275f7f){return _0x275f7f();}};this['db']=new _0x2998e9[(_0x3e649c(0x18d))](_0x2f9963,_0x2998e9[_0x3e649c(0x1d7)]|_0x2998e9[_0x3e649c(0x1da)],_0x469782=>{const _0x22f9c2=_0x3e649c;if(_0x469782){logError(_0x53a64e[_0x22f9c2(0x1ab)],_0x469782),_0x53a64e[_0x22f9c2(0x1d3)](_0x4abaaf,_0x469782);return;}this['createTable'](),_0x53a64e[_0x22f9c2(0x1f7)](_0x5cd6fb);});});}[_0x23eb40(0x176)](){const _0x43fdbe=_0x23eb40,_0x5702e9={'nEIQJ':'Method\x20not\x20implemented.'};throw new Error(_0x5702e9[_0x43fdbe(0x17f)]);}[_0x23eb40(0x18f)](){const _0x18c0da=_0x23eb40;this['db']?.[_0x18c0da(0x18f)]();}}class DBUtil extends DBUtilBase{[_0x23eb40(0x1c1)]=new Map();[_0x23eb40(0x1eb)]=-0x7ffffff8;constructor(){const _0xcae3c2=_0x23eb40,_0x24b3dc={'tZEQN':function(_0x2891f3,_0x5aa159){return _0x2891f3>_0x5aa159;},'ueSNQ':function(_0x2b9bec,_0x3ffe06){return _0x2b9bec*_0x3ffe06;},'KlhgL':function(_0x4b79d6,_0x5a2d84){return _0x4b79d6(_0x5a2d84);},'fpySg':function(_0x2cb136,_0x5f2ec6){return _0x2cb136*_0x5f2ec6;},'aGRYp':function(_0x5b9427,_0x2e438a){return _0x5b9427*_0x2e438a;},'dQtHH':function(_0x29147a,_0x14265d,_0x293e4e){return _0x29147a(_0x14265d,_0x293e4e);}};super();const _0x1ae65e=_0x24b3dc['fpySg'](_0x24b3dc[_0xcae3c2(0x1f6)](0x3e8,0x3c),0xa);_0x24b3dc[_0xcae3c2(0x1b0)](setInterval,()=>{const _0x4e63f7=_0xcae3c2;_0x24b3dc[_0x4e63f7(0x18a)](logDebug,_0x4e63f7(0x1c3)),this[_0x4e63f7(0x1c1)]['forEach']((_0x3e438c,_0xa684e8)=>{const _0x1dbb73=_0x4e63f7;_0x24b3dc[_0x1dbb73(0x1b6)](Date[_0x1dbb73(0x194)]()-_0x24b3dc[_0x1dbb73(0x1ef)](_0x24b3dc[_0x1dbb73(0x18a)](parseInt,_0x3e438c['msgTime']),0x3e8),_0x1ae65e)&&this[_0x1dbb73(0x1c1)][_0x1dbb73(0x1ba)](_0xa684e8);});},_0x1ae65e);}async[_0x23eb40(0x16c)](_0x29ec09){const _0x453005=_0x23eb40;await super[_0x453005(0x16c)](_0x29ec09),this['globalMsgShortId']=await this[_0x453005(0x173)]();}['createTable'](){const _0x4ac776=_0x23eb40,_0x4ce2dc={'wdKHh':function(_0x17bb82,_0x15f393,_0x255f33){return _0x17bb82(_0x15f393,_0x255f33);},'yTiOO':'Could\x20not\x20create\x20table\x20msgs','JViGM':'Could\x20not\x20create\x20table\x20files','Iqqtm':_0x4ac776(0x179)},_0x6b1adb=_0x4ac776(0x1d4);this['db'][_0x4ac776(0x172)](_0x6b1adb,function(_0x35715c){const _0x1265fb=_0x4ac776;_0x35715c&&_0x4ce2dc[_0x1265fb(0x182)](logError,_0x4ce2dc[_0x1265fb(0x197)],_0x35715c[_0x1265fb(0x1e6)]);});const _0x236ab5=_0x4ac776(0x1d6);this['db'][_0x4ac776(0x172)](_0x236ab5,function(_0x2dc0b0){const _0x51ba03=_0x4ac776;_0x2dc0b0&&_0x4ce2dc[_0x51ba03(0x182)](logError,_0x4ce2dc[_0x51ba03(0x1a9)],_0x2dc0b0);});const _0x55b21b=_0x4ac776(0x168);this['db']['run'](_0x55b21b,function(_0x1d996a){const _0x3b4b1d=_0x4ac776;_0x1d996a&&_0x4ce2dc[_0x3b4b1d(0x182)](logError,_0x4ce2dc[_0x3b4b1d(0x1c6)],_0x1d996a);});}async[_0x23eb40(0x173)](){const _0x566a79=_0x23eb40,_0x5258bb={'fMiCK':function(_0x2cae55,_0x5bc442,_0x37b514){return _0x2cae55(_0x5bc442,_0x37b514);},'upVRg':function(_0x6d0b56,_0x2cfa9a){return _0x6d0b56(_0x2cfa9a);},'hHOQH':_0x566a79(0x186),'xzCLr':function(_0x418e76,_0x556568){return _0x418e76(_0x556568);},'OmmGk':_0x566a79(0x17a)};return new Promise((_0x4090af,_0x3e5820)=>{const _0x46bc7e=_0x566a79,_0x192f93={'wopWT':function(_0x1b1f67,_0x27d6ca,_0x48e8eb){return _0x5258bb['fMiCK'](_0x1b1f67,_0x27d6ca,_0x48e8eb);},'dJZul':function(_0x3f3bec,_0x47f17c){const _0x5039a0=_0x3aa1;return _0x5258bb[_0x5039a0(0x189)](_0x3f3bec,_0x47f17c);},'AeQjf':_0x5258bb[_0x46bc7e(0x1b9)],'CBIxn':function(_0x453e5d,_0x3ec7c4){const _0x2e3219=_0x46bc7e;return _0x5258bb[_0x2e3219(0x1e9)](_0x453e5d,_0x3ec7c4);}};this['db'][_0x46bc7e(0x1f0)](_0x5258bb[_0x46bc7e(0x185)],(_0x352cf3,_0x36f924)=>{const _0x459d58=_0x46bc7e;if(_0x352cf3)return _0x192f93[_0x459d58(0x1b7)](logDebug,_0x459d58(0x1e1),_0x352cf3),_0x192f93[_0x459d58(0x180)](_0x4090af,-0x7ffffff8);_0x192f93[_0x459d58(0x1b7)](logDebug,_0x192f93[_0x459d58(0x1f1)],_0x36f924?.['maxId']),_0x192f93[_0x459d58(0x1e0)](_0x4090af,_0x36f924?.[_0x459d58(0x1a5)]??-0x7ffffff8);});});}async[_0x23eb40(0x1d5)](_0x58b673,_0x3271f1){const _0x3cc2b2=_0x23eb40,_0x311630={'eWekn':function(_0x592fdc,_0x3f357c,_0xffa0bb,_0x2570d9,_0xae7f95){return _0x592fdc(_0x3f357c,_0xffa0bb,_0x2570d9,_0xae7f95);},'uSjXT':_0x3cc2b2(0x1ea),'nplry':function(_0x549354,_0x117b0a){return _0x549354(_0x117b0a);}},_0x4ce779=this['db'][_0x3cc2b2(0x181)](_0x58b673);return new Promise((_0x5edf48,_0x199ec7)=>{const _0x2065a8=_0x3cc2b2,_0x380ce2={'VbcIp':function(_0x52cb9e,_0x309c48){return _0x52cb9e(_0x309c48);},'cQjKZ':function(_0x258e29,_0x536df1,_0x51202a,_0x3acf8e,_0x3a9186){const _0x5207b8=_0x3aa1;return _0x311630[_0x5207b8(0x1ec)](_0x258e29,_0x536df1,_0x51202a,_0x3acf8e,_0x3a9186);},'YdMWu':_0x311630[_0x2065a8(0x16b)],'hHJnh':function(_0x242c12,_0x221120){return _0x311630['nplry'](_0x242c12,_0x221120);},'uCEII':function(_0x5f391d,_0xe15382){const _0x2500c6=_0x2065a8;return _0x311630[_0x2500c6(0x1bd)](_0x5f391d,_0xe15382);}};_0x4ce779[_0x2065a8(0x1f0)](..._0x3271f1,(_0x572351,_0x5151f7)=>{const _0x2c0823=_0x2065a8,_0x3bd792={'jZpHe':function(_0x8e8b10,_0x257ce6){const _0x3e0c61=_0x3aa1;return _0x380ce2[_0x3e0c61(0x1f9)](_0x8e8b10,_0x257ce6);}};if(_0x572351)return _0x380ce2['cQjKZ'](logError,_0x380ce2[_0x2c0823(0x1e5)],_0x572351,_0x58b673,_0x3271f1),_0x380ce2[_0x2c0823(0x1aa)](_0x5edf48,null);if(!_0x5151f7){_0x380ce2[_0x2c0823(0x169)](_0x5edf48,null);return;}const _0x5f4e84=_0x5151f7[_0x2c0823(0x1c8)];NTQQMsgApi[_0x2c0823(0x1c2)]({'peerUid':_0x5151f7[_0x2c0823(0x1a7)],'chatType':_0x5151f7[_0x2c0823(0x1a6)]},[_0x5f4e84])['then'](_0xb8cc06=>{const _0x3c8d1=_0x2c0823,_0x338070=_0xb8cc06[_0x3c8d1(0x192)][0x0];if(!_0x338070){_0x5edf48(null);return;}_0x338070['id']=_0x5151f7[_0x3c8d1(0x19b)],_0x5edf48(_0x338070);})[_0x2c0823(0x1f2)](_0x553190=>{const _0x4fbb8f=_0x2c0823;_0x3bd792[_0x4fbb8f(0x1af)](_0x5edf48,null);});});});}async[_0x23eb40(0x1ac)](_0x5cfa81){const _0xdd574c=_0x23eb40,_0x135f25={'ALUvF':'SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?'};if(this[_0xdd574c(0x1c1)][_0xdd574c(0x1b3)](_0x5cfa81))return this[_0xdd574c(0x1c1)][_0xdd574c(0x1f0)](_0x5cfa81);const _0x5d038d=_0x135f25[_0xdd574c(0x1a1)];return this['getMsg'](_0x5d038d,[_0x5cfa81]);}async[_0x23eb40(0x184)](_0x691005){const _0x3c179d=_0x23eb40,_0x92b0f8={'XFRuu':_0x3c179d(0x196)};if(this['msgCache']['has'](_0x691005))return this[_0x3c179d(0x1c1)]['get'](_0x691005);return this[_0x3c179d(0x1d5)](_0x92b0f8['XFRuu'],[_0x691005]);}async[_0x23eb40(0x1d8)](_0xf26bf4,_0x3a516e){const _0x125444=_0x23eb40,_0x5bd0ec={'JSycN':'SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?'},_0x2db297=_0x5bd0ec['JSycN'];return this[_0x125444(0x1d5)](_0x2db297,[_0xf26bf4,_0x3a516e]);}async[_0x23eb40(0x16d)](_0x1a5ba9,_0x5508c1=!![]){const _0xa13ed1=_0x23eb40,_0x365ba0={'MahPV':function(_0x3c1459,_0x5264d2,_0x59935b){return _0x3c1459(_0x5264d2,_0x59935b);},'jpPco':'INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','BDTql':function(_0x3f0534,_0x5d428b){return _0x3f0534(_0x5d428b);}},_0x3cbe6b=await this[_0xa13ed1(0x184)](_0x1a5ba9['msgId']);if(_0x3cbe6b){if(_0x5508c1)this['updateMsg'](_0x1a5ba9)['then']();return _0x3cbe6b['id'];}const _0x171c99=this['db'][_0xa13ed1(0x181)](_0x365ba0['jpPco']),_0x2aa989=++this[_0xa13ed1(0x1eb)];return _0x1a5ba9['id']=_0x2aa989,_0x365ba0[_0xa13ed1(0x1a8)](logDebug,_0xa13ed1(0x1b8)+_0x1a5ba9['msgId']+_0xa13ed1(0x1d1)+_0x1a5ba9['id']),this['msgCache'][_0xa13ed1(0x16f)](_0x2aa989,_0x1a5ba9),this[_0xa13ed1(0x1c1)][_0xa13ed1(0x16f)](_0x1a5ba9[_0xa13ed1(0x1d9)],_0x1a5ba9),_0x171c99[_0xa13ed1(0x172)](this[_0xa13ed1(0x1eb)],_0x1a5ba9[_0xa13ed1(0x1d9)],_0x1a5ba9[_0xa13ed1(0x1a4)]['toString'](),_0x1a5ba9[_0xa13ed1(0x1a7)],_0x1a5ba9[_0xa13ed1(0x1a6)],_0x3a953f=>{const _0x54f516=_0xa13ed1,_0x4f4554={'RLeAV':function(_0x1af6f2,_0x3b9dfc,_0x51304e){const _0x39a426=_0x3aa1;return _0x365ba0[_0x39a426(0x190)](_0x1af6f2,_0x3b9dfc,_0x51304e);}};_0x3a953f&&(_0x3a953f[_0x54f516(0x18b)]===0x13?this[_0x54f516(0x184)](_0x1a5ba9[_0x54f516(0x1d9)])[_0x54f516(0x1be)](_0x583b9d=>{const _0x463a7a=_0x54f516;_0x583b9d?(this[_0x463a7a(0x1c1)][_0x463a7a(0x16f)](_0x2aa989,_0x583b9d),this[_0x463a7a(0x1c1)][_0x463a7a(0x16f)](_0x583b9d[_0x463a7a(0x1d9)],_0x583b9d)):_0x4f4554['RLeAV'](logError,'db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id',_0x3a953f);})[_0x54f516(0x1f2)](_0x32c9a9=>logError(_0x54f516(0x1df),_0x32c9a9)):_0x365ba0[_0x54f516(0x190)](logError,'db\x20could\x20not\x20add\x20msg',_0x3a953f));}),_0x2aa989;}async[_0x23eb40(0x1e4)](_0x5bbd10){const _0x3ca42a=_0x23eb40,_0x41dac2={'CxQSi':function(_0x3989d4,_0x99bd68,_0x5a2928){return _0x3989d4(_0x99bd68,_0x5a2928);},'IiRxp':_0x3ca42a(0x1ad),'BmXfL':function(_0x4ab624,_0x1ddf32){return _0x4ab624(_0x1ddf32);}},_0x355530=this[_0x3ca42a(0x1c1)][_0x3ca42a(0x1f0)](_0x5bbd10[_0x3ca42a(0x1d9)]);_0x355530&&Object[_0x3ca42a(0x1ae)](_0x355530,_0x5bbd10);_0x41dac2[_0x3ca42a(0x1ce)](logDebug,_0x3ca42a(0x1f4)+_0x5bbd10['id']+_0x3ca42a(0x17e)+_0x5bbd10[_0x3ca42a(0x1a4)]+',\x20msgId:\x20'+_0x5bbd10[_0x3ca42a(0x1d9)]);const _0x4b7b3c=this['db'][_0x3ca42a(0x181)](_0x3ca42a(0x193));_0x4b7b3c['run'](_0x5bbd10[_0x3ca42a(0x1a4)],_0x5bbd10[_0x3ca42a(0x1d9)],_0x95406c=>{const _0x2df7fd=_0x3ca42a;_0x95406c&&_0x41dac2[_0x2df7fd(0x188)](logError,_0x41dac2[_0x2df7fd(0x1b1)],_0x95406c);});}async[_0x23eb40(0x1c7)](_0x66dd11){const _0x2f3f27=_0x23eb40,_0x5c5e3f={'glUvO':function(_0x532552,_0x438117,_0x42de6a){return _0x532552(_0x438117,_0x42de6a);},'YVdqM':_0x2f3f27(0x174)},_0x2c2855=this['db'][_0x2f3f27(0x181)](_0x2f3f27(0x1ca));return new Promise((_0x4b7d93,_0xdc7100)=>{const _0x4e9846=_0x2f3f27;_0x2c2855[_0x4e9846(0x172)](_0x66dd11[_0x4e9846(0x191)],_0x66dd11[_0x4e9846(0x1a3)],_0x66dd11['url'],_0x66dd11['size'],_0x66dd11[_0x4e9846(0x19e)],_0x66dd11[_0x4e9846(0x195)],JSON[_0x4e9846(0x1bc)](_0x66dd11[_0x4e9846(0x16a)]),_0x66dd11['elementId'],_0x66dd11['msgId'],function(_0xafbd2b){const _0x3b3136=_0x4e9846;_0xafbd2b&&(_0x5c5e3f[_0x3b3136(0x1f5)](logError,_0x5c5e3f[_0x3b3136(0x1d0)],_0xafbd2b),_0xdc7100(_0xafbd2b)),_0x4b7d93(null);});});}async[_0x23eb40(0x18c)](_0x29c1d5,_0x130fa5){const _0x2d9d16=_0x23eb40,_0x4ee62e={'DSoYB':function(_0x21cc4b,_0x3c46be,_0x53b20e){return _0x21cc4b(_0x3c46be,_0x53b20e);},'jbvgA':_0x2d9d16(0x1a0),'EMrDI':function(_0x47fcf3,_0x469e11){return _0x47fcf3(_0x469e11);},'ssmlh':function(_0x123da2,_0x5f127e){return _0x123da2(_0x5f127e);}},_0x157be3=this['db'][_0x2d9d16(0x181)](_0x29c1d5);return new Promise((_0x50c43a,_0xf77c99)=>{const _0x3dd192=_0x2d9d16;_0x157be3[_0x3dd192(0x1f0)](..._0x130fa5,(_0x47a016,_0x36570d)=>{const _0x1ddb8b=_0x3dd192;_0x47a016&&(_0x4ee62e['DSoYB'](logError,_0x4ee62e[_0x1ddb8b(0x1cc)],_0x47a016),_0x4ee62e['EMrDI'](_0xf77c99,_0x47a016)),_0x36570d&&(_0x36570d['element']=JSON['parse'](_0x36570d['element'])),_0x4ee62e['ssmlh'](_0x50c43a,_0x36570d);});});}async[_0x23eb40(0x1f8)](_0x460ef0){const _0x435306=_0x23eb40,_0x639691={'WKZZm':_0x435306(0x18e)};return this[_0x435306(0x18c)](_0x639691[_0x435306(0x1dc)],[_0x460ef0]);}async[_0x23eb40(0x178)](_0x4bae87){const _0xfb8bbf=_0x23eb40,_0x501a03={'kcemx':'SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?'};return this[_0xfb8bbf(0x18c)](_0x501a03['kcemx'],[_0x4bae87]);}async[_0x23eb40(0x1c5)](_0x26b5ed){const _0xc83e57=_0x23eb40,_0x28dca8={'yNhRe':function(_0x451d8c,_0x244053,_0x1cac28){return _0x451d8c(_0x244053,_0x1cac28);},'hJUQw':_0xc83e57(0x1e2),'DqauB':function(_0x220326,_0x13b2b4){return _0x220326(_0x13b2b4);}},_0x2b7cdd=this['db'][_0xc83e57(0x181)](_0xc83e57(0x17d));return new Promise((_0x4fe010,_0x85c00b)=>{const _0x45b6e7=_0xc83e57;_0x2b7cdd['run'](_0x26b5ed[_0x45b6e7(0x1a3)],_0x26b5ed[_0x45b6e7(0x183)],_0x26b5ed[_0x45b6e7(0x19e)],function(_0x530ae2){const _0x47d304=_0x45b6e7;_0x530ae2&&(_0x28dca8[_0x47d304(0x1b5)](logError,_0x28dca8['hJUQw'],_0x530ae2),_0x28dca8['DqauB'](_0x85c00b,_0x530ae2)),_0x4fe010(null);});});}async[_0x23eb40(0x170)](){const _0x5f5ba7=_0x23eb40,_0x2174a2={'dcwDE':function(_0x31a6bc,_0x2f4366,_0x540ba0){return _0x31a6bc(_0x2f4366,_0x540ba0);},'gTsNr':_0x5f5ba7(0x1a2),'DZEXp':function(_0x1f8650,_0x3b2b2e){return _0x1f8650(_0x3b2b2e);},'wacRw':function(_0xc2bbf9,_0x289edf){return _0xc2bbf9(_0x289edf);},'ziYwq':'SELECT\x20*\x20FROM\x20temp_uins'},_0x4b64dc=_0x2174a2[_0x5f5ba7(0x177)];return new Promise((_0x372f8c,_0x24a61b)=>{const _0x5cce11=_0x5f5ba7,_0x4922ae={'VBwak':function(_0x587ca1,_0x35261c,_0x6b8d19){const _0x2f8ce0=_0x3aa1;return _0x2174a2[_0x2f8ce0(0x19c)](_0x587ca1,_0x35261c,_0x6b8d19);},'LjqnZ':_0x2174a2[_0x5cce11(0x16e)],'rtvKY':function(_0x2ef7a4,_0x22dfa0){const _0x196bf6=_0x5cce11;return _0x2174a2[_0x196bf6(0x1b4)](_0x2ef7a4,_0x22dfa0);},'DFhrF':function(_0x5540b8,_0xe55d01){const _0x284b49=_0x5cce11;return _0x2174a2[_0x284b49(0x198)](_0x5540b8,_0xe55d01);}};this['db']['all'](_0x4b64dc,(_0x224164,_0x1e89f9)=>{const _0x4911a8=_0x5cce11;_0x224164&&(_0x4922ae['VBwak'](logError,_0x4922ae[_0x4911a8(0x19d)],_0x224164),_0x4922ae[_0x4911a8(0x187)](_0x24a61b,_0x224164));const _0x340327={};_0x1e89f9[_0x4911a8(0x1db)](_0x181792=>{const _0x3afdff=_0x4911a8;_0x340327[_0x181792[_0x3afdff(0x1c9)]]=_0x181792['uid'];}),_0x4922ae[_0x4911a8(0x1cf)](_0x372f8c,_0x340327);});});}async[_0x23eb40(0x17c)](_0x3b60d3){const _0x2b2a62=_0x23eb40,_0x38a58c={'TuoGi':function(_0x23f708,_0x1c8027,_0x4ffd9e){return _0x23f708(_0x1c8027,_0x4ffd9e);},'SOJVP':_0x2b2a62(0x1a2),'UZQYv':function(_0x55665a,_0x2933d2){return _0x55665a(_0x2933d2);},'uoEuj':function(_0x184bab,_0x4639c7){return _0x184bab(_0x4639c7);},'crwNx':_0x2b2a62(0x1cb)},_0x42a3fe=_0x38a58c[_0x2b2a62(0x19f)];return new Promise((_0x2e1bdf,_0x465a49)=>{const _0x42b632=_0x2b2a62;this['db'][_0x42b632(0x1f0)](_0x42a3fe,[_0x3b60d3],(_0x558cc6,_0x6d336f)=>{const _0x51688b=_0x42b632;_0x558cc6&&(_0x38a58c['TuoGi'](logError,_0x38a58c[_0x51688b(0x175)],_0x558cc6),_0x38a58c['UZQYv'](_0x465a49,_0x558cc6)),_0x38a58c['uoEuj'](_0x2e1bdf,_0x6d336f?.[_0x51688b(0x1e3)]);});});}async[_0x23eb40(0x1dd)](_0x5f4008,_0xabc0aa){const _0x44afd2=_0x23eb40,_0xc96e8a={'qVyHs':function(_0x2f7568,_0x4c83c6,_0x43e92e){return _0x2f7568(_0x4c83c6,_0x43e92e);},'thHjD':'db\x20could\x20not\x20add\x20temp\x20uin','CyGVW':function(_0xa064a,_0xee3705){return _0xa064a(_0xee3705);},'XrWGg':_0x44afd2(0x1bb)},_0x79a708=await this[_0x44afd2(0x17c)](_0x5f4008);if(!_0x79a708){const _0x320f1c=this['db']['prepare'](_0xc96e8a[_0x44afd2(0x1d2)]);return new Promise((_0x24008e,_0x5ef6e5)=>{const _0x14f808=_0x44afd2;_0x320f1c[_0x14f808(0x172)](_0x5f4008,_0xabc0aa,function(_0x5dcc85){const _0x57816f=_0x14f808;_0x5dcc85&&(_0xc96e8a[_0x57816f(0x1de)](logError,_0xc96e8a['thHjD'],_0x5dcc85),_0xc96e8a['CyGVW'](_0x5ef6e5,_0x5dcc85)),_0xc96e8a['CyGVW'](_0x24008e,null);});});}}}function _0x5bb7(){const _0x3abbb4=['updateMsg','YdMWu','stack','2rgMYzK','120ldUcKG','xzCLr','Could\x20not\x20get\x20msg','globalMsgShortId','eWekn','9Yqjleh','1589VgtFDL','ueSNQ','get','AeQjf','catch','2292000sXvFkS','更新消息,\x20shortId:','glUvO','aGRYp','lNZga','getFileCacheByName','VbcIp','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','uCEII','element','uSjXT','init','addMsg','gTsNr','set','getReceivedTempUinMap','335fHubOg','run','getCurrentMaxShortId','db\x20could\x20not\x20add\x20file','SOJVP','createTable','ziYwq','getFileCacheByUuid','Could\x20not\x20create\x20table\x20temp_uins','SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs','Could\x20not\x20connect\x20to\x20database','getUidByTempUin','UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?',',\x20seq:\x20','nEIQJ','dJZul','prepare','wdKHh','url','getMsgByLongId','OmmGk','数据库中消息最大短id','rtvKY','CxQSi','upVRg','KlhgL','errno','getFileCache','Database','SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?','close','MahPV','name','msgList','UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?','now','elementType','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?','yTiOO','wacRw','KGpYn','1807014VtjsMg','shortId','dcwDE','LjqnZ','uuid','crwNx','db\x20could\x20not\x20get\x20file\x20cache','ALUvF','db\x20could\x20not\x20get\x20temp\x20uin\x20map','path','msgSeq','maxId','chatType','peerUid','BDTql','JViGM','hHJnh','YYWir','getMsgByShortId','updateMsg\x20db\x20error','assign','jZpHe','dQtHH','IiRxp','835410xfOuSR','has','DZEXp','yNhRe','tZEQN','wopWT','记录消息到数据库,\x20消息长id:\x20','hHOQH','delete','INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)','stringify','nplry','then','24248tzZqOt','75846kyBJRZ','msgCache','getMsgsByMsgId','清理消息缓存','720068EifKjE','updateFileCache','Iqqtm','addFileCache','longId','uin','INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?','jbvgA','1041117MiNlPv','BmXfL','DFhrF','YVdqM',',\x20短id:\x20','XrWGg','Xqabc','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','getMsg','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','OPEN_READWRITE','getMsgBySeq','msgId','OPEN_CREATE','forEach','WKZZm','addTempUin','qVyHs','db\x20getMsgByLongId\x20error','CBIxn','Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','db\x20could\x20not\x20update\x20file\x20cache','uid'];_0x5bb7=function(){return _0x3abbb4;};return _0x5bb7();}export const dbUtil=new DBUtil();