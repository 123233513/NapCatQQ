const _0x9d338a=_0xcf9e;(function(_0x12a462,_0x3014da){const _0x5008a4=_0xcf9e,_0x3d0ada=_0x12a462();while(!![]){try{const _0x1abf02=parseInt(_0x5008a4(0x12f))/0x1+-parseInt(_0x5008a4(0x148))/0x2*(-parseInt(_0x5008a4(0x15e))/0x3)+-parseInt(_0x5008a4(0x10d))/0x4*(parseInt(_0x5008a4(0x102))/0x5)+parseInt(_0x5008a4(0xf8))/0x6+-parseInt(_0x5008a4(0x165))/0x7+-parseInt(_0x5008a4(0x12a))/0x8+-parseInt(_0x5008a4(0x13a))/0x9*(-parseInt(_0x5008a4(0x12c))/0xa);if(_0x1abf02===_0x3014da)break;else _0x3d0ada['push'](_0x3d0ada['shift']());}catch(_0x48e87a){_0x3d0ada['push'](_0x3d0ada['shift']());}}}(_0x1946,0x6edef));import _0x5ef1d0 from'sqlite3';import{logDebug,logError}from'@/common/utils/log';function _0x1946(){const _0x55da2b=['raMTR','rVYVU','uid','getFileCache','addTempUin','UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?','getMsgByShortId','KEHsA','updateMsg\x20db\x20error','db\x20could\x20not\x20update\x20file\x20cache','msgSeq','mIvZe','element','1495944Geseud','has','10550fYLoNR','db\x20could\x20not\x20add\x20file','KKBTM','662919LKnTvf','SaxFx','db\x20could\x20not\x20get\x20file\x20cache','GSnXN','OPEN_READWRITE','url','rHxQE','fDeiL','createTable','XgOrm','getMsgsByMsgId','7317xcMPHZ','vmEty','Database','updateFileCache','init','shortId','MQwlB','elementType','globalMsgShortId','pSgyS','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?','pMdjY','SWtib','OPEN_CREATE','38bfxHUL','Esirn','catch','XoZQK','bMzof','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','parse','assign','size','MdcqF','CsZSr','cWFoW','chatType','Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','getReceivedTempUinMap','MgssX','updateMsg','OHgkO','YfmrZ','dLgCR','UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?','Jwowr','29193bspWBh','getMsgBySeq','path','Could\x20not\x20get\x20msg','db\x20getMsgByLongId\x20error','ItzSd','then','5946255MalrAz','getFileCacheByUuid','清理消息缓存','get','WtZoK','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','addFileCache','KYkHu','数据库中消息最大短id','SELECT\x20*\x20FROM\x20temp_uins','cmJBt','WDEMj','PvCQC','msgId','Method\x20not\x20implemented.','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','name','getMsgByLongId','elementId','QMhXs','msgTime','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?','rNpSf','peerUid','xoHIP','db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id','maxId','forEach','getMsg','msgList','QqwXN','getCurrentMaxShortId','GUOdU','更新消息,\x20shortId:','ITafN','run','1381812TcIDtQ','addMsg','Could\x20not\x20connect\x20to\x20database','delete','KZvTs','longId','XkjSw','msgCache','prepare','MxOCI','556550dNiaPl','saxfY','OMMDn','db\x20could\x20not\x20get\x20temp\x20uin\x20map','errno','SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs','dBJql','ucMKj','HCMac','stringify','WNgAA','16yLmHma','Could\x20not\x20create\x20table\x20temp_uins','getFileCacheByName','getUidByTempUin','dKphJ','rwduy','set','SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?','stack','DOaEP','mtUys','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','uin','tgzfT','Could\x20not\x20create\x20table\x20files',',\x20msgId:\x20'];_0x1946=function(){return _0x55da2b;};return _0x1946();}function _0xcf9e(_0x124f60,_0x54bd44){const _0x19463b=_0x1946();return _0xcf9e=function(_0xcf9ea6,_0x2fe92d){_0xcf9ea6=_0xcf9ea6-0xf2;let _0x49aee4=_0x19463b[_0xcf9ea6];return _0x49aee4;},_0xcf9e(_0x124f60,_0x54bd44);}import{NTQQMsgApi}from'@/core';class DBUtilBase{['db'];async[_0x9d338a(0x13e)](_0x4c8979){const _0x330a36=_0x9d338a,_0x157525={'MQwlB':function(_0x29108a,_0xb965c5,_0x52953c){return _0x29108a(_0xb965c5,_0x52953c);},'OMMDn':_0x330a36(0xfa),'Hxvrw':function(_0xed6b5b,_0x4d9a7b){return _0xed6b5b(_0x4d9a7b);},'Jwowr':function(_0x4fd0b1){return _0x4fd0b1();},'mtUys':function(_0x209d12,_0x49551e){return _0x209d12|_0x49551e;}};if(this['db'])return;return new Promise((_0x97e9e6,_0x579cd0)=>{const _0x148884=_0x330a36,_0x4d8e12={'mIvZe':function(_0x5d265a,_0x5d9eaf,_0x3914d6){const _0x4abfa1=_0xcf9e;return _0x157525[_0x4abfa1(0x140)](_0x5d265a,_0x5d9eaf,_0x3914d6);},'sRIJV':_0x157525[_0x148884(0x104)],'wfeie':function(_0x4cf232,_0x2aa482){return _0x157525['Hxvrw'](_0x4cf232,_0x2aa482);},'xhjdr':function(_0x14c83d){const _0x1fbac6=_0x148884;return _0x157525[_0x1fbac6(0x15d)](_0x14c83d);}};this['db']=new _0x5ef1d0[(_0x148884(0x13c))](_0x4c8979,_0x157525[_0x148884(0x117)](_0x5ef1d0[_0x148884(0x133)],_0x5ef1d0[_0x148884(0x147)]),_0x1252f3=>{const _0x5ae034=_0x148884;if(_0x1252f3){_0x4d8e12[_0x5ae034(0x128)](logError,_0x4d8e12['sRIJV'],_0x1252f3),_0x4d8e12['wfeie'](_0x579cd0,_0x1252f3);return;}this[_0x5ae034(0x137)](),_0x4d8e12['xhjdr'](_0x97e9e6);});});}['createTable'](){const _0x18e1ee=_0x9d338a;throw new Error(_0x18e1ee(0x173));}['close'](){this['db']?.['close']();}}class DBUtil extends DBUtilBase{[_0x9d338a(0xff)]=new Map();[_0x9d338a(0x142)]=-0x7ffffff8;constructor(){const _0x48a155=_0x9d338a,_0x1f0e52={'rNpSf':function(_0x33cce6,_0x148012){return _0x33cce6(_0x148012);},'MxOCI':_0x48a155(0x167),'vmEty':function(_0x1e6ff0,_0x28b6f9){return _0x1e6ff0*_0x28b6f9;},'LYqSw':function(_0x52c4ed,_0x475d44,_0x2f4282){return _0x52c4ed(_0x475d44,_0x2f4282);}};super();const _0x243fc7=_0x1f0e52[_0x48a155(0x13b)](0x3e8*0x3c,0xa);_0x1f0e52['LYqSw'](setInterval,()=>{const _0x59f781=_0x48a155,_0x27249a={'dKphJ':function(_0x309e0a,_0xc057eb){return _0x309e0a>_0xc057eb;},'cmJBt':function(_0x54f34e,_0x3e2cac){return _0x54f34e*_0x3e2cac;},'YTJXX':function(_0x1bbadd,_0x572ccd){const _0x58f637=_0xcf9e;return _0x1f0e52[_0x58f637(0x17b)](_0x1bbadd,_0x572ccd);}};_0x1f0e52['rNpSf'](logDebug,_0x1f0e52[_0x59f781(0x101)]),this[_0x59f781(0xff)][_0x59f781(0x180)]((_0x3634b3,_0x3824e2)=>{const _0x109b39=_0x59f781;_0x27249a[_0x109b39(0x111)](Date['now']()-_0x27249a[_0x109b39(0x16f)](_0x27249a['YTJXX'](parseInt,_0x3634b3[_0x109b39(0x179)]),0x3e8),_0x243fc7)&&this[_0x109b39(0xff)][_0x109b39(0xfb)](_0x3824e2);});},_0x243fc7);}async[_0x9d338a(0x13e)](_0x32c2c9){const _0x1fb37c=_0x9d338a;await super[_0x1fb37c(0x13e)](_0x32c2c9),this['globalMsgShortId']=await this[_0x1fb37c(0xf3)]();}['createTable'](){const _0x283e34=_0x9d338a,_0x5c57fa={'GSnXN':function(_0x2e2129,_0x4eebe6,_0x2194da){return _0x2e2129(_0x4eebe6,_0x2194da);},'rwduy':function(_0x441b7b,_0x1e2a72,_0x4b8bd1){return _0x441b7b(_0x1e2a72,_0x4b8bd1);},'raMTR':_0x283e34(0x10e)},_0x365035=_0x283e34(0x118);this['db'][_0x283e34(0xf7)](_0x365035,function(_0x4fc2af){const _0x261800=_0x283e34;_0x4fc2af&&_0x5c57fa[_0x261800(0x132)](logError,'Could\x20not\x20create\x20table\x20msgs',_0x4fc2af[_0x261800(0x115)]);});const _0x4c4587=_0x283e34(0x16a);this['db'][_0x283e34(0xf7)](_0x4c4587,function(_0x1dc70b){const _0x12c560=_0x283e34;_0x1dc70b&&_0x5c57fa[_0x12c560(0x112)](logError,_0x12c560(0x11b),_0x1dc70b);});const _0x47ae8f=_0x283e34(0x14d);this['db'][_0x283e34(0xf7)](_0x47ae8f,function(_0x1f8216){const _0x5e0aef=_0x283e34;_0x1f8216&&logError(_0x5c57fa[_0x5e0aef(0x11d)],_0x1f8216);});}async[_0x9d338a(0xf3)](){const _0x4b61f0=_0x9d338a,_0x47e7a8={'HCMac':function(_0x3efb22,_0x377b40,_0x53e311){return _0x3efb22(_0x377b40,_0x53e311);},'GUOdU':_0x4b61f0(0x155),'KZvTs':function(_0x4cc5ee,_0x8d446b){return _0x4cc5ee(_0x8d446b);},'pMdjY':_0x4b61f0(0x16d),'MSbcm':function(_0x3ea43a,_0x22c355){return _0x3ea43a(_0x22c355);},'PvCQC':_0x4b61f0(0x107)};return new Promise((_0xde06e6,_0x5ecefa)=>{const _0x264849=_0x4b61f0;this['db'][_0x264849(0x168)](_0x47e7a8[_0x264849(0x171)],(_0x43d7a9,_0x47e27d)=>{const _0x5dc26a=_0x264849;if(_0x43d7a9)return _0x47e7a8[_0x5dc26a(0x10a)](logDebug,_0x47e7a8[_0x5dc26a(0xf4)],_0x43d7a9),_0x47e7a8[_0x5dc26a(0xfc)](_0xde06e6,-0x7ffffff8);logDebug(_0x47e7a8[_0x5dc26a(0x145)],_0x47e27d?.[_0x5dc26a(0x17f)]),_0x47e7a8['MSbcm'](_0xde06e6,_0x47e27d?.[_0x5dc26a(0x17f)]??-0x7ffffff8);});});}async['getMsg'](_0x338165,_0x1f7131){const _0x452433=_0x9d338a,_0x336f4e={'rHxQE':function(_0x4ad765,_0x1434c8){return _0x4ad765(_0x1434c8);},'Bktgk':_0x452433(0x161),'dAVKo':function(_0x15391c,_0x1e4480){return _0x15391c(_0x1e4480);}},_0x5567aa=this['db'][_0x452433(0x100)](_0x338165);return new Promise((_0x4fc54d,_0x289d1a)=>{const _0x183204={'xoHIP':function(_0xd2d258,_0x38a460){const _0x5aebcd=_0xcf9e;return _0x336f4e[_0x5aebcd(0x135)](_0xd2d258,_0x38a460);},'SWtib':function(_0x371e3d,_0x1d2a3f,_0xbff559,_0x521830,_0x294b84){return _0x371e3d(_0x1d2a3f,_0xbff559,_0x521830,_0x294b84);},'Esirn':_0x336f4e['Bktgk'],'KYkHu':function(_0xf8f4a4,_0x5a8444){return _0x336f4e['dAVKo'](_0xf8f4a4,_0x5a8444);}};_0x5567aa['get'](..._0x1f7131,(_0x47fed5,_0x5a183e)=>{const _0x4a1916=_0xcf9e,_0x2a784a={'MdcqF':function(_0x7302ee,_0x5c4f12){return _0x183204['xoHIP'](_0x7302ee,_0x5c4f12);}};if(_0x47fed5)return _0x183204[_0x4a1916(0x146)](logError,_0x183204[_0x4a1916(0x149)],_0x47fed5,_0x338165,_0x1f7131),_0x183204[_0x4a1916(0x17d)](_0x4fc54d,null);if(!_0x5a183e){_0x183204[_0x4a1916(0x16c)](_0x4fc54d,null);return;}const _0x1ecec7=_0x5a183e[_0x4a1916(0xfd)];NTQQMsgApi[_0x4a1916(0x139)]({'peerUid':_0x5a183e['peerUid'],'chatType':_0x5a183e['chatType']},[_0x1ecec7])[_0x4a1916(0x164)](_0x269a32=>{const _0x1f3aff=_0x4a1916,_0x52ada7=_0x269a32[_0x1f3aff(0x182)][0x0];if(!_0x52ada7){_0x2a784a[_0x1f3aff(0x151)](_0x4fc54d,null);return;}_0x52ada7['id']=_0x5a183e[_0x1f3aff(0x13f)],_0x2a784a['MdcqF'](_0x4fc54d,_0x52ada7);})['catch'](_0x5e8222=>{_0x4fc54d(null);});});});}async[_0x9d338a(0x123)](_0x2c4cb3){const _0x3bc34d=_0x9d338a,_0x1e0ea5={'saxfY':'SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?'};if(this[_0x3bc34d(0xff)][_0x3bc34d(0x12b)](_0x2c4cb3))return this[_0x3bc34d(0xff)][_0x3bc34d(0x168)](_0x2c4cb3);const _0x1d5622=_0x1e0ea5[_0x3bc34d(0x103)];return this['getMsg'](_0x1d5622,[_0x2c4cb3]);}async[_0x9d338a(0x176)](_0x180597){const _0x24d168=_0x9d338a,_0x45dece={'KEHsA':_0x24d168(0x17a)};if(this['msgCache']['has'](_0x180597))return this[_0x24d168(0xff)]['get'](_0x180597);return this[_0x24d168(0x181)](_0x45dece[_0x24d168(0x124)],[_0x180597]);}async[_0x9d338a(0x15f)](_0xf253d0,_0x27ccc8){const _0x49d12b=_0x9d338a,_0x2b0bc9=_0x49d12b(0x144);return this[_0x49d12b(0x181)](_0x2b0bc9,[_0xf253d0,_0x27ccc8]);}async[_0x9d338a(0xf9)](_0x2ccdd2,_0x4c14e9=!![]){const _0x7b7c46=_0x9d338a,_0x250fa8={'ItzSd':function(_0x952dcb,_0x30311b,_0x41b6cc){return _0x952dcb(_0x30311b,_0x41b6cc);},'pSgyS':function(_0x5d2263,_0x3fe378){return _0x5d2263===_0x3fe378;},'WtZoK':'db\x20could\x20not\x20add\x20msg','ErlXu':function(_0x54e377,_0x62426b){return _0x54e377(_0x62426b);}},_0x51733a=await this[_0x7b7c46(0x176)](_0x2ccdd2['msgId']);if(_0x51733a){if(_0x4c14e9)this[_0x7b7c46(0x158)](_0x2ccdd2)[_0x7b7c46(0x164)]();return _0x51733a['id'];}const _0x3fd0bc=this['db'][_0x7b7c46(0x100)](_0x7b7c46(0x174)),_0x57e311=++this[_0x7b7c46(0x142)];return _0x2ccdd2['id']=_0x57e311,_0x250fa8['ErlXu'](logDebug,'记录消息到数据库,\x20消息长id:\x20'+_0x2ccdd2[_0x7b7c46(0x172)]+',\x20短id:\x20'+_0x2ccdd2['id']),this['msgCache'][_0x7b7c46(0x113)](_0x57e311,_0x2ccdd2),this['msgCache']['set'](_0x2ccdd2[_0x7b7c46(0x172)],_0x2ccdd2),_0x3fd0bc[_0x7b7c46(0xf7)](this[_0x7b7c46(0x142)],_0x2ccdd2[_0x7b7c46(0x172)],_0x2ccdd2[_0x7b7c46(0x127)]['toString'](),_0x2ccdd2[_0x7b7c46(0x17c)],_0x2ccdd2[_0x7b7c46(0x154)],_0x72ba5=>{const _0x53370d=_0x7b7c46;_0x72ba5&&(_0x250fa8[_0x53370d(0x143)](_0x72ba5[_0x53370d(0x106)],0x13)?this[_0x53370d(0x176)](_0x2ccdd2[_0x53370d(0x172)])[_0x53370d(0x164)](_0x455ce2=>{const _0xbad413=_0x53370d;_0x455ce2?(this[_0xbad413(0xff)]['set'](_0x57e311,_0x455ce2),this[_0xbad413(0xff)][_0xbad413(0x113)](_0x455ce2[_0xbad413(0x172)],_0x455ce2)):_0x250fa8[_0xbad413(0x163)](logError,_0xbad413(0x17e),_0x72ba5);})[_0x53370d(0x14a)](_0x4fc855=>logError(_0x53370d(0x162),_0x4fc855)):logError(_0x250fa8[_0x53370d(0x169)],_0x72ba5));}),_0x57e311;}async[_0x9d338a(0x158)](_0x1b20af){const _0x931f15=_0x9d338a,_0x1dce49={'dBJql':function(_0x26e3d5,_0x1c54bc,_0x596c1a){return _0x26e3d5(_0x1c54bc,_0x596c1a);},'SaxFx':_0x931f15(0x125),'OHgkO':function(_0x57b64c,_0x46f2e8){return _0x57b64c(_0x46f2e8);}},_0x49b4c9=this[_0x931f15(0xff)]['get'](_0x1b20af[_0x931f15(0x172)]);_0x49b4c9&&Object[_0x931f15(0x14f)](_0x49b4c9,_0x1b20af);_0x1dce49[_0x931f15(0x159)](logDebug,_0x931f15(0xf5)+_0x1b20af['id']+',\x20seq:\x20'+_0x1b20af[_0x931f15(0x127)]+_0x931f15(0x11c)+_0x1b20af['msgId']);const _0x1d8d1e=this['db']['prepare'](_0x931f15(0x15c));_0x1d8d1e[_0x931f15(0xf7)](_0x1b20af[_0x931f15(0x127)],_0x1b20af[_0x931f15(0x172)],_0x4c10ed=>{const _0x1536f4=_0x931f15;_0x4c10ed&&_0x1dce49[_0x1536f4(0x108)](logError,_0x1dce49[_0x1536f4(0x130)],_0x4c10ed);});}async[_0x9d338a(0x16b)](_0x22ab60){const _0x4bc08f=_0x9d338a,_0xbd7964={'QMhXs':function(_0x11b8af,_0x47efa3,_0x21fa86){return _0x11b8af(_0x47efa3,_0x21fa86);},'DOaEP':_0x4bc08f(0x12d),'Ffjsv':function(_0x360efc,_0xb55e05){return _0x360efc(_0xb55e05);},'XoZQK':'INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)'},_0x30439a=this['db'][_0x4bc08f(0x100)](_0xbd7964[_0x4bc08f(0x14b)]);return new Promise((_0x5f2f92,_0x1b8c6c)=>{const _0x5db9fd=_0x4bc08f;_0x30439a[_0x5db9fd(0xf7)](_0x22ab60[_0x5db9fd(0x175)],_0x22ab60[_0x5db9fd(0x160)],_0x22ab60[_0x5db9fd(0x134)],_0x22ab60[_0x5db9fd(0x150)],_0x22ab60['uuid'],_0x22ab60[_0x5db9fd(0x141)],JSON[_0x5db9fd(0x10b)](_0x22ab60[_0x5db9fd(0x129)]),_0x22ab60[_0x5db9fd(0x177)],_0x22ab60[_0x5db9fd(0x172)],function(_0x193460){const _0xcb1c15=_0x5db9fd;_0x193460&&(_0xbd7964[_0xcb1c15(0x178)](logError,_0xbd7964[_0xcb1c15(0x116)],_0x193460),_0x1b8c6c(_0x193460)),_0xbd7964['Ffjsv'](_0x5f2f92,null);});});}async[_0x9d338a(0x120)](_0xd85b7b,_0x427ee1){const _0x25be8f={'MgssX':function(_0x4d12bd,_0x57a04f,_0x37dc51){return _0x4d12bd(_0x57a04f,_0x37dc51);},'QqwXN':function(_0x18ecb4,_0x5e78df){return _0x18ecb4(_0x5e78df);}},_0x434838=this['db']['prepare'](_0xd85b7b);return new Promise((_0x3515e3,_0x29ef74)=>{const _0x45e259=_0xcf9e,_0x47fff1={'GoAGm':function(_0x47d144,_0x353ae5,_0x36bdd2){const _0xca4694=_0xcf9e;return _0x25be8f[_0xca4694(0x157)](_0x47d144,_0x353ae5,_0x36bdd2);},'WNgAA':function(_0x4f611e,_0x2981d3){const _0x272b25=_0xcf9e;return _0x25be8f[_0x272b25(0xf2)](_0x4f611e,_0x2981d3);}};_0x434838[_0x45e259(0x168)](..._0x427ee1,(_0x27ccf1,_0x2cedb5)=>{const _0x37c73e=_0x45e259;_0x27ccf1&&(_0x47fff1['GoAGm'](logError,_0x37c73e(0x131),_0x27ccf1),_0x29ef74(_0x27ccf1)),_0x2cedb5&&(_0x2cedb5[_0x37c73e(0x129)]=JSON[_0x37c73e(0x14e)](_0x2cedb5[_0x37c73e(0x129)])),_0x47fff1[_0x37c73e(0x10c)](_0x3515e3,_0x2cedb5);});});}async[_0x9d338a(0x10f)](_0x3c6d1b){const _0x310fb4=_0x9d338a,_0x18f2d4={'XgOrm':'SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?'};return this[_0x310fb4(0x120)](_0x18f2d4[_0x310fb4(0x138)],[_0x3c6d1b]);}async[_0x9d338a(0x166)](_0x277343){const _0x5df064=_0x9d338a,_0x4b1408={'bMzof':_0x5df064(0x114)};return this['getFileCache'](_0x4b1408[_0x5df064(0x14c)],[_0x277343]);}async[_0x9d338a(0x13d)](_0x54bb51){const _0x4f68eb=_0x9d338a,_0x1e4fce={'WDEMj':_0x4f68eb(0x126),'CsZSr':function(_0x5a198a,_0x449fc4){return _0x5a198a(_0x449fc4);},'dLgCR':_0x4f68eb(0x122)},_0x471569=this['db'][_0x4f68eb(0x100)](_0x1e4fce[_0x4f68eb(0x15b)]);return new Promise((_0x54b94f,_0x3ec530)=>{const _0x29e611=_0x4f68eb;_0x471569[_0x29e611(0xf7)](_0x54bb51['path'],_0x54bb51[_0x29e611(0x134)],_0x54bb51['uuid'],function(_0xd3ddce){const _0x4d3603=_0x29e611;_0xd3ddce&&(logError(_0x1e4fce[_0x4d3603(0x170)],_0xd3ddce),_0x1e4fce[_0x4d3603(0x152)](_0x3ec530,_0xd3ddce)),_0x1e4fce[_0x4d3603(0x152)](_0x54b94f,null);});});}async[_0x9d338a(0x156)](){const _0x5a7b3f=_0x9d338a,_0x135db9={'VthHx':function(_0x3b5bcb,_0x260b51,_0x355c9f){return _0x3b5bcb(_0x260b51,_0x355c9f);},'ITafN':'db\x20could\x20not\x20get\x20temp\x20uin\x20map','rVYVU':function(_0x35a00e,_0x1998ed){return _0x35a00e(_0x1998ed);},'ucMKj':_0x5a7b3f(0x16e)},_0x39154d=_0x135db9[_0x5a7b3f(0x109)];return new Promise((_0x2d9dd6,_0x5830c6)=>{this['db']['all'](_0x39154d,(_0x31f17e,_0x16da97)=>{const _0x586e61=_0xcf9e;_0x31f17e&&(_0x135db9['VthHx'](logError,_0x135db9[_0x586e61(0xf6)],_0x31f17e),_0x135db9[_0x586e61(0x11e)](_0x5830c6,_0x31f17e));const _0x46a341={};_0x16da97[_0x586e61(0x180)](_0x1f616b=>{const _0x26a9a3=_0x586e61;_0x46a341[_0x1f616b[_0x26a9a3(0x119)]]=_0x1f616b[_0x26a9a3(0x11f)];}),_0x135db9[_0x586e61(0x11e)](_0x2d9dd6,_0x46a341);});});}async[_0x9d338a(0x110)](_0x11affd){const _0x3f1852=_0x9d338a,_0x188e95={'cWFoW':function(_0xf9ca47,_0x2df5aa,_0x7db1f8){return _0xf9ca47(_0x2df5aa,_0x7db1f8);},'KKBTM':'SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?'},_0x3880a8=_0x188e95[_0x3f1852(0x12e)];return new Promise((_0x3ccd0f,_0x836b28)=>{const _0x36fe5b=_0x3f1852,_0x3d2dea={'UkYgj':function(_0x34923c,_0x46448b,_0x1e711c){const _0x4041fe=_0xcf9e;return _0x188e95[_0x4041fe(0x153)](_0x34923c,_0x46448b,_0x1e711c);},'XkjSw':_0x36fe5b(0x105)};this['db'][_0x36fe5b(0x168)](_0x3880a8,[_0x11affd],(_0x4829c9,_0x8341ab)=>{const _0x5ee5ac=_0x36fe5b;_0x4829c9&&(_0x3d2dea['UkYgj'](logError,_0x3d2dea[_0x5ee5ac(0xfe)],_0x4829c9),_0x836b28(_0x4829c9)),_0x3ccd0f(_0x8341ab?.[_0x5ee5ac(0x11f)]);});});}async[_0x9d338a(0x121)](_0x10954d,_0x1c0f1a){const _0x362f46=_0x9d338a,_0x515cc6={'tgzfT':function(_0x1121da,_0x15e100,_0x484d7d){return _0x1121da(_0x15e100,_0x484d7d);},'YfmrZ':'db\x20could\x20not\x20add\x20temp\x20uin','fDeiL':function(_0x5c4bcb,_0x4baf9c){return _0x5c4bcb(_0x4baf9c);},'nucCh':'INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)'},_0x548ed8=await this[_0x362f46(0x110)](_0x10954d);if(!_0x548ed8){const _0xa4d7f8=this['db'][_0x362f46(0x100)](_0x515cc6['nucCh']);return new Promise((_0xc37ed1,_0x4074af)=>{const _0x1bec7a=_0x362f46;_0xa4d7f8[_0x1bec7a(0xf7)](_0x10954d,_0x1c0f1a,function(_0x38e1d1){const _0x3d47af=_0x1bec7a;_0x38e1d1&&(_0x515cc6[_0x3d47af(0x11a)](logError,_0x515cc6[_0x3d47af(0x15a)],_0x38e1d1),_0x515cc6['fDeiL'](_0x4074af,_0x38e1d1)),_0x515cc6[_0x3d47af(0x136)](_0xc37ed1,null);});});}}}export const dbUtil=new DBUtil();