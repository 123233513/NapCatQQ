const _0xb05f79=_0x4726;(function(_0x1a3eb1,_0x40f16a){const _0x39099c=_0x4726,_0x514e35=_0x1a3eb1();while(!![]){try{const _0x4a8a5c=parseInt(_0x39099c(0x114))/0x1+-parseInt(_0x39099c(0xd2))/0x2*(parseInt(_0x39099c(0x10b))/0x3)+-parseInt(_0x39099c(0x11a))/0x4*(parseInt(_0x39099c(0xd8))/0x5)+parseInt(_0x39099c(0xee))/0x6*(-parseInt(_0x39099c(0x10c))/0x7)+-parseInt(_0x39099c(0x140))/0x8*(parseInt(_0x39099c(0x145))/0x9)+-parseInt(_0x39099c(0xf3))/0xa+parseInt(_0x39099c(0x111))/0xb;if(_0x4a8a5c===_0x40f16a)break;else _0x514e35['push'](_0x514e35['shift']());}catch(_0x3f8a75){_0x514e35['push'](_0x514e35['shift']());}}}(_0x2c06,0xdba95));import _0x2c0625 from'sqlite3';import{logDebug,logError}from'@/common/utils/log';function _0x4726(_0x1c333f,_0x4b20c5){const _0x2c0652=_0x2c06();return _0x4726=function(_0x472668,_0x1c2ce5){_0x472668=_0x472668-0xcc;let _0x28b340=_0x2c0652[_0x472668];return _0x28b340;},_0x4726(_0x1c333f,_0x4b20c5);}import{NTQQMsgApi}from'@/core';class DBUtilBase{['db'];async[_0xb05f79(0x11e)](_0x470d9d){const _0xd9f198={'eOTiU':function(_0x47b95b,_0x434186,_0x42b0b3){return _0x47b95b(_0x434186,_0x42b0b3);},'OvMHV':function(_0xdc298){return _0xdc298();},'qEotn':function(_0x319109,_0x3abc84){return _0x319109|_0x3abc84;}};if(this['db'])return;return new Promise((_0x67d4db,_0x110211)=>{const _0x556c59=_0x4726;this['db']=new _0x2c0625[(_0x556c59(0x137))](_0x470d9d,_0xd9f198[_0x556c59(0xef)](_0x2c0625['OPEN_READWRITE'],_0x2c0625['OPEN_CREATE']),_0x163d50=>{const _0x17003c=_0x556c59;if(_0x163d50){_0xd9f198[_0x17003c(0xdd)](logError,_0x17003c(0xf7),_0x163d50),_0x110211(_0x163d50);return;}this['createTable'](),_0xd9f198['OvMHV'](_0x67d4db);});});}[_0xb05f79(0x143)](){const _0x139169=_0xb05f79;throw new Error(_0x139169(0xec));}[_0xb05f79(0xe2)](){const _0x7f7521=_0xb05f79;this['db']?.[_0x7f7521(0xe2)]();}}class DBUtil extends DBUtilBase{['msgCache']=new Map();['globalMsgShortId']=-0x7ffffff8;constructor(){const _0x26a1c0=_0xb05f79,_0x3237ca={'oWJcy':function(_0x1c968b,_0x587886){return _0x1c968b>_0x587886;},'IBfMH':function(_0x3382fd,_0x5566a4){return _0x3382fd(_0x5566a4);},'qXiCG':function(_0x2aed82,_0x21a4e3){return _0x2aed82(_0x21a4e3);},'JBNLc':_0x26a1c0(0xf1),'tylCo':function(_0x40143b,_0x4acde6){return _0x40143b*_0x4acde6;}};super();const _0xa97945=_0x3237ca[_0x26a1c0(0xe8)](0x3e8*0x3c,0xa);setInterval(()=>{const _0x5a7006=_0x26a1c0;_0x3237ca[_0x5a7006(0x10a)](logDebug,_0x3237ca[_0x5a7006(0xdb)]),this[_0x5a7006(0x117)]['forEach']((_0xf892e2,_0x10cad2)=>{const _0x1e692=_0x5a7006;_0x3237ca['oWJcy'](Date[_0x1e692(0xce)]()-_0x3237ca[_0x1e692(0x128)](parseInt,_0xf892e2[_0x1e692(0x147)])*0x3e8,_0xa97945)&&this[_0x1e692(0x117)][_0x1e692(0x118)](_0x10cad2);});},_0xa97945);}async['init'](_0x20c34d){const _0x8ab96f=_0xb05f79;await super[_0x8ab96f(0x11e)](_0x20c34d),this[_0x8ab96f(0x152)]=await this[_0x8ab96f(0x12c)]();}[_0xb05f79(0x143)](){const _0x426ebd=_0xb05f79,_0x5b3149={'DhIzD':'Could\x20not\x20create\x20table\x20msgs','jUbtI':function(_0x120a27,_0x21d1c2,_0x5d3ba4){return _0x120a27(_0x21d1c2,_0x5d3ba4);},'xTfiz':'Could\x20not\x20create\x20table\x20files','ocsQO':function(_0x2a2031,_0x19b9e6,_0x2ce3cc){return _0x2a2031(_0x19b9e6,_0x2ce3cc);}},_0x172f8e='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)';this['db'][_0x426ebd(0xf5)](_0x172f8e,function(_0x4fbf04){const _0x10bf5f=_0x426ebd;_0x4fbf04&&logError(_0x5b3149['DhIzD'],_0x4fbf04[_0x10bf5f(0x12e)]);});const _0xf6c24b=_0x426ebd(0x136);this['db'][_0x426ebd(0xf5)](_0xf6c24b,function(_0x4a815f){_0x4a815f&&_0x5b3149['jUbtI'](logError,_0x5b3149['xTfiz'],_0x4a815f);});const _0x1cb2f5=_0x426ebd(0xcd);this['db']['run'](_0x1cb2f5,function(_0x339955){const _0x218fa1=_0x426ebd;_0x339955&&_0x5b3149[_0x218fa1(0x116)](logError,_0x218fa1(0xf2),_0x339955);});}async[_0xb05f79(0x12c)](){const _0x4f0a5b=_0xb05f79,_0x153024={'uHgfb':function(_0x2a4ec8,_0x12e389,_0x12e399){return _0x2a4ec8(_0x12e389,_0x12e399);},'pDTOm':_0x4f0a5b(0x148),'nQYvo':function(_0x334c6d,_0x16c958){return _0x334c6d(_0x16c958);},'HpLqc':_0x4f0a5b(0x101),'pWZZT':function(_0x4b7771,_0xe8757){return _0x4b7771(_0xe8757);},'GNwHN':'SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs'};return new Promise((_0x4af5c3,_0x3f02e3)=>{const _0x24972f=_0x4f0a5b;this['db'][_0x24972f(0x13a)](_0x153024[_0x24972f(0x149)],(_0x4dfc2c,_0x2273df)=>{const _0x45c024=_0x24972f;if(_0x4dfc2c)return _0x153024[_0x45c024(0x115)](logDebug,_0x153024[_0x45c024(0x127)],_0x4dfc2c),_0x153024[_0x45c024(0x11b)](_0x4af5c3,-0x7ffffff8);logDebug(_0x153024[_0x45c024(0xcf)],_0x2273df?.[_0x45c024(0xe3)]),_0x153024[_0x45c024(0x141)](_0x4af5c3,_0x2273df?.['maxId']??-0x7ffffff8);});});}async['getMsg'](_0x48e3d8,_0x5ac9c7){const _0x4258d9=_0xb05f79,_0x516025={'UXNGf':_0x4258d9(0x13c),'ItEmp':function(_0x3c276d,_0xb3ae83){return _0x3c276d(_0xb3ae83);}},_0x2b9a13=this['db'][_0x4258d9(0xed)](_0x48e3d8);return new Promise((_0x403dd7,_0x432517)=>{const _0x41b41b={'kgrtj':function(_0x3cfb57,_0x2b1f64){return _0x3cfb57(_0x2b1f64);}};_0x2b9a13['get'](..._0x5ac9c7,(_0x4d6c2d,_0x55908b)=>{const _0x47630f=_0x4726,_0x1d1c9f={'KKDgx':function(_0x33ee77,_0xc82326){return _0x33ee77(_0xc82326);}};if(_0x4d6c2d)return logError(_0x516025[_0x47630f(0xfb)],_0x4d6c2d,_0x48e3d8,_0x5ac9c7),_0x516025['ItEmp'](_0x403dd7,null);if(!_0x55908b){_0x516025['ItEmp'](_0x403dd7,null);return;}const _0x41652e=_0x55908b[_0x47630f(0xe7)];NTQQMsgApi[_0x47630f(0x153)]({'peerUid':_0x55908b['peerUid'],'chatType':_0x55908b['chatType']},[_0x41652e])[_0x47630f(0x14b)](_0x56c7f6=>{const _0xe31d43=_0x47630f,_0x1a52cb=_0x56c7f6[_0xe31d43(0x14e)][0x0];if(!_0x1a52cb){_0x41b41b['kgrtj'](_0x403dd7,null);return;}_0x1a52cb['id']=_0x55908b['shortId'],_0x41b41b[_0xe31d43(0x12a)](_0x403dd7,_0x1a52cb);})['catch'](_0x491991=>{const _0x6bcd8a=_0x47630f;_0x1d1c9f[_0x6bcd8a(0xfc)](_0x403dd7,null);});});});}async['getMsgByShortId'](_0x22082d){const _0x570f1c=_0xb05f79,_0x4e2770={'IXgtw':_0x570f1c(0x130)};if(this['msgCache']['has'](_0x22082d))return this['msgCache'][_0x570f1c(0x13a)](_0x22082d);const _0x102bc1=_0x4e2770['IXgtw'];return this[_0x570f1c(0x11c)](_0x102bc1,[_0x22082d]);}async[_0xb05f79(0x10f)](_0x1509bb){const _0x30a65b=_0xb05f79,_0x4b884c={'pnyQZ':_0x30a65b(0x151)};if(this['msgCache'][_0x30a65b(0x105)](_0x1509bb))return this[_0x30a65b(0x117)]['get'](_0x1509bb);return this[_0x30a65b(0x11c)](_0x4b884c[_0x30a65b(0x14f)],[_0x1509bb]);}async['getMsgBySeq'](_0x2247fe,_0x311d29){const _0x19168d=_0xb05f79,_0x13c3b6='SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?';return this[_0x19168d(0x11c)](_0x13c3b6,[_0x2247fe,_0x311d29]);}async[_0xb05f79(0x14c)](_0x243e50,_0x44c064=!![]){const _0x3ca0df=_0xb05f79,_0x2a9b6={'lkuDm':function(_0x43befe,_0x1692e5,_0x4610c4){return _0x43befe(_0x1692e5,_0x4610c4);},'jzdOF':_0x3ca0df(0xf9),'ylnaX':_0x3ca0df(0xea),'CdSVE':function(_0x3e8b06,_0xb34ea3){return _0x3e8b06(_0xb34ea3);}},_0x450dcd=await this[_0x3ca0df(0x10f)](_0x243e50[_0x3ca0df(0x108)]);if(_0x450dcd){if(_0x44c064)this[_0x3ca0df(0x120)](_0x243e50)['then']();return _0x450dcd['id'];}const _0x5c69a0=this['db'][_0x3ca0df(0xed)](_0x3ca0df(0x107)),_0x55290d=++this[_0x3ca0df(0x152)];return _0x243e50['id']=_0x55290d,_0x2a9b6[_0x3ca0df(0x123)](logDebug,_0x3ca0df(0x10d)+_0x243e50[_0x3ca0df(0x108)]+',\x20短id:\x20'+_0x243e50['id']),this[_0x3ca0df(0x117)][_0x3ca0df(0xd5)](_0x55290d,_0x243e50),this['msgCache'][_0x3ca0df(0xd5)](_0x243e50[_0x3ca0df(0x108)],_0x243e50),_0x5c69a0[_0x3ca0df(0xf5)](this[_0x3ca0df(0x152)],_0x243e50['msgId'],_0x243e50['msgSeq'][_0x3ca0df(0x142)](),_0x243e50[_0x3ca0df(0xeb)],_0x243e50['chatType'],_0x184913=>{const _0x39e12e=_0x3ca0df,_0x19496e={'QRVuZ':function(_0x9c47cd,_0x41aaed,_0x56ba62){const _0x9fee59=_0x4726;return _0x2a9b6[_0x9fee59(0x102)](_0x9c47cd,_0x41aaed,_0x56ba62);},'pVNwG':_0x2a9b6[_0x39e12e(0x100)]};_0x184913&&(_0x184913['errno']===0x13?this['getMsgByLongId'](_0x243e50['msgId'])[_0x39e12e(0x14b)](_0x222031=>{const _0x3bfe8e=_0x39e12e;_0x222031?(this[_0x3bfe8e(0x117)]['set'](_0x55290d,_0x222031),this[_0x3bfe8e(0x117)]['set'](_0x222031[_0x3bfe8e(0x108)],_0x222031)):_0x19496e[_0x3bfe8e(0xd1)](logError,_0x19496e[_0x3bfe8e(0xd0)],_0x184913);})[_0x39e12e(0xe4)](_0x92724b=>logError(_0x39e12e(0x13d),_0x92724b)):logError(_0x2a9b6[_0x39e12e(0xf6)],_0x184913));}),_0x55290d;}async[_0xb05f79(0x120)](_0x480e7c){const _0x38e14d=_0xb05f79,_0x47ccfc={'qnclT':function(_0x9d1b1c,_0xbcdc08,_0x3c0ab2){return _0x9d1b1c(_0xbcdc08,_0x3c0ab2);},'WGIQA':_0x38e14d(0xe5),'CvJbK':_0x38e14d(0xf4)},_0xa50b1c=this[_0x38e14d(0x117)][_0x38e14d(0x13a)](_0x480e7c[_0x38e14d(0x108)]);_0xa50b1c&&Object[_0x38e14d(0xdc)](_0xa50b1c,_0x480e7c);logDebug(_0x38e14d(0xcc)+_0x480e7c['id']+_0x38e14d(0x139)+_0x480e7c[_0x38e14d(0x138)]+_0x38e14d(0x150)+_0x480e7c['msgId']);const _0x31987c=this['db'][_0x38e14d(0xed)](_0x47ccfc['CvJbK']);_0x31987c[_0x38e14d(0xf5)](_0x480e7c[_0x38e14d(0x138)],_0x480e7c[_0x38e14d(0x108)],_0x58d3ff=>{const _0x43c3b0=_0x38e14d;_0x58d3ff&&_0x47ccfc[_0x43c3b0(0xd7)](logError,_0x47ccfc[_0x43c3b0(0x11f)],_0x58d3ff);});}async[_0xb05f79(0x131)](_0x577fc4){const _0x5b49b4=_0xb05f79,_0x113c9d={'NkcRY':_0x5b49b4(0x12d),'hhnKp':function(_0x2c994c,_0x102bf6){return _0x2c994c(_0x102bf6);},'leGts':_0x5b49b4(0xe9)},_0x38f28c=this['db'][_0x5b49b4(0xed)](_0x113c9d[_0x5b49b4(0x106)]);return new Promise((_0x32c921,_0x461bd5)=>{const _0x2f195a=_0x5b49b4,_0x162cc8={'zTpgL':function(_0x30f0f0,_0x4e8d91,_0x30e11d){return _0x30f0f0(_0x4e8d91,_0x30e11d);},'jSKIZ':_0x113c9d[_0x2f195a(0xd9)],'YoLcX':function(_0xf9725b,_0x3d5d70){return _0xf9725b(_0x3d5d70);},'cXEPB':function(_0x12fd6d,_0xe2f272){const _0x4e1f5a=_0x2f195a;return _0x113c9d[_0x4e1f5a(0xe6)](_0x12fd6d,_0xe2f272);}};_0x38f28c[_0x2f195a(0xf5)](_0x577fc4[_0x2f195a(0x13b)],_0x577fc4[_0x2f195a(0xf8)],_0x577fc4[_0x2f195a(0x103)],_0x577fc4[_0x2f195a(0xdf)],_0x577fc4[_0x2f195a(0x133)],_0x577fc4['elementType'],JSON['stringify'](_0x577fc4[_0x2f195a(0xd6)]),_0x577fc4[_0x2f195a(0x121)],_0x577fc4[_0x2f195a(0x108)],function(_0x415b06){const _0x4b8cee=_0x2f195a;_0x415b06&&(_0x162cc8[_0x4b8cee(0x112)](logError,_0x162cc8[_0x4b8cee(0x11d)],_0x415b06),_0x162cc8[_0x4b8cee(0x135)](_0x461bd5,_0x415b06)),_0x162cc8[_0x4b8cee(0x146)](_0x32c921,null);});});}async[_0xb05f79(0x12f)](_0x440067,_0x277a2c){const _0x49586e=_0xb05f79,_0xa2f65a={'CZRKd':function(_0x3ae023,_0xb4c09f,_0x157db0){return _0x3ae023(_0xb4c09f,_0x157db0);},'ayLvl':_0x49586e(0x13f),'eYLYQ':function(_0x556872,_0x544413){return _0x556872(_0x544413);}},_0x514d1d=this['db'][_0x49586e(0xed)](_0x440067);return new Promise((_0x4cc654,_0x158eb0)=>{const _0x1b04c7=_0x49586e;_0x514d1d[_0x1b04c7(0x13a)](..._0x277a2c,(_0x129922,_0x62d76a)=>{const _0x5b6932=_0x1b04c7;_0x129922&&(_0xa2f65a[_0x5b6932(0x10e)](logError,_0xa2f65a[_0x5b6932(0xff)],_0x129922),_0xa2f65a['eYLYQ'](_0x158eb0,_0x129922)),_0x62d76a&&(_0x62d76a[_0x5b6932(0xd6)]=JSON[_0x5b6932(0x14a)](_0x62d76a[_0x5b6932(0xd6)])),_0x4cc654(_0x62d76a);});});}async[_0xb05f79(0x12b)](_0x4cdb60){const _0x1c9869=_0xb05f79,_0x50b569={'SzpEk':_0x1c9869(0x125)};return this['getFileCache'](_0x50b569['SzpEk'],[_0x4cdb60]);}async[_0xb05f79(0x14d)](_0x8093ef){const _0x255bb4=_0xb05f79;return this[_0x255bb4(0x12f)](_0x255bb4(0x134),[_0x8093ef]);}async['updateFileCache'](_0x159530){const _0x250e11=_0xb05f79,_0x3b28a1={'bxhaA':function(_0x18f2c0,_0x16ef10,_0x3a113){return _0x18f2c0(_0x16ef10,_0x3a113);},'OdJNp':_0x250e11(0x13e)},_0x55535a=this['db']['prepare'](_0x3b28a1[_0x250e11(0xda)]);return new Promise((_0x77f475,_0x1228c3)=>{const _0x64f45c=_0x250e11;_0x55535a[_0x64f45c(0xf5)](_0x159530['path'],_0x159530['url'],_0x159530[_0x64f45c(0x133)],function(_0x54d175){const _0x13d02a=_0x64f45c;_0x54d175&&(_0x3b28a1[_0x13d02a(0x122)](logError,_0x13d02a(0x129),_0x54d175),_0x1228c3(_0x54d175)),_0x77f475(null);});});}async[_0xb05f79(0xfd)](){const _0x5989ee=_0xb05f79,_0x28ed84={'eWCST':function(_0x41523,_0x54cd51){return _0x41523(_0x54cd51);},'HnQhC':_0x5989ee(0xd3)},_0x1fa221=_0x28ed84['HnQhC'];return new Promise((_0x27937f,_0x11f1d3)=>{const _0x29f089=_0x5989ee;this['db'][_0x29f089(0x109)](_0x1fa221,(_0x36136e,_0x2ccaf6)=>{const _0x59b7b3=_0x29f089;_0x36136e&&(logError('db\x20could\x20not\x20get\x20temp\x20uin\x20map',_0x36136e),_0x28ed84['eWCST'](_0x11f1d3,_0x36136e));const _0x3fa6d4={};_0x2ccaf6[_0x59b7b3(0x113)](_0x2bf524=>{_0x3fa6d4[_0x2bf524['uin']]=_0x2bf524['uid'];}),_0x27937f(_0x3fa6d4);});});}async['getUidByTempUin'](_0x3ae95b){const _0x1866f9=_0xb05f79,_0x118d68={'ZzRtz':function(_0x1725a4,_0x5755c4,_0x3eae2e){return _0x1725a4(_0x5755c4,_0x3eae2e);},'PbBoB':function(_0x9a3fee,_0xf25a4){return _0x9a3fee(_0xf25a4);},'ItslP':_0x1866f9(0x154)},_0x12b6d2=_0x118d68[_0x1866f9(0x119)];return new Promise((_0x3a109e,_0x2c25d3)=>{const _0x2b479a=_0x1866f9,_0x31603b={'ZDZVY':function(_0x49a8f1,_0x2e696f,_0x192a92){const _0x3943ab=_0x4726;return _0x118d68[_0x3943ab(0x110)](_0x49a8f1,_0x2e696f,_0x192a92);},'iXSDY':function(_0x4b864d,_0x3ebe00){const _0x491113=_0x4726;return _0x118d68[_0x491113(0x126)](_0x4b864d,_0x3ebe00);},'mWnee':function(_0x14479c,_0x1079fe){return _0x14479c(_0x1079fe);}};this['db'][_0x2b479a(0x13a)](_0x12b6d2,[_0x3ae95b],(_0x1c6663,_0x495a26)=>{const _0x53f03e=_0x2b479a;_0x1c6663&&(_0x31603b[_0x53f03e(0x124)](logError,'db\x20could\x20not\x20get\x20temp\x20uin\x20map',_0x1c6663),_0x31603b[_0x53f03e(0xe1)](_0x2c25d3,_0x1c6663)),_0x31603b[_0x53f03e(0xe0)](_0x3a109e,_0x495a26?.['uid']);});});}async[_0xb05f79(0x104)](_0x9851ff,_0x5089ee){const _0x51568=_0xb05f79,_0x341bdc={'quvSQ':function(_0x28b664,_0x35db2f,_0x106c3b){return _0x28b664(_0x35db2f,_0x106c3b);}},_0x17a92f=await this[_0x51568(0xde)](_0x9851ff);if(!_0x17a92f){const _0x5cd0bd=this['db'][_0x51568(0xed)](_0x51568(0x132));return new Promise((_0x3baa82,_0x56b7cd)=>{const _0x76b054=_0x51568,_0x3eebad={'NeWcz':function(_0x448f1e,_0x27dffc,_0x5c85b9){const _0x294aea=_0x4726;return _0x341bdc[_0x294aea(0xfe)](_0x448f1e,_0x27dffc,_0x5c85b9);},'YhRYk':_0x76b054(0xf0),'ofNPQ':function(_0x4e28bb,_0x5cb4b7){return _0x4e28bb(_0x5cb4b7);}};_0x5cd0bd[_0x76b054(0xf5)](_0x9851ff,_0x5089ee,function(_0x2520aa){const _0x274346=_0x76b054;_0x2520aa&&(_0x3eebad[_0x274346(0xfa)](logError,_0x3eebad[_0x274346(0x144)],_0x2520aa),_0x3eebad[_0x274346(0xd4)](_0x56b7cd,_0x2520aa)),_0x3eebad[_0x274346(0xd4)](_0x3baa82,null);});});}}}export const dbUtil=new DBUtil();function _0x2c06(){const _0x47d345=['Database','msgSeq',',\x20seq:\x20','get','name','Could\x20not\x20get\x20msg','db\x20getMsgByLongId\x20error','UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?','db\x20could\x20not\x20get\x20file\x20cache','7712NIzWtW','pWZZT','toString','createTable','YhRYk','6705KnNlUK','cXEPB','msgTime','Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','GNwHN','parse','then','addMsg','getFileCacheByUuid','msgList','pnyQZ',',\x20msgId:\x20','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?','globalMsgShortId','getMsgsByMsgId','SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?','更新消息,\x20shortId:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','now','HpLqc','pVNwG','QRVuZ','3447026UmqOoG','SELECT\x20*\x20FROM\x20temp_uins','ofNPQ','set','element','qnclT','95Keldid','NkcRY','OdJNp','JBNLc','assign','eOTiU','getUidByTempUin','size','mWnee','iXSDY','close','maxId','catch','updateMsg\x20db\x20error','hhnKp','longId','tylCo','INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','db\x20could\x20not\x20add\x20msg','peerUid','Method\x20not\x20implemented.','prepare','16494GNgloE','qEotn','db\x20could\x20not\x20add\x20temp\x20uin','清理消息缓存','Could\x20not\x20create\x20table\x20temp_uins','12528760yDGZbS','UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?','run','ylnaX','Could\x20not\x20connect\x20to\x20database','path','db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id','NeWcz','UXNGf','KKDgx','getReceivedTempUinMap','quvSQ','ayLvl','jzdOF','数据库中消息最大短id','lkuDm','url','addTempUin','has','leGts','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','msgId','all','qXiCG','3NLEYBs','4200nhPbSo','记录消息到数据库,\x20消息长id:\x20','CZRKd','getMsgByLongId','ZzRtz','80303960fxPaVw','zTpgL','forEach','525225IfqSxc','uHgfb','ocsQO','msgCache','delete','ItslP','333028biSgzt','nQYvo','getMsg','jSKIZ','init','WGIQA','updateMsg','elementId','bxhaA','CdSVE','ZDZVY','SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?','PbBoB','pDTOm','IBfMH','db\x20could\x20not\x20update\x20file\x20cache','kgrtj','getFileCacheByName','getCurrentMaxShortId','db\x20could\x20not\x20add\x20file','stack','getFileCache','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?','addFileCache','INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)','uuid','SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?','YoLcX','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)'];_0x2c06=function(){return _0x47d345;};return _0x2c06();}