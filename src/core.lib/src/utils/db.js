const _0x3607e2=_0x54e9;(function(_0x44954e,_0x2ec8bb){const _0x42d397=_0x54e9,_0x44a5ad=_0x44954e();while(!![]){try{const _0xef5abe=parseInt(_0x42d397(0x169))/0x1*(-parseInt(_0x42d397(0x14f))/0x2)+-parseInt(_0x42d397(0x134))/0x3+-parseInt(_0x42d397(0x15a))/0x4*(parseInt(_0x42d397(0x112))/0x5)+-parseInt(_0x42d397(0xff))/0x6+-parseInt(_0x42d397(0x117))/0x7+-parseInt(_0x42d397(0x10e))/0x8+parseInt(_0x42d397(0x116))/0x9*(parseInt(_0x42d397(0x11c))/0xa);if(_0xef5abe===_0x2ec8bb)break;else _0x44a5ad['push'](_0x44a5ad['shift']());}catch(_0x966f76){_0x44a5ad['push'](_0x44a5ad['shift']());}}}(_0x3685,0x1e9a9));function _0x54e9(_0x577753,_0x5b5cd7){const _0x36855e=_0x3685();return _0x54e9=function(_0x54e95d,_0xe69631){_0x54e95d=_0x54e95d-0xe4;let _0x4c36df=_0x36855e[_0x54e95d];return _0x4c36df;},_0x54e9(_0x577753,_0x5b5cd7);}import _0x5b7392 from'sqlite3';import{logDebug,logError}from'@/common/utils/log';import{NTQQMsgApi}from'@/core';class DBUtilBase{['db'];async['init'](_0x18c287){const _0x4380c6=_0x54e9,_0x506648={'OIWKg':function(_0x39340d,_0x2f2a00,_0x1e9dce){return _0x39340d(_0x2f2a00,_0x1e9dce);},'JEEsg':_0x4380c6(0xf0),'sVqWl':function(_0x5659b6,_0x2bae7a){return _0x5659b6(_0x2bae7a);},'pNHqw':function(_0x44807a){return _0x44807a();}};if(this['db'])return;return new Promise((_0x42080e,_0x226069)=>{const _0x460071=_0x4380c6,_0x3ca3f4={'EFROr':function(_0x4296c2,_0x1e9863,_0x2668db){return _0x506648['OIWKg'](_0x4296c2,_0x1e9863,_0x2668db);},'gUOcE':_0x506648[_0x460071(0x132)],'YoHyv':function(_0x19f421,_0x3c5e7f){const _0x1e0205=_0x460071;return _0x506648[_0x1e0205(0x11e)](_0x19f421,_0x3c5e7f);},'rNobl':function(_0x58acc2){const _0x6f68ef=_0x460071;return _0x506648[_0x6f68ef(0x109)](_0x58acc2);}};this['db']=new _0x5b7392[(_0x460071(0x154))](_0x18c287,_0x5b7392[_0x460071(0x105)]|_0x5b7392[_0x460071(0x14c)],_0x3a92c2=>{const _0x38bc69=_0x460071;if(_0x3a92c2){_0x3ca3f4[_0x38bc69(0x12c)](logError,_0x3ca3f4[_0x38bc69(0xfa)],_0x3a92c2),_0x3ca3f4[_0x38bc69(0xfe)](_0x226069,_0x3a92c2);return;}this[_0x38bc69(0x14b)](),_0x3ca3f4[_0x38bc69(0x10a)](_0x42080e);});});}['createTable'](){const _0x188b16=_0x54e9;throw new Error(_0x188b16(0x168));}['close'](){const _0x814eb1=_0x54e9;this['db']?.[_0x814eb1(0x150)]();}}function _0x3685(){const _0x2e7775=['globalMsgShortId','vwPnA','db\x20could\x20not\x20get\x20temp\x20uin\x20map','delete','db\x20could\x20not\x20add\x20temp\x20uin','AXnHE','updateMsg','mgFWh','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','rqRHM','fzfkO','dYuFx','getCurrentMaxShortId','msgSeq','uQlrT','Bmxkn','db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id','size','createTable','OPEN_CREATE','path','数据库中消息最大短id','2BHiJjd','close','catch','UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?','maxId','Database','ZQbpZ','msgCache','forEach','uuid','msgTime','8116XoOyYC','hfWiB','IROsq','updateMsg\x20db\x20error','get','addFileCache','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?','Could\x20not\x20create\x20table\x20files','uid','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?','url','set','db\x20getMsgByLongId\x20error','Method\x20not\x20implemented.','27883JEfXmt','Could\x20not\x20create\x20table\x20msgs','updateFileCache','prepare','addMsg',',\x20msgId:\x20','peerUid','getFileCacheByName','stringify','fZfHT','Rqtlk',',\x20seq:\x20','清理消息缓存','WevhE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','Could\x20not\x20connect\x20to\x20database','elementId','element','INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)','bIKMh','getMsgBySeq','MYglZ','msgId','db\x20could\x20not\x20add\x20msg','parse','gUOcE','MIoSU','Fydth','rOLRD','YoHyv','88896IQAjVB','msgList','getMsg','errno','qjNLf','SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?','OPEN_READWRITE','HuXHc','run','SELECT\x20*\x20FROM\x20temp_uins','pNHqw','rNobl','addTempUin','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','XVKHn','553432xRqHOZ','shortId','getMsgByLongId','assign','610VVaePa','PjyFV','getMsgsByMsgId','rkfuQ','2227059VFcdLl','1394855bOcaWE','DQgVA','getMsgByShortId','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?','hWOPr','30VVTNRt','hSpul','sVqWl','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?','YvxxV','init','chatType','FnJDk','pAYWL','getReceivedTempUinMap','has','FWvxp','BPHIk','all','db\x20could\x20not\x20update\x20file\x20cache','getUidByTempUin','EFROr','UGCzV','hIBfH','getFileCache','oKXrx','sbYjC','JEEsg','XPxLI','174957pFKJkV','wGuLp','qnNjz','eixkS','lRBND'];_0x3685=function(){return _0x2e7775;};return _0x3685();}class DBUtil extends DBUtilBase{['msgCache']=new Map();[_0x3607e2(0x139)]=-0x7ffffff8;constructor(){const _0x4f5974=_0x3607e2,_0x513821={'WevhE':function(_0x324584,_0x1db5f5){return _0x324584>_0x1db5f5;},'hfWiB':function(_0x583554,_0x1cdabe){return _0x583554-_0x1cdabe;},'JWpHY':function(_0x1d3037,_0x4dd3c4){return _0x1d3037*_0x4dd3c4;},'Rqtlk':function(_0x2c532e,_0xf49d51){return _0x2c532e(_0xf49d51);},'YvxxV':_0x4f5974(0xed),'hIBfH':function(_0x38598d,_0x89c6ef){return _0x38598d*_0x89c6ef;},'bIKMh':function(_0x1ef1a5,_0x5bf255){return _0x1ef1a5*_0x5bf255;},'eixkS':function(_0x40a8f7,_0x3f55a4,_0x250ddb){return _0x40a8f7(_0x3f55a4,_0x250ddb);}};super();const _0x33a205=_0x513821[_0x4f5974(0x12e)](_0x513821[_0x4f5974(0xf4)](0x3e8,0x3c),0xa);_0x513821[_0x4f5974(0x137)](setInterval,()=>{const _0x409db7=_0x4f5974;_0x513821[_0x409db7(0xeb)](logDebug,_0x513821[_0x409db7(0x120)]),this['msgCache'][_0x409db7(0x157)]((_0xaf0a0a,_0xf28f32)=>{const _0x5541de=_0x409db7;_0x513821[_0x5541de(0xee)](_0x513821[_0x5541de(0x15b)](Date['now'](),_0x513821['JWpHY'](parseInt(_0xaf0a0a[_0x5541de(0x159)]),0x3e8)),_0x33a205)&&this[_0x5541de(0x156)][_0x5541de(0x13c)](_0xf28f32);});},_0x33a205);}async['init'](_0x2d7889){const _0x1a9b39=_0x3607e2;await super[_0x1a9b39(0x121)](_0x2d7889),this[_0x1a9b39(0x139)]=await this[_0x1a9b39(0x145)]();}[_0x3607e2(0x14b)](){const _0x2ac975=_0x3607e2,_0x317bb6={'BPHIk':function(_0x228063,_0x34c2a0,_0x4d3953){return _0x228063(_0x34c2a0,_0x4d3953);},'UGCzV':_0x2ac975(0x16a),'mgFWh':function(_0x2e2289,_0x254e80,_0x1a8a62){return _0x2e2289(_0x254e80,_0x1a8a62);},'fzfkO':_0x2ac975(0x161),'dYuFx':function(_0x21b3c3,_0x3b9d13,_0x3d2934){return _0x21b3c3(_0x3b9d13,_0x3d2934);},'rkfuQ':'Could\x20not\x20create\x20table\x20temp_uins'},_0x1cc40b=_0x2ac975(0x10c);this['db']['run'](_0x1cc40b,function(_0xa707c6){const _0x2a235e=_0x2ac975;_0xa707c6&&_0x317bb6[_0x2a235e(0x128)](logError,_0x317bb6[_0x2a235e(0x12d)],_0xa707c6['stack']);});const _0x48e4f1=_0x2ac975(0xef);this['db']['run'](_0x48e4f1,function(_0x168a91){const _0x6a806b=_0x2ac975;_0x168a91&&_0x317bb6[_0x6a806b(0x140)](logError,_0x317bb6[_0x6a806b(0x143)],_0x168a91);});const _0x29d8a7=_0x2ac975(0x163);this['db'][_0x2ac975(0x107)](_0x29d8a7,function(_0x1cf529){const _0x3d63b9=_0x2ac975;_0x1cf529&&_0x317bb6[_0x3d63b9(0x144)](logError,_0x317bb6[_0x3d63b9(0x115)],_0x1cf529);});}async[_0x3607e2(0x145)](){const _0x321c0e={'BxAJV':'Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','rqRHM':function(_0x16c43c,_0x3b0ef7){return _0x16c43c(_0x3b0ef7);},'lRBND':'SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs'};return new Promise((_0x1d9a92,_0x5a9efb)=>{const _0x494d27=_0x54e9,_0x3c6d5c={'xJwzO':_0x321c0e['BxAJV'],'FWvxp':function(_0x58a4c4,_0x351894){const _0x4e3050=_0x54e9;return _0x321c0e[_0x4e3050(0x142)](_0x58a4c4,_0x351894);}};this['db'][_0x494d27(0x15e)](_0x321c0e[_0x494d27(0x138)],(_0x59c4d2,_0x2520f5)=>{const _0x214b85=_0x494d27;if(_0x59c4d2)return logDebug(_0x3c6d5c['xJwzO'],_0x59c4d2),_0x3c6d5c[_0x214b85(0x127)](_0x1d9a92,-0x7ffffff8);logDebug(_0x214b85(0x14e),_0x2520f5?.['maxId']),_0x1d9a92(_0x2520f5?.[_0x214b85(0x153)]??-0x7ffffff8);});});}async[_0x3607e2(0x101)](_0x4ce343,_0x5864ea){const _0x33dade=_0x3607e2,_0x476ebb={'TEWSl':'Could\x20not\x20get\x20msg','IddOS':function(_0x2f5e08,_0x22206a){return _0x2f5e08(_0x22206a);}},_0x5241e1=this['db'][_0x33dade(0xe4)](_0x4ce343);return new Promise((_0x1f9e8e,_0x4aa081)=>{const _0x325f44={'vwPnA':function(_0x4370f6,_0x32cdbc){return _0x4370f6(_0x32cdbc);},'FnJDk':_0x476ebb['TEWSl'],'Fydth':function(_0x4a1160,_0x517525){return _0x476ebb['IddOS'](_0x4a1160,_0x517525);}};_0x5241e1['get'](..._0x5864ea,(_0x147fd2,_0x25e4e7)=>{const _0x2d341a=_0x54e9,_0x305141={'gCnYD':function(_0x4555cd,_0x4a0d72){return _0x4555cd(_0x4a0d72);},'KJWKu':function(_0x3106b5,_0x436881){const _0xc74d5=_0x54e9;return _0x325f44[_0xc74d5(0x13a)](_0x3106b5,_0x436881);}};if(_0x147fd2)return logError(_0x325f44[_0x2d341a(0x123)],_0x147fd2,_0x4ce343,_0x5864ea),_0x325f44[_0x2d341a(0xfc)](_0x1f9e8e,null);if(!_0x25e4e7){_0x325f44['vwPnA'](_0x1f9e8e,null);return;}const _0x3a58ee=_0x25e4e7['longId'];NTQQMsgApi[_0x2d341a(0x114)]({'peerUid':_0x25e4e7[_0x2d341a(0xe7)],'chatType':_0x25e4e7['chatType']},[_0x3a58ee])['then'](_0x15d9e9=>{const _0x164f45=_0x2d341a,_0xf303f6=_0x15d9e9[_0x164f45(0x100)][0x0];if(!_0xf303f6){_0x305141['gCnYD'](_0x1f9e8e,null);return;}_0xf303f6['id']=_0x25e4e7[_0x164f45(0x10f)],_0x305141['gCnYD'](_0x1f9e8e,_0xf303f6);})[_0x2d341a(0x151)](_0x1933ea=>{_0x305141['KJWKu'](_0x1f9e8e,null);});});});}async[_0x3607e2(0x119)](_0x3bd191){const _0x31207f=_0x3607e2,_0x164c36={'uQlrT':_0x31207f(0x11a)};if(this[_0x31207f(0x156)][_0x31207f(0x126)](_0x3bd191))return this['msgCache']['get'](_0x3bd191);const _0x180eb8=_0x164c36[_0x31207f(0x147)];return this['getMsg'](_0x180eb8,[_0x3bd191]);}async[_0x3607e2(0x110)](_0x4eba13){const _0x245b53=_0x3607e2;if(this[_0x245b53(0x156)]['has'](_0x4eba13))return this['msgCache']['get'](_0x4eba13);return this[_0x245b53(0x101)](_0x245b53(0x160),[_0x4eba13]);}async[_0x3607e2(0xf5)](_0x4e4b2d,_0x486fe9){const _0x3d0151=_0x3607e2,_0x4cae5a={'BMIbg':_0x3d0151(0x11f)},_0x350b64=_0x4cae5a['BMIbg'];return this[_0x3d0151(0x101)](_0x350b64,[_0x4e4b2d,_0x486fe9]);}async[_0x3607e2(0xe5)](_0x1ffc1d,_0x282ace=!![]){const _0x2d21fc=_0x3607e2,_0x4d91c2={'oKXrx':function(_0x2f3c76,_0x102722,_0x2097a0){return _0x2f3c76(_0x102722,_0x2097a0);},'EGFqQ':function(_0x2d3fb4,_0x201214){return _0x2d3fb4===_0x201214;},'pAYWL':function(_0x2c730e,_0x2d1a0d,_0x1665a7){return _0x2c730e(_0x2d1a0d,_0x1665a7);},'MYglZ':function(_0x285c07,_0x4e1342){return _0x285c07(_0x4e1342);}},_0x79dd42=await this[_0x2d21fc(0x110)](_0x1ffc1d[_0x2d21fc(0xf7)]);if(_0x79dd42){if(_0x282ace)this[_0x2d21fc(0x13f)](_0x1ffc1d)['then']();return _0x79dd42['id'];}const _0xdd608c=this['db'][_0x2d21fc(0xe4)](_0x2d21fc(0x141)),_0x6f1def=++this[_0x2d21fc(0x139)];return _0x1ffc1d['id']=_0x6f1def,_0x4d91c2[_0x2d21fc(0xf6)](logDebug,'记录消息到数据库,\x20消息长id:\x20'+_0x1ffc1d[_0x2d21fc(0xf7)]+',\x20短id:\x20'+_0x1ffc1d['id']),this[_0x2d21fc(0x156)]['set'](_0x6f1def,_0x1ffc1d),this['msgCache'][_0x2d21fc(0x166)](_0x1ffc1d[_0x2d21fc(0xf7)],_0x1ffc1d),_0xdd608c[_0x2d21fc(0x107)](this[_0x2d21fc(0x139)],_0x1ffc1d[_0x2d21fc(0xf7)],_0x1ffc1d[_0x2d21fc(0x146)]['toString'](),_0x1ffc1d[_0x2d21fc(0xe7)],_0x1ffc1d[_0x2d21fc(0x122)],_0x2030f7=>{const _0x13771f=_0x2d21fc;_0x2030f7&&(_0x4d91c2['EGFqQ'](_0x2030f7[_0x13771f(0x102)],0x13)?this[_0x13771f(0x110)](_0x1ffc1d[_0x13771f(0xf7)])['then'](_0x1ec849=>{const _0x46e4e6=_0x13771f;_0x1ec849?(this[_0x46e4e6(0x156)]['set'](_0x6f1def,_0x1ec849),this['msgCache']['set'](_0x1ec849[_0x46e4e6(0xf7)],_0x1ec849)):_0x4d91c2[_0x46e4e6(0x130)](logError,_0x46e4e6(0x149),_0x2030f7);})['catch'](_0x1bc102=>logError(_0x13771f(0x167),_0x1bc102)):_0x4d91c2[_0x13771f(0x124)](logError,_0x13771f(0xf8),_0x2030f7));}),_0x6f1def;}async[_0x3607e2(0x13f)](_0x35a9d5){const _0x35f928=_0x3607e2,_0x5420f9={'DQgVA':function(_0x4b3ee4,_0x28cd51,_0x4a80a7){return _0x4b3ee4(_0x28cd51,_0x4a80a7);},'MIoSU':function(_0x2ea150,_0x2c2d39){return _0x2ea150(_0x2c2d39);},'hSpul':_0x35f928(0x164)},_0x3c36e2=this[_0x35f928(0x156)][_0x35f928(0x15e)](_0x35a9d5[_0x35f928(0xf7)]);_0x3c36e2&&Object[_0x35f928(0x111)](_0x3c36e2,_0x35a9d5);_0x5420f9[_0x35f928(0xfb)](logDebug,'更新消息,\x20shortId:'+_0x35a9d5['id']+_0x35f928(0xec)+_0x35a9d5[_0x35f928(0x146)]+_0x35f928(0xe6)+_0x35a9d5[_0x35f928(0xf7)]);const _0x192dca=this['db'][_0x35f928(0xe4)](_0x5420f9[_0x35f928(0x11d)]);_0x192dca['run'](_0x35a9d5[_0x35f928(0x146)],_0x35a9d5[_0x35f928(0xf7)],_0x2cf5ce=>{const _0x54716c=_0x35f928;_0x2cf5ce&&_0x5420f9[_0x54716c(0x118)](logError,_0x54716c(0x15d),_0x2cf5ce);});}async[_0x3607e2(0x15f)](_0x3730b8){const _0x3d507e=_0x3607e2,_0x441fcb={'Bmxkn':function(_0x326200,_0x16f920){return _0x326200(_0x16f920);}},_0x3bcac8=this['db'][_0x3d507e(0xe4)]('INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)');return new Promise((_0x29f617,_0x54c9e5)=>{const _0xa24e14=_0x3d507e,_0x47247d={'XPxLI':function(_0x49ac4d,_0x2e123f,_0x1c861c){return _0x49ac4d(_0x2e123f,_0x1c861c);},'sbYjC':'db\x20could\x20not\x20add\x20file','HuXHc':function(_0x1a8f3f,_0x93b40c){const _0x2fb8d0=_0x54e9;return _0x441fcb[_0x2fb8d0(0x148)](_0x1a8f3f,_0x93b40c);}};_0x3bcac8[_0xa24e14(0x107)](_0x3730b8['name'],_0x3730b8[_0xa24e14(0x14d)],_0x3730b8['url'],_0x3730b8[_0xa24e14(0x14a)],_0x3730b8[_0xa24e14(0x158)],_0x3730b8['elementType'],JSON[_0xa24e14(0xe9)](_0x3730b8[_0xa24e14(0xf2)]),_0x3730b8[_0xa24e14(0xf1)],_0x3730b8[_0xa24e14(0xf7)],function(_0x430284){const _0x3c4f24=_0xa24e14;_0x430284&&(_0x47247d[_0x3c4f24(0x133)](logError,_0x47247d[_0x3c4f24(0x131)],_0x430284),_0x47247d[_0x3c4f24(0x106)](_0x54c9e5,_0x430284)),_0x29f617(null);});});}async[_0x3607e2(0x12f)](_0x5962a7,_0x48243e){const _0xa1c214=_0x3607e2,_0x3110f9={'hWOPr':'db\x20could\x20not\x20get\x20file\x20cache','xJXFn':function(_0x2022f7,_0x12c117){return _0x2022f7(_0x12c117);}},_0xc3f2db=this['db'][_0xa1c214(0xe4)](_0x5962a7);return new Promise((_0x1f8bdf,_0x390062)=>{const _0x5545ad=_0xa1c214;_0xc3f2db[_0x5545ad(0x15e)](..._0x48243e,(_0x351215,_0x2faa3f)=>{const _0x1cbe7a=_0x5545ad;_0x351215&&(logError(_0x3110f9[_0x1cbe7a(0x11b)],_0x351215),_0x3110f9['xJXFn'](_0x390062,_0x351215)),_0x2faa3f&&(_0x2faa3f[_0x1cbe7a(0xf2)]=JSON[_0x1cbe7a(0xf9)](_0x2faa3f[_0x1cbe7a(0xf2)])),_0x3110f9['xJXFn'](_0x1f8bdf,_0x2faa3f);});});}async[_0x3607e2(0xe8)](_0x4b5e2a){const _0x59af3f=_0x3607e2,_0x2b909d={'MKSPW':'SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?'};return this[_0x59af3f(0x12f)](_0x2b909d['MKSPW'],[_0x4b5e2a]);}async['getFileCacheByUuid'](_0x3308ab){const _0x450253=_0x3607e2;return this[_0x450253(0x12f)]('SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?',[_0x3308ab]);}async[_0x3607e2(0x16b)](_0x47814e){const _0x112464=_0x3607e2,_0x4d468a={'fZfHT':function(_0x426a67,_0x5ebfcf,_0xcb03de){return _0x426a67(_0x5ebfcf,_0xcb03de);},'XVKHn':_0x112464(0x12a),'EuIMD':function(_0xe1df38,_0x20115b){return _0xe1df38(_0x20115b);},'rOLRD':_0x112464(0x152)},_0x585c92=this['db'][_0x112464(0xe4)](_0x4d468a[_0x112464(0xfd)]);return new Promise((_0x5795c2,_0x2e1d71)=>{const _0x258571=_0x112464;_0x585c92[_0x258571(0x107)](_0x47814e[_0x258571(0x14d)],_0x47814e[_0x258571(0x165)],_0x47814e[_0x258571(0x158)],function(_0x521b9b){const _0x174a63=_0x258571;_0x521b9b&&(_0x4d468a[_0x174a63(0xea)](logError,_0x4d468a[_0x174a63(0x10d)],_0x521b9b),_0x2e1d71(_0x521b9b)),_0x4d468a['EuIMD'](_0x5795c2,null);});});}async[_0x3607e2(0x125)](){const _0xc0aa3a=_0x3607e2,_0x5e0c36={'qnNjz':function(_0xfdaa58,_0x1b3b12,_0x7144cb){return _0xfdaa58(_0x1b3b12,_0x7144cb);},'qjNLf':_0xc0aa3a(0x13b),'JTnIC':function(_0x3a1775,_0x24222d){return _0x3a1775(_0x24222d);},'IROsq':_0xc0aa3a(0x108)},_0x2e66d3=_0x5e0c36[_0xc0aa3a(0x15c)];return new Promise((_0x1e806d,_0x2d74cc)=>{const _0x757918=_0xc0aa3a;this['db'][_0x757918(0x129)](_0x2e66d3,(_0x4220de,_0x5cc311)=>{const _0x386348=_0x757918;_0x4220de&&(_0x5e0c36[_0x386348(0x136)](logError,_0x5e0c36[_0x386348(0x103)],_0x4220de),_0x5e0c36['JTnIC'](_0x2d74cc,_0x4220de));const _0x5c3178={};_0x5cc311['forEach'](_0x2ffd32=>{const _0x2998b2=_0x386348;_0x5c3178[_0x2ffd32['uin']]=_0x2ffd32[_0x2998b2(0x162)];}),_0x1e806d(_0x5c3178);});});}async[_0x3607e2(0x12b)](_0x175a7b){const _0x4d1f0f=_0x3607e2,_0xdff391={'PjyFV':'db\x20could\x20not\x20get\x20temp\x20uin\x20map','ajrrN':function(_0x55c2b0,_0xfa4762){return _0x55c2b0(_0xfa4762);},'ihMTp':_0x4d1f0f(0x104)},_0x3ab60a=_0xdff391['ihMTp'];return new Promise((_0x22b0cb,_0x4a5e0f)=>{const _0x38b867=_0x4d1f0f,_0x208eb2={'AXnHE':_0xdff391[_0x38b867(0x113)],'gyMUy':function(_0x261a51,_0xf7b2b6){return _0xdff391['ajrrN'](_0x261a51,_0xf7b2b6);}};this['db']['get'](_0x3ab60a,[_0x175a7b],(_0x3b6925,_0x11a77a)=>{const _0x1c0202=_0x38b867;_0x3b6925&&(logError(_0x208eb2[_0x1c0202(0x13e)],_0x3b6925),_0x208eb2['gyMUy'](_0x4a5e0f,_0x3b6925)),_0x22b0cb(_0x11a77a?.['uid']);});});}async[_0x3607e2(0x10b)](_0x4e5b06,_0x5b341){const _0x55c26c=_0x3607e2,_0xd890e3={'wGuLp':function(_0x3663d4,_0x4b92d5,_0x1fb24f){return _0x3663d4(_0x4b92d5,_0x1fb24f);},'oiVWl':_0x55c26c(0x13d),'ZQbpZ':function(_0x41f2db,_0x4f917c){return _0x41f2db(_0x4f917c);}},_0x21ef29=await this[_0x55c26c(0x12b)](_0x4e5b06);if(!_0x21ef29){const _0x1d8cb8=this['db'][_0x55c26c(0xe4)](_0x55c26c(0xf3));return new Promise((_0xe178bd,_0x3c484b)=>{const _0x20b3cf=_0x55c26c;_0x1d8cb8[_0x20b3cf(0x107)](_0x4e5b06,_0x5b341,function(_0x511570){const _0x5dd1b3=_0x20b3cf;_0x511570&&(_0xd890e3[_0x5dd1b3(0x135)](logError,_0xd890e3['oiVWl'],_0x511570),_0xd890e3[_0x5dd1b3(0x155)](_0x3c484b,_0x511570)),_0xd890e3[_0x5dd1b3(0x155)](_0xe178bd,null);});});}}}export const dbUtil=new DBUtil();