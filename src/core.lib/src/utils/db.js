const _0x1bed1d=_0x14d5;(function(_0x596dbc,_0x1fb963){const _0x3e8620=_0x14d5,_0x1eb3dd=_0x596dbc();while(!![]){try{const _0x207c8e=-parseInt(_0x3e8620(0x187))/0x1+-parseInt(_0x3e8620(0x13a))/0x2+-parseInt(_0x3e8620(0x13d))/0x3*(parseInt(_0x3e8620(0x121))/0x4)+-parseInt(_0x3e8620(0x147))/0x5*(-parseInt(_0x3e8620(0x11e))/0x6)+-parseInt(_0x3e8620(0x185))/0x7+parseInt(_0x3e8620(0x10f))/0x8+-parseInt(_0x3e8620(0x10a))/0x9*(-parseInt(_0x3e8620(0x158))/0xa);if(_0x207c8e===_0x1fb963)break;else _0x1eb3dd['push'](_0x1eb3dd['shift']());}catch(_0x751a7c){_0x1eb3dd['push'](_0x1eb3dd['shift']());}}}(_0x2c70,0xc9804));import _0x3bf997 from'sqlite3';import{logDebug,logError}from'@/common/utils/log';import{NTQQMsgApi}from'@/core';function _0x2c70(){const _0x105d65=['uGLLW','DYnJZ','记录消息到数据库,\x20消息长id:\x20','msgTime','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?','jMvMf','elementId','dvkAV','QPiDK','apZLA','WTxWx','rdnTi','path','db\x20could\x20not\x20get\x20file\x20cache','createTable','updateMsg\x20db\x20error','OPEN_READWRITE','get','getFileCacheByUuid','qKOdI','UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?','assign','peerUid','LMyAB','db\x20could\x20not\x20add\x20msg','fvAiw','OPEN_CREATE','db\x20could\x20not\x20get\x20temp\x20uin\x20map','jBgQq','rZnKy','updateFileCache','now','DjSpE','748027fdsjoV','OzUyG','603483jhaWIm','msgId','Could\x20not\x20get\x20msg','element','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?','db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','addFileCache','cpJYl','getMsg','uqigB','forEach','stack','shortId','neFMU','bvIDz','41067cFLmlG','iWvfn','khyzr','getFileCache','BGdUK','11237256AmIwOW','msgSeq','uid','prepare','addTempUin','maxId','Could\x20not\x20create\x20table\x20files','bnpNr','ANflN','INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','addMsg','has','gISSF','KrMmj','msgCache','12084ltFBPz','SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs','ArsTr','2608664SPASLA','Hffse','db\x20could\x20not\x20update\x20file\x20cache','uin','WvtUx','bnHNx','LNJaH','CuoBj','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','parse','globalMsgShortId','getMsgByShortId','getCurrentMaxShortId','catch','getMsgByLongId','Could\x20not\x20create\x20table\x20temp_uins','Method\x20not\x20implemented.','delete','mpVYq','YiXzc','SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?','SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','longId','2005434GprTyM',',\x20短id:\x20','toString','6AzvgNU','SUWqT','Could\x20not\x20create\x20table\x20msgs','url',',\x20seq:\x20','YkMzs','更新消息,\x20shortId:','SELECT\x20*\x20FROM\x20temp_uins','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?','init','2020MtITDH','cVYHi','name','aIbFn','set','yanYw','all','aXLPK','msgList','stringify','uuid','chatType','OQYKz','akTGk','db\x20could\x20not\x20add\x20file','db\x20getMsgByLongId\x20error','uktXW','3560iiFuPk','size','dMlYq','RzATH','jCDtT','then','OaqDi','elementType','aAAea','close','errno','run'];_0x2c70=function(){return _0x105d65;};return _0x2c70();}class DBUtilBase{['db'];async[_0x1bed1d(0x146)](_0x18fbb4){const _0x47d984={'apZLA':function(_0x5919bc,_0x1cb753,_0x934c21){return _0x5919bc(_0x1cb753,_0x934c21);},'gISSF':'Could\x20not\x20connect\x20to\x20database','neFMU':function(_0x57f64d,_0x17292d){return _0x57f64d(_0x17292d);},'RVuLR':function(_0x21ef45){return _0x21ef45();},'jBgQq':function(_0x53194d,_0x213946){return _0x53194d|_0x213946;}};if(this['db'])return;return new Promise((_0xc60c6b,_0x2c390b)=>{const _0x56e5c4=_0x14d5;this['db']=new _0x3bf997['Database'](_0x18fbb4,_0x47d984[_0x56e5c4(0x180)](_0x3bf997[_0x56e5c4(0x174)],_0x3bf997[_0x56e5c4(0x17e)]),_0x149171=>{const _0x4638ec=_0x56e5c4;if(_0x149171){_0x47d984[_0x4638ec(0x16d)](logError,_0x47d984[_0x4638ec(0x11b)],_0x149171),_0x47d984[_0x4638ec(0x108)](_0x2c390b,_0x149171);return;}this[_0x4638ec(0x172)](),_0x47d984['RVuLR'](_0xc60c6b);});});}[_0x1bed1d(0x172)](){const _0x494c13=_0x1bed1d;throw new Error(_0x494c13(0x131));}[_0x1bed1d(0x161)](){const _0x51ee37=_0x1bed1d;this['db']?.[_0x51ee37(0x161)]();}}function _0x14d5(_0x590596,_0x66fc9c){const _0x2c70c5=_0x2c70();return _0x14d5=function(_0x14d591,_0x2687c4){_0x14d591=_0x14d591-0xfe;let _0x2195be=_0x2c70c5[_0x14d591];return _0x2195be;},_0x14d5(_0x590596,_0x66fc9c);}class DBUtil extends DBUtilBase{[_0x1bed1d(0x11d)]=new Map();[_0x1bed1d(0x12b)]=-0x7ffffff8;constructor(){const _0xfc83b6=_0x1bed1d,_0x5be2cf={'RzATH':function(_0x42b83f,_0x5d8a98){return _0x42b83f-_0x5d8a98;},'WvtUx':function(_0x26e2d8,_0x255f70){return _0x26e2d8*_0x255f70;},'QPiDK':function(_0x21e9b4,_0x4489dd){return _0x21e9b4(_0x4489dd);},'sSsMF':'清理消息缓存'};super();const _0x6c0ba7=_0x5be2cf[_0xfc83b6(0x125)](0x3e8*0x3c,0xa);setInterval(()=>{const _0x1ce09c=_0xfc83b6;_0x5be2cf[_0x1ce09c(0x16c)](logDebug,_0x5be2cf['sSsMF']),this[_0x1ce09c(0x11d)][_0x1ce09c(0x105)]((_0x2f05e6,_0x4c07bd)=>{const _0x20f5d6=_0x1ce09c;_0x5be2cf[_0x20f5d6(0x15b)](Date[_0x20f5d6(0x183)](),_0x5be2cf[_0x20f5d6(0x125)](parseInt(_0x2f05e6[_0x20f5d6(0x167)]),0x3e8))>_0x6c0ba7&&this[_0x20f5d6(0x11d)][_0x20f5d6(0x132)](_0x4c07bd);});},_0x6c0ba7);}async[_0x1bed1d(0x146)](_0x548bcd){const _0x3117f9=_0x1bed1d;await super[_0x3117f9(0x146)](_0x548bcd),this[_0x3117f9(0x12b)]=await this[_0x3117f9(0x12d)]();}[_0x1bed1d(0x172)](){const _0x1a39c6=_0x1bed1d,_0x4aee64={'qKOdI':function(_0x45b71b,_0x160de3,_0x3d3a34){return _0x45b71b(_0x160de3,_0x3d3a34);},'uktXW':_0x1a39c6(0x13f),'DYnJZ':_0x1a39c6(0x115),'YiXzc':function(_0x556490,_0x8e946a,_0x220b7c){return _0x556490(_0x8e946a,_0x220b7c);}},_0x1349d9=_0x1a39c6(0x129);this['db'][_0x1a39c6(0x163)](_0x1349d9,function(_0x281e48){const _0x9f02e2=_0x1a39c6;_0x281e48&&_0x4aee64[_0x9f02e2(0x177)](logError,_0x4aee64[_0x9f02e2(0x157)],_0x281e48[_0x9f02e2(0x106)]);});const _0x238ca2='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)';this['db']['run'](_0x238ca2,function(_0x178a57){const _0x178653=_0x1a39c6;_0x178a57&&_0x4aee64['qKOdI'](logError,_0x4aee64[_0x178653(0x165)],_0x178a57);});const _0x48dcfe=_0x1a39c6(0x137);this['db']['run'](_0x48dcfe,function(_0x4d307c){const _0x529c30=_0x1a39c6;_0x4d307c&&_0x4aee64[_0x529c30(0x134)](logError,_0x529c30(0x130),_0x4d307c);});}async['getCurrentMaxShortId'](){const _0x187513=_0x1bed1d,_0x481b20={'DjSpE':function(_0x3c49da,_0x12ae73,_0x5d2935){return _0x3c49da(_0x12ae73,_0x5d2935);},'fvAiw':_0x187513(0x138),'RociT':'数据库中消息最大短id','bnpNr':function(_0x12f893,_0x26de2e){return _0x12f893(_0x26de2e);},'akTGk':_0x187513(0x11f)};return new Promise((_0x4830e6,_0x5531d7)=>{const _0x59df6d=_0x187513;this['db'][_0x59df6d(0x175)](_0x481b20[_0x59df6d(0x154)],(_0x38d146,_0x271b79)=>{const _0x5d78de=_0x59df6d;if(_0x38d146)return _0x481b20[_0x5d78de(0x184)](logDebug,_0x481b20[_0x5d78de(0x17d)],_0x38d146),_0x4830e6(-0x7ffffff8);_0x481b20[_0x5d78de(0x184)](logDebug,_0x481b20['RociT'],_0x271b79?.[_0x5d78de(0x114)]),_0x481b20[_0x5d78de(0x116)](_0x4830e6,_0x271b79?.[_0x5d78de(0x114)]??-0x7ffffff8);});});}async['getMsg'](_0x5bbba2,_0x3464de){const _0x5269b8=_0x1bed1d,_0x5a5bc7={'khyzr':function(_0x4f3576,_0x2be4e8){return _0x4f3576(_0x2be4e8);},'rtPlg':function(_0x12ddf2,_0x4d772f,_0x357497,_0x25a5f0,_0xd3d2fb){return _0x12ddf2(_0x4d772f,_0x357497,_0x25a5f0,_0xd3d2fb);},'aIbFn':_0x5269b8(0x189),'ZnjuQ':function(_0x2b19d2,_0x278db0){return _0x2b19d2(_0x278db0);}},_0xfa79ce=this['db'][_0x5269b8(0x112)](_0x5bbba2);return new Promise((_0x552514,_0x577476)=>{const _0x158ac7=_0x5269b8;_0xfa79ce[_0x158ac7(0x175)](..._0x3464de,(_0x256e0f,_0x55524e)=>{const _0x49b2ab=_0x158ac7,_0x5edede={'jKQPc':function(_0x51301e,_0x5628b9){const _0x98c426=_0x14d5;return _0x5a5bc7[_0x98c426(0x10c)](_0x51301e,_0x5628b9);}};if(_0x256e0f)return _0x5a5bc7['rtPlg'](logError,_0x5a5bc7[_0x49b2ab(0x14a)],_0x256e0f,_0x5bbba2,_0x3464de),_0x5a5bc7[_0x49b2ab(0x10c)](_0x552514,null);if(!_0x55524e){_0x5a5bc7['ZnjuQ'](_0x552514,null);return;}const _0x35be9d=_0x55524e[_0x49b2ab(0x139)];NTQQMsgApi['getMsgsByMsgId']({'peerUid':_0x55524e[_0x49b2ab(0x17a)],'chatType':_0x55524e[_0x49b2ab(0x152)]},[_0x35be9d])['then'](_0xe83dc8=>{const _0x30d625=_0x49b2ab,_0x1b30e9=_0xe83dc8[_0x30d625(0x14f)][0x0];if(!_0x1b30e9){_0x5edede['jKQPc'](_0x552514,null);return;}_0x1b30e9['id']=_0x55524e[_0x30d625(0x107)],_0x552514(_0x1b30e9);})[_0x49b2ab(0x12e)](_0x483ef7=>{_0x552514(null);});});});}async[_0x1bed1d(0x12c)](_0x29c036){const _0x11651c=_0x1bed1d,_0x2b0869={'cpJYl':_0x11651c(0xfe)};if(this[_0x11651c(0x11d)][_0x11651c(0x11a)](_0x29c036))return this[_0x11651c(0x11d)]['get'](_0x29c036);const _0x4759b5=_0x2b0869[_0x11651c(0x102)];return this[_0x11651c(0x103)](_0x4759b5,[_0x29c036]);}async[_0x1bed1d(0x12f)](_0x2facbb){const _0x3349ea=_0x1bed1d,_0x4b417b={'BGdUK':_0x3349ea(0x145)};if(this[_0x3349ea(0x11d)][_0x3349ea(0x11a)](_0x2facbb))return this[_0x3349ea(0x11d)][_0x3349ea(0x175)](_0x2facbb);return this[_0x3349ea(0x103)](_0x4b417b[_0x3349ea(0x10e)],[_0x2facbb]);}async['getMsgBySeq'](_0x181eea,_0x3814d5){const _0x49286c=_0x1bed1d,_0x216036=_0x49286c(0x168);return this['getMsg'](_0x216036,[_0x181eea,_0x3814d5]);}async[_0x1bed1d(0x119)](_0xa3f551,_0x303465=!![]){const _0x2637ea=_0x1bed1d,_0x585449={'OaqDi':function(_0x30d124,_0xe3276,_0x4b75ef){return _0x30d124(_0xe3276,_0x4b75ef);},'YkMzs':_0x2637ea(0xff),'mpVYq':function(_0x493144,_0x3e354d){return _0x493144===_0x3e354d;},'jMvMf':_0x2637ea(0x17c),'yanYw':_0x2637ea(0x100),'HrWgo':function(_0x3297a5,_0x8468e3){return _0x3297a5(_0x8468e3);}},_0x212ed1=await this['getMsgByLongId'](_0xa3f551['msgId']);if(_0x212ed1){if(_0x303465)this['updateMsg'](_0xa3f551)['then']();return _0x212ed1['id'];}const _0x44121a=this['db'][_0x2637ea(0x112)](_0x585449[_0x2637ea(0x14c)]),_0x5a33db=++this['globalMsgShortId'];return _0xa3f551['id']=_0x5a33db,_0x585449['HrWgo'](logDebug,_0x2637ea(0x166)+_0xa3f551['msgId']+_0x2637ea(0x13b)+_0xa3f551['id']),this[_0x2637ea(0x11d)][_0x2637ea(0x14b)](_0x5a33db,_0xa3f551),this[_0x2637ea(0x11d)]['set'](_0xa3f551[_0x2637ea(0x188)],_0xa3f551),_0x44121a[_0x2637ea(0x163)](this['globalMsgShortId'],_0xa3f551[_0x2637ea(0x188)],_0xa3f551['msgSeq'][_0x2637ea(0x13c)](),_0xa3f551[_0x2637ea(0x17a)],_0xa3f551[_0x2637ea(0x152)],_0x175b9c=>{const _0x1fbc34=_0x2637ea,_0xbaa9e={'uGLLW':function(_0x121963,_0x1a57ef,_0x3a0a93){const _0x128d08=_0x14d5;return _0x585449[_0x128d08(0x15e)](_0x121963,_0x1a57ef,_0x3a0a93);},'aAAea':_0x585449[_0x1fbc34(0x142)]};_0x175b9c&&(_0x585449[_0x1fbc34(0x133)](_0x175b9c[_0x1fbc34(0x162)],0x13)?this[_0x1fbc34(0x12f)](_0xa3f551['msgId'])[_0x1fbc34(0x15d)](_0x222e29=>{const _0x56a21b=_0x1fbc34;_0x222e29?(this[_0x56a21b(0x11d)][_0x56a21b(0x14b)](_0x5a33db,_0x222e29),this['msgCache'][_0x56a21b(0x14b)](_0x222e29['msgId'],_0x222e29)):_0xbaa9e[_0x56a21b(0x164)](logError,_0xbaa9e[_0x56a21b(0x160)],_0x175b9c);})[_0x1fbc34(0x12e)](_0x8da4a0=>logError(_0x1fbc34(0x156),_0x8da4a0)):_0x585449['OaqDi'](logError,_0x585449[_0x1fbc34(0x169)],_0x175b9c));}),_0x5a33db;}async['updateMsg'](_0x81e150){const _0x449dd9=_0x1bed1d,_0x3e546b={'uqigB':_0x449dd9(0x173),'bnHNx':function(_0x3a5bf6,_0x1294d4){return _0x3a5bf6(_0x1294d4);}},_0x3a937d=this['msgCache'][_0x449dd9(0x175)](_0x81e150[_0x449dd9(0x188)]);_0x3a937d&&Object[_0x449dd9(0x179)](_0x3a937d,_0x81e150);_0x3e546b[_0x449dd9(0x126)](logDebug,_0x449dd9(0x143)+_0x81e150['id']+_0x449dd9(0x141)+_0x81e150[_0x449dd9(0x110)]+',\x20msgId:\x20'+_0x81e150['msgId']);const _0x4e1cd4=this['db'][_0x449dd9(0x112)](_0x449dd9(0x178));_0x4e1cd4['run'](_0x81e150['msgSeq'],_0x81e150[_0x449dd9(0x188)],_0x5b53db=>{const _0x166de4=_0x449dd9;_0x5b53db&&logError(_0x3e546b[_0x166de4(0x104)],_0x5b53db);});}async[_0x1bed1d(0x101)](_0x232d7b){const _0x263485=_0x1bed1d,_0x39878e={'KrMmj':_0x263485(0x155),'rdnTi':function(_0x241803,_0x5319cd){return _0x241803(_0x5319cd);},'yvcPE':_0x263485(0x118)},_0x534836=this['db'][_0x263485(0x112)](_0x39878e['yvcPE']);return new Promise((_0x5d5ad6,_0xb00f2a)=>{const _0x588599=_0x263485,_0x3b14db={'aXLPK':_0x39878e[_0x588599(0x11c)],'LNJaH':function(_0x39dba7,_0x2d4ac2){const _0x3b95d9=_0x588599;return _0x39878e[_0x3b95d9(0x16f)](_0x39dba7,_0x2d4ac2);}};_0x534836[_0x588599(0x163)](_0x232d7b[_0x588599(0x149)],_0x232d7b[_0x588599(0x170)],_0x232d7b['url'],_0x232d7b[_0x588599(0x159)],_0x232d7b['uuid'],_0x232d7b[_0x588599(0x15f)],JSON[_0x588599(0x150)](_0x232d7b[_0x588599(0x18a)]),_0x232d7b[_0x588599(0x16a)],_0x232d7b[_0x588599(0x188)],function(_0x35e4d4){const _0x40e25f=_0x588599;_0x35e4d4&&(logError(_0x3b14db[_0x40e25f(0x14e)],_0x35e4d4),_0x3b14db[_0x40e25f(0x127)](_0xb00f2a,_0x35e4d4)),_0x5d5ad6(null);});});}async[_0x1bed1d(0x10d)](_0x20ca37,_0x5bb1de){const _0xa2808a=_0x1bed1d,_0x17a6c2={'Hffse':function(_0xf0ce63,_0x59a93c,_0x51a983){return _0xf0ce63(_0x59a93c,_0x51a983);},'ArsTr':function(_0x5b9e1f,_0x30faaa){return _0x5b9e1f(_0x30faaa);}},_0x2ad478=this['db'][_0xa2808a(0x112)](_0x20ca37);return new Promise((_0x353caa,_0x23b2b0)=>{const _0xd03e79=_0xa2808a;_0x2ad478[_0xd03e79(0x175)](..._0x5bb1de,(_0x3097e6,_0x47a145)=>{const _0x1a4a52=_0xd03e79;_0x3097e6&&(_0x17a6c2[_0x1a4a52(0x122)](logError,_0x1a4a52(0x171),_0x3097e6),_0x17a6c2[_0x1a4a52(0x120)](_0x23b2b0,_0x3097e6)),_0x47a145&&(_0x47a145['element']=JSON[_0x1a4a52(0x12a)](_0x47a145[_0x1a4a52(0x18a)])),_0x353caa(_0x47a145);});});}async['getFileCacheByName'](_0x4f8766){const _0xadbd9e=_0x1bed1d,_0x35880e={'dMlYq':_0xadbd9e(0x136)};return this[_0xadbd9e(0x10d)](_0x35880e[_0xadbd9e(0x15a)],[_0x4f8766]);}async[_0x1bed1d(0x176)](_0x23778e){const _0x47db83=_0x1bed1d,_0x36bb66={'ANflN':'SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?'};return this[_0x47db83(0x10d)](_0x36bb66[_0x47db83(0x117)],[_0x23778e]);}async[_0x1bed1d(0x182)](_0x2e370e){const _0x19ab1a=_0x1bed1d,_0x470581={'ZkmCF':function(_0x11f480,_0x1c0411){return _0x11f480(_0x1c0411);},'cVYHi':'UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?'},_0x4bc56d=this['db']['prepare'](_0x470581[_0x19ab1a(0x148)]);return new Promise((_0x902650,_0x31b57f)=>{const _0x476f23=_0x19ab1a,_0x29d589={'OzUyG':function(_0x5a7481,_0x5ec0b8,_0x808d44){return _0x5a7481(_0x5ec0b8,_0x808d44);},'iWvfn':_0x476f23(0x123),'CuoBj':function(_0x2b4e19,_0x3c6ebb){return _0x470581['ZkmCF'](_0x2b4e19,_0x3c6ebb);}};_0x4bc56d[_0x476f23(0x163)](_0x2e370e['path'],_0x2e370e[_0x476f23(0x140)],_0x2e370e[_0x476f23(0x151)],function(_0x15fb02){const _0x5225f6=_0x476f23;_0x15fb02&&(_0x29d589[_0x5225f6(0x186)](logError,_0x29d589[_0x5225f6(0x10b)],_0x15fb02),_0x29d589[_0x5225f6(0x128)](_0x31b57f,_0x15fb02)),_0x902650(null);});});}async['getReceivedTempUinMap'](){const _0x344726=_0x1bed1d,_0x1f8cdb={'LMyAB':_0x344726(0x144)},_0x2a277c=_0x1f8cdb[_0x344726(0x17b)];return new Promise((_0x37d618,_0x2e41a9)=>{const _0x111946=_0x344726,_0x306d13={'jCDtT':'db\x20could\x20not\x20get\x20temp\x20uin\x20map','SUWqT':function(_0x177831,_0x53892b){return _0x177831(_0x53892b);}};this['db'][_0x111946(0x14d)](_0x2a277c,(_0x1b8b2e,_0x5a03fa)=>{const _0x5f0a00=_0x111946;_0x1b8b2e&&(logError(_0x306d13[_0x5f0a00(0x15c)],_0x1b8b2e),_0x306d13[_0x5f0a00(0x13e)](_0x2e41a9,_0x1b8b2e));const _0x2bb96b={};_0x5a03fa['forEach'](_0x5d3f2c=>{const _0x225825=_0x5f0a00;_0x2bb96b[_0x5d3f2c[_0x225825(0x124)]]=_0x5d3f2c[_0x225825(0x111)];}),_0x306d13[_0x5f0a00(0x13e)](_0x37d618,_0x2bb96b);});});}async['getUidByTempUin'](_0x556a5b){const _0x39211a=_0x1bed1d,_0x496ae1={'OQYKz':_0x39211a(0x17f),'WTxWx':function(_0x232bbb,_0x583abb){return _0x232bbb(_0x583abb);}},_0x1381a4=_0x39211a(0x135);return new Promise((_0x10e6cb,_0x520b63)=>{const _0x515aeb=_0x39211a;this['db'][_0x515aeb(0x175)](_0x1381a4,[_0x556a5b],(_0x2b20e9,_0x390ff3)=>{const _0x45f534=_0x515aeb;_0x2b20e9&&(logError(_0x496ae1[_0x45f534(0x153)],_0x2b20e9),_0x496ae1[_0x45f534(0x16e)](_0x520b63,_0x2b20e9)),_0x496ae1['WTxWx'](_0x10e6cb,_0x390ff3?.[_0x45f534(0x111)]);});});}async[_0x1bed1d(0x113)](_0x4603c9,_0x194880){const _0x4df6a0=_0x1bed1d,_0xad32a3={'rZnKy':function(_0x53d1c0,_0x5cc3f8){return _0x53d1c0(_0x5cc3f8);},'bvIDz':'INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)'},_0x1ea01f=await this['getUidByTempUin'](_0x4603c9);if(!_0x1ea01f){const _0x3ae679=this['db'][_0x4df6a0(0x112)](_0xad32a3[_0x4df6a0(0x109)]);return new Promise((_0x24159f,_0x4389e8)=>{const _0x45a945=_0x4df6a0,_0x70e0b4={'BAztA':function(_0x458ec4,_0x46110b,_0x34053a){return _0x458ec4(_0x46110b,_0x34053a);},'dvkAV':function(_0x588798,_0x338e89){const _0x1dd547=_0x14d5;return _0xad32a3[_0x1dd547(0x181)](_0x588798,_0x338e89);}};_0x3ae679[_0x45a945(0x163)](_0x4603c9,_0x194880,function(_0x4d277e){const _0x51e5c2=_0x45a945;_0x4d277e&&(_0x70e0b4['BAztA'](logError,'db\x20could\x20not\x20add\x20temp\x20uin',_0x4d277e),_0x4389e8(_0x4d277e)),_0x70e0b4[_0x51e5c2(0x16b)](_0x24159f,null);});});}}}export const dbUtil=new DBUtil();