const _0x4208f9=_0x1973;(function(_0x3c7c13,_0x9396e8){const _0x46a110=_0x1973,_0x2ec686=_0x3c7c13();while(!![]){try{const _0x5b7521=-parseInt(_0x46a110(0x1df))/0x1+parseInt(_0x46a110(0x1fe))/0x2+parseInt(_0x46a110(0x242))/0x3*(-parseInt(_0x46a110(0x255))/0x4)+parseInt(_0x46a110(0x208))/0x5*(-parseInt(_0x46a110(0x211))/0x6)+-parseInt(_0x46a110(0x201))/0x7*(parseInt(_0x46a110(0x232))/0x8)+-parseInt(_0x46a110(0x22e))/0x9*(parseInt(_0x46a110(0x245))/0xa)+parseInt(_0x46a110(0x1e2))/0xb;if(_0x5b7521===_0x9396e8)break;else _0x2ec686['push'](_0x2ec686['shift']());}catch(_0x56d312){_0x2ec686['push'](_0x2ec686['shift']());}}}(_0x3902,0x97c09));import _0x2c75ff from'sqlite3';import{logDebug,logError}from'@/common/utils/log';import{NTQQMsgApi}from'@/core';function _0x3902(){const _0x5d2899=['uin','668YPdyse','getMsgBySeq','CJdqM','element','QpzFe','KdWGv','getMsg','now','updateMsg\x20db\x20error','msgTime','db\x20could\x20not\x20get\x20temp\x20uin\x20map','has','run','path','db\x20getMsgByLongId\x20error','forEach','SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?','close','Could\x20not\x20get\x20msg','getUidByTempUin','db\x20could\x20not\x20add\x20temp\x20uin','uuid','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?','YevUF','HVEGK','FrgOV','hpxuP','updateFileCache','createTable','cUdtY','记录消息到数据库,\x20消息长id:\x20','gzIEL','686392AcZdXd','FkIIM','globalMsgShortId','24523928mmtfyX','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','wPxKg','FnAKH','getReceivedTempUinMap','all','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','AtUZt','ZAwdw',',\x20seq:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','addMsg','then','XMAmB','getFileCache','cvEyo','Method\x20not\x20implemented.','Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','FFWiE','errno','SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?','EhYkg','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','iAeRX','catch','BrDZi','QlbGj','peerUid','1160666ezPsWU','getMsgByLongId','name','762797suqnpR','url','Database','PHwtg','getMsgsByMsgId','HYDtU','chatType','57950mBkZlm','ifjeG','assign','db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id','uid','nezBo','qaMUP','Could\x20not\x20create\x20table\x20files','zjszL','12mtVEQx','VrKMp','UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?','stringify','efiYZ','delete','getCurrentMaxShortId','jkAve','stack','init','LWCGf','db\x20could\x20not\x20update\x20file\x20cache','yEOJj','fSrzl','get','UcRFT','oVfXC','清理消息缓存','db\x20could\x20not\x20add\x20file','更新消息,\x20shortId:','getMsgByShortId','PztWA','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?','db\x20could\x20not\x20get\x20file\x20cache','ZAFFI','maxId','prepare','getFileCacheByName','tVYEE','1212201imHPAy','rJZoZ','Could\x20not\x20create\x20table\x20temp_uins','toString','8mGBekt','TfcYH','updateMsg','TMtnU','HLRAz','IEWzp','aSvGQ','YbSYq','ajhwO','SgAZA','msgId','SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs','opLTs','NpcpT','rFqZI','SELECT\x20*\x20FROM\x20temp_uins','17346cJjpzl','YycIf','pOwvI','30hyNyoZ','db\x20could\x20not\x20add\x20msg','lodJn','FyOST',',\x20短id:\x20','shortId','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?','parse','size','Could\x20not\x20connect\x20to\x20database','pQUoT','msgSeq','msgCache','set','MVQmu'];_0x3902=function(){return _0x5d2899;};return _0x3902();}function _0x1973(_0x48b620,_0x4d13d1){const _0x39028a=_0x3902();return _0x1973=function(_0x197317,_0x4e5fd1){_0x197317=_0x197317-0x1d1;let _0x2c6774=_0x39028a[_0x197317];return _0x2c6774;},_0x1973(_0x48b620,_0x4d13d1);}class DBUtilBase{['db'];async[_0x4208f9(0x21a)](_0x3b392e){const _0x53359d=_0x4208f9,_0x64c2f9={'hwnHO':_0x53359d(0x24e),'HYDtU':function(_0x524755,_0xd61a41){return _0x524755(_0xd61a41);},'obDVG':function(_0x1a8971,_0x11b38a){return _0x1a8971|_0x11b38a;}};if(this['db'])return;return new Promise((_0x18a4ad,_0x4801d6)=>{const _0x4f75d4=_0x53359d;this['db']=new _0x2c75ff[(_0x4f75d4(0x203))](_0x3b392e,_0x64c2f9['obDVG'](_0x2c75ff['OPEN_READWRITE'],_0x2c75ff['OPEN_CREATE']),_0x478462=>{const _0x46451b=_0x4f75d4;if(_0x478462){logError(_0x64c2f9['hwnHO'],_0x478462),_0x64c2f9[_0x46451b(0x206)](_0x4801d6,_0x478462);return;}this[_0x46451b(0x1db)](),_0x18a4ad();});});}['createTable'](){const _0x2e10b3=_0x4208f9,_0x34a96c={'EhYkg':_0x2e10b3(0x1f2)};throw new Error(_0x34a96c[_0x2e10b3(0x1f7)]);}[_0x4208f9(0x266)](){const _0x1851a2=_0x4208f9;this['db']?.[_0x1851a2(0x266)]();}}class DBUtil extends DBUtilBase{['msgCache']=new Map();['globalMsgShortId']=-0x7ffffff8;constructor(){const _0x1bdce2=_0x4208f9,_0x28b324={'wPxKg':function(_0x2a7a23,_0x18d177){return _0x2a7a23>_0x18d177;},'kGRbt':function(_0x303c4b,_0x408d40){return _0x303c4b-_0x408d40;},'TMtnU':function(_0x23984e,_0x172f0c){return _0x23984e*_0x172f0c;},'FkIIM':function(_0x53464d,_0x6354d9){return _0x53464d(_0x6354d9);},'efiYZ':_0x1bdce2(0x222)};super();const _0x22f6a3=_0x28b324[_0x1bdce2(0x235)](0x3e8*0x3c,0xa);setInterval(()=>{const _0x2b86c2=_0x1bdce2,_0xf3aa21={'AtUZt':function(_0x4948df,_0x1b2a6c){const _0x449292=_0x1973;return _0x28b324[_0x449292(0x1e4)](_0x4948df,_0x1b2a6c);},'gYZlo':function(_0x15cf0c,_0xe254f3){return _0x28b324['kGRbt'](_0x15cf0c,_0xe254f3);},'PHwtg':function(_0x1ab648,_0x51515d){return _0x28b324['TMtnU'](_0x1ab648,_0x51515d);},'TfcYH':function(_0xe57cb,_0x1876ef){const _0x20dc2=_0x1973;return _0x28b324[_0x20dc2(0x1e0)](_0xe57cb,_0x1876ef);}};_0x28b324['FkIIM'](logDebug,_0x28b324[_0x2b86c2(0x215)]),this[_0x2b86c2(0x251)][_0x2b86c2(0x264)]((_0x389851,_0x1b572e)=>{const _0x4e8304=_0x2b86c2;_0xf3aa21[_0x4e8304(0x1e9)](_0xf3aa21['gYZlo'](Date[_0x4e8304(0x25c)](),_0xf3aa21[_0x4e8304(0x204)](_0xf3aa21[_0x4e8304(0x233)](parseInt,_0x389851[_0x4e8304(0x25e)]),0x3e8)),_0x22f6a3)&&this[_0x4e8304(0x251)][_0x4e8304(0x216)](_0x1b572e);});},_0x22f6a3);}async[_0x4208f9(0x21a)](_0x394246){const _0x15aaf1=_0x4208f9;await super['init'](_0x394246),this[_0x15aaf1(0x1e1)]=await this[_0x15aaf1(0x217)]();}['createTable'](){const _0x195770=_0x4208f9,_0x9a1343={'oVfXC':function(_0x36cb50,_0x33d12a,_0x33c602){return _0x36cb50(_0x33d12a,_0x33c602);},'rFqZI':_0x195770(0x20f),'LWCGf':function(_0xf57000,_0x1f8dfa,_0x5e05ab){return _0xf57000(_0x1f8dfa,_0x5e05ab);}},_0x287919=_0x195770(0x1f8);this['db'][_0x195770(0x261)](_0x287919,function(_0x21424b){const _0x80613d=_0x195770;_0x21424b&&logError('Could\x20not\x20create\x20table\x20msgs',_0x21424b[_0x80613d(0x219)]);});const _0xc37e1b=_0x195770(0x1e3);this['db'][_0x195770(0x261)](_0xc37e1b,function(_0x2a2062){const _0x57913d=_0x195770;_0x2a2062&&_0x9a1343[_0x57913d(0x221)](logError,_0x9a1343[_0x57913d(0x240)],_0x2a2062);});const _0x3f959e=_0x195770(0x1ec);this['db'][_0x195770(0x261)](_0x3f959e,function(_0x5dfb48){const _0x4e5a1d=_0x195770;_0x5dfb48&&_0x9a1343[_0x4e5a1d(0x21b)](logError,_0x4e5a1d(0x230),_0x5dfb48);});}async[_0x4208f9(0x217)](){const _0x5766b6=_0x4208f9,_0x5a26ae={'qaMUP':function(_0x5ea368,_0x162c0b,_0xc9cd32){return _0x5ea368(_0x162c0b,_0xc9cd32);},'nezBo':function(_0x24155f,_0x46d395){return _0x24155f(_0x46d395);},'nWpbv':'数据库中消息最大短id','IEWzp':_0x5766b6(0x23d)};return new Promise((_0x1eb3f3,_0x5da55b)=>{const _0x2fa146=_0x5766b6,_0x50866f={'jkAve':function(_0x477ec6,_0x2bb76b,_0x1b0798){const _0x2cc077=_0x1973;return _0x5a26ae[_0x2cc077(0x20e)](_0x477ec6,_0x2bb76b,_0x1b0798);},'iAeRX':function(_0x4e7ddf,_0x44de80){const _0x251594=_0x1973;return _0x5a26ae[_0x251594(0x20d)](_0x4e7ddf,_0x44de80);},'zqatQ':function(_0x411d38,_0x3c42bf,_0x4af007){return _0x411d38(_0x3c42bf,_0x4af007);},'YevUF':_0x5a26ae['nWpbv']};this['db'][_0x2fa146(0x21f)](_0x5a26ae[_0x2fa146(0x237)],(_0x1f9530,_0x363dc5)=>{const _0x462d46=_0x2fa146;if(_0x1f9530)return _0x50866f[_0x462d46(0x218)](logDebug,_0x462d46(0x1f3),_0x1f9530),_0x50866f['iAeRX'](_0x1eb3f3,-0x7ffffff8);_0x50866f['zqatQ'](logDebug,_0x50866f[_0x462d46(0x1d6)],_0x363dc5?.[_0x462d46(0x22a)]),_0x50866f[_0x462d46(0x1f9)](_0x1eb3f3,_0x363dc5?.[_0x462d46(0x22a)]??-0x7ffffff8);});});}async[_0x4208f9(0x25b)](_0x18b6b2,_0x2322a9){const _0x193a19=_0x4208f9,_0x2d702a={'yEOJj':function(_0x177252,_0x3a1873){return _0x177252(_0x3a1873);},'FyOST':function(_0x38473f,_0x1f8ba6,_0x554616,_0x3d14e7,_0x30588f){return _0x38473f(_0x1f8ba6,_0x554616,_0x3d14e7,_0x30588f);},'NpcpT':_0x193a19(0x1d1),'DSFRB':function(_0x2c665b,_0x2a77e3){return _0x2c665b(_0x2a77e3);}},_0x330a31=this['db'][_0x193a19(0x22b)](_0x18b6b2);return new Promise((_0x15fc31,_0xa21e4a)=>{const _0x3cff9b=_0x193a19;_0x330a31[_0x3cff9b(0x21f)](..._0x2322a9,(_0x45cd1f,_0x4bb394)=>{const _0x2365aa=_0x3cff9b,_0x472fb0={'HLRAz':function(_0x4da4d1,_0x161834){const _0x84d37=_0x1973;return _0x2d702a[_0x84d37(0x21d)](_0x4da4d1,_0x161834);}};if(_0x45cd1f)return _0x2d702a[_0x2365aa(0x248)](logError,_0x2d702a[_0x2365aa(0x23f)],_0x45cd1f,_0x18b6b2,_0x2322a9),_0x2d702a['DSFRB'](_0x15fc31,null);if(!_0x4bb394){_0x2d702a['yEOJj'](_0x15fc31,null);return;}const _0x5f128c=_0x4bb394['longId'];NTQQMsgApi[_0x2365aa(0x205)]({'peerUid':_0x4bb394['peerUid'],'chatType':_0x4bb394[_0x2365aa(0x207)]},[_0x5f128c])[_0x2365aa(0x1ee)](_0x1312ab=>{const _0x353289=_0x2365aa,_0x13b431=_0x1312ab['msgList'][0x0];if(!_0x13b431){_0x15fc31(null);return;}_0x13b431['id']=_0x4bb394[_0x353289(0x24a)],_0x15fc31(_0x13b431);})[_0x2365aa(0x1fa)](_0x1f5103=>{const _0x4aecf1=_0x2365aa;_0x472fb0[_0x4aecf1(0x236)](_0x15fc31,null);});});});}async[_0x4208f9(0x225)](_0x3f802f){const _0x4b55d0=_0x4208f9,_0x24bcfa={'pQUoT':_0x4b55d0(0x1d5)};if(this[_0x4b55d0(0x251)][_0x4b55d0(0x260)](_0x3f802f))return this[_0x4b55d0(0x251)]['get'](_0x3f802f);const _0x33fe46=_0x24bcfa[_0x4b55d0(0x24f)];return this['getMsg'](_0x33fe46,[_0x3f802f]);}async[_0x4208f9(0x1ff)](_0x34604d){const _0x5318e3=_0x4208f9,_0x24bf15={'ZnDrk':_0x5318e3(0x24b)};if(this[_0x5318e3(0x251)][_0x5318e3(0x260)](_0x34604d))return this['msgCache']['get'](_0x34604d);return this[_0x5318e3(0x25b)](_0x24bf15['ZnDrk'],[_0x34604d]);}async[_0x4208f9(0x256)](_0x4503e6,_0x472b5a){const _0x406d94=_0x4208f9,_0x50fef1={'YbSYq':_0x406d94(0x227)},_0xf41d4d=_0x50fef1[_0x406d94(0x239)];return this[_0x406d94(0x25b)](_0xf41d4d,[_0x4503e6,_0x472b5a]);}async[_0x4208f9(0x1ed)](_0x5c51be,_0x360eff=!![]){const _0x401825=_0x4208f9,_0x29f2ca={'aSvGQ':function(_0x445a8d,_0x1b6b75,_0x34b14d){return _0x445a8d(_0x1b6b75,_0x34b14d);},'CJdqM':_0x401825(0x20b),'qPBPu':function(_0xec7150,_0x5dd47d){return _0xec7150===_0x5dd47d;},'lodJn':_0x401825(0x246),'YycIf':_0x401825(0x1e8),'RZHqJ':function(_0x2d6706,_0x123e1d){return _0x2d6706(_0x123e1d);}},_0x23579d=await this[_0x401825(0x1ff)](_0x5c51be[_0x401825(0x23c)]);if(_0x23579d){if(_0x360eff)this[_0x401825(0x234)](_0x5c51be)[_0x401825(0x1ee)]();return _0x23579d['id'];}const _0x55d9e4=this['db'][_0x401825(0x22b)](_0x29f2ca[_0x401825(0x243)]),_0x8caa29=++this[_0x401825(0x1e1)];return _0x5c51be['id']=_0x8caa29,_0x29f2ca['RZHqJ'](logDebug,_0x401825(0x1dd)+_0x5c51be[_0x401825(0x23c)]+_0x401825(0x249)+_0x5c51be['id']),this[_0x401825(0x251)]['set'](_0x8caa29,_0x5c51be),this[_0x401825(0x251)]['set'](_0x5c51be[_0x401825(0x23c)],_0x5c51be),_0x55d9e4[_0x401825(0x261)](this[_0x401825(0x1e1)],_0x5c51be[_0x401825(0x23c)],_0x5c51be['msgSeq'][_0x401825(0x231)](),_0x5c51be[_0x401825(0x1fd)],_0x5c51be['chatType'],_0x1d598c=>{const _0x157f65=_0x401825,_0x5b14b0={'MVQmu':function(_0x14e2ed,_0x156ed4,_0x212cf7){const _0x33216b=_0x1973;return _0x29f2ca[_0x33216b(0x238)](_0x14e2ed,_0x156ed4,_0x212cf7);},'fSrzl':_0x29f2ca[_0x157f65(0x257)]};_0x1d598c&&(_0x29f2ca['qPBPu'](_0x1d598c[_0x157f65(0x1f5)],0x13)?this[_0x157f65(0x1ff)](_0x5c51be[_0x157f65(0x23c)])['then'](_0x40e3b4=>{const _0x4d9925=_0x157f65;_0x40e3b4?(this['msgCache'][_0x4d9925(0x252)](_0x8caa29,_0x40e3b4),this[_0x4d9925(0x251)]['set'](_0x40e3b4[_0x4d9925(0x23c)],_0x40e3b4)):_0x5b14b0[_0x4d9925(0x253)](logError,_0x5b14b0[_0x4d9925(0x21e)],_0x1d598c);})[_0x157f65(0x1fa)](_0x5d34c0=>logError(_0x157f65(0x263),_0x5d34c0)):logError(_0x29f2ca[_0x157f65(0x247)],_0x1d598c));}),_0x8caa29;}async[_0x4208f9(0x234)](_0x37dce7){const _0x4ca285=_0x4208f9,_0x2d289e={'KdWGv':function(_0x4bdca3,_0xa93431,_0x5f59be){return _0x4bdca3(_0xa93431,_0x5f59be);},'rJZoZ':_0x4ca285(0x25d),'XMAmB':'UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?'},_0x1fc9b4=this[_0x4ca285(0x251)]['get'](_0x37dce7[_0x4ca285(0x23c)]);_0x1fc9b4&&Object[_0x4ca285(0x20a)](_0x1fc9b4,_0x37dce7);logDebug(_0x4ca285(0x224)+_0x37dce7['id']+_0x4ca285(0x1eb)+_0x37dce7[_0x4ca285(0x250)]+',\x20msgId:\x20'+_0x37dce7['msgId']);const _0x175b16=this['db'][_0x4ca285(0x22b)](_0x2d289e[_0x4ca285(0x1ef)]);_0x175b16[_0x4ca285(0x261)](_0x37dce7[_0x4ca285(0x250)],_0x37dce7['msgId'],_0x21b6d9=>{const _0x13816e=_0x4ca285;_0x21b6d9&&_0x2d289e[_0x13816e(0x25a)](logError,_0x2d289e[_0x13816e(0x22f)],_0x21b6d9);});}async['addFileCache'](_0x5132db){const _0x23bd6c=_0x4208f9,_0x11c92d={'CnqRN':function(_0x55f2ed,_0x1717eb,_0x461f4f){return _0x55f2ed(_0x1717eb,_0x461f4f);},'ZAwdw':_0x23bd6c(0x223),'SgAZA':function(_0x330d82,_0x4d80b0){return _0x330d82(_0x4d80b0);},'cvEyo':'INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)'},_0x219eeb=this['db'][_0x23bd6c(0x22b)](_0x11c92d[_0x23bd6c(0x1f1)]);return new Promise((_0x4ca0e4,_0x33b695)=>{const _0x214c26=_0x23bd6c;_0x219eeb[_0x214c26(0x261)](_0x5132db[_0x214c26(0x200)],_0x5132db[_0x214c26(0x262)],_0x5132db[_0x214c26(0x202)],_0x5132db[_0x214c26(0x24d)],_0x5132db['uuid'],_0x5132db['elementType'],JSON[_0x214c26(0x214)](_0x5132db[_0x214c26(0x258)]),_0x5132db['elementId'],_0x5132db[_0x214c26(0x23c)],function(_0x24d0ee){const _0x19a457=_0x214c26;_0x24d0ee&&(_0x11c92d['CnqRN'](logError,_0x11c92d[_0x19a457(0x1ea)],_0x24d0ee),_0x33b695(_0x24d0ee)),_0x11c92d[_0x19a457(0x23b)](_0x4ca0e4,null);});});}async[_0x4208f9(0x1f0)](_0x5b553c,_0x36d23f){const _0x32be6f=_0x4208f9,_0x2e3cba={'ifjeG':function(_0x798560,_0x3bd98b,_0x3fd32e){return _0x798560(_0x3bd98b,_0x3fd32e);},'QlbGj':_0x32be6f(0x228),'tFTIM':function(_0x4143c6,_0x33dc92){return _0x4143c6(_0x33dc92);}},_0x80bbd7=this['db'][_0x32be6f(0x22b)](_0x5b553c);return new Promise((_0x1af499,_0x287526)=>{const _0x517594=_0x32be6f,_0x1904fc={'ZAFFI':function(_0xe710d8,_0x3d1126,_0x29ff7b){const _0x511d72=_0x1973;return _0x2e3cba[_0x511d72(0x209)](_0xe710d8,_0x3d1126,_0x29ff7b);},'zjszL':_0x2e3cba[_0x517594(0x1fc)],'PztWA':function(_0x29775b,_0x32d5bb){return _0x2e3cba['tFTIM'](_0x29775b,_0x32d5bb);}};_0x80bbd7[_0x517594(0x21f)](..._0x36d23f,(_0x3b6bc2,_0x29f37c)=>{const _0x19ccc5=_0x517594;_0x3b6bc2&&(_0x1904fc[_0x19ccc5(0x229)](logError,_0x1904fc[_0x19ccc5(0x210)],_0x3b6bc2),_0x1904fc['PztWA'](_0x287526,_0x3b6bc2)),_0x29f37c&&(_0x29f37c[_0x19ccc5(0x258)]=JSON[_0x19ccc5(0x24c)](_0x29f37c[_0x19ccc5(0x258)])),_0x1904fc[_0x19ccc5(0x226)](_0x1af499,_0x29f37c);});});}async[_0x4208f9(0x22c)](_0x334741){const _0x58b097=_0x4208f9;return this['getFileCache'](_0x58b097(0x265),[_0x334741]);}async['getFileCacheByUuid'](_0x5ae504){const _0x3d948a=_0x4208f9,_0x5ae88c={'FnAKH':'SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?'};return this[_0x3d948a(0x1f0)](_0x5ae88c[_0x3d948a(0x1e5)],[_0x5ae504]);}async[_0x4208f9(0x1da)](_0xc3e00c){const _0x2fefe3=_0x4208f9,_0x89a8dd={'UcRFT':_0x2fefe3(0x21c)},_0x465253=this['db'][_0x2fefe3(0x22b)](_0x2fefe3(0x213));return new Promise((_0x4a2966,_0x3cc310)=>{const _0x22ba3d=_0x2fefe3,_0x441698={'hpxuP':_0x89a8dd[_0x22ba3d(0x220)],'CLieJ':function(_0x5e741d,_0x2fa6d8){return _0x5e741d(_0x2fa6d8);}};_0x465253[_0x22ba3d(0x261)](_0xc3e00c['path'],_0xc3e00c['url'],_0xc3e00c[_0x22ba3d(0x1d4)],function(_0x27f286){const _0x92e993=_0x22ba3d;_0x27f286&&(logError(_0x441698[_0x92e993(0x1d9)],_0x27f286),_0x441698['CLieJ'](_0x3cc310,_0x27f286)),_0x4a2966(null);});});}async[_0x4208f9(0x1e6)](){const _0x5eba4f=_0x4208f9,_0x2f4282={'opLTs':function(_0x90c132,_0x518b55,_0x46310d){return _0x90c132(_0x518b55,_0x46310d);},'cUdtY':function(_0x194197,_0x4014b9){return _0x194197(_0x4014b9);}},_0xa3efcd=_0x5eba4f(0x241);return new Promise((_0xb19223,_0x2d3d1c)=>{const _0x113594=_0x5eba4f,_0xb0230f={'yTMoy':function(_0x2cf261,_0x5dc6be,_0xa4083){const _0x40bcb1=_0x1973;return _0x2f4282[_0x40bcb1(0x23e)](_0x2cf261,_0x5dc6be,_0xa4083);},'VrKMp':_0x113594(0x25f),'FFWiE':function(_0x1d2081,_0x7be2e9){const _0x44622b=_0x113594;return _0x2f4282[_0x44622b(0x1dc)](_0x1d2081,_0x7be2e9);}};this['db'][_0x113594(0x1e7)](_0xa3efcd,(_0x35da49,_0x49597b)=>{const _0x357a1d=_0x113594;_0x35da49&&(_0xb0230f['yTMoy'](logError,_0xb0230f[_0x357a1d(0x212)],_0x35da49),_0x2d3d1c(_0x35da49));const _0x1d3176={};_0x49597b['forEach'](_0xb46920=>{const _0x26bda2=_0x357a1d;_0x1d3176[_0xb46920[_0x26bda2(0x254)]]=_0xb46920[_0x26bda2(0x20c)];}),_0xb0230f[_0x357a1d(0x1f4)](_0xb19223,_0x1d3176);});});}async['getUidByTempUin'](_0x391061){const _0x34fafa=_0x4208f9,_0x16f79f={'QpzFe':_0x34fafa(0x25f),'HVEGK':function(_0x5e666f,_0x52640f){return _0x5e666f(_0x52640f);},'FrgOV':_0x34fafa(0x1f6)},_0x49d1d0=_0x16f79f[_0x34fafa(0x1d8)];return new Promise((_0x35187d,_0x463784)=>{const _0x55f027=_0x34fafa,_0xc98479={'ajhwO':function(_0x4ff317,_0x5f0ba6,_0x8c197b){return _0x4ff317(_0x5f0ba6,_0x8c197b);},'gzIEL':_0x16f79f[_0x55f027(0x259)],'tVYEE':function(_0x26fd47,_0x1561b4){const _0x155e29=_0x55f027;return _0x16f79f[_0x155e29(0x1d7)](_0x26fd47,_0x1561b4);},'BrDZi':function(_0x56508a,_0x58920d){const _0x5d21f2=_0x55f027;return _0x16f79f[_0x5d21f2(0x1d7)](_0x56508a,_0x58920d);}};this['db'][_0x55f027(0x21f)](_0x49d1d0,[_0x391061],(_0x249eba,_0x53eba8)=>{const _0x633e8a=_0x55f027;_0x249eba&&(_0xc98479[_0x633e8a(0x23a)](logError,_0xc98479[_0x633e8a(0x1de)],_0x249eba),_0xc98479[_0x633e8a(0x22d)](_0x463784,_0x249eba)),_0xc98479[_0x633e8a(0x1fb)](_0x35187d,_0x53eba8?.['uid']);});});}async['addTempUin'](_0x149c15,_0x908812){const _0x2fe9ea=_0x4208f9,_0xfed9bc={'yHXEt':function(_0x45c3e0,_0x1438d2){return _0x45c3e0(_0x1438d2);},'pOwvI':'INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)'},_0x3092f0=await this[_0x2fe9ea(0x1d2)](_0x149c15);if(!_0x3092f0){const _0x56797e=this['db'][_0x2fe9ea(0x22b)](_0xfed9bc[_0x2fe9ea(0x244)]);return new Promise((_0x2d702d,_0x3c7aac)=>{const _0x2f6923=_0x2fe9ea;_0x56797e[_0x2f6923(0x261)](_0x149c15,_0x908812,function(_0xbc0f16){const _0x3f2668=_0x2f6923;_0xbc0f16&&(logError(_0x3f2668(0x1d3),_0xbc0f16),_0x3c7aac(_0xbc0f16)),_0xfed9bc['yHXEt'](_0x2d702d,null);});});}}}export const dbUtil=new DBUtil();