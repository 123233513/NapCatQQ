const _0x154d24=_0x4580;(function(_0x4b8190,_0x92f7d2){const _0x31a585=_0x4580,_0xdd1cce=_0x4b8190();while(!![]){try{const _0x22987d=parseInt(_0x31a585(0x111))/0x1*(-parseInt(_0x31a585(0x13c))/0x2)+parseInt(_0x31a585(0x139))/0x3*(-parseInt(_0x31a585(0x117))/0x4)+parseInt(_0x31a585(0x13a))/0x5*(parseInt(_0x31a585(0x123))/0x6)+parseInt(_0x31a585(0xec))/0x7+parseInt(_0x31a585(0x16d))/0x8*(parseInt(_0x31a585(0x16e))/0x9)+-parseInt(_0x31a585(0x108))/0xa+-parseInt(_0x31a585(0x132))/0xb;if(_0x22987d===_0x92f7d2)break;else _0xdd1cce['push'](_0xdd1cce['shift']());}catch(_0x3375ec){_0xdd1cce['push'](_0xdd1cce['shift']());}}}(_0x9e4e,0x8f259));function _0x9e4e(){const _0x2b7392=['getMsgByShortId','DfFtI','getFileCacheByName','4366290zhQBGZ','SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs','Database','db\x20could\x20not\x20add\x20temp\x20uin','IKJXZ','vBoIX','gjsCk','updateMsg\x20db\x20error','gHhxa','catch','TYoAt','db\x20could\x20not\x20update\x20file\x20cache','close','rEwIb','msgCache','178662IJTQVC','记录消息到数据库,\x20消息长id:\x20','createTable','Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','清理消息缓存','YIdCt','Could\x20not\x20create\x20table\x20temp_uins','3RorcZC','5gXjQyA','dgwkH','144814BQylkm','wnDVg','CSBTo','getFileCacheByUuid','数据库中消息最大短id','getMsg','Method\x20not\x20implemented.','oopvq','parse','db\x20could\x20not\x20get\x20file\x20cache','Could\x20not\x20get\x20msg','then','obnGh','Could\x20not\x20connect\x20to\x20database','更新消息,\x20shortId:','path','msgList','OPEN_CREATE','addTempUin','SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?','elementId','JCArW','aSufe','size','set','msgId','UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?','get','Could\x20not\x20create\x20table\x20files','KhQHt','wWOea','run','globalMsgShortId','url','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','db\x20could\x20not\x20add\x20msg','chatType','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','forEach','XzetH',',\x20seq:\x20','sVvrx','jLKqS','db\x20could\x20not\x20get\x20temp\x20uin\x20map','OPEN_READWRITE','eIPPL','Could\x20not\x20create\x20table\x20msgs','maxId','has','29328rDpVYN','540jlynDw','mgfZC','peerUid','element','YTVGn','nvpnC','eTWyl','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','TEHCU','prepare','8104285oXCcEg','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?','init','UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?','stringify','getFileCache','getUidByTempUin','getMsgsByMsgId','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?','KmuJm','DcuSf','qgdbF','UadpZ','addFileCache','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','yWHVW','cGjlm','msgSeq','INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)','ggqJN','sOspp','UHLum',',\x20短id:\x20','db\x20could\x20not\x20add\x20file','eCoNM','uid',',\x20msgId:\x20','getReceivedTempUinMap','6724790BeqIrI','msgTime','Ldzsg','now','elementType','errno','mPFjM','longId','VzYKw','3OeHHUl','updateMsg','qXfJf','mKxoC','yhKFM','getMsgByLongId','2452636OmDAJw','NvWmw','getMsgBySeq','uuid','uoHTW','eguUP','SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?','rzPJK','nxYRx'];_0x9e4e=function(){return _0x2b7392;};return _0x9e4e();}import _0x5a66d3 from'sqlite3';import{logDebug,logError}from'@/common/utils/log';function _0x4580(_0x23b2ca,_0x4b74ab){const _0x9e4e8a=_0x9e4e();return _0x4580=function(_0x458031,_0x2db09b){_0x458031=_0x458031-0xe3;let _0x4102fd=_0x9e4e8a[_0x458031];return _0x4102fd;},_0x4580(_0x23b2ca,_0x4b74ab);}import{NTQQMsgApi}from'@/core';class DBUtilBase{['db'];async[_0x154d24(0xee)](_0xc2d0f0){const _0x3d1be9=_0x154d24,_0x3e8315={'VhIgD':function(_0x58b021,_0x2b119b,_0x414367){return _0x58b021(_0x2b119b,_0x414367);},'ggqJN':_0x3d1be9(0x149),'wnDVg':function(_0x856968,_0x51b2a5){return _0x856968(_0x51b2a5);},'rEwIb':function(_0x1f99ac){return _0x1f99ac();},'DfFtI':function(_0x416014,_0x382440){return _0x416014|_0x382440;}};if(this['db'])return;return new Promise((_0x46b023,_0xa9fdbf)=>{const _0x830a84=_0x3d1be9,_0x3cd0fc={'mgfZC':function(_0x258aaf,_0x58ca07,_0x2c2d98){return _0x3e8315['VhIgD'](_0x258aaf,_0x58ca07,_0x2c2d98);},'wWOea':_0x3e8315[_0x830a84(0xff)],'sJusk':function(_0x3240d2,_0x1dc5c8){const _0x164ff0=_0x830a84;return _0x3e8315[_0x164ff0(0x13d)](_0x3240d2,_0x1dc5c8);},'qXfJf':function(_0x6df968){const _0x4c8de6=_0x830a84;return _0x3e8315[_0x4c8de6(0x130)](_0x6df968);}};this['db']=new _0x5a66d3[(_0x830a84(0x125))](_0xc2d0f0,_0x3e8315[_0x830a84(0x121)](_0x5a66d3[_0x830a84(0x168)],_0x5a66d3[_0x830a84(0x14d)]),_0xab862f=>{const _0x3f27f8=_0x830a84;if(_0xab862f){_0x3cd0fc[_0x3f27f8(0x16f)](logError,_0x3cd0fc[_0x3f27f8(0x15a)],_0xab862f),_0x3cd0fc['sJusk'](_0xa9fdbf,_0xab862f);return;}this['createTable'](),_0x3cd0fc[_0x3f27f8(0x113)](_0x46b023);});});}[_0x154d24(0x134)](){const _0x2f2977=_0x154d24;throw new Error(_0x2f2977(0x142));}[_0x154d24(0x12f)](){this['db']?.['close']();}}class DBUtil extends DBUtilBase{[_0x154d24(0x131)]=new Map();[_0x154d24(0x15c)]=-0x7ffffff8;constructor(){const _0x39a842=_0x154d24,_0x519b4e={'YUiBK':function(_0x22db24,_0x3c7a2b){return _0x22db24-_0x3c7a2b;},'YAHIc':function(_0xb69a89,_0x2f7e05){return _0xb69a89*_0x2f7e05;},'eCoNM':function(_0x218807,_0x5162f2){return _0x218807(_0x5162f2);},'UHLum':function(_0x1666b8,_0x119dde){return _0x1666b8*_0x119dde;},'JCArW':function(_0x57223f,_0x38b7f8,_0x2dc199){return _0x57223f(_0x38b7f8,_0x2dc199);}};super();const _0x54fd0f=_0x519b4e['YAHIc'](_0x519b4e[_0x39a842(0x101)](0x3e8,0x3c),0xa);_0x519b4e[_0x39a842(0x151)](setInterval,()=>{const _0x552b74=_0x39a842;_0x519b4e[_0x552b74(0x104)](logDebug,_0x552b74(0x136)),this[_0x552b74(0x131)][_0x552b74(0x162)]((_0x47d11a,_0xa8d025)=>{const _0x53b766=_0x552b74;_0x519b4e['YUiBK'](Date[_0x53b766(0x10b)](),_0x519b4e['YAHIc'](_0x519b4e[_0x53b766(0x104)](parseInt,_0x47d11a[_0x53b766(0x109)]),0x3e8))>_0x54fd0f&&this[_0x53b766(0x131)]['delete'](_0xa8d025);});},_0x54fd0f);}async['init'](_0x3841f1){const _0x5a3155=_0x154d24;await super['init'](_0x3841f1),this[_0x5a3155(0x15c)]=await this['getCurrentMaxShortId']();}[_0x154d24(0x134)](){const _0x51f49f=_0x154d24,_0x5d68f5={'aSufe':function(_0x453e18,_0x398b11,_0x2d065c){return _0x453e18(_0x398b11,_0x2d065c);},'WNGsg':_0x51f49f(0x158),'nxYRx':_0x51f49f(0x138)},_0x266045=_0x51f49f(0xe9);this['db'][_0x51f49f(0x15b)](_0x266045,function(_0x123e59){const _0x48c595=_0x51f49f;_0x123e59&&logError(_0x48c595(0x16a),_0x123e59['stack']);});const _0x406a43=_0x51f49f(0x161);this['db']['run'](_0x406a43,function(_0x46419e){const _0x29b1fc=_0x51f49f;_0x46419e&&_0x5d68f5[_0x29b1fc(0x152)](logError,_0x5d68f5['WNGsg'],_0x46419e);});const _0x1d37e9=_0x51f49f(0x15e);this['db'][_0x51f49f(0x15b)](_0x1d37e9,function(_0xf1179c){const _0x2d9a3a=_0x51f49f;_0xf1179c&&_0x5d68f5[_0x2d9a3a(0x152)](logError,_0x5d68f5[_0x2d9a3a(0x11f)],_0xf1179c);});}async['getCurrentMaxShortId'](){const _0x11f128=_0x154d24,_0x1ac6ca={'eIPPL':function(_0x346ad7,_0x2934cd,_0x52137c){return _0x346ad7(_0x2934cd,_0x52137c);},'Ldzsg':function(_0x1e0331,_0x11ed32){return _0x1e0331(_0x11ed32);},'YIdCt':_0x11f128(0x140),'gHhxa':_0x11f128(0x124)};return new Promise((_0x52fe4b,_0x16bf8d)=>{const _0x2a9fdb=_0x11f128,_0xa4e951={'eguUP':function(_0x4cf199,_0x4a8ae4,_0x26cde2){const _0x224a68=_0x4580;return _0x1ac6ca[_0x224a68(0x169)](_0x4cf199,_0x4a8ae4,_0x26cde2);},'uoHTW':_0x2a9fdb(0x135),'KhQHt':function(_0x36a0ce,_0x192c79){const _0x409e15=_0x2a9fdb;return _0x1ac6ca[_0x409e15(0x10a)](_0x36a0ce,_0x192c79);},'RbFlL':function(_0x5a7add,_0x377e4f,_0x3e4cc7){const _0x4ba796=_0x2a9fdb;return _0x1ac6ca[_0x4ba796(0x169)](_0x5a7add,_0x377e4f,_0x3e4cc7);},'aovkX':_0x1ac6ca[_0x2a9fdb(0x137)]};this['db'][_0x2a9fdb(0x157)](_0x1ac6ca[_0x2a9fdb(0x12b)],(_0xfe70eb,_0x1da0e7)=>{const _0x447d33=_0x2a9fdb;if(_0xfe70eb)return _0xa4e951[_0x447d33(0x11c)](logDebug,_0xa4e951[_0x447d33(0x11b)],_0xfe70eb),_0xa4e951[_0x447d33(0x159)](_0x52fe4b,-0x7ffffff8);_0xa4e951['RbFlL'](logDebug,_0xa4e951['aovkX'],_0x1da0e7?.[_0x447d33(0x16b)]),_0xa4e951[_0x447d33(0x159)](_0x52fe4b,_0x1da0e7?.[_0x447d33(0x16b)]??-0x7ffffff8);});});}async[_0x154d24(0x141)](_0x5ca553,_0x15d66c){const _0x43e603=_0x154d24,_0x3dff6a={'dgwkH':function(_0x1e8425,_0x4abcc3){return _0x1e8425(_0x4abcc3);},'IKJXZ':function(_0x4e3bf8,_0x24957f,_0x23538c,_0x1b1e62,_0x1b49bb){return _0x4e3bf8(_0x24957f,_0x23538c,_0x1b1e62,_0x1b49bb);}},_0x537763=this['db'][_0x43e603(0xeb)](_0x5ca553);return new Promise((_0xef9706,_0x505671)=>{const _0x2617e6=_0x43e603,_0x2c0444={'YTVGn':function(_0x5db009,_0x6f3007){const _0x41b10c=_0x4580;return _0x3dff6a[_0x41b10c(0x13b)](_0x5db009,_0x6f3007);},'yWHVW':function(_0x4ee7ad,_0x2657cd,_0x38de87,_0x165fcd,_0x46ed6c){const _0x15231c=_0x4580;return _0x3dff6a[_0x15231c(0x127)](_0x4ee7ad,_0x2657cd,_0x38de87,_0x165fcd,_0x46ed6c);},'nvpnC':_0x2617e6(0x146),'KmuJm':function(_0x404d8f,_0x87765e){return _0x404d8f(_0x87765e);}};_0x537763[_0x2617e6(0x157)](..._0x15d66c,(_0x6f40c7,_0x2120a8)=>{const _0x33da8a=_0x2617e6;if(_0x6f40c7)return _0x2c0444[_0x33da8a(0xfb)](logError,_0x2c0444[_0x33da8a(0xe6)],_0x6f40c7,_0x5ca553,_0x15d66c),_0x2c0444[_0x33da8a(0xe5)](_0xef9706,null);if(!_0x2120a8){_0x2c0444[_0x33da8a(0xf5)](_0xef9706,null);return;}const _0x4cd81b=_0x2120a8[_0x33da8a(0x10f)];NTQQMsgApi[_0x33da8a(0xf3)]({'peerUid':_0x2120a8[_0x33da8a(0xe3)],'chatType':_0x2120a8[_0x33da8a(0x160)]},[_0x4cd81b])['then'](_0x3646ac=>{const _0x5d0cde=_0x33da8a,_0x3cf541=_0x3646ac[_0x5d0cde(0x14c)][0x0];if(!_0x3cf541){_0x2c0444[_0x5d0cde(0xe5)](_0xef9706,null);return;}_0x3cf541['id']=_0x2120a8['shortId'],_0xef9706(_0x3cf541);})[_0x33da8a(0x12c)](_0x4d803d=>{_0x2c0444['YTVGn'](_0xef9706,null);});});});}async[_0x154d24(0x120)](_0x14fc2d){const _0x1bc427=_0x154d24,_0x16dee7={'ccByF':_0x1bc427(0xe8)};if(this[_0x1bc427(0x131)][_0x1bc427(0x16c)](_0x14fc2d))return this['msgCache'][_0x1bc427(0x157)](_0x14fc2d);const _0x46df59=_0x16dee7['ccByF'];return this[_0x1bc427(0x141)](_0x46df59,[_0x14fc2d]);}async[_0x154d24(0x116)](_0x46b2c1){const _0x10ff1e=_0x154d24,_0x2d816b={'rzPJK':_0x10ff1e(0xed)};if(this[_0x10ff1e(0x131)][_0x10ff1e(0x16c)](_0x46b2c1))return this[_0x10ff1e(0x131)]['get'](_0x46b2c1);return this[_0x10ff1e(0x141)](_0x2d816b[_0x10ff1e(0x11e)],[_0x46b2c1]);}async[_0x154d24(0x119)](_0x146eda,_0x1f42c8){const _0x163d9a=_0x154d24,_0x126285={'ULhSo':_0x163d9a(0xf4)},_0x547e89=_0x126285['ULhSo'];return this[_0x163d9a(0x141)](_0x547e89,[_0x146eda,_0x1f42c8]);}async['addMsg'](_0x269a40,_0x2cbac8=!![]){const _0x3e4927=_0x154d24,_0xf09b03={'jLKqS':function(_0x59a645,_0x5cff4e,_0x56fcad){return _0x59a645(_0x5cff4e,_0x56fcad);},'NNnHr':'db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id','eTWyl':_0x3e4927(0xfa)},_0xf02bd0=await this[_0x3e4927(0x116)](_0x269a40[_0x3e4927(0x155)]);if(_0xf02bd0){if(_0x2cbac8)this[_0x3e4927(0x112)](_0x269a40)['then']();return _0xf02bd0['id'];}const _0x446c98=this['db'][_0x3e4927(0xeb)](_0xf09b03[_0x3e4927(0xe7)]),_0x53a7fd=++this['globalMsgShortId'];return _0x269a40['id']=_0x53a7fd,logDebug(_0x3e4927(0x133)+_0x269a40[_0x3e4927(0x155)]+_0x3e4927(0x102)+_0x269a40['id']),this[_0x3e4927(0x131)][_0x3e4927(0x154)](_0x53a7fd,_0x269a40),this[_0x3e4927(0x131)][_0x3e4927(0x154)](_0x269a40[_0x3e4927(0x155)],_0x269a40),_0x446c98[_0x3e4927(0x15b)](this[_0x3e4927(0x15c)],_0x269a40[_0x3e4927(0x155)],_0x269a40[_0x3e4927(0xfd)]['toString'](),_0x269a40['peerUid'],_0x269a40['chatType'],_0x116676=>{const _0x56973f=_0x3e4927,_0x539df0={'iHxVM':function(_0x34054f,_0x2be5cf,_0x228d1e){const _0x3abe46=_0x4580;return _0xf09b03[_0x3abe46(0x166)](_0x34054f,_0x2be5cf,_0x228d1e);},'TEHCU':_0xf09b03['NNnHr']};_0x116676&&(_0x116676[_0x56973f(0x10d)]===0x13?this[_0x56973f(0x116)](_0x269a40[_0x56973f(0x155)])[_0x56973f(0x147)](_0x518f8c=>{const _0x157290=_0x56973f;_0x518f8c?(this[_0x157290(0x131)]['set'](_0x53a7fd,_0x518f8c),this['msgCache']['set'](_0x518f8c[_0x157290(0x155)],_0x518f8c)):_0x539df0['iHxVM'](logError,_0x539df0[_0x157290(0xea)],_0x116676);})['catch'](_0xf6893b=>logError('db\x20getMsgByLongId\x20error',_0xf6893b)):_0xf09b03[_0x56973f(0x166)](logError,_0x56973f(0x15f),_0x116676));}),_0x53a7fd;}async[_0x154d24(0x112)](_0x334548){const _0x3e6879=_0x154d24,_0x5863f9={'VzYKw':function(_0x294d2e,_0x35fbea,_0x1ac97a){return _0x294d2e(_0x35fbea,_0x1ac97a);},'nvIoN':_0x3e6879(0x12a),'sVvrx':function(_0xb12c34,_0x53aead){return _0xb12c34(_0x53aead);},'HVbpP':_0x3e6879(0xef)},_0xffcf2a=this['msgCache'][_0x3e6879(0x157)](_0x334548[_0x3e6879(0x155)]);_0xffcf2a&&Object['assign'](_0xffcf2a,_0x334548);_0x5863f9[_0x3e6879(0x165)](logDebug,_0x3e6879(0x14a)+_0x334548['id']+_0x3e6879(0x164)+_0x334548[_0x3e6879(0xfd)]+_0x3e6879(0x106)+_0x334548['msgId']);const _0x2959f6=this['db'][_0x3e6879(0xeb)](_0x5863f9['HVbpP']);_0x2959f6['run'](_0x334548[_0x3e6879(0xfd)],_0x334548[_0x3e6879(0x155)],_0x57f167=>{const _0xf10dfe=_0x3e6879;_0x57f167&&_0x5863f9[_0xf10dfe(0x110)](logError,_0x5863f9['nvIoN'],_0x57f167);});}async[_0x154d24(0xf9)](_0x40333e){const _0x5aeebc=_0x154d24,_0x17f3bb={'yhKFM':function(_0x21f920,_0x3fc1ee,_0x2748e0){return _0x21f920(_0x3fc1ee,_0x2748e0);},'gjsCk':function(_0x4ab3a3,_0x55729d){return _0x4ab3a3(_0x55729d);},'LzBHp':'INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)'},_0x51774d=this['db'][_0x5aeebc(0xeb)](_0x17f3bb['LzBHp']);return new Promise((_0x57d190,_0x4f2692)=>{const _0x3ab0a3=_0x5aeebc;_0x51774d['run'](_0x40333e['name'],_0x40333e['path'],_0x40333e['url'],_0x40333e[_0x3ab0a3(0x153)],_0x40333e[_0x3ab0a3(0x11a)],_0x40333e[_0x3ab0a3(0x10c)],JSON[_0x3ab0a3(0xf0)](_0x40333e['element']),_0x40333e[_0x3ab0a3(0x150)],_0x40333e[_0x3ab0a3(0x155)],function(_0x13d2b5){const _0x3ed2ff=_0x3ab0a3;_0x13d2b5&&(_0x17f3bb[_0x3ed2ff(0x115)](logError,_0x3ed2ff(0x103),_0x13d2b5),_0x17f3bb[_0x3ed2ff(0x129)](_0x4f2692,_0x13d2b5)),_0x57d190(null);});});}async[_0x154d24(0xf1)](_0x4f9d2d,_0x40f045){const _0x1d77a2=_0x154d24,_0x5c2364={'XzetH':_0x1d77a2(0x145),'CSBTo':function(_0xb25d19,_0x491890){return _0xb25d19(_0x491890);}},_0x555e6a=this['db']['prepare'](_0x4f9d2d);return new Promise((_0x386a93,_0x5aa723)=>{_0x555e6a['get'](..._0x40f045,(_0x193c4d,_0x40167b)=>{const _0x2a5ea6=_0x4580;_0x193c4d&&(logError(_0x5c2364[_0x2a5ea6(0x163)],_0x193c4d),_0x5c2364[_0x2a5ea6(0x13e)](_0x5aa723,_0x193c4d)),_0x40167b&&(_0x40167b[_0x2a5ea6(0xe4)]=JSON[_0x2a5ea6(0x144)](_0x40167b[_0x2a5ea6(0xe4)])),_0x5c2364[_0x2a5ea6(0x13e)](_0x386a93,_0x40167b);});});}async[_0x154d24(0x122)](_0x1cc5e0){const _0x417e1b=_0x154d24,_0x3cc090={'sOspp':'SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?'};return this['getFileCache'](_0x3cc090[_0x417e1b(0x100)],[_0x1cc5e0]);}async[_0x154d24(0x13f)](_0x13b51f){const _0x1aeb46=_0x154d24,_0x5be005={'oopvq':_0x1aeb46(0x11d)};return this['getFileCache'](_0x5be005[_0x1aeb46(0x143)],[_0x13b51f]);}async['updateFileCache'](_0x41ed0a){const _0x5dd3d4=_0x154d24,_0x37ca50={'hQvLa':function(_0x556b10,_0x4ac056,_0x926cb2){return _0x556b10(_0x4ac056,_0x926cb2);},'DcuSf':_0x5dd3d4(0x12e),'obnGh':function(_0x450218,_0x56ab35){return _0x450218(_0x56ab35);},'Fxuib':function(_0x4deab0,_0x31bb2c){return _0x4deab0(_0x31bb2c);},'cGjlm':_0x5dd3d4(0x156)},_0x2da4f3=this['db'][_0x5dd3d4(0xeb)](_0x37ca50[_0x5dd3d4(0xfc)]);return new Promise((_0x460f7b,_0xd7e0b8)=>{const _0x52f1d3=_0x5dd3d4;_0x2da4f3[_0x52f1d3(0x15b)](_0x41ed0a[_0x52f1d3(0x14b)],_0x41ed0a[_0x52f1d3(0x15d)],_0x41ed0a[_0x52f1d3(0x11a)],function(_0x2c450d){const _0x34efd7=_0x52f1d3;_0x2c450d&&(_0x37ca50['hQvLa'](logError,_0x37ca50[_0x34efd7(0xf6)],_0x2c450d),_0x37ca50[_0x34efd7(0x148)](_0xd7e0b8,_0x2c450d)),_0x37ca50['Fxuib'](_0x460f7b,null);});});}async[_0x154d24(0x107)](){const _0x43a43f=_0x154d24,_0x51625d={'tVhvD':function(_0x35283d,_0x4fc4d7,_0x5d9919){return _0x35283d(_0x4fc4d7,_0x5d9919);},'NvWmw':_0x43a43f(0x167),'mPFjM':function(_0x2fc38d,_0x655426){return _0x2fc38d(_0x655426);},'qgdbF':'SELECT\x20*\x20FROM\x20temp_uins'},_0x5d9ce3=_0x51625d[_0x43a43f(0xf7)];return new Promise((_0x123789,_0xe40570)=>{this['db']['all'](_0x5d9ce3,(_0x320903,_0x469418)=>{const _0x31a880=_0x4580;_0x320903&&(_0x51625d['tVhvD'](logError,_0x51625d[_0x31a880(0x118)],_0x320903),_0x51625d[_0x31a880(0x10e)](_0xe40570,_0x320903));const _0x3569f5={};_0x469418[_0x31a880(0x162)](_0x96f43b=>{_0x3569f5[_0x96f43b['uin']]=_0x96f43b['uid'];}),_0x123789(_0x3569f5);});});}async[_0x154d24(0xf2)](_0x32b3de){const _0x11080b=_0x154d24,_0x312c34={'tTDqU':_0x11080b(0x167),'TYoAt':function(_0x3c7dfc,_0x611a2b){return _0x3c7dfc(_0x611a2b);},'UadpZ':_0x11080b(0x14f)},_0x49ed2c=_0x312c34[_0x11080b(0xf8)];return new Promise((_0x1a141d,_0x584194)=>{this['db']['get'](_0x49ed2c,[_0x32b3de],(_0x14b8b0,_0x4efd4d)=>{const _0x219b37=_0x4580;_0x14b8b0&&(logError(_0x312c34['tTDqU'],_0x14b8b0),_0x312c34[_0x219b37(0x12d)](_0x584194,_0x14b8b0)),_0x1a141d(_0x4efd4d?.[_0x219b37(0x105)]);});});}async[_0x154d24(0x14e)](_0x1bf00a,_0x926d51){const _0x282cd2=_0x154d24,_0x268591={'vBoIX':_0x282cd2(0x126),'mKxoC':function(_0x1948ad,_0xe58cfc){return _0x1948ad(_0xe58cfc);},'RduQQ':_0x282cd2(0xfe)},_0x244c8f=await this[_0x282cd2(0xf2)](_0x1bf00a);if(!_0x244c8f){const _0x4b49d0=this['db'][_0x282cd2(0xeb)](_0x268591['RduQQ']);return new Promise((_0x35a101,_0x2dcd59)=>{const _0x2a804c=_0x282cd2;_0x4b49d0[_0x2a804c(0x15b)](_0x1bf00a,_0x926d51,function(_0x30d078){const _0x2e9414=_0x2a804c;_0x30d078&&(logError(_0x268591[_0x2e9414(0x128)],_0x30d078),_0x268591[_0x2e9414(0x114)](_0x2dcd59,_0x30d078)),_0x268591[_0x2e9414(0x114)](_0x35a101,null);});});}}}export const dbUtil=new DBUtil();