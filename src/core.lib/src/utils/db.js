const _0x3411b9=_0xd379;(function(_0xc18973,_0x3e320d){const _0x444301=_0xd379,_0x44819c=_0xc18973();while(!![]){try{const _0x233bcb=-parseInt(_0x444301(0x8f))/0x1+-parseInt(_0x444301(0xe6))/0x2+parseInt(_0x444301(0x95))/0x3+parseInt(_0x444301(0xd0))/0x4+parseInt(_0x444301(0x92))/0x5*(parseInt(_0x444301(0xe0))/0x6)+parseInt(_0x444301(0x80))/0x7+parseInt(_0x444301(0x76))/0x8*(-parseInt(_0x444301(0xed))/0x9);if(_0x233bcb===_0x3e320d)break;else _0x44819c['push'](_0x44819c['shift']());}catch(_0x1df701){_0x44819c['push'](_0x44819c['shift']());}}}(_0x29c6,0x44142));import _0x5d2361 from'sqlite3';import{logDebug,logError}from'@/common/utils/log';import{NTQQMsgApi}from'@/core';function _0xd379(_0x46e88c,_0x5a3c26){const _0x29c62b=_0x29c6();return _0xd379=function(_0xd379e5,_0x50ea90){_0xd379e5=_0xd379e5-0x73;let _0x1fc5ac=_0x29c62b[_0xd379e5];return _0x1fc5ac;},_0xd379(_0x46e88c,_0x5a3c26);}class DBUtilBase{['db'];async[_0x3411b9(0xd2)](_0x38e6ee){const _0xe2c971=_0x3411b9,_0x408d6f={'OmDix':_0xe2c971(0xc6),'qwhRl':function(_0x2cf480,_0x612d87){return _0x2cf480|_0x612d87;}};if(this['db'])return;return new Promise((_0x260a10,_0x90d9a9)=>{const _0x395a88=_0xe2c971,_0x4d78fd={'daUAO':function(_0x2b5b44,_0x1db107,_0x569b8b){return _0x2b5b44(_0x1db107,_0x569b8b);},'TxrXT':_0x408d6f[_0x395a88(0x75)]};this['db']=new _0x5d2361[(_0x395a88(0xc4))](_0x38e6ee,_0x408d6f[_0x395a88(0xdd)](_0x5d2361[_0x395a88(0xb4)],_0x5d2361['OPEN_CREATE']),_0x3d0c61=>{const _0x4addb6=_0x395a88;if(_0x3d0c61){_0x4d78fd[_0x4addb6(0xe4)](logError,_0x4d78fd[_0x4addb6(0xa3)],_0x3d0c61),_0x90d9a9(_0x3d0c61);return;}this[_0x4addb6(0xb3)](),_0x260a10();});});}[_0x3411b9(0xb3)](){const _0x21b92b={'cgNVu':'Method\x20not\x20implemented.'};throw new Error(_0x21b92b['cgNVu']);}[_0x3411b9(0xb8)](){const _0x13873f=_0x3411b9;this['db']?.[_0x13873f(0xb8)]();}}function _0x29c6(){const _0x213c4e=['path','Cuycp','ETWBS','SELECT\x20*\x20FROM\x20temp_uins\x20WHERE\x20uin\x20=\x20?','addTempUin','set','mlgbq','OcCQJ','msgList','globalMsgShortId','记录消息到数据库,\x20消息长id:\x20','TxrXT','uid','qpYpL','peerUid','yQiKj','getFileCacheByUuid','Could\x20not\x20create\x20table\x20files','stack','waggf','lHFaw','INSERT\x20INTO\x20msgs\x20(shortId,\x20longId,\x20seq,\x20peerUid,\x20chatType)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)','清理消息缓存','addFileCache','msgId','INSERT\x20INTO\x20files\x20(name,\x20path,\x20url,\x20size,\x20uuid,\x20elementType\x20,element,\x20elementId,\x20msgId)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','maxId','createTable','OPEN_READWRITE','chatType','prepare',',\x20短id:\x20','close','parse','BRbGz','element','stringify','agdNB','has','nUYWx','msgTime','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20shortId\x20=\x20?','elementType','longId','Database','now','Could\x20not\x20connect\x20to\x20database','SELECT\x20*\x20FROM\x20temp_uins','getMsgByLongId','uuid','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20temp_uins\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uin\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','elementId','Could\x20not\x20get\x20max\x20short\x20id,\x20Use\x20default\x20-2147483640','errno','bkVSn','bTMEg','572456LGNAQa','csNHF','init','updateFileCache','getMsgBySeq','run','arNbw','gmqMS','jzSLp','getFileCache','ivKGA','Could\x20not\x20get\x20msg','ZHJSd','qwhRl','getReceivedTempUinMap','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20msgs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20shortId\x20INTEGER\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20longId\x20TEXT\x20NOT\x20NULL\x20UNIQUE,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20seq\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20peerUid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chatType\x20INTEGER\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','6ZpxHkV','aJSmf','then',',\x20msgId:\x20','daUAO','数据库中消息最大短id','474716BZUPUt','msgCache','addMsg','gEkTM','msgSeq','HWZGm','getMsg','9ZQJkrs','rnAvJ','oAXma','db\x20could\x20not\x20get\x20file\x20cache','db\x20could\x20not\x20add\x20msg','db\x20could\x20not\x20update\x20file\x20cache','ULObq','db\x20could\x20not\x20get\x20msg\x20by\x20long\x20id','getCurrentMaxShortId','getUidByTempUin','url','shortId','bwmjM','xxGpn','OmDix','298568DnAgOh','RpNzv','toString','IEDJF','get','FWoJw','catch','hUtJu','fQjIT','BmJNW','2135413RmpEXD','UZExx','fNWIr','name','db\x20could\x20not\x20add\x20file','updateMsg','db\x20could\x20not\x20add\x20temp\x20uin','BaAHO','roTcj','SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20peerUid\x20=\x20?\x20AND\x20seq\x20=\x20?','OFYvs','DajRW','DTLZA','all','forEach','213961VxGNye','delete','LYWcE','1338775xvmSeL','WASZS','whBrb','154686EKIGqJ','db\x20could\x20not\x20get\x20temp\x20uin\x20map','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20files\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20name\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20path\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20url\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20size\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementType\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20element\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20elementId\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msgId\x20TEXT\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)'];_0x29c6=function(){return _0x213c4e;};return _0x29c6();}class DBUtil extends DBUtilBase{[_0x3411b9(0xe7)]=new Map();[_0x3411b9(0xa1)]=-0x7ffffff8;constructor(){const _0x39d296=_0x3411b9,_0x4d5a07={'OcCQJ':function(_0xdc9a62,_0x9d523e){return _0xdc9a62*_0x9d523e;},'xxGpn':function(_0x15956e,_0x15ec22){return _0x15956e(_0x15ec22);},'bTMEg':function(_0x395d14,_0x18f760){return _0x395d14(_0x18f760);},'lHFaw':_0x39d296(0xae),'NUgmj':function(_0x4788f9,_0x12b8bc){return _0x4788f9*_0x12b8bc;},'ETWBS':function(_0x5dae73,_0x434df1,_0x485a13){return _0x5dae73(_0x434df1,_0x485a13);}};super();const _0x2a119d=_0x4d5a07['NUgmj'](0x3e8*0x3c,0xa);_0x4d5a07[_0x39d296(0x9a)](setInterval,()=>{const _0x4b1a30=_0x39d296;_0x4d5a07[_0x4b1a30(0xcf)](logDebug,_0x4d5a07[_0x4b1a30(0xac)]),this[_0x4b1a30(0xe7)][_0x4b1a30(0x8e)]((_0x499bf9,_0xd51aef)=>{const _0x3f5e2b=_0x4b1a30;Date[_0x3f5e2b(0xc5)]()-_0x4d5a07[_0x3f5e2b(0x9f)](_0x4d5a07[_0x3f5e2b(0x74)](parseInt,_0x499bf9[_0x3f5e2b(0xc0)]),0x3e8)>_0x2a119d&&this[_0x3f5e2b(0xe7)][_0x3f5e2b(0x90)](_0xd51aef);});},_0x2a119d);}async['init'](_0x1e8b65){const _0x13be99=_0x3411b9;await super['init'](_0x1e8b65),this[_0x13be99(0xa1)]=await this['getCurrentMaxShortId']();}[_0x3411b9(0xb3)](){const _0x43ff91=_0x3411b9,_0x3cc119={'MFtZt':function(_0x189867,_0x43a861,_0x20e685){return _0x189867(_0x43a861,_0x20e685);},'MCzed':'Could\x20not\x20create\x20table\x20msgs','Cuycp':function(_0x1a9612,_0x36b31f,_0x7ffcd6){return _0x1a9612(_0x36b31f,_0x7ffcd6);},'ZHJSd':_0x43ff91(0xa9),'roTcj':'Could\x20not\x20create\x20table\x20temp_uins'},_0xe2ee3b=_0x43ff91(0xdf);this['db']['run'](_0xe2ee3b,function(_0x42ec99){const _0xaf75b0=_0x43ff91;_0x42ec99&&_0x3cc119['MFtZt'](logError,_0x3cc119['MCzed'],_0x42ec99[_0xaf75b0(0xaa)]);});const _0x5b1550=_0x43ff91(0x97);this['db']['run'](_0x5b1550,function(_0x5bc357){const _0x44c561=_0x43ff91;_0x5bc357&&_0x3cc119[_0x44c561(0x99)](logError,_0x3cc119[_0x44c561(0xdc)],_0x5bc357);});const _0x7c930f=_0x43ff91(0xca);this['db'][_0x43ff91(0xd5)](_0x7c930f,function(_0x3ba86a){const _0x18d69e=_0x43ff91;_0x3ba86a&&logError(_0x3cc119[_0x18d69e(0x88)],_0x3ba86a);});}async[_0x3411b9(0xf5)](){const _0x593416=_0x3411b9,_0x3d5ef3={'whBrb':function(_0x31d45b,_0x261822,_0x4975d1){return _0x31d45b(_0x261822,_0x4975d1);},'DTLZA':_0x593416(0xcc),'TKoMi':function(_0x5e3ea5,_0x11c771){return _0x5e3ea5(_0x11c771);},'mlgbq':'SELECT\x20MAX(shortId)\x20as\x20maxId\x20FROM\x20msgs'};return new Promise((_0x6aa828,_0x812459)=>{const _0x595e04=_0x593416,_0x2598c1={'DajRW':function(_0x5ecb15,_0xb0621c,_0x2daa09){const _0x27b8ed=_0xd379;return _0x3d5ef3[_0x27b8ed(0x94)](_0x5ecb15,_0xb0621c,_0x2daa09);},'GWKjf':_0x3d5ef3[_0x595e04(0x8c)],'BZbHN':function(_0x179d8b,_0x2cbcaa){return _0x3d5ef3['TKoMi'](_0x179d8b,_0x2cbcaa);}};this['db'][_0x595e04(0x7a)](_0x3d5ef3[_0x595e04(0x9e)],(_0x41b3b0,_0x255ebf)=>{const _0x35866f=_0x595e04;if(_0x41b3b0)return _0x2598c1['DajRW'](logDebug,_0x2598c1['GWKjf'],_0x41b3b0),_0x2598c1['BZbHN'](_0x6aa828,-0x7ffffff8);_0x2598c1[_0x35866f(0x8b)](logDebug,_0x35866f(0xe5),_0x255ebf?.[_0x35866f(0xb2)]),_0x2598c1['BZbHN'](_0x6aa828,_0x255ebf?.[_0x35866f(0xb2)]??-0x7ffffff8);});});}async[_0x3411b9(0xec)](_0x230239,_0x425742){const _0x26cc49=_0x3411b9,_0x1dcf4d={'LYWcE':function(_0x30fc04,_0xbbac32){return _0x30fc04(_0xbbac32);},'pHBrT':function(_0x17ddde,_0x3f121b){return _0x17ddde(_0x3f121b);}},_0x25912d=this['db'][_0x26cc49(0xb6)](_0x230239);return new Promise((_0x1b69c1,_0xa870c1)=>{const _0x2c4b4b=_0x26cc49,_0x2975aa={'oAXma':function(_0xb2b66c,_0x7efa23){const _0x182999=_0xd379;return _0x1dcf4d[_0x182999(0x91)](_0xb2b66c,_0x7efa23);}};_0x25912d[_0x2c4b4b(0x7a)](..._0x425742,(_0x421a87,_0x26aec3)=>{const _0xb29481=_0x2c4b4b,_0x4a45ec={'RpNzv':function(_0x45205d,_0x4984bb){return _0x45205d(_0x4984bb);}};if(_0x421a87)return logError(_0xb29481(0xdb),_0x421a87,_0x230239,_0x425742),_0x1dcf4d['LYWcE'](_0x1b69c1,null);if(!_0x26aec3){_0x1dcf4d['pHBrT'](_0x1b69c1,null);return;}const _0x627dc8=_0x26aec3[_0xb29481(0xc3)];NTQQMsgApi['getMsgsByMsgId']({'peerUid':_0x26aec3[_0xb29481(0xa6)],'chatType':_0x26aec3['chatType']},[_0x627dc8])[_0xb29481(0xe2)](_0xc2e0fa=>{const _0x19b1d5=_0xb29481,_0x5b62eb=_0xc2e0fa[_0x19b1d5(0xa0)][0x0];if(!_0x5b62eb){_0x2975aa['oAXma'](_0x1b69c1,null);return;}_0x5b62eb['id']=_0x26aec3[_0x19b1d5(0xf8)],_0x2975aa[_0x19b1d5(0xef)](_0x1b69c1,_0x5b62eb);})['catch'](_0x5075bc=>{const _0x802501=_0xb29481;_0x4a45ec[_0x802501(0x77)](_0x1b69c1,null);});});});}async['getMsgByShortId'](_0xdbc088){const _0x2ab2b4=_0x3411b9;if(this[_0x2ab2b4(0xe7)][_0x2ab2b4(0xbe)](_0xdbc088))return this[_0x2ab2b4(0xe7)][_0x2ab2b4(0x7a)](_0xdbc088);const _0x381d9d=_0x2ab2b4(0xc1);return this[_0x2ab2b4(0xec)](_0x381d9d,[_0xdbc088]);}async[_0x3411b9(0xc8)](_0x5b0b5b){const _0x5b6e85=_0x3411b9,_0x5356bd={'wXNOX':'SELECT\x20*\x20FROM\x20msgs\x20WHERE\x20longId\x20=\x20?'};if(this[_0x5b6e85(0xe7)][_0x5b6e85(0xbe)](_0x5b0b5b))return this['msgCache'][_0x5b6e85(0x7a)](_0x5b0b5b);return this[_0x5b6e85(0xec)](_0x5356bd['wXNOX'],[_0x5b0b5b]);}async[_0x3411b9(0xd4)](_0x3f53a9,_0x44f9cb){const _0x19898b=_0x3411b9,_0x41f64e={'BaAHO':_0x19898b(0x89)},_0x1cd8a1=_0x41f64e[_0x19898b(0x87)];return this[_0x19898b(0xec)](_0x1cd8a1,[_0x3f53a9,_0x44f9cb]);}async[_0x3411b9(0xe8)](_0x4a0580,_0x5d134c=!![]){const _0x294dc9=_0x3411b9,_0x2866e5={'hUtJu':function(_0x20e8fd,_0x31be90,_0x51268b){return _0x20e8fd(_0x31be90,_0x51268b);},'waggf':_0x294dc9(0xf4),'fNWIr':function(_0x2e40f2,_0x3bb70d){return _0x2e40f2===_0x3bb70d;},'yQiKj':_0x294dc9(0xf1),'jzSLp':function(_0x122887,_0x1190fd){return _0x122887(_0x1190fd);}},_0x40164f=await this[_0x294dc9(0xc8)](_0x4a0580[_0x294dc9(0xb0)]);if(_0x40164f){if(_0x5d134c)this[_0x294dc9(0x85)](_0x4a0580)[_0x294dc9(0xe2)]();return _0x40164f['id'];}const _0x5acad2=this['db'][_0x294dc9(0xb6)](_0x294dc9(0xad)),_0x59759d=++this['globalMsgShortId'];return _0x4a0580['id']=_0x59759d,_0x2866e5[_0x294dc9(0xd8)](logDebug,_0x294dc9(0xa2)+_0x4a0580[_0x294dc9(0xb0)]+_0x294dc9(0xb7)+_0x4a0580['id']),this[_0x294dc9(0xe7)][_0x294dc9(0x9d)](_0x59759d,_0x4a0580),this['msgCache'][_0x294dc9(0x9d)](_0x4a0580['msgId'],_0x4a0580),_0x5acad2['run'](this[_0x294dc9(0xa1)],_0x4a0580[_0x294dc9(0xb0)],_0x4a0580[_0x294dc9(0xea)][_0x294dc9(0x78)](),_0x4a0580[_0x294dc9(0xa6)],_0x4a0580[_0x294dc9(0xb5)],_0x23a7c6=>{const _0x50d4ea=_0x294dc9,_0x5b7b26={'IEDJF':function(_0x53d3bb,_0x2cd66e,_0x3424dd){const _0x72e0a7=_0xd379;return _0x2866e5[_0x72e0a7(0x7d)](_0x53d3bb,_0x2cd66e,_0x3424dd);},'aJSmf':_0x2866e5[_0x50d4ea(0xab)]};_0x23a7c6&&(_0x2866e5[_0x50d4ea(0x82)](_0x23a7c6[_0x50d4ea(0xcd)],0x13)?this[_0x50d4ea(0xc8)](_0x4a0580[_0x50d4ea(0xb0)])[_0x50d4ea(0xe2)](_0x430452=>{const _0x2dda2c=_0x50d4ea;_0x430452?(this[_0x2dda2c(0xe7)][_0x2dda2c(0x9d)](_0x59759d,_0x430452),this[_0x2dda2c(0xe7)][_0x2dda2c(0x9d)](_0x430452[_0x2dda2c(0xb0)],_0x430452)):_0x5b7b26[_0x2dda2c(0x79)](logError,_0x5b7b26[_0x2dda2c(0xe1)],_0x23a7c6);})[_0x50d4ea(0x7c)](_0x22fc57=>logError('db\x20getMsgByLongId\x20error',_0x22fc57)):_0x2866e5['hUtJu'](logError,_0x2866e5[_0x50d4ea(0xa7)],_0x23a7c6));}),_0x59759d;}async[_0x3411b9(0x85)](_0x2f2d76){const _0x3d4742=_0x3411b9,_0x5dc80d={'cknmA':'updateMsg\x20db\x20error','OFYvs':function(_0x2a98a9,_0x423b2d){return _0x2a98a9(_0x423b2d);}},_0x497c18=this['msgCache']['get'](_0x2f2d76[_0x3d4742(0xb0)]);_0x497c18&&Object['assign'](_0x497c18,_0x2f2d76);_0x5dc80d[_0x3d4742(0x8a)](logDebug,'更新消息,\x20shortId:'+_0x2f2d76['id']+',\x20seq:\x20'+_0x2f2d76[_0x3d4742(0xea)]+_0x3d4742(0xe3)+_0x2f2d76[_0x3d4742(0xb0)]);const _0x5f2601=this['db'][_0x3d4742(0xb6)]('UPDATE\x20msgs\x20SET\x20seq=?\x20WHERE\x20longId=?');_0x5f2601[_0x3d4742(0xd5)](_0x2f2d76['msgSeq'],_0x2f2d76[_0x3d4742(0xb0)],_0x53c02b=>{_0x53c02b&&logError(_0x5dc80d['cknmA'],_0x53c02b);});}async[_0x3411b9(0xaf)](_0x34e7a9){const _0x10bfc2=_0x3411b9,_0x27fd49={'ZttiX':_0x10bfc2(0x84),'dmlcg':function(_0x935d31,_0x42f9a5){return _0x935d31(_0x42f9a5);}},_0x338597=this['db'][_0x10bfc2(0xb6)](_0x10bfc2(0xb1));return new Promise((_0x5581f1,_0x15e650)=>{const _0x317498=_0x10bfc2;_0x338597[_0x317498(0xd5)](_0x34e7a9[_0x317498(0x83)],_0x34e7a9[_0x317498(0x98)],_0x34e7a9[_0x317498(0xf7)],_0x34e7a9['size'],_0x34e7a9[_0x317498(0xc9)],_0x34e7a9[_0x317498(0xc2)],JSON[_0x317498(0xbc)](_0x34e7a9['element']),_0x34e7a9[_0x317498(0xcb)],_0x34e7a9[_0x317498(0xb0)],function(_0x4d4eed){_0x4d4eed&&(logError(_0x27fd49['ZttiX'],_0x4d4eed),_0x27fd49['dmlcg'](_0x15e650,_0x4d4eed)),_0x5581f1(null);});});}async[_0x3411b9(0xd9)](_0x4b51c0,_0x2cfd48){const _0x43cbe9=_0x3411b9,_0x149bb4={'qpYpL':function(_0x23f9fb,_0x11e747,_0x46f411){return _0x23f9fb(_0x11e747,_0x46f411);},'gmqMS':function(_0x3a97f8,_0x28d691){return _0x3a97f8(_0x28d691);}},_0x18a310=this['db'][_0x43cbe9(0xb6)](_0x4b51c0);return new Promise((_0xc920c2,_0x1b5013)=>{const _0x185517=_0x43cbe9,_0x27a5d7={'rmmZd':function(_0x2cec03,_0x353fb0,_0x298abd){const _0x3f67af=_0xd379;return _0x149bb4[_0x3f67af(0xa5)](_0x2cec03,_0x353fb0,_0x298abd);},'WASZS':function(_0x4f3143,_0x1b7c83){return _0x4f3143(_0x1b7c83);},'HWZGm':function(_0x25a671,_0x243d54){const _0x239110=_0xd379;return _0x149bb4[_0x239110(0xd7)](_0x25a671,_0x243d54);}};_0x18a310[_0x185517(0x7a)](..._0x2cfd48,(_0x50cecf,_0x335ef3)=>{const _0x356a6e=_0x185517;_0x50cecf&&(_0x27a5d7['rmmZd'](logError,_0x356a6e(0xf0),_0x50cecf),_0x27a5d7[_0x356a6e(0x93)](_0x1b5013,_0x50cecf)),_0x335ef3&&(_0x335ef3[_0x356a6e(0xbb)]=JSON[_0x356a6e(0xb9)](_0x335ef3[_0x356a6e(0xbb)])),_0x27a5d7[_0x356a6e(0xeb)](_0xc920c2,_0x335ef3);});});}async['getFileCacheByName'](_0x416737){const _0x4433f7=_0x3411b9,_0x34c2e8={'BRbGz':'SELECT\x20*\x20FROM\x20files\x20WHERE\x20name\x20=\x20?'};return this['getFileCache'](_0x34c2e8[_0x4433f7(0xba)],[_0x416737]);}async[_0x3411b9(0xa8)](_0xc02814){const _0x3aa81c=_0x3411b9;return this[_0x3aa81c(0xd9)]('SELECT\x20*\x20FROM\x20files\x20WHERE\x20uuid\x20=\x20?',[_0xc02814]);}async[_0x3411b9(0xd3)](_0x6c393a){const _0x149924=_0x3411b9,_0x49254e={'UZExx':function(_0x5c2dec,_0x3ebc97){return _0x5c2dec(_0x3ebc97);}},_0x57a9ad=this['db'][_0x149924(0xb6)]('UPDATE\x20files\x20SET\x20path\x20=\x20?,\x20url\x20=\x20?\x20WHERE\x20uuid\x20=\x20?');return new Promise((_0x3e8af0,_0x1c8b0c)=>{const _0x152f6e=_0x149924,_0x2bb62c={'agdNB':function(_0x466868,_0x3ca8a2){const _0x2ad0f8=_0xd379;return _0x49254e[_0x2ad0f8(0x81)](_0x466868,_0x3ca8a2);}};_0x57a9ad[_0x152f6e(0xd5)](_0x6c393a[_0x152f6e(0x98)],_0x6c393a[_0x152f6e(0xf7)],_0x6c393a[_0x152f6e(0xc9)],function(_0x1dbf0d){const _0x3c0c0e=_0x152f6e;_0x1dbf0d&&(logError(_0x3c0c0e(0xf2),_0x1dbf0d),_0x2bb62c['agdNB'](_0x1c8b0c,_0x1dbf0d)),_0x2bb62c[_0x3c0c0e(0xbd)](_0x3e8af0,null);});});}async[_0x3411b9(0xde)](){const _0x7ccd0d=_0x3411b9,_0x5eb636={'BMzLC':function(_0x3bf704,_0x3c29e4,_0x5c5889){return _0x3bf704(_0x3c29e4,_0x5c5889);},'BmJNW':function(_0x1bb6c4,_0x5d869f){return _0x1bb6c4(_0x5d869f);},'bwmjM':function(_0x63d213,_0x359e26){return _0x63d213(_0x359e26);},'nUYWx':_0x7ccd0d(0xc7)},_0x472a9e=_0x5eb636[_0x7ccd0d(0xbf)];return new Promise((_0x2ca814,_0x2c1719)=>{const _0x126f39=_0x7ccd0d;this['db'][_0x126f39(0x8d)](_0x472a9e,(_0xc987bd,_0x11ba15)=>{const _0x404df7=_0x126f39;_0xc987bd&&(_0x5eb636['BMzLC'](logError,'db\x20could\x20not\x20get\x20temp\x20uin\x20map',_0xc987bd),_0x5eb636[_0x404df7(0x7f)](_0x2c1719,_0xc987bd));const _0x20134b={};_0x11ba15[_0x404df7(0x8e)](_0x175275=>{const _0x58c9e6=_0x404df7;_0x20134b[_0x175275['uin']]=_0x175275[_0x58c9e6(0xa4)];}),_0x5eb636[_0x404df7(0x73)](_0x2ca814,_0x20134b);});});}async[_0x3411b9(0xf6)](_0x5a7d56){const _0x2bbdf5=_0x3411b9,_0x4d458c={'FWoJw':function(_0x59a68b,_0x59e35e,_0x497acf){return _0x59a68b(_0x59e35e,_0x497acf);},'xWXGt':function(_0xbb5a3d,_0x1dd540){return _0xbb5a3d(_0x1dd540);},'ivKGA':_0x2bbdf5(0x9b)},_0x3de6cb=_0x4d458c[_0x2bbdf5(0xda)];return new Promise((_0x74dd73,_0x4192cc)=>{const _0x39aafd=_0x2bbdf5,_0x237847={'bkVSn':function(_0x2de1ec,_0x3c7279,_0x213009){const _0x300be7=_0xd379;return _0x4d458c[_0x300be7(0x7b)](_0x2de1ec,_0x3c7279,_0x213009);},'MyCDD':_0x39aafd(0x96),'gEkTM':function(_0x41a9a9,_0x16bb3e){return _0x4d458c['xWXGt'](_0x41a9a9,_0x16bb3e);}};this['db'][_0x39aafd(0x7a)](_0x3de6cb,[_0x5a7d56],(_0x1cc734,_0x45b2a1)=>{const _0x30de05=_0x39aafd;_0x1cc734&&(_0x237847[_0x30de05(0xce)](logError,_0x237847['MyCDD'],_0x1cc734),_0x237847[_0x30de05(0xe9)](_0x4192cc,_0x1cc734)),_0x74dd73(_0x45b2a1?.[_0x30de05(0xa4)]);});});}async[_0x3411b9(0x9c)](_0x69b894,_0xc16ff9){const _0x387ef9=_0x3411b9,_0xd4041e={'fQjIT':function(_0x191562,_0x3169b9,_0x46b2e0){return _0x191562(_0x3169b9,_0x46b2e0);},'ULObq':_0x387ef9(0x86),'arNbw':function(_0x3dc97d,_0x2c97e3){return _0x3dc97d(_0x2c97e3);}},_0x1308d3=await this['getUidByTempUin'](_0x69b894);if(!_0x1308d3){const _0x381a1e=this['db'][_0x387ef9(0xb6)]('INSERT\x20INTO\x20temp_uins\x20(uin,\x20uid)\x20VALUES\x20(?,\x20?)');return new Promise((_0x2eb4b9,_0x1c35bc)=>{const _0x2db946=_0x387ef9,_0x2ab30f={'csNHF':function(_0x4d6208,_0x511527,_0x5058cd){const _0x4a201c=_0xd379;return _0xd4041e[_0x4a201c(0x7e)](_0x4d6208,_0x511527,_0x5058cd);},'rkMKN':_0xd4041e[_0x2db946(0xf3)],'rnAvJ':function(_0x2de341,_0x521bc2){const _0x2c2c9a=_0x2db946;return _0xd4041e[_0x2c2c9a(0xd6)](_0x2de341,_0x521bc2);}};_0x381a1e[_0x2db946(0xd5)](_0x69b894,_0xc16ff9,function(_0x3fd615){const _0xd07c0a=_0x2db946;_0x3fd615&&(_0x2ab30f[_0xd07c0a(0xd1)](logError,_0x2ab30f['rkMKN'],_0x3fd615),_0x2ab30f['rnAvJ'](_0x1c35bc,_0x3fd615)),_0x2ab30f[_0xd07c0a(0xee)](_0x2eb4b9,null);});});}}}export const dbUtil=new DBUtil();